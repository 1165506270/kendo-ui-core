<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Flickr Photos Viewer</title>
<link href="Site.css" rel="stylesheet" type="text/css" />
<script src="md5.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="listview.js"></script>
<body>

<div class="wrap">
<header class="floatWrap">
<h1>Aero<strong>Viewr</strong></h1>
<!--<a href="#" class="signin">Sign in</a>-->
<span class="signin">Signed in as <a href="#" ><em>MyUser</em></a></span>
<ul><li><input type="text" id="searchBox"/></li><li><a href="#" class="p-icon i-search">Search</a></li><li><a href="#" class="p-icon i-help">Help</a></li></ul>
</header>

<section class="photo">
<img id="bigPhoto" alt="big photo" /></section>
<section class="main">

    <h1>Nature Set <span class="by-user">by <a href="#"><em>SomeUser</em></a></span></h1>
    <div class="thumbsWrap"><ul id="mainPhotos"></ul></div>
</section>

<section class="footer">
<a href="#" class="slideshow"><span class="p-border-big p-icon i-slideshow"></span><em>Slideshow</em></a>
<ul id="footerPhotos"></ul>
<a href="#" class="uploadphotos"><span class="p-border-big p-icon i-uploadphotos"></span><em>Upload photos</em></a>
</section>
</div>

<script type="text/javascript">

$(document).ready(function(){

    var app = {
        key: 'ea73824c4e27a137b7597fc3ffb3ba98',
        secret: '2e767957c686dd30',
        frob: "72157626154487045-2db02b0fc7fbf6de-60630644"
    };

    var auth = {
        token:'72157626154487043-7dfd951a1ede12fa' //write
    };

    var service = "http://api.flickr.com/services/rest/";

    var mainPhotos = new window.listview({element: $("#mainPhotos"), template: "<img src='http://farm<#=farm#>.static.flickr.com/<#=server#>/<#=id#>_<#=secret#>_s.jpg'>", onItemBound: itemBound});
    var footerPhotos = new window.listview({element: $("#footerPhotos"), template: "<img src='http://farm<#=farm#>.static.flickr.com/<#=server#>/<#=id#>_<#=secret#>_s.jpg'>", onItemBound: itemBound});

    function itemBound(e){
        e.item
         .find("img")
         .hide()
         .bind({
             load: function(e){
                $(this).fadeIn(1000);
             },
            click: function(e){
                $("#bigPhoto").attr("src", $(this).attr('src').replace("_s", ""));
            }
        });
    }

    $(".i-search").click(function(e){
        e.preventDefault();
        var params = {
            nojsoncallback : 1,
            text: $("#searchBox").val(),
            extras: "owner_name,tags",
            per_page: 10
        }
        var url = buildAuthMethod(service, "flickr.photos.search", params);

        $.get(url, function(data){
            try {
                photos = eval('(' + data + ')').photos;
               // var photosContainer = $("#photos");
                var photoList = photos.photo;

                //var bottomText = "page: " + photos.page + " of " + photos.pages + ", " + photos.perpage + " from " + photos.total + " photos per page.";

                //$("<p></p>").html(bottomText).appendTo(photosContainer);
                mainPhotos.bind(photoList);
               footerPhotos.bind(photoList);
            } catch (e) {
                alert('Error! The requested URL did not return JSON.');
                return;
            }
        });

    });

    function getThumbnailURL(photo){
        return 'http://farm' + photo.farm + '.' + 'static.flickr.com/' + photo.server + '/' + photo.id + '_' + photo.secret + '_s.jpg';
    }

    function buildAuthMethod(service, method, params) {
        params = params || {};
        params["method"] = method;
        params["api_key"] = app.key;
        params["auth_token"] = auth.token;
        params["format"] = "json";
        params["api_sig"] = getApiSig(app.secret, params);

        return service + "?" + $.param(params);
    }

    function getApiSig(secret, params){
        var concatString = "",
            keys = [];
            
        for (var key in params) {
          if (params.hasOwnProperty(key)) {
            keys.push(key);
          }
        }

        keys.sort ();
        concatString += secret
        for (var i = 0; i < keys.length; i++) {
          key = keys[i];
          concatString += key + params[key];
        }
        return hex_md5(concatString);
    }
});
</script>

</body>
</html>

