#!/usr/bin/env bash

export FIREFOX_PROFILE="ci"
export CHROME_USER_DATA_DIR="/tmp/ci"
export NODE_PATH=.:/usr/lib/node_modules

# clear Google Cache
rm -rf ~/.cache/google-chrome/*

jake merge-scripts

xvfb-run -a sh -c 'tests/tests.js tests/ 8884 1>test-results.xml'

# Update docs submodule
sh -c 'cd docs && git fetch && git reset --hard origin/master'
jake vsdoc > /tmp/vsdoc.js && /usr/lib/node_modules/jshint/bin/hint /tmp/vsdoc.js
