#!upstart
description "node.js server for the <%= @app[:name] %> application"
author      "Kendo UI Team"

start on startup
stop on shutdown

expect fork

env APPLICATION_DIRECTORY="/var/www/<%= @app[:name] %>-staging"
env LOG="/var/log/<%= @app[:name] %>-staging.sys.log"
env NODE_ENV="production"
env NODE_PATH="/usr/lib/node_modules"
env APIKEY="zqFMFiXOMLAxq9Or"
env EDITORIGIN="http://kendobuild.telerik.com/dojo-staging"
env RUNORIGIN="http://kendobuild/dojo-runner-staging"
env PORT="<%= @app[:port] %>"
env RUNNER="<%= @app[:name] == 'dojo-runner' ? 'true' : 'false' %>"

script
    export HOME="/root"

    exec /usr/bin/forever --watch --sourceDir $APPLICATION_DIRECTORY -a -l $LOG start app.js >> $LOG
end script

pre-start script
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Starting" >> $LOG
end script

pre-stop script
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Stopping" >> $LOG
    exec /usr/bin/forever stop app.js >> $LOG
end script
