<!DOCTYPE html>
<html>
    <head>
        <script src="../src/jquery.js"></script>
        <script src="../src/kendo.core.js"></script>
        <script src="script-resolver.js"></script>
        <link rel="stylesheet" href="../styles/kendo.common.css" />
        <link rel="stylesheet" href="../styles/kendo.blueopal.css" />
        <style type="text/css">
            .checkbox {
                background: url(images/checkboxes.gif) no-repeat 0 -13px;
                width: 13px;
                height: 13px;
                border: none;
                display: inline-block;
                overflow: hidden;
            }

            .checkbox:hover {
                background-position: 0 -26px;
            }

            .implicit {
                background-position: 0 -52px;
            }

            .implicit:hover {
                background-position: 0 -65px;
            }

            .explicit {
                background-position: 0 -91px;
            }

            .explicit:hover {
                background-position: 0 -104px;
            }
        </style>
        <script type="text/javascript">
            var kendoConfig = [
                // Framework --------------------------------------------------
                {
                    id: "core",
                    name: "Core",
                    category: "Framework",
                    source: "kendo.core.js"
                }, {
                    id: "fx",
                    name: "Effects",
                    category: "Framework",
                    source: "kendo.fx.js",
                    depends: [ "core" ]
                }, {
                    id: "odata",
                    name: "OData",
                    category: "Framework",
                    source: "kendo.data.odata.js",
                    depends: [ "core" ],
                    hidden: true
                }, {
                    id: "xml",
                    name: "XML",
                    category: "Framework",
                    source: "kendo.data.xml.js",
                    depends: [ "core" ],
                    hidden: true
                }, {
                    id: "model",
                    name: "Model",
                    category: "Framework",
                    source: "kendo.model.js",
                    depends: [ "core" ],
                    hidden: true
                }, {
                    id: "data",
                    name: "Data source",
                    category: "Framework",
                    source: "kendo.data.js",
                    depends: [ "core", "model" ],
                    features: [{
                            id: "data-odata",
                            name: "OData",
                            depends: [ "odata" ]
                        }, {
                            id: "data-XML",
                            name: "XML",
                            depends: [ "xml" ]
                        }
                    ]
                }, {
                    id: "draganddrop",
                    name: "Drag & drop",
                    category: "Framework",
                    source: "kendo.draganddrop.js",
                    depends: [ "core" ]
                }, {
                    id: "groupable",
                    name: "Groupable",
                    category: "Framework",
                    source: "kendo.groupable.js",
                    depends: [ "core", "draganddrop" ],
                    advanced: true
                }, {
                    id: "resizable",
                    name: "Resizable",
                    category: "Framework",
                    source: "kendo.resizable.js",
                    depends: [ "core", "draganddrop" ],
                    advanced: true
                }, {
                    id: "sortable",
                    name: "Sortable",
                    category: "Framework",
                    source: "kendo.sortable.js",
                    depends: [ "data" ],
                    advanced: true
                }, {
                    id: "selectable",
                    name: "Selectable",
                    category: "Framework",
                    source: "kendo.selectable.js",
                    depends: [ "core" ],
                    advanced: true
                }, {
                    id: "scroller",
                    name: "Scroller",
                    category: "Framework",
                    source: "kendo.scroller.js",
                    depends: [ "fx" ]
                }, {
                    id: "pageable",
                    name: "Pageable",
                    category: "Framework",
                    source: "kendo.pageable.js",
                    depends: [ "data" ],
                    advanced: true
                }, {
                    id: "popup",
                    name: "Pop-up",
                    category: "Framework",
                    source: "kendo.popup.js",
                    depends: [ "fx" ],
                    advanced: true
                }, {
                    id: "list",
                    name: "List",
                    category: "Framework",
                    source: "kendo.list.js",
                    depends: [ "core" ]
                },

                // Widgets ----------------------------------------------------
                {
                    id: "autocomplete",
                    name: "AutoComplete",
                    category: "Widgets",
                    source: "kendo.autocomplete.js",
                    depends: [ "data", "list" ]
                }, {
                    id: "calendar",
                    name: "Calendar",
                    category: "Widgets",
                    source: "kendo.calendar.js",
                    depends: [ "fx" ]
                }, {
                    id: "chart",
                    name: "Chart",
                    category: "Widgets",
                    source: "kendo.chart.js",
                    depends: [ "data" ]
                }, {
                    id: "combobox",
                    name: "ComboBox",
                    category: "Widgets",
                    source: "kendo.combobox.js",
                    depends: [ "data", "list" ]
                }, {
                    id: "datepicker",
                    name: "DatePicker",
                    category: "Widgets",
                    source: "kendo.datepicker.js",
                    depends: [ "calendar", "popup" ]
                }, {
                    id: "dropdownlist",
                    name: "DropDownList",
                    category: "Widgets",
                    source: "kendo.dropdownlist.js",
                    depends: [ "data", "list" ]
                }, {
                    id: "grid",
                    name: "Grid",
                    category: "Widgets",
                    source: "kendo.grid.js",
                    depends: [ "data" ],
                    features: [{
                            id: "grid-sorting",
                            name: "Sorting",
                            depends: [ "sortable" ]
                        }, {
                            id: "grid-paging",
                            name: "Paging",
                            depends: [ "pageable" ]
                        }, {
                            id: "grid-selection",
                            name: "Selection",
                            depends: [ "selectable" ]
                    }]
                }, {
                    id: "menu",
                    name: "Menu",
                    category: "Widgets",
                    source: "kendo.menu.js",
                    depends: [ "data", "popup" ]
                }, {
                    id: "panelbar",
                    name: "PanelBar",
                    category: "Widgets",
                    source: "kendo.panelbar.js",
                    depends: [ "data", "fx" ]
                }, {
                    id: "slider",
                    name: "Slider",
                    category: "Widgets",
                    source: "kendo.slider.js",
                    depends: [ "draganddrop" ]
                }, {
                    id: "splitter",
                    name: "Splitter",
                    category: "Widgets",
                    source: "kendo.splitter.js",
                    depends: [ "resizable" ]
                }, {
                    id: "tabstrip",
                    name: "TabStrip",
                    category: "Widgets",
                    source: "kendo.tabstrip.js",
                    depends: [ "data", "fx" ]
                }, {
                    id: "treeview",
                    name: "TreeView",
                    category: "Widgets",
                    source: "kendo.treeview.js",
                    depends: [ "data", "draganddrop" ]
                }, {
                    id: "upload",
                    name: "Upload",
                    category: "Widgets",
                    source: "kendo.upload.js",
                    depends: [ "core" ]
                }, {
                    id: "window",
                    name: "Window",
                    category: "Widgets",
                    source: "kendo.window.js",
                    depends: [ "fx", "draganddrop" ]
                }
            ];
        </script>
    </head>
    <body>
        <div id="configurator"></div>

        <script id="categoryTemplate" type="text/x-kendo-tmpl">
            <h2>#= data #</h2>
            <ul class="category" data-id="#= data #">
                #= renderComponents(data) #
            </ul>
        </script>

        <script id="componentTemplate" type="text/x-kendo-tmpl">
            <li class="component" data-id="#= id #">
                <span class="checkbox"></span>
                <span class="name">#= name #</span>
                # if (data.features) { #
                    <ul class="features">
                        #= renderFeatures(data) #
                    </ul>
                # } #
            </li>
        </script>

        <script id="featureTemplate" type="text/x-kendo-tmpl">
            <li class="feature" data-id="#= id #">
                <span class="checkbox"></span>
                <span class="name">#= name #</span>
            </li>
        </script>

        <script type="text/javascript">
            var resolver,
                categoryTemplate,
                componentTemplate,
                featureTemplate,
                showAdvanced = false;

            $(document).ready(function() {
                resolver = new ScriptResolver(kendoConfig);
                categoryTemplate = template("categoryTemplate");
                componentTemplate = template("componentTemplate");
                featureTemplate = template("featureTemplate");

                renderCategories();

                $("#configurator .checkbox").bind("click", function() {
                    var checkbox = $(this);

                    if (checkbox.hasClass("explicit")) {
                        checkbox.removeClass("explicit");
                    } else {
                        checkbox.addClass("explicit");
                    }

                    updateDependencies();
                });
            });

            function renderCategories() {
                var categories = {};
                $.each(kendoConfig, function(i, component) {
                    categories[component.category] = true;
                });

                for (var category in categories) {
                    $("#configurator").append(categoryTemplate(category));
                }
            }

            function renderComponents(category) {
                var result = "",
                    visible;
                $.each(kendoConfig, function(i, component) {
                    var visible = !component.hidden &&
                        (!component.advanced ||
                            (showAdvanced && component.advanced)
                        );

                    if (visible && component.category === category) {
                        result += componentTemplate(component);
                    }
                });

                return result;
            }

            function renderFeatures(component) {
                var result = "";
                $.each(component.features, function(i, feature) {
                    result += featureTemplate(feature);
                });

                return result;
            }

            function updateDependencies() {
                $("#configurator .checkbox").removeClass("implicit");

                resolver.reset();

                $("#configurator .component").each(function() {
                    var component = $(this);
                    if (required(component)) {
                        var features = $.map(component.find(".feature"), function(feature) {
                            if (required(feature)) {
                                return $(feature).data("id");
                            }
                        });

                        resolver.addComponent(component.data("id"), features);
                    }
                });

                $("#configurator .component, #configurator .feature").each(function() {
                    var checkbox = $("> .checkbox", this);
                    if (resolver.resolved.indexOf($(this).data("id")) > -1) {
                        if (!checkbox.hasClass("explicit")) {
                            checkbox.addClass("implicit");
                        }
                    }
                });

                console.log(resolver.scripts);
            }

            function required(element) {
                return $(element).find(".implicit, .explicit").length > 0;
            }

            function template(id) {
                return kendo.template($("#" + id).html())
            }

            function capitalize(word) {
                return word.charAt(0).toUpperCase() + word.slice(1);
            }
        </script>
    </body>
</html>
