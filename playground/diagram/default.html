<!DOCTYPE html>
<!--Note from Swa; you can simply open this HTML page in the browser and the tests will run.-->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>JS Diagram </title>
    <style type="text/css">
        html, body, #mainDiv
        {
            height: 100%;
            overflow: hidden;
        }

        #canvasDiv
        {
            float: left;
        }

        #canvas
        {
            height: 100%;
        }

        input.diagramCommandBtn
        {
            border: 1px gray solid;
            background-color: gray;
            color: white;
            cursor: pointer;
        }

        #toolBoxDiv
        {
            float: left;
        }

        .shape
        {
            float: left;
            padding: 10px;
            cursor: pointer;
        }

            .shape:hover
            {
                background-color: rgba(0,0,0,0.25);
            }

            .shape svg
            {
                width: 100px;
                height: 100px;
            }

            .shape h3
            {
                padding: 5px;
                font-size: .9em;
                overflow: hidden;
                font-weight: normal;
                max-width: 100px;
                text-transform: uppercase;
            }

        h2
        {
            margin: 10px;
        }

        #splitter
        {
            height: 90%;
        }

        #toolbarDiv
        {
        }
    </style>

    <link href="../../styles/web/kendo.common.css" rel="stylesheet"></script>
    <link href="../../styles/web/kendo.default.css" rel="stylesheet"></script>

    <script src="../../src/jquery.js"></script>
    <script src="../../src/kendo.core.js"></script>
    <script src="../../src/kendo.data.js"></script>
    <script src="../../src/kendo.dataviz.core.js"></script>
    <script src="../../src/kendo.userevents.js"></script>
    <script src="../../src/kendo.draganddrop.js"></script>
    <script src="../../src/kendo.slider.js"></script>
    <script src="../../src/kendo.resizable.js"></script>
    <script src="../../src/kendo.splitter.js"></script>
    <script src="../../src/kendo.listview.js"></script>

    <script src="../../src/kendo.diagram.math.js"></script>
    <script src="../../src/kendo.diagram.svg.js"></script>
    <script src="../../src/kendo.diagram.services.js"></script>
    <script src="../../src/kendo.diagram.extensions.js"></script>
    <script src="../../src/kendo.diagram.dom.js"></script>
</head>
<body>
    <div id="mainDiv">
        <div id="toolbarDiv">
            <input type="button" class="diagramCommandBtn" id="undoButton" title="Undo (CTRL+Z)" value="Undo" />
            <input type="button" class="diagramCommandBtn" id="redoButton" title="Redo (CTRL+Y)" value="Redo" />
            <input type="button" class="diagramCommandBtn" id="deleteButton" title="Delete (DEL)" value="Delete" />
            <input type="button" class="diagramCommandBtn" id="selectAllButton" title="Select All (CTRL+A)" value="SelectAll" />
            rotate selection:<input id="rotateShape" />
        </div>
        <div id="splitter">
            <div id="toolBoxDiv">
                <!--<h2>Shapes</h2>-->
                <div id="toolBox"></div>
            </div>
            <div id="canvasDiv">
                <!--<h2>Diagram</h2>-->
                <div id="canvas"></div>
            </div>
        </div>
    </div>
</body>
<script type="text/x-kendo-tmpl" id="template">
    <div class="shape">        
        <svg><path d="#=data#" fill="#=background#"/></svg>            
        <h3>#:name#</h3>
    </div>
</script>

<script>
    var shapesSource = [
        {
            name: "Rectangle",
            data: "m0,0 L0,100 L100,100 L100,0z",
            background: "steelblue"
        },
        {
            name: "Circle",
            data: "Circle",
            background: "steelblue"
        },
        {
            name: "Triangle",
            data: "m0,100 L100,100 L50,0z",
            background: "steelblue"
        },
        {
            name: "Sequential Data",
            data: "m50.21875,97.4375l0,0c-26.35457,0 -47.71875,-21.25185 -47.71875,-47.46875l0,0c0,-26.21678 21.36418,-47.46875 47.71875,-47.46875l0,0c12.65584,0 24.79359,5.00155 33.74218,13.90339c8.94862,8.90154 13.97657,20.97617 13.97657,33.56536l0,0c0,12.58895 -5.02795,24.66367 -13.97657,33.56542l13.97657,0l0,13.90333l-47.71875,0z",
            background: "steelblue"
        },
        {
            name: "Data",
            data: "m2.5,97.70305l19.07013,-95.20305l76.27361,0l-19.0702,95.20305l-76.27354,0z",
            background: "steelblue"
        },
        {
            name: "Wave",
            data: "m2.5,15.5967c31.68356,-45.3672 63.37309,45.3642 95.05661,0l0,81.65914c-31.68353,45.36404 -63.37305,-45.36732 -95.05661,0l0,-81.65914z",
            background: "steelblue"
        }
    ];
    var Shapes = {
        Rectangle: {
            data: "Rectangle"
        },
        Triangle: {
            data: "m0,100 L100,100 L50,0z"
        },
        SequentialData: {
            data: "m50.21875,97.4375l0,0c-26.35457,0 -47.71875,-21.25185 -47.71875,-47.46875l0,0c0,-26.21678 21.36418,-47.46875 47.71875,-47.46875l0,0c12.65584,0 24.79359,5.00155 33.74218,13.90339c8.94862,8.90154 13.97657,20.97617 13.97657,33.56536l0,0c0,12.58895 -5.02795,24.66367 -13.97657,33.56542l13.97657,0l0,13.90333l-47.71875,0z"
        },
        Data: {
            data: "m2.5,97.70305l19.07013,-95.20305l76.27361,0l-19.0702,95.20305l-76.27354,0z"
        },
        Wave: {
            data: "m2.5,15.5967c31.68356,-45.3672 63.37309,45.3642 95.05661,0l0,81.65914c-31.68353,45.36404 -63.37305,-45.36732 -95.05661,0l0,-81.65914z",            
        }
    };

    $(function () {
        $("#canvas").kendoDiagram();
        var diagram = $("#canvas").data("kendoDiagram"),
            kendo = window.kendo,
            Point = kendo.diagram.Point;

        var seq = Shapes.SequentialData;
        seq.text = "Sequential Data.";
        var shape1 = diagram.addShape(new Point(100, 100), seq);
        shape2 = diagram.addShape(new Point(100, 400), Shapes.Wave);
        shape2.content("content");

        var shape3 = diagram.addShape(new Point(370, 400), Shapes.Rectangle);
        var shape4 = diagram.addShape(new Point(400, 200), Shapes.Triangle);
        var topCor = shape2.getConnector("Top");
        var topCor2 = shape3.getConnector("Top");
        var bottomCor = shape1.getConnector("Bottom");
        var bottomCor2 = shape4.getConnector("Top");
        var bottomCor3 = shape4.getConnector("Bottom");
        diagram.connect(bottomCor, topCor);
        var con2 = diagram.connect(bottomCor, topCor2);
        diagram.connect(bottomCor, bottomCor2);
        diagram.connect(topCor, bottomCor2);
        diagram.connect(bottomCor, bottomCor3);
        diagram.connect(new Point(100, 200), new Point(400, 400));
        diagram.connect(new Point(400, 100), new Point(100, 400));
        con2.content("Connection Label");

        // Org Chart also...
        var s1 = diagram.addShape(new Point(800, 0), Shapes.Rectangle);

        var s2 = diagram.addShape(new Point(600, 200), Shapes.Rectangle);
        var s3 = diagram.addShape(new Point(1000, 200), Shapes.Rectangle);

        var s4 = diagram.addShape(new Point(600, 400), Shapes.Rectangle);
        var s5 = diagram.addShape(new Point(1000, 400), Shapes.Rectangle);

        diagram.connect(s1, s2);
        diagram.connect(s1, s3);
        diagram.connect(s2, s4);
        diagram.connect(s3, s5);

        $("#canvas").kendoDropTarget({
            drop: function (e) {
                var item = e.draggable.hint.data("data"),
                    pos = e.draggable.hintOffset,
                    dp = diagram.documentToCanvasPoint(new Point(pos.left, pos.top)),
                    normal = diagram._normalizePointZoom(dp.minus(diagram.pan()));

                diagram.addShape(normal, item);
            }
        });

        var list = $("#toolBox").kendoListView({
            dataSource: {
                data: shapesSource
            },
            template: kendo.template($("#template").html()),
            //selectable: "single"
        });

        list.kendoDraggable({
            filter: "div[role=option]",
            hint: function (row) {
                var svg = row.children("svg"),
                    list = $("#toolBox").data("kendoListView"),
                    item = list.dataSource.getByUid(row.data().uid);
                svg = svg.clone();
                svg.data("data", item);
                return svg;
            }
        });

        $("#splitter").kendoSplitter({
            panes: [
                { collapsible: false },
                { collapsible: false, size: "75%" }
            ]
        });

        $("#undoButton").click(function (e) {
            diagram.undo();
        });
        $("#redoButton").click(function (e) {
            diagram.redo();
        });
        $("#deleteButton").click(function (e) {
            diagram.remove(diagram.select(), true);
        });
        $("#selectAllButton").click(function (e) {
            diagram.select(true);
        });
        $("#rotateShape").kendoSlider({
            min: 0,
            max: 359,
            change: shapeRotate,
            slide: shapeRotate,
        });
    });

    function shapeRotate(e) {
        var diagram = $("#canvas").data("kendoDiagram");
        $.each(diagram.select(), function () {
            if (this.rotate) {
                this.rotate(e.value | 0);
            }
        });
    }

    function explicitRotate(e) {
        var shapeBounds = shape2.bounds();
        var pos = shapeBounds.topLeft();
        var center = shapeBounds.center().minus(pos);
        var angle = e.target.value | 0;

        var transform = new kendo.diagram.CompositeTransform(pos.x, pos.y, undefined, undefined, angle, center);
        transform.render(shape2.visual.native);
        shape2.refresh();
    }
</script>
</html>
