<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="../src/jquery.js"></script>
    <script src="../src/kendo.core.js"></script>
    <script src="../src/kendo.draganddrop.js"></script>
    <script src="../src/kendo.query.js"></script>
    <script src="../src/kendo.datasource.js"></script>
    <script src="../src/kendo.groupable.js"></script>
    <script src="../src/kendo.grid.js"></script>
    <style>
        table
        {
            border: 1px solid black;
            border-collapse: collapse;
            width: 100%;
            table-layout: fixed;
        }
        
        td, th
        {
            border: 1px solid black;
            height: 22px;
        }
        
        th
        {
            background: magenta;
        }
        
        .grid
        {
            width: 500px;
        }
        
        .grid-header
        {
            padding-right: 17px;
            background: magenta;
        }
                
        .t-grouping-header {
            background-color: #EFF7FC;
            cursor: default;
            margin: 0;
            padding: .25em;
        }
        
        .draggable
        {
            border: 1px solid red;
            background: blue;
            width: 100px;
            height: 100px;
        }
        .dropTarget
        {
            border: 1px solid red;
            background: red;
            width: 100px;
            height: 100px;
        }
        
        .t-grouping-header .t-group-indicator {
            display: inline-block;
            zoom: 1;
            border-width: 1px;
            border-style: solid;
            line-height: 1.5em;
            padding: .15em .15em .15em .4em;
            margin: 0px 3px 0px 1px;
            -moz-border-radius: 4px;
            -webkit-border-radius: 4px;
            border-radius: 4px;
        }
        
        .t-grouping-header,
        .t-grouping-dropclue
        {
            height: 24px;
            line-height: 24px;
        }

        .t-grouping-dropclue
        {
            position: absolute;
            width: 6px;
        }
    </style>
</head>
<body>
    
    <div class="grid-data">
        <div class="t-grouping-header"></div>
        <table id="grid">
            <thead>
                <tr>
                    <th data-field="OrderID">
                        OrderID
                    </th>
                    <th data-field="ContactName">
                        ContactName
                    </th>
                    <th data-field="ShipAddress">
                        ShipAddress
                    </th>
                </tr>
            </thead>
        </table>
    </div>

    <script>
        var data = [];

        for (var i = 0; i < 100; i++) {
            data.push({ OrderID: i, ContactName: "Contact " + i, ShipAddress: "Ship Address " + i });
        }

        var dataSource = new kendo.data.DataSource({
            data: data,
            pageSize: 10
        });

        $("table#grid").kendoGrid({
            dataSource: dataSource
        });

        $("div.grid-data").kendoGroupable({
            filter: "th",
            groupContainer: "div.t-grouping-header"
        });
//        hint = function(target) {                    
//            return $("<span/>").text(target.data("field")).css({"background": "red","white-space": "nowrap"});
//        };
//        var indicatorTmpl = window.kendo.template('<div class="t-group-indicator" data-field="${data.field}">' + 
//                '<a href="#" class="t-link">' +
//                    '<span class="t-icon t-arrow-${(data.dir || "asc") == "asc" ? "up" : "down"}-small">(sorted ${(data.dir || "asc") == "asc" ? "ascending": "descending"})</span>' +
//                    '${data.field}' + 
//                '</a>' + 
//                '<a class="t-button t-button-icon t-button-bare">' +
//                    '<span class="t-icon t-group-delete"></span>' + 
//                '</a>' +
//             '</div>',  {useWithBlock:false});

//        var insideDropTarget = false;
//        var groupHeader = $(".grid-data .t-grouping-header");        
//        var dropCue = $('<div class="t-grouping-dropclue">|</>');
//        var indicators = [];

//        $(document).ready(function() {
//            
//            $("#grid").kendoDraggable({
//                filter: "th",
//                hint: hint,
//                dragend: function(e) {
//                    dragEnd(this);
//                    if(this.dropped) {
//                        var field = e.currentTarget.data("field");    
//                        if($.grep($(".t-group-indicator", groupHeader), function (item) { return $(item).data("field") === field }).length == 0) {                            
//                            groupHeader.append(buildIndicator(field));
//                            
//                            //console.log(buildDescriptors());
//                            //dataSource.group(buildDescriptors());
//                        }
//                    }                                      
//                },
//                dragstart: dragStart,
//                drag: drag });

//            groupHeader
//                .kendoDropTarget({
//                    dragenter: function() {
//                        insideDropTarget = true;
//                    },
//                    dragleave: function() {
//                        insideDropTarget = false;
//                    }
//                })
//                .kendoDraggable({
//                    filter: "div.t-group-indicator",
//                    hint:hint,
//                    dragend: function(e) {
//                        dragEnd(this);
//                        if(!this.dropped) {
////                            this._destroy();
////                            this.element.remove();
//                            e.currentTarget.remove();
//                            //console.log(buildDescriptors());
//                            //dataSource.group(buildDescriptors());
//                        }                            
//                    },
//                    dragstart: dragStart,
//                    drag: drag
//                });
//        });

//        function buildIndicator(field) {
//            return indicatorTmpl({field: field});
////            return $(indicatorTmpl({field: field}))
////                    .kendoDraggable({
////                        hint:hint,
////                        dragend: function(e) {
////                            dragEnd(this);
////                            if(!this.dropped) {
////                                this._destroy();
////                                this.element.remove();

////                                //console.log(buildDescriptors());
////                                //dataSource.group(buildDescriptors());
////                            }                            
////                        },
////                        dragstart: dragStart,
////                        drag: drag
////                    });
//        }

//        function dragEnd(draggable) {            

////            if(draggable.dropped && indicators.length > 0) {
////                var left = dropCue.position().left;
////                debugger;
////                if(left < indicators[0].left) {                   
////                    draggable.element.insertBefore(indicators[0].element);
////                } else if(left > indicators[indicators.length - 1].right) {
////                    draggable.element.insertAfter(indicators[indicators.length - 1].element);
////                } else {                             
////                    range = $.grep(indicators, function(item) {
////                        return item.element[0] !== draggable.element && item.left <= left && left <= item.right;
////                    })[0];

////                    draggable.element.insertBefore(range.element);
////                }
////            }

//            dropCue.remove();
//            indicators = [];
//        }

//        function dragStart() {
//            indicators = $.map($(".t-group-indicator", groupHeader), function(item) {
//                item = $(item);
//                var left = item.position().left;
//                return {
//                    left: left,
//                    right: left + item.outerWidth(),
//                    element: item
//                };
//            });
//                            
//            dropCue.css({top:0, left: 0}).appendTo(groupHeader);
//        }

//        function drag(e) {
//            if(!insideDropTarget || indicators.length == 0) {
//                return;
//            }
//            var pageX = e.pageX,                                
//                positionX = this.element.position().left,
//                range,
//                element = this.element[0];
//                            
//            if(pageX > indicators[indicators.length - 1].right) {
//                positionX = indicators[indicators.length - 1].right;
//            } else {                             
//                range = $.grep(indicators, function(item) {
//                    return item.element[0] !== element && item.left <= pageX && pageX <= item.right;
//                })[0];

//                if(range) {
//                    positionX = range.left;
//                }
//            }
//                            
//            dropCue.css({ left: positionX });            
//        }

//        function buildDescriptors() {            
//            return $.map($(".t-group-indicator", groupHeader), function(item) {
//                item = $(item);                
//                return {
//                    field: item.data("field"),
//                    dir: item.has("span.t-arrow-up-small") ? "asc" : "desc"
//                };
//            }); 
//        }
    </script>
</body>
</html>
