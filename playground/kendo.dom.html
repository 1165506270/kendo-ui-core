<!doctype html>
<html>
    <head>
        <script src="../src/jquery.js"></script>
        <script src="../src/kendo.core.js"></script>
        <script src="kendo.dom.js"></script>
        <script src="../src/kendo.data.js"></script>
        <script src="../src/kendo.data.odata.js"></script>
        <script src="../src/kendo.grid.js"></script>
        <link rel="stylesheet" href="../dist/styles/web/kendo.common.min.css">
        <link rel="stylesheet" href="../dist/styles/web/kendo.default.min.css">
    </head>
    <body>
        <div id="grid" class="k-grid k-widget"></div>
        <script>
            function now() {
                return window.performance && window.performance.now ? window.performance.now() : new window.Date().getTime()
            }

            $("button").click(function() {
                columns.push(columns.shift());
                m.redraw();
            });

            var dataSource = new kendo.data.DataSource({
                type: "odata",
                transport: {
                    read: {
                        url: "http://demos.telerik.com/kendo-ui/service/Northwind.svc/Orders",
                        dataType: "jsonp"
                    }
                },
                change: function() {
                    var start = now();
                    m.render(document.getElementById("grid"), table());
                    var end = now();
                    console.log("Mithril", end-start);
                }
            });

            var columns = [
                { field: "OrderID", title: "Order ID" },
                { field: "ShipName", title: "Ship Name" }
            ];

            // Mithril
            function table() {
                return kendo.dom("table", { role: "grid" }, [colgroup(), thead(), tbody()]);
            }

            function thead() {
                return kendo.dom("thead", { role: "rowgroup", className: "k-grid-header" }, [theadrow()]);
            }

            function theadrow() {
                return kendo.dom("tr", { role: "row" }, ths());
            }

            function ths() {
                return columns.map(function(column) {
                    return th(column);
                });
            }

            function th(column) {
                return kendo.dom("th", { "data-field": column.field, className: "k-header", role: "columnheader" }, column.title);
            }

            function tbody() {
                return kendo.dom("tbody", rows());
            }

            function colgroup() {
                return kendo.dom("colgroup", cols());
            }

            function cols() {
                return columns.map(function() {
                    return kendo.dom("col");
                });
            }

            function rows() {
                return dataSource.view().map(row);
            }

            function row(dataItem, index) {
                var attr = {
                    "data-uid": dataItem.uid
                };

                if (index % 2) {
                    attr["className"] = "k-alt";
                }

                return kendo.dom("tr", attr, cells(dataItem));
            }

            function cells(dataItem) {
                return columns.map(function(column) {
                    return cell(column.field, dataItem);
                });
            }

            function cell(field, dataItem) {
                return kendo.dom("td", dataItem[field]);
            }


            dataSource.fetch(function() {
                m.render(document.getElementById("grid"), table());

                $("#grid").find("th").kendoSorter({ dataSource: dataSource });
            });

        </script>
    </body>
</html>
