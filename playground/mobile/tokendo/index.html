 <!DOCTYPE html>
 <html>
 <head>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
     <title>ToKenDo</title>

     <!-- Weinre Proxy, configure to your machine if you have it. -->
     <!--<script src="http://bundev:8888/target/target-script-min.js"></script>-->
     
    <link rel="stylesheet" href="layout.css" />
    <link rel="stylesheet" href="scroll-container.css" />
    <link rel="stylesheet" href="tokendo.css" />

    <script src="../src/zepto.js"></script>
    <script src="../src/detect.js"></script>
    <script src="../src/fx.js"></script>
    <script src="../src/event.js"></script>

    <script>
        var jQuery = Zepto;
    </script>

    <script src="../../../src/kendo.loader.js"></script>
    <!-- TODO: use loader to load these -->
    <script>
        kendo.loader.define({
            mobile: {
                url: "kendo.mobile.application.js",
                depends: "core",
                features: {
                    view: {
                        url: "kendo.mobile.view.js"
                    },
                    scrollableView: {
                        url: "kendo.mobile.scroller.js"
                    }
                }
            }
        });

        kendo.loader.mobile({
            view: {},
            scrollableView: {}
        }, function() {
            var application = new Application({
                splashScreen: "images/splash.png"
            });

            var taskList;

            application.run(function(application) {
                taskList = new View({
                    onBind: function(data, element) {
                        var template = kendo.core.template(document.getElementById("item_tmpl").innerHTML);

                        element.html(template({ data: data }))
                            .delegate('.more-details', 'click', function() {
                                application.goToView('details', { itemId: $(this).index() });
                            });
                    }
                });

                application.addView(taskList);

                $('label').live('click', function(e) {
                    var $this = $(this);
                    $this.toggleClass('input-checked', document.getElementById($this.attr('for')).checked);
                });

                // load data
                var dataLoader = document.createElement('script');
                dataLoader.src = "tokendo.data.js";
                document.getElementsByTagName("head")[0].appendChild(dataLoader);
            });

            window.jsonpCallback = function (data) {
                taskList.bind(data);
            }
    });
    </script>
 </head>
 <body>
    <script type="text/html" id="item_tmpl">
        <ul class="list">
        <% for (var i = 0; i < data.length; i++) {
            var item = data[i]; %>
            <li class="item">
                <label for="isdone_<%= i %>" <%= (item.done ? " class='input-checked'" : "") %>>
                    <input type="checkbox" id="isdone_<%= i %>" <%= (item.done ? " checked='checked'" : "") %> />
                    <%= item.title %>
                    <a href="#" class="more-details">More...</a>
                </label>
            </li>
        <% } %>
        </ul>
    </script>
 </body>
 </html>

