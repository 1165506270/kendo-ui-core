<!DOCTYPE html>
<html>
    <head>
        <title>MVVM</title>
        <script src="../src/jquery.js"></script>
        <script src="../src/kendo.core.js"></script>
        <script src="../src/kendo.binder.js"></script>
        <script src="../src/kendo.model.js"></script>
        <script src="../src/kendo.data.js"></script>
        <script src="../src/kendo.grid.js"></script>
        <link rel="stylesheet" href="../styles/kendo.common.css"/>
        <link rel="stylesheet" href="../styles/kendo.default.css"/>
        <style>
            table, td, th {
                border: 1px solid black;
               border-collapse: collapse;
            }
        </style>
    </head>
    <body>
        <form>
            <button data-click="removeProduct">Remove a product</button>
            <button data-click="addProduct">Add a product</button>
            <button data-click="selectFirst">Select "Food"</button>

            <div data-template="div-template"></div>

            <fieldset>
                <legend>&lt;select multiple&gt;</legend>
                <select style="width: 200px"
                    data-value="selectedProduct"
                    data-template="option-tmpl"
                    data-source="products">
                </select>

                <script type="text/x-kendo-tmpl" id="option-tmpl">
                    <option value="${id}">${name}</option>
                </script>
                <script type="text/x-kendo-tmpl" id="div-template">
                    # if (selectedProduct["foo"]) {
                        "option strict"
                    #
                        Selected product is #= selectedProduct.name #
                    # } else { #
                        No selected product
                    # } #
                </script>
            </fieldset>
        </form>

        <script>
            var template = $("#div-template").html();
            var parts = kendo.Template.scan(template);
            var keywords = {};

            $.each("if else with for while switch case do".split(" "), function() {
                keywords[this] = true;
            });

            var identifiers = [];
            for (var i = 1; i < parts.length; i+=2) {
                var match = parts[i].match(/([$A-Za-z_][.\[\]'"0-9A-Za-z_]*)/g);
                if (match) {
                    identifiers.push.apply(identifiers, match);
                }
            }

            console.log(identifiers);

            identifiers = $.grep(identifiers, function(identifier) {
                return !keywords[identifier];
            });

            console.log(identifiers);

            var viewModel = kendo.observable({
                products: [ { id: 1, name: "Food" }, { id: 2, name: "Beverages" } ],
                selectedProduct: null,
                selectFirst: function() {
                    this.set("selectedProduct", this.products[0]);
                },
                addProduct: function() {
                    this.products.push({ id: 3, name: "Coffee" });
                },
                removeProduct: function(e) {
                    this.products.splice(this.products.length-1, 1);
                }
            });

            kendo.bind($("form"), viewModel);
        </script>
    </body>
</html>

