<!DOCTYPE HTML>
<html>
    <head>
        <title>Scheduler</title>
        <link href="../styles/web/kendo.common.min.css" rel="stylesheet" />
        <link href="../styles/web/kendo.silver.min.css" rel="stylesheet" />

        <script src="../src/jquery.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.core.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.timezones.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.fx.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.userevents.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.draganddrop.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.mobile.scroller.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.validator.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.window.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.data.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.list.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.dropdownlist.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.multiselect.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.binder.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.popup.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.tooltip.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.calendar.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.datepicker.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.timepicker.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.datetimepicker.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.list.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.dropdownlist.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.editable.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.scheduler.view.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.scheduler.dayview.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.scheduler.agendaview.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.scheduler.monthview.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.scheduler.recurrence.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.scheduler.js" type="text/javascript" charset="utf-8"></script>
        <script src="../src/kendo.numerictextbox.js" type="text/javascript" charset="utf-8"></script>
        <style>

            html
            {
                font:12px sans-serif;
                overflow-y:scroll;
            }

        </style>
    </head>
    <body>
            <div id="scheduler"></div>
    <script>
        function createLayoutConfiguration(name, resources, inner) {
            var resource = resources[0];
            if (resource) {
                var configuration = [];
                var field = resource.field;

                var data = resource.dataSource.view();

                for (var dataIndex = 0; dataIndex < data.length; dataIndex++) {
                    configuration.push({
                        text: kendo.getter(resource.dataTextField)(data[dataIndex]),
                        columns: createLayoutConfiguration(name, resources.slice(1), inner)
                    });
                }
                return configuration;
            }
            return inner;
        }

        var CustomView = kendo.ui.WeekView.extend({
            _createColumns: function(resources, inner) {
               return createLayoutConfiguration("columns", resources, inner);
            },
            _createRows: function(resources, inner) {
               return createLayoutConfiguration("rows", resources, inner);
            },
            _layout: function(dates) {
                var layout = kendo.ui.WeekView.fn._layout.call(this, dates);
                var columns = this._createColumns(this.options.resources, layout.columns);
                var rows = this._createRows(this.options.resources, layout.rows);

                return $.extend(layout, {
                    columns: columns,
                });
            },

            _content: function(dates) {
                var that = this,
                    options = that.options,
                    start = options.startTime,
                    end = options.endTime,
                    html = '';

                html += '<tbody>';

                html += this._forTimeRange(start, end, function(date, majorTick) {
                    var content = "",
                        idx,
                        length;

                    content = '<tr' + (majorTick ? ' class="k-middle-row"' : "") + '>';

                    for (var columnIdx = 0; columnIdx < that.columnCount; columnIdx++) {
                        for (idx = 0, length = dates.length; idx < length; idx++) {
                            content += "<td" + (kendo.date.isToday(dates[idx]) ? ' class="k-today"' : "") + ">";
                            content += "&nbsp;</td>";
                        }
                    }
                    content += "</tr>";
                    return content;
                });

                html += '</tbody>';

                this.content.find("table").append(html);
            },
            render: function(events) {
            }
        });

       $("#scheduler").kendoScheduler({
            height: 800,
            date: new Date("2013/6/6"),
            startTime: new Date("2013/6/6 10:00"),
           // majorTick: 30,
//            startTime: new Date(2013, 4, 14, 11, 0,0),
 //           endTime: new Date(2013, 4, 14, 18, 0,0),
             views: ["day", { type: "week", selected: true }, { type: "month", selected: true }, "agenda"],
            resources: [
                {
                    field: "ownerId",
                    dataSource: [
                        { text: "Alex", value: 1, color: "red" },
                        { text: "Bob", value: 2, color: "green" },
                        { text: "Charlie", value: 3, color: "blue" }
                    ],
                    title: "Owner"
                },{
                    field: "ownerId",
                    dataSource: [
                        { text: "Alex", value: 1, color: "red" },
                        { text: "Bob", value: 2, color: "green" },
                        { text: "Charlie", value: 3, color: "blue" }
                    ],
                    title: "Owner"
                }
            ],
            dataSource: {
                batch: true,
                transport: {
                    read: {
                        url: "http://demos.kendoui.com/service/tasks",
                        dataType: "jsonp"
                    },
                    update: {
                        url: "http://demos.kendoui.com/service/tasks/update",
                        dataType: "jsonp"
                    },
                    create: {
                        url: "http://demos.kendoui.com/service/tasks/create",
                        dataType: "jsonp"
                    },
                    destroy: {
                        url: "http://demos.kendoui.com/service/tasks/destroy",
                        dataType: "jsonp"
                    },
                    parameterMap: function(options, operation) {
                        if (operation !== "read" && options.models) {
                            return {models: kendo.stringify(options.models)};
                        }
                    }
                },
                schema: {
                    timezone: "Etc/UTC",
                    model: {
                        id: "TaskID",
                        fields: {
                            TaskID: { type: "number" },
                            title: { field: "Title", defaultValue: "No title", validation: { required: true } },
                            start: { type: "date", field: "Start" },
                            end: { type: "date", field: "End" },
                            description: { field: "Description" },
                            recurrence: { field: "Recurrence" },
                            exception: { field: "RecurrenceException" },
                            recurrenceId: { field: "RecurrenceID" },
                            ownerId: { field: "OwnerID", defaultValue: 1 },
                            isAllDay: { type: "boolean", field: "IsAllDay" }
                        }
                    }
                }
            }
        });
    </script>
    </body>
</html>
