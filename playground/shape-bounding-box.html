<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" >
        <title>Spline</title>
        <link href="../styles/dataviz/kendo.dataviz.min.css" rel="stylesheet" />
        <script src="../src/jquery.js"></script>
        <script src="../src/kendo.core.js"></script>
        <script src="../src/kendo.data.js"></script>
        <script src="../src/kendo.binder.js"></script>
        <script src="../src/kendo.dataviz.core.js"></script>

         <script src="../src/dataviz/util.js"></script>
         <script src="../src/dataviz/geometry.js"></script>
         <script src="../src/dataviz/drawing/core.js"></script>
         <script src="../src/dataviz/drawing/shapes.js"></script>
         <script src="../src/dataviz/drawing/parser.js"></script>
         <script src="../src/dataviz/drawing/svg.js"></script>
         <script src="../src/dataviz/drawing/canvas.js"></script>
         <script src="../src/dataviz/drawing/vml.js"></script>
    </head>
    <body>
        <textarea id="pathString" cols="40" rows="5" data-bind="value:path"></textarea>
        <div data-bind="text:drawPath"></div>
        <div id="container"></div>
        <div id="test"></div>
         <--
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1200px" height="1200px" style="position:absolute; left: 300px;">
            <g>
                <path d="M 300 300 v 86.6 h-25 A 50 100 0 1 1 350 300 c -5 100 100 100 100 -100 10 -70 50 100 50 100" stroke="red" stroke-width="2" stroke-linecap="square" fill="none" stroke-linejoin="round"></path>                             
            </g>
        </svg>
         -->
        <!--
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="400px" height="400px" style="position:absolute;">
                <g>
                    <path d="M400 300 A 100 50 0 1 1 250 256.7" stroke="red" stroke-width="2" stroke-linecap="square" fill="none" stroke-linejoin="round"></path>           
                    <circle cx="300" cy="300" r="3" stroke="black" stroke-width="2" stroke-linecap="square" fill="none"></circle>
                </g>
            </svg>
        -->
     <!--
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="700px" height="700px" style="position: absolute;">
            <g>
                <circle cx="300" cy="300" r="100" stroke="red" stroke-width="2" stroke-linecap="square" fill="none" stroke-linejoin="round" />            
                <circle cx="300" cy="300" r="3" stroke="black" stroke-width="2" stroke-linecap="square" fill="none"></circle>
            </g>
        </svg> 
      -->
        <script>
            //test curve M100 100 c 50 50 100 0 200 0 200 10 0 100 -50 100
            //test arc M275 386.6 A 50 100 0 0 0 350 300
            var dataviz = kendo.dataviz,
                geometry = dataviz.geometry,
                Point = geometry.Point,
                Circle = geometry.Circle,
                drawing = dataviz.drawing,
                Path = drawing.Path,
                Segment = drawing.Segment,
                Surface = drawing.Surface,
                surface = Surface.create(document.getElementById("container"), {width: 700, height: 700}),
                circleGeometry = new Circle(Point.create(150, 400), 100),
                circle = new drawing.Circle(circleGeometry, {fill: {color: "red"} }),
                boundingRect = circle.boundingRect(),
                strokeOptions = {stroke: {color: "black", width: 2}},
                circleBoundingPath = rectPath(boundingRect, strokeOptions),
                curve = new Path(strokeOptions),
                group = new drawing.Group(),
                parser = drawing.SvgPathParser.current;

            curve.moveTo(100, 100);
            curve.curveTo(Point.create(200, 200), Point.create(300, 200), Point.create(400, 100));
            curve.lineTo(500, 150);
            curve.curveTo(Point.create(450, 200), Point.create(200, 300), Point.create(100, 200));
            //curve.close();

            var curveBoundingRect = rectPath(curve.boundingRect(), strokeOptions);
                        
            var arcGeometry = new geometry.Arc(Point.create(300, 300), {
                startAngle: 0,
                endAngle: 120,
                radiusX: 50,
                radiusY: 100,
                counterClockwise: true
            });
            
            var arc = new drawing.Arc(arcGeometry, strokeOptions);
            group.append(arc, new drawing.Circle(new geometry.Circle(Point.create(300, 300), 3), strokeOptions), rectPath(arc.boundingRect(), strokeOptions));//circle, circleBoundingPath, curve, curveBoundingRect);
            //surface.draw(group);
            var viewModel = kendo.observable({
                path: "M 300 300 v 86.6 h-25 A 50 100 0 1 1 350 300 c -5 100 100 100 100 -100 10 -70 50 100 50 100",
                drawPath: function() {
                    var pathString = this.get("path");
                    if (pathString) {
                        var multiPath = parser.parse(pathString, strokeOptions),
                            multiPathGroup =  new drawing.Group(),
                            multiPathBoundingRect = multiPath.boundingRect();
            
                        multiPathGroup.append(multiPath, rectPath(multiPathBoundingRect, strokeOptions));
                        surface.clear();
                        surface.draw(multiPathGroup);
                    }
                    
                    return pathString;
                }
            });
            
            kendo.bind($("body"), viewModel);

            function rectPath(rect, options) {
                var rectPath = new Path(options),
                    width = rect.width(),
                    height = rect.height();
                rectPath.moveTo(rect.p0.x, rect.p0.y);
                rectPath.lineTo(rect.p0.x + width, rect.p0.y);
                rectPath.lineTo(rect.p0.x + width, rect.p0.y + height);
                rectPath.lineTo(rect.p0.x, rect.p0.y + height);
                rectPath.close();

                return rectPath;
            }
            renderTest();
            function renderTest() {
                var surface = Surface.create(document.getElementById("test"), {width: 700, height: 700}),
                    arcGeometry = new geometry.Arc(Point.create(100, 100), {
                        startAngle: 0,
                        endAngle: 180,
                        radiusX: 50,
                        radiusY: 100,
                        counterClockwise: false
                    }),
                    arc = new drawing.Arc(arcGeometry, $.extend({}, strokeOptions, {fill: {color: "red"}}));
                   debugger;
                surface.draw(arc);
            }
        </script>
    </body>
</html>