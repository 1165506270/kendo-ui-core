<!DOCTYPE html>
<html>
    <head>
        <title>TreeView binding</title>
        <link rel="stylesheet" href="../styles/web/kendo.common.css"/>
        <link rel="stylesheet/less" type="text/css" href="../styles/web/kendo.default.less"/>
        <link rel="stylesheet" type="text/css" href="../demos/mvc/content/shared/styles/examples.css"></link>

        <script src="../demos/mvc/content/shared/js/less.js"></script>

        <script src="../src/jquery.js"></script>
        <script src="../src/kendo.core.js"></script>
        <script src="../src/kendo.data.js"></script>
        <script src="../src/kendo.draganddrop.js"></script>
        <script src="../src/kendo.fx.js"></script>
        <script src="../src/kendo.treeview.js"></script>
        <script>
            var Node = kendo.data.Model.define({
                init: function(value) {
                    var data = {},
                        children = {};


                    kendo.data.Model.fn.init.call(this, value);

                    data[this.idField] = this.id;

                    children = $.extend(true, {}, this.children, {
                        transport: {
                            read: {
                                data: data
                            }
                        }
                    });

                    this.children = new TreeDataSource(children);
                },
                shouldSerialize: function(field) {
                    return kendo.data.Model.fn.shouldSerialize.call(this, field) && field !== "children";
                }
            });

            var TreeDataSource = kendo.data.DataSource.extend({
                init: function(options) {
                    kendo.data.DataSource.fn.init.call(this, $.extend(true, {}, { schema: { modelBase: Node } }, options));
                }
            });

        </script>
    </head>
    <body>
        <h2>Heterogeneous data source</h2>
        <ul id="treeview1"></ul>
        <h2>Homogeneous data source</h2>
        <ul id="treeview2"></ul>
        <script>
            var heterogeneous = new TreeDataSource({
                transport: {
                    read: {
                        url: "http://korchev:8080/Northwind/Home/Categories",
                        dataType: "json"
                    }
                },
                schema: {
                    data: "categories",
                    model: {
                        id: "categoryId",
                        children: {
                            transport: {
                                read: {
                                    url: "http://korchev:8080/Northwind/Home/Products",
                                    dataType: "json"
                                }
                            },
                            schema: {
                                data: "products"
                            }
                        }
                    }
                }
            });

            heterogeneous.fetch(function() {
                var categories = heterogeneous.data();

                $.each(categories, function() {
                    var li = $("<li><a href='#'></a></li>").appendTo($("#treeview1"));
                    var category = this;

                    li.find("a").text(category.categoryName).click(function(e) {
                        e.preventDefault();

                        category.children.fetch(function() {
                            li.find("ul").remove();
                            var products = category.children.data();
                            var ul = $("<ul></ul>").appendTo(li);
                            $.each(products, function() {
                                var product = this;
                                $("<li></li>").text(product.productName).appendTo(ul);
                            });
                        });
                    });
                });
            });

            var homogeneous = new TreeDataSource({
                transport: {
                    read: {
                        url: "http://korchev:8080/Northwind/Home/Employees",
                        dataType: "json",
                        data: {
                            employeeId: "root"
                        }
                    }
                },
                schema: {
                    data: "employees",
                    model: {
                        id: "employeeId",
                        children: {
                            transport: {
                                read: {
                                    url: "http://korchev:8080/Northwind/Home/Employees",
                                    dataType: "json"
                                }
                            },
                            schema: {
                                data: "employees"
                            }
                        }
                    }
                }
            });

            homogeneous.fetch(function() {
                var categories = homogeneous.data();

                $.each(categories, function() {
                    var li = $("<li><a href='#'></a></li>").appendTo($("#treeview2"));
                    var category = this;

                    li.find("a").text(category.employeeName).click(function(e) {
                        e.preventDefault();

                        category.children.fetch(function() {
                            li.find("ul").remove();
                            var products = category.children.data();
                            var ul = $("<ul></ul>").appendTo(li);
                            $.each(products, function() {
                                var product = this;
                                $("<li></li>").text(product.employeeName).appendTo(ul);
                            });
                        });
                    });
                });
            });

            var inline = {
                data: [
                    {
                        text: "root",
                        items: [
                            { text: "leaf" },
                            {
                                text: "node with children",
                                items: [ { text: "leaf" }]
                            }
                        ]
                    }
                ]
            }
        </script>
    </body>
</html>
