<!DOCTYPE HTML>
<html class="k-ios">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>Kendo Sushi</title>
        <link rel="stylesheet/less" type="text/css" href="../styles/mobile/layout.less" />
        <script src="../styles/mobile/less.js"></script>
        <script src="../src/jquery.js"></script>
        <script src="../src/kendo.core.js"></script>
        <script src="../src/kendo.model.js"></script>
        <script src="../src/kendo.data.js"></script>
        <script src="../src/kendo.fx.js"></script>
        <script src="../src/kendo.history.js"></script>
        <script src="../src/kendo.mobile.core.js"></script>
        <script src="../src/kendo.mobile.button.js"></script>
        <script src="../src/kendo.mobile.tabstrip.js"></script>
        <script src="../src/kendo.mobile.listview.js"></script>
        <script src="../src/kendo.mobile.navbar.js"></script>
        <script src="../src/kendo.mobile.scroller.js"></script>
        <script src="../src/kendo.mobile.application.js"></script>
        <style>
            .added {
                color: green;
                font-size: .8rem;
            }

            #featured li {
                height: 7rem;
            }

            #featured img {
                float: left;
                margin-right: 1rem;
            }

            #featured h2 {
                font-size: 1.0rem;
                margin: 0;
            }

            #featured a.km-button {
                float: right;
                margin-top: 1rem;
            }

            #featured a.details-link {
                display: block;
            }
        </style>
    </head>
    <body>
        <div data-kendo-role="view" data-kendo-url="/" data-kendo-animation="slide">
            <header data-kendo-role="header">
                <div data-kendo-role="navbar">
                    <span data-kendo-role="view-title">Kendo Sushi!</span>
                </div>
            </header>

            <div data-kendo-role="content">
                <ul id="featured">
                </ul>
            </div>

            <footer data-kendo-role="footer" data-id="default">
                <div data-kendo-role="tabstrip">
                    <a href="index.html">Home</a>
                    <a href="#menu">Our menu</a>
                    <a href="account.html">Account</a>
                    <a href="#cart">Cart</a>
                </div>
            </footer>
        </div>

        <div data-kendo-role="view" id="details" data-kendo-transition="slide">
            <header data-kendo-role="header">
                <div data-kendo-role="navbar">
                    <span data-kendo-role="view-title">Item</span>
                </div>
            </header>

            <div data-kendo-role="content">
            </div>

            <footer data-kendo-role="footer" data-id="default">
            </footer>
        </div>

        <script id="menuTemplate" type="text/x-kendo-template">

            <a data-kendo-role="button" data-kendo-name="add" href="\\#">Add to cart</a>

            <a class="details-link" data-kendo-role="listview-link" href="\#details?id=${id}">
                <img src="images/${image}" />
                <span class="price">&euro; ${price}</span>
                <h2>${name}</h2>
                # if (cart.indexOf(id) >= 0) { #
                    <span class="added">Item added in your cart</span>
                # } #
            </a>
        </script>

        <script id="detailTemplate" type="text/x-kendo-template">
            <img src="images/${image}" />
            <span class="price">&euro; ${price}</span>
            <h2>${name}</h2>
            <p>${description}</p>
            # if (cart.indexOf(id) >= 0) { #
                <span class="added">Item added in your cart</span>
            # } #
            <a data-kendo-role="button" href="\\#">Add to cart</a>
        </script>

        <script>
            window.cart = [];
            var ds = new kendo.data.DataSource({
                schema: { model: {id: "id"} },
                transport: { read: { url: "featured.js", dataType: "json" } },
            });

            ds.read();

            var itemDetailsTemplate = kendo.template($("#detailTemplate").text());

            $("#featured").kendoMobileListView({dataSource: ds, template: $("#menuTemplate").text()});

            var listView = $("#featured").data("kendoMobileListView");

            listView.bind("click", function(e) {
                if (e.buttonName === "add") {
                    cart.push(e.dataItem.id);
                    listView.refresh();
                }
            });

            kendo.application.bind("viewShow", function(e) {
                var view = e.view, item;

                if (view.element.attr("id") === "details") {
                    item = ds.get(e.params.id).data;
                    view.content.html(itemDetailsTemplate(item));
                }
            });
        </script>
    </body>
</html>
