<!DOCTYPE html>
<html>
    <head>
        <title>code code11 tests</title>
        <script src="../../jquery-loader.js"></script>
        <script src="../..//qunit/qunit/qunit.js"></script>
        <script src="../../qunit/addons/close-enough/qunit-close-enough.js"></script>
        <script src="../../kendo-test-helpers.js"></script>
        <link href="../../qunit/qunit/qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../../src/kendo.core.js"></script>        
        <script src="../../../src/kendo.dataviz.core.js"></script>
        <script src="../../../src/kendo.dataviz.barcode.js"></script> 
		<script src="constants.js"></script> 
		<script src="utils.js"></script>  		
 		
        <script type="text/javascript">
			var dataviz = kendo.dataviz,
                encodings = dataviz.encodings;				
				
			(function() {
				var encoding,
					START = [[BAR,1],[SPACE,1], [BAR,2],[SPACE,2], [BAR, 1]],
					GAP = [SPACE, 1],
					characters = {
						"0": [[BAR,1],[SPACE,1], [BAR,1],[SPACE,1], [BAR, 2]],
						"1": [[BAR,2],[SPACE,1], [BAR,1],[SPACE,1], [BAR, 2]],
						"2": [[BAR,1],[SPACE,2], [BAR,1],[SPACE,1], [BAR, 2]],
						"3": [[BAR,2],[SPACE,2], [BAR,1],[SPACE,1], [BAR, 1]],
						"4": [[BAR,1],[SPACE,1], [BAR,2],[SPACE,1], [BAR, 2]],
						"5": [[BAR,2],[SPACE,1], [BAR,2],[SPACE,1], [BAR, 1]],
						"6": [[BAR,1],[SPACE,2], [BAR,2],[SPACE,1], [BAR, 1]],
						"7": [[BAR,1],[SPACE,1], [BAR,1],[SPACE,2], [BAR, 2]],
						"8": [[BAR,2],[SPACE,1], [BAR,1],[SPACE,2], [BAR, 1]],
						"9": [[BAR,2],[SPACE,1], [BAR,1],[SPACE,1], [BAR, 1]],
						"-": [[BAR,1],[SPACE,1], [BAR,2],[SPACE,1], [BAR, 1]]						
					}
				
				function generateResult(value, options){										
					var expectedResult = [];
					if(options.quietZoneLength){
						expectedResult.push([SPACE, options.quietZoneLength]);
					}					
			
					expectedResult.pushArray(START);
					expectedResult.push(GAP);
					for( var i = 0; i < value.length; i++){										
						expectedResult.pushArray(characters[value.charAt(i)]);		
						expectedResult.push(GAP);						
					}
					
					if(options.checkValues){
						for(var i = 0; i< options.checkValues.length; i++){
							expectedResult.pushArray(characters[options.checkValues[i]]);
							expectedResult.push(GAP);							
						}	
					}													
										
					expectedResult.pushArray(START);					
					
					if(options.quietZoneLength){
						expectedResult.push([SPACE, options.quietZoneLength]);
					}

					return expectedResult;
				}
				
				module("code11", {
                    setup: function() {
                        encoding = new encodings.code11();
                    },
                    teardown: function(){
						encoding = null;
					}
                });
				
				test("test value 0", function(){
					var value = "0",
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, {
							quietZoneLength: encoding.options.quietZoneLength,
							checkValues: ["0"]
						});
					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 123-45", function(){
					var value = "123-45",
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, {
							quietZoneLength: encoding.options.quietZoneLength,
							checkValues: ["5"]
						});
					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 123-456-78 added K checksum", function(){
					var value = "123-456-78",
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, {
							quietZoneLength: encoding.options.quietZoneLength,
							checkValues: ["5", "6"]
						});
					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 123-456-789 length over C checksum total", function(){
					var value = "123-456-789",
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, {
							quietZoneLength: encoding.options.quietZoneLength,
							checkValues: ["5", "9"]
						});
					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 59100000501 check digit dash", function(){
					var value = "59100000501",
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, {
							quietZoneLength: encoding.options.quietZoneLength,
							checkValues: ["-", "0"]
						});
					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test invalid character error", function() {
					var thrownError = false;
					try{
						encoding.encode("012-34a12", 300, 100);
					}
					catch (ex){						
						thrownError = true;						
					}
					ok(thrownError);
                });
				
				test("test base unit calculation", function(){
					var quietZoneLength = 2 * encoding.options.quietZoneLength,
						precision = 2,
						width = 200,
						height = 100,
						valueNoCheckSum = "123-45",
						valueShortSymbols = "0-9",
						valueLongSymbols = "138",
						valueBothCheckSums = "59100000501",
						expectedResultNoCheckSum = fixed(width / (62 + quietZoneLength), precision),
						expectedResultShortSymbols  = fixed(width / (44 + quietZoneLength), precision),
						expectedResultLongSymbols = fixed(width / (47 + quietZoneLength), precision),
						expectedResultBothCheckSums = fixed(width / (110 + quietZoneLength), precision),
						resultNoCheckSum,
						resultShortSymbols,
						resultLongSymbols,
						resultBothCheckSums;
						

					encoding.options.addCheckSum = false;
					resultNoCheckSum = encoding.encode(valueNoCheckSum, width, height).baseUnit;
					equal(fixed(resultNoCheckSum, precision), expectedResultNoCheckSum);
					
					encoding.options.addCheckSum = true;
					
					resultShortSymbols = encoding.encode(valueShortSymbols, width, height).baseUnit;
					equal(fixed(resultShortSymbols, precision), expectedResultShortSymbols);
					
					resultLongSymbols = encoding.encode(valueLongSymbols, width, height).baseUnit;
					equal(fixed(resultLongSymbols, precision), expectedResultLongSymbols);
									
					resultBothCheckSums = encoding.encode(valueBothCheckSums, width, height).baseUnit;
					equal(fixed(resultBothCheckSums, precision), expectedResultBothCheckSums);
						
				});
				
			})();
        </script>
		
		<h1 id="qunit-header">encoding code11</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <div id="container" style="width: 600px; height: 400px">
        </div>
	</body>
</html>								