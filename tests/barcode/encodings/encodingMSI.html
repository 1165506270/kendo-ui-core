<!DOCTYPE html>
<html>
    <head>
        <title>code MSI tests</title>
        <script src="../../jquery-loader.js"></script>
        <script src="../..//qunit/qunit/qunit.js"></script>
        <script src="../../qunit/addons/close-enough/qunit-close-enough.js"></script>
        <script src="../../kendo-test-helpers.js"></script>
        <link href="../../qunit/qunit/qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../../src/kendo.core.js"></script>        
        <script src="../../../src/kendo.dataviz.core.js"></script>
        <script src="../../../src/kendo.dataviz.barcode.js"></script> 
		<script src="constants.js"></script> 
		<script src="utils.js"></script>  		
 		
        <script type="text/javascript">
			var dataviz = kendo.dataviz,
                encodings = dataviz.encodings;
				
			(function() {
				var encoding,
					checkMod10 = "Modulo10",
					checkModDouble10 = "DoubleModulo10",
					checkMod11 = "Modulo11",
					checkMod1110 = "Modulo11Modulo10",
					START = [[BAR,2],[SPACE,1]],
					STOP = [[BAR,1],[SPACE,2],[BAR,1]],
					characters = [												
						[[BAR,1],[SPACE,2],[BAR,1], [SPACE,2], [BAR,1], [SPACE,2], [BAR,1], [SPACE,2]],
					    [[BAR,1],[SPACE,2],[BAR,1], [SPACE,2], [BAR,1], [SPACE,2], [BAR,2], [SPACE,1]],
						[[BAR,1],[SPACE,2],[BAR,1], [SPACE,2], [BAR,2], [SPACE,1], [BAR,1], [SPACE,2]],
						[[BAR,1],[SPACE,2],[BAR,1], [SPACE,2], [BAR,2], [SPACE,1], [BAR,2], [SPACE,1]],
						[[BAR,1],[SPACE,2],[BAR,2], [SPACE,1], [BAR,1], [SPACE,2], [BAR,1], [SPACE,2]],
						[[BAR,1],[SPACE,2],[BAR,2], [SPACE,1], [BAR,1], [SPACE,2], [BAR,2], [SPACE,1]],
						[[BAR,1],[SPACE,2],[BAR,2], [SPACE,1], [BAR,2], [SPACE,1], [BAR,1], [SPACE,2]],
						[[BAR,1],[SPACE,2],[BAR,2], [SPACE,1], [BAR,2], [SPACE,1], [BAR,2], [SPACE,1]],
						[[BAR,2],[SPACE,1],[BAR,1], [SPACE,2], [BAR,1], [SPACE,2], [BAR,1], [SPACE,2]],
						[[BAR,2],[SPACE,1],[BAR,1], [SPACE,2], [BAR,1], [SPACE,2], [BAR,2], [SPACE,1]]
					];
					
				function calculateBaseUnit(width, dataLength, checkSumLength, quietZoneLength){
					var startStopLength = 7;
						return width / 
							(12 * (dataLength + checkSumLength) + 2 * quietZoneLength + startStopLength);
				}
				
				function generateResult(value, options){										
					var expectedResult = [];
					if(options.quietZoneLength){
						expectedResult.push([SPACE, options.quietZoneLength]);
					}					
			
					expectedResult.pushArray(START);
				
					for( var i = 0; i < value.length; i++){										
						expectedResult.pushArray(characters[value.charAt(i)]);						
					}
					
					if(options.checkValues){
						for(var i = 0; i< options.checkValues.length; i++){
							expectedResult.pushArray(characters[options.checkValues[i]]);			
						}	
					}													
										
					expectedResult.pushArray(STOP);					
					
					if(options.quietZoneLength){
						expectedResult.push([SPACE, options.quietZoneLength]);
					}

					return expectedResult;
				}
				
				module("MSI", {
                    setup: function() {
                        encoding = new encodings.msi();
                    },
                    teardown: function(){
						encoding = null;
					}
                });
				
				test("test value 8052 checksum mod10", function(){
					encoding.options.checkSumType = checkMod10;
					var value = "8052",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value,  
							{checkValues: ["3"], quietZoneLength: encoding.options.quietZoneLength});
					ok(comparePatterns(result.pattern,expectedResult));
				});
		
				test("test value 09345 checksum mod10", function(){
					encoding.options.checkSumType = checkMod10;
					var value = "09345",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value,  
							{checkValues: ["0"], quietZoneLength: encoding.options.quietZoneLength});							

					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 0 checksum mod10", function(){
					encoding.options.checkSumType = checkMod10;
					var value = "0",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, 
							{checkValues: ["0"], quietZoneLength: encoding.options.quietZoneLength});

					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				
				test("test value 80523 checksum mod11", function(){
					encoding.options.checkSumType = checkMod11;
					var value = "80523",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, 
							{checkValues: ["8"], quietZoneLength: encoding.options.quietZoneLength});
					
					ok(comparePatterns(result.pattern,expectedResult));
				});			
		
				test("test value 09345 checksum mod11", function(){
					encoding.options.checkSumType = checkMod11;
					var value = "09345",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, 
							{checkValues: ["9"], quietZoneLength: encoding.options.quietZoneLength});

					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test checksum mod11 over 6 digits", function(){
					encoding.options.checkSumType = checkMod11;
					var value = "0123456",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, 
							{checkValues: ["0"], quietZoneLength: encoding.options.quietZoneLength});

					ok(comparePatterns(result.pattern,expectedResult));
				});
				
					
				test("test checksum mod11 over 12 digits", function(){
					encoding.options.checkSumType = checkMod11;
					var value = "0123456789012",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, 
							{checkValues: ["5"], quietZoneLength: encoding.options.quietZoneLength});

					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 0 checksum mod11", function(){
					encoding.options.checkSumType = checkMod11;
					var value = "0",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value,  
							{checkValues: ["0"], quietZoneLength: encoding.options.quietZoneLength});

					ok(comparePatterns(result.pattern,expectedResult));
				});													
				
				test("test value 6 checksum mod11", function(){
					encoding.options.checkSumType = checkMod11;
					var value = "6",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, 
							{checkValues: ["1","0"], quietZoneLength: encoding.options.quietZoneLength});

					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 8052 checksum double mod10", function(){
					encoding.options.checkSumType = checkModDouble10;
					var value = "8052",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value,  
							{checkValues: ["3", "4"], quietZoneLength: encoding.options.quietZoneLength});

					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 09345 checksum double mod10", function(){
					encoding.options.checkSumType = checkModDouble10;
					var value = "09345",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, 
							{checkValues: ["0", "5"], quietZoneLength: encoding.options.quietZoneLength});
					
					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				
				test("test value 8052 checksum mod11 mod10", function(){
					encoding.options.checkSumType = checkMod1110;
					var value = "8052",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value,  
							{checkValues: ["7", "5"], quietZoneLength: encoding.options.quietZoneLength});

					ok(comparePatterns(result.pattern,expectedResult));
				});
				
				test("test value 09345 checksum mod11 mod10", function(){
					encoding.options.checkSumType = checkMod1110;
					var value = "09345",	
						result = encoding.encode(value, 200, 100),
						expectedResult = generateResult(value, 
							{checkValues: ["9", "6"], quietZoneLength: encoding.options.quietZoneLength});
					
					ok(comparePatterns(result.pattern,expectedResult));
				});

				test("test invalid character error", function() {
					var thrownError = false;
					try{
						encoding.encode("01234a12", 300, 100);
					}
					catch (ex){						
						thrownError = true;						
					}
					ok(thrownError);
                });
				
				test("test invalid checksum type error", function() {
					encoding.options.checkSumType = "mod11mod11";
					var thrownError = false;
					try{
						encoding.encode("0123412", 300, 100);
					}
					catch (ex){						
						thrownError = true;						
					}
					ok(thrownError);
                });
				
				test("test base unit calculation", function(){
					var value = "09345",
						width = 200,
						precision = 2,
						quietZoneLength = encoding.options.quietZoneLength,
						resultNoCheckSum,
						resultSingleCheckSum,
						resultDoubleCheckSum,
						expectedResultNoCheckSum = fixed(calculateBaseUnit(width, value.length, 0, quietZoneLength), precision),
						expectedResultSingleCheckSum = fixed(calculateBaseUnit(width, value.length, 1, quietZoneLength), precision),
						expectedResultDoubleCheckSum = fixed(calculateBaseUnit(width, value.length, 2, quietZoneLength), precision);
						
					encoding.options.addCheckSum = false;						
					resultNoCheckSum = encoding.encode(value, 200, 100).baseUnit,					
					equal(fixed(resultNoCheckSum, precision), expectedResultNoCheckSum);
					
					encoding.options.addCheckSum = true;				
					encoding.options.checkSumType = checkMod10;					
					resultSingleCheckSum = encoding.encode(value, 200, 100).baseUnit,					
					equal(fixed(resultSingleCheckSum, precision), expectedResultSingleCheckSum);
										
					encoding.options.addCheckSum = true;				
					encoding.options.checkSumType = checkModDouble10;					
					resultDoubleCheckSum = encoding.encode(value, 200, 100).baseUnit,					
					equal(fixed(resultDoubleCheckSum, precision), expectedResultDoubleCheckSum);
					
					encoding.options.addCheckSum = true;				
					encoding.options.checkSumType = checkMod1110;					
					resultDoubleCheckSum = encoding.encode(value, 200, 100).baseUnit,					
					equal(fixed(resultDoubleCheckSum, precision), expectedResultDoubleCheckSum);
					
				});
				
			})();
        </script>
		
		<h1 id="qunit-header">encoding MSI</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <div id="container" style="width: 600px; height: 400px">
        </div>
	</body>
</html>					