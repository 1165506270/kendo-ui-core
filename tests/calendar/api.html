<!DOCTYPE html>
<html>
    <head>
        <title>Calendar API</title>
        <script src="../../src/jquery.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script type="text/javascript" src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.calendar.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Calendar API</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>

            var Calendar = kendo.ui.Calendar;

            module("kendo.ui.Calendar API", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    div.remove();
                }
            });

            test("navigate method render view using default values", function() {
                var cal = new Calendar(div, {animation: false}),
                    date = new Date(),
                    firstVisibleDate = kendo.calendar.firstVisibleDay(date);

                equal(cal.element.find(".k-content").find("a:first").html(), firstVisibleDate.getDate());
            });

            test("navigate method render view depending on given date and view", function() {
                var cal = new Calendar(div, { animation: false }),
                    date = new Date(2000, 10, 10);

                cal.navigate(date, "decade");

                equal(cal.element.find(".k-content").find("a:first").html(), "1999");
            });

            test("navigate method should disable._prevArrow if cannot navigate to past", function() {
                var date = new Date(2000, 10, 10),
                cal = new Calendar(div, {
                    value: date,
                    min: date
                });

                ok(cal._prevArrow.hasClass("k-state-disabled"));
            });

            test("navigate method should disable._nextArrow if cannot navigate to future", function() {
                var date = new Date(2000, 10, 10),
                cal = new Calendar(div, {
                    value: date,
                    max: date
                });

                ok(cal._nextArrow.hasClass("k-state-disabled"));
            });

            test("navigate method should disable._prevArrow if cannot navigate to past (year)", function() {
                var date = new Date(2000, 10, 10),
                    cal = new Calendar(div, {
                        value: date,
                        min: date,
                        firstView: "year"
                    });

                ok(cal._prevArrow.hasClass("k-state-disabled"));
            });

            test("navigate method should disable._nextArrow if cannot navigate to future (year)", function() {
                var date = new Date(2000, 10, 10),
                    cal = new Calendar(div, {
                        value: date,
                        max: date,
                        firstView: "year"
                    });

                ok(cal._nextArrow.hasClass("k-state-disabled"));
            });

            test("navigate method should disable._prevArrow if cannot navigate to past (decade)", function() {
                var date = new Date(2000, 10, 10),
                    cal = new Calendar(div, {
                        value: date,
                        min: date,
                        firstView: "decade"
                    });

                ok(cal._prevArrow.hasClass("k-state-disabled"));
            });

            test("navigate method should disable._nextArrow if cannot navigate to future (decade)", function() {
                var date = new Date(2000, 10, 10),
                    cal = new Calendar(div, {
                        value: date,
                        max: date,
                        firstView: "decade"
                    });

                ok(cal._nextArrow.hasClass("k-state-disabled"));
            });

            test("navigate method should disable._prevArrow if cannot navigate to past (century)", function() {
                var date = new Date(2000, 10, 10),
                    cal = new Calendar(div, {
                        value: date,
                        min: date,
                        firstView: "century"
                    });

                ok(cal._prevArrow.hasClass("k-state-disabled"));
            });

            test("navigate method should disable._nextArrow if cannot navigate to future (century)", function() {
                var date = new Date(2000, 10, 10),
                    cal = new Calendar(div, {
                        value: date,
                        max: date,
                        firstView: "century"
                    });

                ok(cal._nextArrow.hasClass("k-state-disabled"));
            });

            test("navigate should select date equal to _value", function() {
                var cal = new Calendar(div, {animation: false}),
                    value = new Date(2000, 10, 10);

                cal.navigateDown(value);

                cal.navigateToPast();

                equal(cal._table.find(".k-state-selected").length, 0);
            });

            test("navigateToPast should navigate to previous month when month view", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue),
                    names = kendo.culture().calendar.months.names;

                modified.setMonth(modified.getMonth() - 1);

                cal.navigateToPast();

                equal(+cal._viewedValue, +modified);
                ok(cal._title.html().indexOf(names[modified.getMonth()]) !== -1);
            });

            test("navigateToPast should navigate to previous year when year view", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "year";
                modified.setFullYear(modified.getFullYear() - 1);

                cal.navigateToPast();

                ok(cal._title.html(), modified.getFullYear());
                equal(+cal._viewedValue, +modified);
            });

            test("navigateToPast should navigate to previous decade when decade view", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "decade";
                modified.setFullYear(modified.getFullYear() - 10);


                var start = modified.getFullYear() - modified.getFullYear() % 10;

                cal.navigateToPast();

                ok(cal._title.html(), start + "-" + (start + 9));
                equal(+cal._viewedValue, +modified);
            });

            test("navigateToPast should navigate to previous century when century view", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "century";
                modified.setFullYear(modified.getFullYear() - 100);


                var start = modified.getFullYear() - modified.getFullYear() % 100;

                cal.navigateToPast();

                ok(cal._title.html(), start + "-" + (start + 99));
                equal(+cal._viewedValue, +modified);
            });

            test("navigateToFuture should navigate to next month when month view", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue),
                    names = kendo.culture().calendar.months.names;

                cal._currentView = "month";
                modified.setMonth(modified.getMonth() + 1);

                cal.navigateToFuture();

                equal(+cal._viewedValue, +modified);
                ok(cal._title.html().indexOf(names[modified.getMonth()]) !== -1);
            });

            test("navigateToFuture should navigate to next year when year view", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "year";
                modified.setFullYear(modified.getFullYear() + 1);

                cal.navigateToFuture();

                ok(cal._title.html(), modified.getFullYear());
                equal(+cal._viewedValue, +modified);
            });

            test("navigateToFuture should navigate to next decade when decade view", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "decade";
                modified.setFullYear(modified.getFullYear() + 10);


                var start = modified.getFullYear() - modified.getFullYear() % 10;

                cal.navigateToFuture();

                ok(cal._title.html(), start + "-" + (start + 9));
                equal(+cal._viewedValue, +modified);
            });

            test("navigateToFuture should navigate to next century when century view", function() {
                var cal = new Calendar(div, {
                        max: new Date(2400, 10, 10),
                        animation: false
                    }),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "century";
                modified.setFullYear(modified.getFullYear() + 100);


                var start = modified.getFullYear() - modified.getFullYear() % 100;

                cal.navigateToFuture();

                ok(cal._title.html(), start + "-" + (start + 99));
                equal(+cal._viewedValue, +modified);
            });

            test("navigateUp should navigate upper view (year)", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "month";

                cal.navigateUp();

                equal(cal._currentView, "year");
            });

            test("navigateUp should navigate upper view (decade)", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "year";

                cal.navigateUp();

                equal(cal._currentView, "decade");
            });

            test("navigateUp should navigate upper view (century)", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "decade";

                cal.navigateUp();

                equal(cal._currentView, "century");
                ok(cal._title.hasClass("k-state-disabled"));
            });

            test("navigateDown should navigate lower view (decade)", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "century";

                cal.navigateDown(modified);

                equal(cal._currentView, "decade");
            });

            test("navigateDown should navigate lower view (year)", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "decade";

                cal.navigateDown(modified);

                equal(cal._currentView, "year");
            });

            test("navigateDown should navigate lower view (month)", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "year";

                cal.navigateDown(modified);

                equal(cal._currentView, "month");
            });

            test("navigateDown should navigate lower view (month)", function() {
                var cal = new Calendar(div, {animation: false}),
                    modified = new Date(cal._viewedValue);

                cal._currentView = "year";

                cal.navigateDown(modified);

                equal(cal._currentView, "month");
            });

            test("navigateDown with date navigate to cell's date", function() {
                var cal = stub(new Calendar(div, {animation: false}), "navigate"),
                    value = new Date(2000, 10, 10);

                cal._currentView = "year";

                cal.navigateDown(value);

                equal(cal.calls("navigate"), 1);
                equal(+cal.args("navigate")[0], +value);
            });

            test("navigateDown should call value method if _currentView === options.depth", function() {
                var cal = stub(new Calendar(div, {animation: false}), "value"),
                    value = new Date(2000, 10, 10);

                cal.navigateDown(value);

                equal(cal.calls("value"), 1);
                equal(+cal.args("value")[0], +value);
            });

            test("navigate should put in range passed date", function() {
                var cal = new Calendar(div, {animation: false}),
                    value = new Date(1800, 10, 10);

                cal.navigate(value);

                equal(+cal._viewedValue, +cal.options.min);
            });

            test("value should select set selectedValue property", function() {
                var cal = new Calendar(div, {animation: false}),
                    value = new Date(2000, 10, 10);

                cal.value(value);

                equal(+cal._value, +value);
            });

            test("value should return selectedValue", function() {
                var cal = new Calendar(div, {animation: false}),
                    value = new Date(2000, 10, 10);

                cal._value = value;

                equal(+cal.value(), +value);
            });

            test("value method should call navigate method with correct date", function() {
                var value = new Date(2000,10,10),
                    cal = new Calendar(div, {value: value});

                stub(cal, "navigate");

                cal.value(value);

                equal(cal.calls("navigate"), 1);
                equal(+cal.args("navigate")[0], +value);
            });

            test("value method should update selection of the view", function() {
                var value = new Date(2000,10,10),
                    cal = new Calendar(div, {value: value, animation: false});

                    value.setDate(17);

                    cal.value(value);

                ok(cal.element.find(".k-content td").eq(19).hasClass("k-state-selected"));
            });

            test("value should clear _value if null", function() {
                var value = new Date(2000,10,10),
                    cal = new Calendar(div, {min: value, animation: false});

                cal.value(null);

                equal(cal.value(), null);
                equal(cal.element.find(".k-content td:has(k-state-selected)").length, 0);
            });

            test("value should not accept value lower than min", function() {
                var value = new Date(2000,10,10),
                    cal = new Calendar(div, {min: value, animation: false});

                cal.value(new Date(1900, 10,10));

                equal(cal.value(), null);
            });

            test("value should not accept value bigger than max", function() {
                var value = new Date(2000,10,10),
                    cal = new Calendar(div, {max: value, animation: false});

                cal.value(new Date(2900, 10,10));

                equal(cal.value(), null);
            });

            test("value should not accept invalid date", function() {
                var value = new Date(2000,10,10),
                    cal = new Calendar(div, {max: value, animation: false});

                cal.value("dsadasDA");

                equal(cal.value(), null);
            });

            test("focus date depending on given value", function() {
                var value = new Date(2000,10,10),
                    cal = new Calendar(div, {animation: false});

                cal._focus(value);

                equal(cal._table.find(".k-state-focused").length, 1);
                equal(cal._table.find(".k-state-focused").text(), "10");
            });

            test("focus date in current view without navigating", function() {
                var value = new Date(2000,10,10),
                    viewedValue = new Date(2000, 10, 15),
                    cal = new Calendar(div, {value: value, animation: false});

                cal.navigate(null, "year");

                cal._focus(value);

                equal(cal._table.find(".k-state-focused").length, 1);
                equal(cal._table.find(".k-state-focused").text(), "Nov");
            });

            test("focus should not call navigate if need to focus next cell in current decade view", function() {
                var value = new Date(2005,10,10),
                    viewedValue = new Date(2004, 10, 15),
                    cal = new Calendar(div, {animation: false});

                cal._viewedValue = viewedValue;
                cal._view = kendo.calendar["decade"];

                stub(cal, {navigate: cal.navigate});

                cal._focus(value);

                equal(cal.calls("navigate"), 0);
            });

            test("navigate should not re-render view if it was not changed", function() {
                var value = new Date(2000, 10, 10),
                    cal = new Calendar(div, {value: value});

                stub(kendo.calendar.month, "content");

                cal.navigateDown(value);

                equal(kendo.calendar.month.calls("content"), 0);
            });

            test("navigate should not re-render view if it was not changed", function() {
                var value = new Date(2000, 10, 10),
                    cal = new Calendar(div, {value: value, min: value});

                stub(kendo.calendar.month, "content");

                cal.navigateToPast(value);

                equal(kendo.calendar.month.calls("content"), 0);
            });

            test("min() returns current min value", function() {
                 var value = new Date(2000, 10, 10),
                 cal = new Calendar(div, {min: value});

                 var result = cal.min();

                 equal(+result, +value);
             });

            test("min() should set min value value of the calendar", function() {
                 var value = new Date(2000, 10, 10),
                 cal = new Calendar(div);

                 cal.min(value);

                 equal(+cal.options.min, +value);
             });

             test("min() should set min value value of the calendar", function() {
                 var value = new Date(2000, 10, 10),
                 cal = new Calendar(div);

                 cal.min(value);
                 stub(cal, { navigate: cal.navigate });

                 equal(+cal.options.min, +value);
                 equal(cal.calls("navigate"), 0);
            });

            test("Should navigate if min is bigger then _viewedValue", function() {
                 var value = new Date(2000, 10, 10),
                     cal = new Calendar(div, {value: value});

                 value.setDate(5); //should re-render in order to hide dates before 5th

                 stub(cal, { navigate: cal.navigate });

                 cal.min(value);

                 equal(cal.calls("navigate"), 1);
            });

            test("Should clear _value if less then min", function() {
                 var value = new Date(2000, 10, 10),
                     cal = new Calendar(div, {value: value});

                 value.setDate(13);

                 stub(cal, { navigate: cal.navigate });

                 cal.min(value);

                 equal(cal.value(), null);
                 equal(cal.calls("navigate"), 1);
            });

            test("max() returns current max value", function() {
                 var value = new Date(2000, 10, 10),
                 cal = new Calendar(div, {max: value});

                 var result = cal.max();

                 equal(+result, +value);
             });

            test("max() should set max value value of the calendar", function() {
                 var value = new Date(2050, 10, 10),
                 cal = new Calendar(div);

                 cal.max(value);
                 stub(cal, { navigate: cal.navigate });

                 equal(+cal.options.max, +value);
                 equal(cal.calls("navigate"), 0);
            });

            test("Should navigate if max is less then _viewedValue", function() {
                 var value = new Date(2000, 10, 10),
                     cal = new Calendar(div, {value: value});

                 value.setDate(15); //should re-render in order to hide dates after 15th

                 stub(cal, { navigate: cal.navigate });

                 cal.max(value);

                 equal(cal.calls("navigate"), 1);
            });

            test("Should clear _value if bigger then max", function() {
                 var value = new Date(2000, 10, 10),
                     cal = new Calendar(div, {value: value});

                 value.setDate(5);

                 stub(cal, { navigate: cal.navigate });

                 cal.max(value);

                 equal(cal.value(), null);
                 equal(cal.calls("navigate"), 1);
            });

        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
