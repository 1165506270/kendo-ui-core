<!DOCTYPE html>
<html>
    <head>
        <title>kendo.chart</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <link href="../qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.chart.js"></script>
        <script type="text/javascript">
            var Chart = kendo.ui.Chart,
                Box = Chart.Box,
                chartBox = new Box(0, 0, 800, 600);

            function BarStub(box) {
                this.boxHistory = [];
                this.box = box;
            }

            BarStub.prototype = {
                updateLayout: function(box) {
                    this.boxHistory.push(box);
                }
            };

            (function() {
                var series,
                    plotArea,
                    positiveValues = [1, 2];

                function PlotAreaStub() {
                    this.box = new Box(0, 0, 100, 100);
                }

                $.extend(PlotAreaStub.prototype, {
                    getDataPointBox: function(point) {
                        //return new Box(point.x, point.y, point.x + 1, point.y + 1);
                    }
                });

                module("Bar Series", {
                    setup: function() {
                        plotArea = new PlotAreaStub();

                        series = new Chart.BarSeries(plotArea, 0, {
                            seriesData: [ positiveValues ]
                        });
                    }
                });

                test("Creates bars for series data points", function() {
                    equal(series.children.length, positiveValues.length);
                });

                test("Reports value range", function() {
                    same(series.getValueRange(), [positiveValues[0], positiveValues[1]]);
                });

            })();

            (function() {
                var cluster,
                    bars,
                    clusterBox = new Box(0, 0, 100, 100);

                function createCluster(options) {
                    cluster = new Chart.DataPointCluster(options);
                    bars = [ new BarStub(), new BarStub() ];
                    [].push.apply(cluster.children, bars);
                    cluster.updateLayout(clusterBox);
                }

                module("Horizontal Cluster", {
                    setup: function() {
                        createCluster();
                    }
                });

                test("distributes width evenly", function() {
                    $.each(bars, function() {
                        equal(this.boxHistory[0].width(), clusterBox.width() / bars.length)
                    });
                });

                test("positions children next to each other", function() {
                    $.each(bars, function(index) {
                        equal(this.boxHistory[0].x1, this.boxHistory[0].width() * index)
                    });
                });

                module("Vertical Cluster", {
                    setup: function() {
                        createCluster({ isHorizontal: false });
                    }
                });

                test("distributes height evenly", function() {
                    $.each(bars, function() {
                        equal(this.boxHistory[0].height(), clusterBox.height() / bars.length)
                    });
                });

                test("positions children below each other", function() {
                    $.each(bars, function(index) {
                        equal(this.boxHistory[0].y1, this.boxHistory[0].height() * index)
                    });
                });
            })();

            (function() {
                var stack,
                    stackBox = new Box(0, 0, 100, 100);

                module("Vertical Stack", {
                    setup: function() {
                        stack = new Chart.DataPointStack();
                    }
                });

                test("On first pass: calls updateLayout with original box", function() {
                    stack.children.push(new BarStub());
                    stack.updateLayout(stackBox);

                    same(stack.children[0].boxHistory[0], stackBox);
                });

                test("Second bar is placed on top of the first", function() {
                    stack.children.push(
                        new BarStub(new Box(0, 80, 100, 100)),
                        new BarStub(new Box(0, 50, 100, 100))
                    );

                    stack.updateLayout(stackBox);

                    same(stack.children[1].box.y1, 30);
                    same(stack.children[1].box.y2, 80);
                });


                module("Horizontal Stack", {
                    setup: function() {
                        stack = new Chart.DataPointStack({ isVertical: false });
                        stack.children.push();
                    }
                });

                test("Second bar is placed to the right of the first", function() {
                    stack.children.push(
                        new BarStub(new Box(0, 0, 20, 10)),
                        new BarStub(new Box(0, 0, 50, 10))
                    );

                    stack.updateLayout(stackBox);

                    same(stack.children[1].box.x1, 20);
                    same(stack.children[1].box.x2, 70);
                });

            })();

        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
