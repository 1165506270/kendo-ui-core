<!DOCTYPE html>
<html>
    <head>
        <title>kendo.chart</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <link href="../qunit/qunit/qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.dataviz.core.js"></script>
        <script src="../../src/kendo.dataviz.chart.js"></script>
        <script src="../../src/kendo.dataviz.themes.js"></script>
        <script src="../../src/kendo.dataviz.svg.js"></script>
        <script src="../../src/kendo.dataviz.vml.js"></script>
        <script src="util.js"></script>

        <script type="text/javascript">
            var dataviz = kendo.dataviz,
                Box2D = dataviz.Box2D,
                chartBox = new Box2D(0, 0, 800, 600),
                plotArea,
                bubbleChart,
                root,
                view,
                TOLERANCE = 1;

            function setupBubbleChart(plotArea, options) {
                view = new ViewStub();

                bubbleChart = new dataviz.BubbleChart(plotArea, options);

                root = new dataviz.RootElement();
                root.append(bubbleChart);

                bubbleChart.reflow();
                bubbleChart.getViewElements(view);
            }

            (function() {
            var series = { data: [{
                    x: 1, y: 1, size: 1, category: "a",
                    color: "red"
                }, {
                    x: 2, y: 2, size: 20, category: "b"
                }] };

                function PlotAreaStub() { }

                $.extend(PlotAreaStub.prototype, {
                    namedXAxes: {
                        primary: {
                            getSlot: function(categoryIndex) {
                                return new Box2D(0, 0, categoryIndex + 1, 0);
                            }
                        }
                    },
                    namedYAxes: {
                        primary: {
                            getSlot: function(value) {
                                return new Box2D(0, 1, 0, value);
                            },
                            options: {}
                        }
                    },
                    options: {}
                });

                // ------------------------------------------------------------
                module("Bubble Chart / Legend items", {
                    setup: function() {
                        plotArea = new PlotAreaStub();
                        setupBubbleChart(plotArea, { series: [ series ] });
                    }
                });

                test("returns legend item for each point", function() {
                    equals(bubbleChart.legendItems().length, 2);
                });

                test("sets legend item name to category", function() {
                    equals(bubbleChart.legendItems()[0].name, "a");
                });

                test("sets legend item color", function() {
                    equals(bubbleChart.legendItems()[0].color, "red");
                });

                test("skips points with visibleInLegend set to false", function() {
                    bubbleChart.points[1].value.visibleInLegend = false;
                    equals(bubbleChart.legendItems().length, 1);
                });

            })();

            (function() {
                var data = [{
                        xValue: 1,
                        yValue: 10,
                        sizeValue: 100,
                        pointColor: "red"
                    }, {
                        xValue: 2,
                        yValue: 20,
                        sizeValue: 200,
                        pointColor: "blue"
                    }],
                    points;

                function createBubbleChart(bubbleSeries) {
                    $("#container").kendoChart({
                        dataSource: {
                            data: data
                        },
                        series: [kendo.deepExtend({
                            type: "bubble"
                        }, bubbleSeries)]
                    });

                    var chart = $("#container").data("kendoChart");
                    points = chart._plotArea.charts[0].points;
                }

                // ------------------------------------------------------------
                module("Bubble Chart / Data Binding / Data Source", {
                    teardown: function() {
                        $("#container").empty();
                    }
                });

                test("binds to 3-element array", function() {
                    createBubbleChart({
                        data: [[1, 10, 100], [2, 20, 200]]
                    });

                    same(points[1].value, { x: 2, y: 20, size: 200 });
                });

                test("binds x, y and size field", function() {
                    createBubbleChart({
                        xField: "xValue",
                        yField: "yValue",
                        sizeField: "sizeValue"
                    });

                    same(points[1].value, { x: 2, y: 20, size: 200 });
                });

                test("binds color field", function() {
                    createBubbleChart({
                        xField: "xValue",
                        yField: "yValue",
                        sizeField: "sizeValue",
                        colorField: "pointColor"
                    });

                    same(points[1].value.color, "blue");
                });

                test("binds category field", function() {
                    createBubbleChart({
                        xField: "xValue",
                        yField: "yValue",
                        sizeField: "sizeValue",
                        categoryField: "pointColor"
                    });

                    same(points[1].value.category, "blue");
                });

                test("binds to object with x, y and size fields", function() {
                    createBubbleChart({
                        data: [{x: 1, y: 10, size: 100}, {x: 2, y: 20, size: 200}]
                    });

                    same(points[1].value, { x: 2, y: 20, size: 200 });
                });

                test("binds color to object field", function() {
                    createBubbleChart({
                        data: [{ x: 1, y: 10, size: 100, color: "red" }]
                    });

                    same(points[0].value.color, "red");
                });

                test("binds category to object field", function() {
                    createBubbleChart({
                        data: [{ x: 1, y: 10, size: 100, category: "UK" }]
                    });

                    same(points[0].value.category, "UK");
                });

            })();

        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <div id="container">
        </div>
    </body>
</html>
