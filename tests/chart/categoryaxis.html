<!DOCTYPE html>
<html>
    <head>
        <title>kendo.chart</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <link href="../qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.chart.js"></script>
        <script src="util.js"></script>
        <script type="text/javascript">
            var Chart = kendo.ui.Chart,
                Box2D = Chart.Box2D,
                chartBox = new Box2D(0, 0, 800, 600),
                view,
                TOLERANCE = 2;

            // Tests expect particular font size
            Chart.Text.fn.options.font = "16px Verdana, sans-serif";

            function moduleSetup() {
                view = new ViewStub();
            }

            (function() {
                var categoryAxis,
                    MAX_LABEL_HEIGHT = 17,
                    MAJOR_TICK_HEIGHT = 4,
                    LINE_Y = chartBox.y1,
                    LINE_X = 33,
                    MARGIN = PADDING = 5;

                function createCategoryAxis(options) {
                    categoryAxis = new Chart.CategoryAxis(
                        $.extend({
                            categories: ["Foo", "Bar"]
                        }, options)
                    );
                    categoryAxis.reflow(chartBox);
                }

                // ------------------------------------------------------------
                module("Category Axis / Horizontal / Rendering", {
                    setup: function() {
                        moduleSetup();

                        createCategoryAxis();
                    }
                });

                test("creates axis line", function() {
                    categoryAxis.getViewElements(view);
                    sameBox(view.log.line[0], new Box2D(
                            chartBox.x1, LINE_Y,
                            chartBox.x2, LINE_Y),
                            TOLERANCE
                    );
                });

                test("creates labels", 1, function() {
                    categoryAxis.getViewElements(view);

                    same($.map(view.log.text, function(text) { return text.content }),
                         ["Foo", "Bar"]);
                });

                test("labels have set color", 1, function() {
                    createCategoryAxis({
                        labels: {
                            color: "#f00"
                        }
                    });

                    categoryAxis.getViewElements(view);

                    equals(view.log.text[0].style.color, "#f00");
                });

                test("labels have rotation angle", 1, function() {
                    createCategoryAxis({
                        labels: {
                            rotation: 42.5
                        }
                    });

                    categoryAxis.getViewElements(view);

                    equals(view.log.text[0].style.rotation, 42.5);
                });

                test("labels have set background", 1, function() {
                    createCategoryAxis({
                        labels: {
                            background: "#f0f"
                        }
                    });

                    categoryAxis.getViewElements(view);

                    equals(view.log.rect[0].style.fill, "#f0f");
                });

                test("labels are positioned below axis line with margin and padding", 2, function() {
                    createCategoryAxis({
                        labels: {
                            margin: MARGIN,
                            padding: PADDING
                        }
                    });

                    categoryAxis.getViewElements(view);

                    $.each(view.log.text, function() {
                            equal(this.style.y, LINE_Y + MAJOR_TICK_HEIGHT + 2 * MARGIN + PADDING, TOLERANCE);
                    })
                });

                test("labels are distributed horizontally", function() {
                    categoryAxis.getViewElements(view);

                    same($.map(view.log.text, function(text) { return text.style.x }),
                         [185.5, 586.5], TOLERANCE);
                });

                test("labels are positioned below axis line", 2, function() {
                    categoryAxis.getViewElements(view);
                    $.each(view.log.text, function() {
                            equal(this.style.y, LINE_Y + MAJOR_TICK_HEIGHT + MARGIN, TOLERANCE);
                    })
                });

                test("major ticks are distributed horizontally", function() {
                    categoryAxis.getViewElements(view);
                    view.log.line.shift();
                    same($.map(view.log.line, function(line) { return line.x1; }),
                         [0, 400, 800], TOLERANCE);
                });

                test("major ticks can be disabled", function() {
                    categoryAxis.options.majorTickType = "none";
                    categoryAxis.getViewElements(view);
                    view.log.line.shift();
                    equal(view.log.line.length, 0);
                });

                test("minor ticks are distributed horizontally", function() {
                    categoryAxis.options.majorTickType = "none";
                    categoryAxis.options.minorTickType = "outside";
                    categoryAxis.getViewElements(view);
                    view.log.line.shift();
                    same($.map(view.log.line, function(line) { return line.x1; }),
                         [0, 200, 400, 600, 800], TOLERANCE);
                });

                test("minor ticks can be disabled", function() {
                    categoryAxis.options.majorTickType = "none";
                    categoryAxis.options.minorTickType = "none";
                    categoryAxis.getViewElements(view);
                    view.log.line.shift();
                    equal(view.log.line.length, 0);
                });

                test("line width 0 remove all ticks", function() {
                    categoryAxis.options.line.width = 0;
                    categoryAxis.options.majorTickType = "outside";
                    categoryAxis.options.minorTickType = "outside";
                    categoryAxis.getViewElements(view);
                    equal(view.log.line.length, 0);
                });

                // ------------------------------------------------------------
                module("Category Axis / Vertical / Rendering", {
                    setup: function() {
                        moduleSetup();

                        createCategoryAxis({ orientation: "vertical" });
                    }
                });

                test("creates axis line", function() {
                    categoryAxis.getViewElements(view);
                    sameBox(view.log.line[0], new Box2D(
                            LINE_X + MARGIN, chartBox.y1,
                            LINE_X + MARGIN, chartBox.y2),
                            TOLERANCE
                    );
                });

                test("creates labels", 1, function() {
                    categoryAxis.getViewElements(view);

                    same($.map(view.log.text, function(text) { return text.content }),
                         ["Foo", "Bar"]);
                });

                test("labels have rotation angle", 1, function() {
                    createCategoryAxis({
                        labels: {
                            rotation: 42.5
                        }
                    });

                    categoryAxis.getViewElements(view);

                    equals(view.log.text[0].style.rotation, 42.5);
                });

                test("labels are distributed vertically", function() {
                    categoryAxis.getViewElements(view);

                    same($.map(view.log.text, function(text) { return text.style.y }),
                         [141, 441], TOLERANCE);
                });

                test("labels are positioned to the left of the axis line", function() {
                    categoryAxis.getViewElements(view);

                    same($.map(view.log.text, function(text) { return text.style.x }),
                         [0, 2]);
                });

                test("major ticks are distributed vertically", function() {
                    categoryAxis.getViewElements(view);
                    view.log.line.shift();
                    same($.map(view.log.line, function(line) { return line.y1; }),
                         [0, 300, 600], TOLERANCE);
                });

                test("minor ticks are distributed vertically", function() {
                    categoryAxis.options.majorTickType = "none";
                    categoryAxis.options.minorTickType = "outside";
                    categoryAxis.getViewElements(view);
                    view.log.line.shift();
                    same($.map(view.log.line, function(line) { return line.y1; }),
                        [0, 150, 300, 450, 600], TOLERANCE);
                });

                test("line width 0 remove all ticks", function() {
                    categoryAxis.options.line.width = 0;
                    categoryAxis.options.majorTickType = "outside";
                    categoryAxis.options.minorTickType = "outside";
                    categoryAxis.getViewElements(view);

                    equal(view.log.line.length, 0);
                });

                test("labels have set background", 1, function() {
                    createCategoryAxis({
                        orientation: "vertical",
                        labels: {
                            background: "#f0f"
                        }
                    });

                    categoryAxis.getViewElements(view);

                    equals(view.log.rect[0].style.fill, "#f0f");
                });

                test("labels are positioned to the left of the axis line with margin and padding", function() {
                    createCategoryAxis({
                        orientation: "vertical",
                        labels: {
                            margin: MARGIN,
                            padding: PADDING
                        }
                    });

                    categoryAxis.getViewElements(view);

                    same($.map(view.log.text, function(text) { return text.style.x }),
                         [0 + MARGIN + PADDING, 2 + MARGIN + PADDING]);
                });

                // ------------------------------------------------------------
                module("Category Axis / Horizontal / Slots", {
                    setup: function() {
                        moduleSetup();

                        createCategoryAxis();
                    }
                });

                test("positions slot for first category", function() {
                    var slot = categoryAxis.getSlot(0);
                    same([slot.x1, slot.x2], [0, chartBox.width() / 2]);
                });

                test("positions slot for second category", function() {
                    var slot = categoryAxis.getSlot(1);
                    same([slot.x1, slot.x2], [chartBox.width() / 2, chartBox.width()]);
                });

                test("slot height is 0", function() {
                    var slot = categoryAxis.getSlot(0);
                    same(slot.height(), 0);
                });

                test("assumes 1 category when no categories are defined", function() {
                    categoryAxis = new Chart.CategoryAxis();
                    categoryAxis.reflow(chartBox);

                    var slot = categoryAxis.getSlot(0);
                    same([slot.x1, slot.x2], [0, chartBox.width()]);
                });

                // ------------------------------------------------------------
                module("Category Axis / Vertical / Slots", {
                    setup: function() {
                        moduleSetup();

                        createCategoryAxis({ orientation: "vertical" });
                    }
                });

                test("positions slot for first category", function() {
                    var slot = categoryAxis.getSlot(0);
                    same([slot.y1, slot.y2], [0, chartBox.height() / 2]);
                });

                test("positions slot for second category", function() {
                    var slot = categoryAxis.getSlot(1);
                    same([slot.y1, slot.y2], [chartBox.height() / 2, chartBox.height()]);
                });

                test("slot width is 0", function() {
                    var slot = categoryAxis.getSlot(0);
                    same(slot.width(), 0);
                });

            })();

        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
