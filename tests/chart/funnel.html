<!DOCTYPE html>
<html>
    <head>
        <title>kendo.chart.funnel</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit/addons/close-enough/qunit-close-enough.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <link href="../qunit/qunit/qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.dataviz.core.js"></script>
        <script src="../../src/kendo.dataviz.chart.js"></script>
        <script src="../../src/kendo.dataviz.chart.funnel.js"></script>
        <script src="../../src/kendo.dataviz.themes.js"></script>
        <script src="../../src/kendo.dataviz.svg.js"></script>
        <script src="../../src/kendo.dataviz.vml.js"></script>
        <script src="util.js"></script>
        <script type="text/javascript">
            var dataviz = kendo.dataviz,
                Box2D = dataviz.Box2D,
                TOLERANCE = 1,
                box = new Box2D(0, 0, 800, 600),
                chart;

            function createChart(options) {
                var plotArea = {
                    options: {
                        seriesColors: ["red", "green", "blue"]
                    }
                };

                chart = new dataviz.FunnelChart(plotArea, options);
                chart.reflow(box);
            }

            // ------------------------------------------------------------
            module("dependOn none", {
                setup: function() {
                    createChart({
                        series: [{
                            type: "funnel",
                            data: [{
                                value: 1,
                                category: "A",
                            }, {
                                value: 2,
                                category: "B"
                            }, {
                                value: 3,
                                category: "C"
                            }]
                        }]
                    });
                }
            });

            test("First segment position", function() {
                arrayClose(mapPoints(chart.segments[0].points), [
                    [0, 0], [800, 0], [707, 200], [93, 200]
                ], TOLERANCE);
            });

            test("Second segment position", function() {
                arrayClose(mapPoints(chart.segments[1].points), [
                    [93, 200], [706, 200], [613, 400], [186, 400]
                ], TOLERANCE);
            });

            test("Third segment position", function() {
                arrayClose(mapPoints(chart.segments[2].points), [
                    [186,400], [613, 400], [520, 600], [280, 600]
                ], TOLERANCE);
            });


            test("Creates segments for data points", function() {
                equal(chart.segments.length, chart.options.series[0].data.length);
            });

            module("dependOn height", {
                setup: function() {
                    createChart({
                        dependOn:"height",
                        series: [{
                            type: "funnel",
                            data: [{
                                value: 1,
                                category: "A",
                            }, {
                                value: 2,
                                category: "B"
                            }, {
                                value: 3,
                                category: "C"
                            }]
                        }]
                    });
                }
            });

            test("First segment position", function() {
                arrayClose(mapPoints(chart.segments[0].points), [
                    [0, 0], [800, 0], [753, 100], [46, 100]
                ], TOLERANCE);
            });

            test("Second segment position", function() {
                arrayClose(mapPoints(chart.segments[1].points), [
                    [46, 100], [753, 100], [660, 300], [140, 300]
                ], TOLERANCE);
            });

            test("Third segment position", function() {
                arrayClose(mapPoints(chart.segments[2].points), [
                    [140,300], [660, 300], [520, 600], [280, 600]
                ], TOLERANCE);
            });

            module("max neckSize", {
                setup: function() {
                    createChart({
                        dependOn:"height",
                        neckSize: 1,
                        series: [{
                            type: "funnel",
                            data: [{
                                value: 1,
                                category: "A",
                            }, {
                                value: 2,
                                category: "B"
                            }, {
                                value: 3,
                                category: "C"
                            }]
                        }]
                    });
                }
            });

            test("First segment position", function() {
                arrayClose(mapPoints(chart.segments[0].points), [
                    [0, 0], [800, 0], [800, 100], [0, 100]
                ], TOLERANCE);
            });

            test("Second segment position", function() {
                arrayClose(mapPoints(chart.segments[1].points), [
                    [0, 100], [800, 100], [800, 300], [0, 300]
                ], TOLERANCE);
            });

            test("Third segment position", function() {
                arrayClose(mapPoints(chart.segments[2].points), [
                    [0, 300], [800, 300], [800, 600], [0, 600]
                ], TOLERANCE);
            });

            module("min neckSize", {
                setup: function() {
                    createChart({
                        dependOn:"height",
                        neckSize: 0,
                        series: [{
                            type: "funnel",
                            data: [{
                                value: 1,
                                category: "A",
                            }, {
                                value: 2,
                                category: "B"
                            }, {
                                value: 3,
                                category: "C"
                            }]
                        }]
                    });
                }
            });

            test("First segment position", function() {
                arrayClose(mapPoints(chart.segments[0].points), [
                    [0, 0], [800, 0], [733, 100], [66, 100]
                ], TOLERANCE);
            });

            test("Second segment position", function() {
                arrayClose(mapPoints(chart.segments[1].points), [
                    [66, 100], [733, 100], [600, 300], [200, 300]
                ], TOLERANCE);
            });

            test("Third segment position", function() {
                arrayClose(mapPoints(chart.segments[2].points), [
                    [200, 300], [600, 300], [400, 600], [400, 600]
                ], TOLERANCE);
            });

            module("Series setup")

            test("sets point owner", function() {
                ok(chart.segments[0].owner === chart);
            });

            test("sets point series", function() {
                equal(chart.segments[0].series.type, "funnel");
            });

            test("sets point category", function() {
                equal(chart.segments[0].category, "A");
            });

            test("sets point dataItem", function() {
                equal(typeof chart.segments[0].dataItem, "object");
            });
        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <div id="container" style="width: 600px; height: 400px">
        </div>
    </body>
</html>
