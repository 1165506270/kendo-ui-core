<!DOCTYPE html>
<html>
    <head>
        <title>kendo.chart</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <link href="../qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.chart.js"></script>
        <script type="text/javascript">
            var Chart = kendo.ui.Chart,
                Box2D = Chart.Box2D,
                Point2D = Chart.Point2D,
                box,
                targetBox;

            // ------------------------------------------------------------
            module("Box2D", {
                setup: function() {
                    box = new Box2D(0, 0, 20, 20);
                    targetBox = new Box2D(10, 10, 40, 40);
                }
            });

            test("clone returns new instance", function() {
                notEqual(box.clone(), box);
            });

            test("clone copies coordinates", function() {
                var clone = box.clone();

                same([clone.x1, clone.y1, clone.x2, clone.y2],
                     [box.x1, box.y1, box.x2, box.y2]);
            });

            test("translate on x-axis", function() {
                var clone = box.clone().translate(10, 0);

                same([clone.x1, clone.y1, clone.x2, clone.y2],
                     [box.x1 + 10, box.y1, box.x2 + 10, box.y2]);
            });

            test("translate y-axis", function() {
                var clone = box.clone().translate(0, 10);

                same([clone.x1, clone.y1, clone.x2, clone.y2],
                     [box.x1, box.y1 + 10, box.x2, box.y2 + 10]);
            });

            test("translate returns box instance", function() {
                equal(box.translate(0, 0), box);
            });

            test("wrap increases box size to fit target box", function() {
                box.wrap(targetBox);
                same([box.x1, box.y1, box.x2, box.y2], [0, 0, 40, 40]);
            });

            test("wrap returns box instance", function() {
                equal(box.wrap(targetBox), box);
            });

            test("snapTo moves box to target location", function() {
                box.snapTo(targetBox);

                same([box.x1, box.y1], [targetBox.x1, targetBox.y1]);
            });

            test("snapTo updates dimensions to match target", function() {
                box.snapTo(targetBox);

                same([box.width(), box.height()], [targetBox.width(), targetBox.height()]);
            });

            test("snapTo on x-axis updates only x coordinates", function() {
                var clone = box.clone().snapTo(targetBox, "x");

                same([clone.x1, clone.y1, clone.x2, clone.y2],
                     [targetBox.x1, box.y1, targetBox.x2, box.y2]);
            });

            test("snapTo on y-axis updates only y coordinates", function() {
                var clone = box.clone().snapTo(targetBox, "y");

                same([clone.x1, clone.y1, clone.x2, clone.y2],
                     [box.x1, targetBox.y1, box.x2, targetBox.y2]);
            });

            test("snapTo returns box instance", function() {
                equal(box.snapTo(targetBox), box);
            });

            test("alignTo 'top' aligns box to target top", function() {
                box.alignTo(targetBox, "top");
                equal(box.y2, targetBox.y1);
            });

            test("alignTo 'top' keeps height", function() {
                var clone = box.clone().alignTo(targetBox, "top");
                equal(clone.height(), box.height());
            });

            test("alignTo 'bottom' aligns box to target bottom", function() {
                box.alignTo(targetBox, "bottom");
                equal(box.y1, targetBox.y2);
            });

            test("alignTo 'bottom' keeps height", function() {
                var clone = box.clone().alignTo(targetBox, "bottom");
                equal(clone.height(), box.height());
            });

            test("alignTo 'right' aligns box to target right edge", function() {
                box.alignTo(targetBox, "right");
                equal(box.x1, targetBox.x2);
            });

            test("alignTo 'right' keeps width", function() {
                var clone = box.clone().alignTo(targetBox, "right");
                equal(clone.height(), box.height());
            });

            test("alignTo 'left' aligns box to target left edge", function() {
                box.alignTo(targetBox, "left");
                equal(box.x2, targetBox.x1);
            });

            test("alignTo 'left' keeps width", function() {
                var clone = box.clone().alignTo(targetBox, "left");
                equal(clone.height(), box.height());
            });

            test("alignTo returns box instance", function() {
                equal(box.alignTo(targetBox, "bottom"), box);
            });

            test("shrink reduces width", function() {
                var clone = box.clone().shrink(10, 0);
                equal(clone.width(), box.width() - 10);
            });

            test("shrink reduces height", function() {
                var clone = box.clone().shrink(0, 10);
                equal(clone.height(), box.height() - 10);
            });

            test("shrink returns box instance", function() {
                equal(box.shrink(0, 0), box);
            });

            test("expand increases width", function() {
                var clone = box.clone().expand(10, 0);
                equal(clone.width(), box.width() + 10);
            });

            test("expand increases height", function() {
                var clone = box.clone().expand(0, 10);
                equal(clone.height(), box.height() + 10);
            });

            test("expand returns box instance", function() {
                equal(box.expand(0, 0), box);
            });

            test("move changes x", function() {
                var clone = box.clone().move(10, 0);
                equal(clone.x1, box.x1 + 10);
            });

            test("move changes y", function() {
                var clone = box.clone().move(0, 10);
                equal(clone.y1, box.y1 + 10);
            });

            test("move maintains width", function() {
                var clone = box.clone().move(10, 0);
                equal(clone.width(), box.width());
            });

            test("move maintains height", function() {
                var clone = box.clone().move(0, 10);
                equal(clone.height(), box.height());
            });

            test("move returns box instance", function() {
                equal(box.move(0, 0), box);
            });

            test("pad adds top padding", function() {
                var clone = box.clone().pad(10);
                equal(clone.y1, box.y1 - 10);
            });

            test("pad adds right padding", function() {
                var clone = box.clone().pad(10);
                equal(clone.x2, box.x2 + 10);
            });

            test("pad adds bottom padding", function() {
                var clone = box.clone().pad(10);
                equal(clone.y2, box.y2 + 10);
            });

            test("pad adds left padding", function() {
                var clone = box.clone().pad(10);
                equal(clone.x1, box.x1 - 10);
            });

            test("pad returns box instance", function() {
                equal(box.pad(0), box);
            });

            test("unpad adds top padding", function() {
                var clone = box.clone().unpad(10);
                equal(clone.y1, box.y1 + 10);
            });

            test("unpad adds right padding", function() {
                var clone = box.clone().unpad(10);
                equal(clone.x2, box.x2 - 10);
            });

            test("unpad adds bottom padding", function() {
                var clone = box.clone().unpad(10);
                equal(clone.y2, box.y2 - 10);
            });

            test("unpad adds left padding", function() {
                var clone = box.clone().unpad(10);
                equal(clone.x1, box.x1 + 10);
            });

            test("unpad returns box instance", function() {
                equal(box.unpad(0), box);
            });

            test("containsPoint returns true for points within box", function() {
                ok(box.containsPoint(5, 5));
            });

            test("containsPoint returns false for points outside box", function() {
                ok(box.containsPoint(5, 5));
            });

            test("center returns x center", function() {
                equals(box.center().x, 10);
            });

            test("center returns y center", function() {
                equals(box.center().y, 10);
            });

            test("points returns box points", function() {
                same($.map(box.points(), function(point) {
                    return [[point.x, point.y]];
                }), [
                    [0, 0], [20, 0], [20, 20], [0, 20]
                ]);
            });

            // ------------------------------------------------------------
            var point;

            module("Point2D", {
                setup: function() {
                    point = new Point2D(10, 20);
                }
            });

            test("constructor sets x", function() {
                equals(point.x, 10);
            });

            test("constructor sets y", function() {
                equals(point.y, 20);
            });

            // ------------------------------------------------------------
            var sector;

            module("Sector", {
                setup: function() {
                    sector = new Chart.Sector(new Point2D(10, 20), 30, 90, 180);
                }
            });

            test("constructor sets center", function() {
                same([sector.c.x, sector.c.y], [10, 20]);
            });

            test("constructor sets r", function() {
                equals(sector.r, 30);
            });

            test("constructor sets start angle", function() {
                equals(sector.startAngle, 90);
            });

            test("constructor sets angle", function() {
                equals(sector.angle, 180);
            });

            // ------------------------------------------------------------
            var deepExtend = Chart.deepExtend,
                extendSrc,
                extendDst;

            module("deepExtend", {
                setup: function() {
                    extendSrc = {
                        margin: {
                            top: 10
                        },
                        colors: ["red"],
                        border: 5
                    };

                    extendDst = {
                        margin: 5,
                        colors: ["green", "blue"],
                        border: undefined
                    }

                    deepExtend(extendDst, extendSrc);
                }
            });

            test("Overwrites arrays", function() {
                equal(extendDst.colors[0], "red");
                equal(extendDst.colors.length, 1);
            });

            test("Does not copy undefined values", function() {
                equal(extendDst.border, 5);
            });

            test("Overwrites fields containing primitive types", function() {
                equal(extendDst.margin.top, 10);
            });

            // ------------------------------------------------------------
            var Color = Chart.Color;

            module("Color");

            test("assumes black when parsing undefined", function() {
                var c = new Color(undefined);
                equals(c.toHex(), "#000000");
            });

            test("parses #xxyyzz", function() {
                var c = new Color("#aabbcc");
                equals(c.toHex(), "#aabbcc");
            });

            test("parses #xyz", function() {
                var c = new Color("#abc");
                equals(c.toHex(), "#aabbcc");
            });

            test("parses rgb(x, y, z)", function() {
                var c = new Color("rgb(170, 187, 204)");
                equals(c.toHex(), "#aabbcc");
            });

            test("normalizes rgb(x, y, z)", function() {
                var c = new Color("rgb(0, 400, 500)");
                equals(c.toHex(), "#00ffff");
            });

            test("parses named color", function() {
                var c = new Color("tomato");
                equals(c.toHex(), "#ff6347");
            });

            test("accepts rgb values", function() {
                var c = new Color(0, 255, 255);
                equals(c.toHex(), "#00ffff");
            });

            test("brightness lightens colors", function() {
                var c = new Color(100, 100, 240).brightness(1.2);
                equals(c.toHex(), "#7878ff");
            });

            test("brightness darkens colors", function() {
                var c = new Color(100, 100, 0).brightness(0.2);
                equals(c.toHex(), "#141400");
            });

            // ------------------------------------------------------------
            module("blendColors");

            test("#fff, #99c62a with alpha 0.2 => #add155", function() {
                equals(Chart.blendColors("#99c62a", "#fff", 0.2), "#add155");
            });

            // ------------------------------------------------------------
            var blendGradient = Chart.blendGradient,
                gradient;

            module("blendGradient", {
                setup: function() {
                    gradient = {
                        stops: [{
                            offset: 0.05,
                            color: "#fff",
                            opacity: 0.2
                        }]
                    };
                }
            });

            test("blend over #99c62a with alpha 0.2", function() {
                var result = blendGradient("#99c62a", gradient);

                same(result.stops[0], {
                    offset: 0.05,
                    color: "#add155",
                    opacity: 0
                });
            });

            // ------------------------------------------------------------
            module("Chart Gradients");

            test("build returns overlay from name", function() {
                equals(Chart.Gradients.build({ name: "glass" }).type, "linear");
            });

            test("build returns undefined when no overlay exists", function() {
                equals(typeof Chart.Gradients.build("x"), "undefined");
            });

            test("build applies options", function() {
                equals(Chart.Gradients.build({ name: "glass", rotation: 90 }).rotation, 90);
            });

            test("build returns same gradient for same options", function() {
                equals(Chart.Gradients.build({ name: "glass", rotation: 90 }).id,
                       Chart.Gradients.build({ name: "glass", rotation: 90 }).id);
            });

        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html> 
