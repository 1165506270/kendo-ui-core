<!DOCTYPE html>
<html>
    <head>
        <title>Chart helpers</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <link href="../qunit/qunit/qunit.css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.dataviz.core.js"></script>
        <script src="../../src/kendo.dataviz.chart.js"></script>
        <script src="../../src/kendo.dataviz.themes.js"></script>
        <script src="../../src/kendo.dataviz.svg.js"></script>
        <script src="../../src/kendo.dataviz.vml.js"></script>
        <script>
            var dataviz = kendo.dataviz,
                Chart = dataviz.ui.Chart,
                Box2D = dataviz.Box2D,
                Point2D = dataviz.Point2D,
                box,
                targetBox;

            // ------------------------------------------------------------
            module("Box2D", {
                setup: function() {
                    box = new Box2D(0, 0, 20, 20);
                    targetBox = new Box2D(10, 10, 40, 40);
                }
            });

            test("clone returns new instance", function() {
                notEqual(box.clone(), box);
            });

            test("clone copies coordinates", function() {
                var clone = box.clone();

                deepEqual([clone.x1, clone.y1, clone.x2, clone.y2],
                     [box.x1, box.y1, box.x2, box.y2]);
            });

            test("getHash returns hash code", function() {
                equal(box.getHash(), "0,0,20,20");
            });

            test("translate on x-axis", function() {
                var clone = box.clone().translate(10, 0);

                deepEqual([clone.x1, clone.y1, clone.x2, clone.y2],
                     [box.x1 + 10, box.y1, box.x2 + 10, box.y2]);
            });

            test("translate y-axis", function() {
                var clone = box.clone().translate(0, 10);

                deepEqual([clone.x1, clone.y1, clone.x2, clone.y2],
                     [box.x1, box.y1 + 10, box.x2, box.y2 + 10]);
            });

            test("translate returns box instance", function() {
                equal(box.translate(0, 0), box);
            });

            test("wrap increases box size to fit target box", function() {
                box.wrap(targetBox);
                deepEqual([box.x1, box.y1, box.x2, box.y2], [0, 0, 40, 40]);
            });

            test("wrap returns box instance", function() {
                equal(box.wrap(targetBox), box);
            });

            test("wrapPoint increases box size to fit point", function() {
                box.wrapPoint(new Point2D(40, 40));
                deepEqual([box.x1, box.y1, box.x2, box.y2], [0, 0, 40, 40]);
            });

            test("wrapPoint returns box instance", function() {
                equal(box.wrapPoint(new Point2D(40, 40)), box);
            });

            test("snapTo moves box to target location", function() {
                box.snapTo(targetBox);

                deepEqual([box.x1, box.y1], [targetBox.x1, targetBox.y1]);
            });

            test("snapTo updates dimensions to match target", function() {
                box.snapTo(targetBox);

                deepEqual([box.width(), box.height()], [targetBox.width(), targetBox.height()]);
            });

            test("snapTo on x-axis updates only x coordinates", function() {
                var clone = box.clone().snapTo(targetBox, "x");

                deepEqual([clone.x1, clone.y1, clone.x2, clone.y2],
                     [targetBox.x1, box.y1, targetBox.x2, box.y2]);
            });

            test("snapTo on y-axis updates only y coordinates", function() {
                var clone = box.clone().snapTo(targetBox, "y");

                deepEqual([clone.x1, clone.y1, clone.x2, clone.y2],
                     [box.x1, targetBox.y1, box.x2, targetBox.y2]);
            });

            test("snapTo returns box instance", function() {
                equal(box.snapTo(targetBox), box);
            });

            test("alignTo 'top' aligns box to target top", function() {
                box.alignTo(targetBox, "top");
                equal(box.y2, targetBox.y1);
            });

            test("alignTo 'top' keeps height", function() {
                var clone = box.clone().alignTo(targetBox, "top");
                equal(clone.height(), box.height());
            });

            test("alignTo 'bottom' aligns box to target bottom", function() {
                box.alignTo(targetBox, "bottom");
                equal(box.y1, targetBox.y2);
            });

            test("alignTo 'bottom' keeps height", function() {
                var clone = box.clone().alignTo(targetBox, "bottom");
                equal(clone.height(), box.height());
            });

            test("alignTo 'right' aligns box to target right edge", function() {
                box.alignTo(targetBox, "right");
                equal(box.x1, targetBox.x2);
            });

            test("alignTo 'right' keeps width", function() {
                var clone = box.clone().alignTo(targetBox, "right");
                equal(clone.height(), box.height());
            });

            test("alignTo 'left' aligns box to target left edge", function() {
                box.alignTo(targetBox, "left");
                equal(box.x2, targetBox.x1);
            });

            test("alignTo 'left' keeps width", function() {
                var clone = box.clone().alignTo(targetBox, "left");
                equal(clone.height(), box.height());
            });

            test("alignTo returns box instance", function() {
                equal(box.alignTo(targetBox, "bottom"), box);
            });

            test("shrink reduces width", function() {
                var clone = box.clone().shrink(10, 0);
                equal(clone.width(), box.width() - 10);
            });

            test("shrink reduces height", function() {
                var clone = box.clone().shrink(0, 10);
                equal(clone.height(), box.height() - 10);
            });

            test("shrink returns box instance", function() {
                equal(box.shrink(0, 0), box);
            });

            test("expand increases width", function() {
                var clone = box.clone().expand(10, 0);
                equal(clone.width(), box.width() + 10);
            });

            test("expand increases height", function() {
                var clone = box.clone().expand(0, 10);
                equal(clone.height(), box.height() + 10);
            });

            test("expand returns box instance", function() {
                equal(box.expand(0, 0), box);
            });

            test("move changes x", function() {
                var clone = box.clone().move(10, 0);
                equal(clone.x1, box.x1 + 10);
            });

            test("move changes y", function() {
                var clone = box.clone().move(0, 10);
                equal(clone.y1, box.y1 + 10);
            });

            test("move maintains width", function() {
                var clone = box.clone().move(10, 0);
                equal(clone.width(), box.width());
            });

            test("move maintains height", function() {
                var clone = box.clone().move(0, 10);
                equal(clone.height(), box.height());
            });

            test("move returns box instance", function() {
                equal(box.move(0, 0), box);
            });

            test("pad adds top padding", function() {
                var clone = box.clone().pad(10);
                equal(clone.y1, box.y1 - 10);
            });

            test("pad adds right padding", function() {
                var clone = box.clone().pad(10);
                equal(clone.x2, box.x2 + 10);
            });

            test("pad adds bottom padding", function() {
                var clone = box.clone().pad(10);
                equal(clone.y2, box.y2 + 10);
            });

            test("pad adds left padding", function() {
                var clone = box.clone().pad(10);
                equal(clone.x1, box.x1 - 10);
            });

            test("pad returns box instance", function() {
                equal(box.pad(0), box);
            });

            test("unpad adds top padding", function() {
                var clone = box.clone().unpad(10);
                equal(clone.y1, box.y1 + 10);
            });

            test("unpad adds right padding", function() {
                var clone = box.clone().unpad(10);
                equal(clone.x2, box.x2 - 10);
            });

            test("unpad adds bottom padding", function() {
                var clone = box.clone().unpad(10);
                equal(clone.y2, box.y2 - 10);
            });

            test("unpad adds left padding", function() {
                var clone = box.clone().unpad(10);
                equal(clone.x1, box.x1 + 10);
            });

            test("unpad returns box instance", function() {
                equal(box.unpad(0), box);
            });

            test("containsPoint returns true for points within box", function() {
                ok(box.containsPoint(new Point2D(5, 5)));
            });

            test("containsPoint returns false for points outside box", function() {
                ok(box.containsPoint(new Point2D(5, 5)));
            });

            test("center returns x center", function() {
                equal(box.center().x, 10);
            });

            test("center returns y center", function() {
                equal(box.center().y, 10);
            });

            test("points returns box points", function() {
                deepEqual($.map(box.points(), function(point) {
                    return [[point.x, point.y]];
                }), [
                    [0, 0], [20, 0], [20, 20], [0, 20]
                ]);
            });

            // ------------------------------------------------------------
            var point;

            module("Point2D", {
                setup: function() {
                    point = new Point2D(10, 20);
                }
            });

            test("constructor sets x", function() {
                equal(point.x, 10);
            });

            test("constructor sets y", function() {
                equal(point.y, 20);
            });

            test("x defaults to 0", function() {
                equal(new Point2D().x, 0);
            });

            test("y defaults to 0", function() {
                equal(new Point2D().y, 0);
            });

            (function() {
                var sector;

                module("Sector", {
                    setup: function() {
                        sector = new dataviz.Sector(new Point2D(10, 20), 30, 90, 180);
                    }
                });

                test("constructor sets center", function() {
                    deepEqual([sector.c.x, sector.c.y], [10, 20]);
                });

                test("constructor sets radius", function() {
                    equal(sector.r, 30);
                });

                test("constructor sets start angle", function() {
                    equal(sector.startAngle, 90);
                });

                test("constructor sets angle", function() {
                    equal(sector.angle, 180);
                });

                test("clone returns new sector instance", function() {
                    notEqual(sector.clone(), sector);
                    ok(sector instanceof dataviz.Sector);
                });

                test("expand returns same instance", function() {
                    equal(sector.expand(100), sector);
                });

                test("expand increases radius", function() {
                    equal(sector.expand(100).r, 130);
                });

                test("point returns intersection point for angle", function() {
                    var point = sector.point(180);
                    deepEqual([point.x, point.y], [40, 20])
                });
            })();

            (function() {
                var ring;

                module("Ring", {
                    setup: function() {
                        ring = new dataviz.Ring(new Point2D(100, 200), 20, 30, 90, 180);
                    }
                });

                test("constructor sets center", function() {
                    deepEqual([ring.c.x, ring.c.y], [100, 200]);
                });

                test("constructor sets radii", function() {
                    equal(ring.ir, 20);
                    equal(ring.r, 30);
                });

                test("constructor sets start angle", function() {
                    equal(ring.startAngle, 90);
                });

                test("constructor sets angle", function() {
                    equal(ring.angle, 180);
                });

                test("clone returns new ring instance", function() {
                    notEqual(ring.clone(), ring);
                });

                test("middle returns middle angle", function() {
                    equal(ring.middle(), 180);
                });

                test("point returns intersection point for angle", function() {
                    var point = ring.point(180);
                    deepEqual([point.x, point.y], [130, 200])
                });

                test("calculates inner point correctly", function() {
                    var innerPoint = ring.point(90, true);

                    equal(innerPoint.x, 100);
                    equal(innerPoint.y, 180);
                });
            })();

            (function() {
                var pin;

                module("Pin", {
                    setup: function() {
                        pin = new dataviz.Pin({
                            origin: new Point2D(100, 200)
                        });
                    }
                });

                test("constructor sets origin", function() {
                    deepEqual([pin.origin.x, pin.origin.y], [100, 200]);
                });
            })();

            // ------------------------------------------------------------
            var Color = dataviz.Color;

            module("Color");

            test("assumes black when parsing undefined", function() {
                var c = new Color(undefined);
                equal(c.toHex(), "#000000");
            });

            test("parses #xxyyzz", function() {
                var c = new Color("#aabbcc");
                equal(c.toHex(), "#aabbcc");
            });

            test("parses #xyz", function() {
                var c = new Color("#abc");
                equal(c.toHex(), "#aabbcc");
            });

            test("parses rgb(x, y, z)", function() {
                var c = new Color("rgb(170, 187, 204)");
                equal(c.toHex(), "#aabbcc");
            });

            test("normalizes rgb(x, y, z)", function() {
                var c = new Color("rgb(0, 400, 500)");
                equal(c.toHex(), "#00ffff");
            });

            test("parses named color", function() {
                var c = new Color("tomato");
                equal(c.toHex(), "#ff6347");
            });

            test("accepts rgb values", function() {
                var c = new Color(0, 255, 255);
                equal(c.toHex(), "#00ffff");
            });

            test("brightness lightens colors", function() {
                var c = new Color(100, 100, 240).brightness(1.2);
                equal(c.toHex(), "#7878ff");
            });

            test("brightness darkens colors", function() {
                var c = new Color(100, 100, 0).brightness(0.2);
                equal(c.toHex(), "#141400");
            });

            // ------------------------------------------------------------
            module("blendColors");

            test("#fff, #99c62a with alpha 0.2 => #add155", function() {
                equal(dataviz.blendColors("#99c62a", "#fff", 0.2), "#add155");
            });

            // ------------------------------------------------------------
            var blendGradient = dataviz.blendGradient,
                gradient;

            module("blendGradient", {
                setup: function() {
                    gradient = {
                        stops: [{
                            offset: 0.05,
                            color: "#fff",
                            opacity: 0.2
                        }]
                    };
                }
            });

            test("blend over #99c62a with alpha 0.2", function() {
                var result = blendGradient("#99c62a", gradient);

                deepEqual(result.stops[0], {
                    offset: 0.05,
                    color: "#add155",
                    opacity: 0
                });
            });

            // ------------------------------------------------------------
            var floorDate = dataviz.floorDate,
                ceilDate = dataviz.ceilDate,
                date;

            module("Date helpers / floorDate", {
                setup: function() {
                    date = new Date("2012/03/29 17:40:10");
                }
            });

            test("floorDate rounds date down to years", function() {
                deepEqual(floorDate(date, "years"), new Date("2012/01/01 00:00"));
            });

            test("floorDate rounds date down to months", function() {
                deepEqual(floorDate(date, "months"), new Date("2012/03/01 00:00"));
            });

            test("floorDate rounds date down to weeks", function() {
                deepEqual(floorDate(date, "weeks"), new Date("2012/03/25 00:00"));
            });

            test("floorDate rounds date down to weeks with custom week start", function() {
                deepEqual(floorDate(date, "weeks", kendo.days.Monday), new Date("2012/03/26 00:00"));
            });

            test("floorDate rounds date down to days", function() {
                deepEqual(floorDate(date, "days"), new Date("2012/03/29 00:00"));
            });

            test("floorDate rounds date down to hours", function() {
                deepEqual(floorDate(date, "hours"), new Date("2012/03/29 17:00"));
            });

            test("floorDate rounds date down to minutes", function() {
                deepEqual(floorDate(date, "minutes"), new Date("2012/03/29 17:40"));
            });

            test("floorDate returns undefined when no date is specified", function() {
                equal(floorDate(), undefined);
            });

            test("floorDate returns date when no unit is specified", function() {
                deepEqual(floorDate(date), date);
            });

            // ------------------------------------------------------------
            module("Date helpers / ceilDate", {
                setup: function() {
                    date = new Date("2012/03/29 17:40:10");
                }
            });

            test("ceilDate rounds date up to years", function() {
                deepEqual(ceilDate(date, "years"), new Date("2013/01/01 00:00"));
            });

            test("ceilDate does not increment year for dates divisable by the baseUnit", function() {
                deepEqual(
                    ceilDate(new Date("2013/01/01 00:00"), "years"),
                    new Date("2013/01/01 00:00")
                );
            });

            test("ceilDate rounds date up to months", function() {
                deepEqual(ceilDate(date, "months"), new Date("2012/04/01 00:00"));
            });

            test("ceilDate does not increment month for dates divisable by the baseUnit", function() {
                deepEqual(
                    ceilDate(new Date("2013/01/01 00:00"), "months"),
                    new Date("2013/01/01 00:00")
                );
            });

            test("ceilDate rounds date up to weeks", function() {
                deepEqual(ceilDate(date, "weeks"), new Date("2012/04/01 00:00"));
            });

            test("ceilDate rounds date up to weeks with custom week start day", function() {
                deepEqual(ceilDate(date, "weeks", kendo.days.Monday), new Date("2012/04/02 00:00"));
            });

            test("ceilDate does not increment weeks for dates divisable by the baseUnit", function() {
                deepEqual(
                    ceilDate(new Date("2012/03/25 00:00"), "weeks"),
                    new Date("2012/03/25 00:00")
                );
            });

            test("ceilDate rounds date up to days", function() {
                deepEqual(ceilDate(date, "days"), new Date("2012/03/30 00:00"));
            });

            test("ceilDate does not increment day for dates divisable by the baseUnit", function() {
                deepEqual(
                    ceilDate(new Date("2013/01/01 00:00"), "days"),
                    new Date("2013/01/01 00:00")
                );
            });

            test("ceilDate rounds date up to hours", function() {
                deepEqual(ceilDate(date, "hours"), new Date("2012/03/29 18:00"));
            });

            test("ceilDate does not increment hour for dates divisable by the baseUnit", function() {
                deepEqual(
                    ceilDate(new Date("2013/01/01 00:00"), "hours"),
                    new Date("2013/01/01 00:00")
                );
            });

            test("ceilDate rounds date up to minutes", function() {
                deepEqual(ceilDate(date, "minutes"), new Date("2012/03/29 17:41"));
            });

            test("ceilDate does not increment minute for dates divisable by the baseUnit", function() {
                deepEqual(
                    ceilDate(new Date("2013/01/01 00:00"), "minutes"),
                    new Date("2013/01/01 00:00")
                );
            });

            test("ceilDate returns undefined when no date is specified", function() {
                equal(ceilDate(), undefined);
            });

            test("ceilDate returns date when no unit is specified", function() {
                deepEqual(ceilDate(date), date);
            });

            // ------------------------------------------------------------
            var duration = dataviz.duration,
                dateA = new Date("2010/01/01 10:00"),
                dateB = new Date("2011/03/01 15:00");

            module("Date helpers / duration");

            test("calculates duration in years", function() {
                equal(duration(dateA, dateB, "years"), 1);
            });

            test("calculates duration in months", function() {
                equal(duration(dateA, dateB, "months"), 14);
            });

            test("calculates duration in days", function() {
                equal(duration(dateA, dateB, "days"), 424);
            });

            test("calculates duration in days during DST transition", function() {
                equal(duration(
                    new Date("2012/03/24 GMT+0200 (FLE Standard Time)"),
                    new Date("2012/03/26 GMT+0300 (FLE Daylight Time)"),
                    "days"
                    ), 2
                );
            });

            test("calculates duration in hours", function() {
                equal(duration(dateA, dateB, "hours"), 10181);
            });

            test("calculates duration in hours during DST transition", function() {
                equal(duration(
                    new Date("2012/03/25 00:00 GMT+0200 (FLE Standard Time)"),
                    new Date("2012/03/25 06:00 GMT+0300 (FLE Daylight Time)"),
                    "hours"
                    ), 5
                );
            });

            test("calculates duration in minutes", function() {
                equal(duration(dateA, dateB, "minutes"), 610860);
            });

            // ------------------------------------------------------------
            var addDuration = dataviz.addDuration;

            module("Date helpers / addDuration");

            test("rounds date to years", function() {
                deepEqual(addDuration(dateA, 10, "years"), new Date("2020/01/01"));
            });

            test("rounds date to months", function() {
                deepEqual(addDuration(dateA, 15, "months"), new Date("2011/04/01"));
            });

            test("rounds date to default week start (Sunday)", function() {
                deepEqual(addDuration(dateA, 1, "weeks", 0), new Date("2010/01/03"));
            });

            test("rounds date to default week start (Sunday) after adding 5 weeks", function() {
                deepEqual(addDuration(dateA, 5, "weeks", 0), new Date("2010/01/31"));
            });

            test("rounds date to custom week start", function() {
                deepEqual(addDuration(dateA, 1, "weeks", 1), new Date("2010/01/04"));
            });

            test("rounds date to custom week start after adding 5 weeks", function() {
                deepEqual(addDuration(dateA, 5, "weeks", 1), new Date("2010/02/01"));
            });

            test("rounds date to days", function() {
                deepEqual(addDuration(dateA, 35, "days"), new Date("2010/02/05"));
            });

            test("rounds to days during DST transition", function() {
                deepEqual(addDuration(
                        new Date("2012/03/25 GMT+0200 (FLE Standard Time)"),
                        2,
                        "days"
                    ), new Date("2012/03/27 GMT+0300 (FLE Daylight Time)")
                );
            });

            test("rounds date to hours", function() {
                deepEqual(addDuration(dateA, 24, "hours"), new Date("2010/01/02 10:00"));
            });

            test("rounds to hours during DST transition", function() {
                deepEqual(addDuration(
                        new Date("2012/03/25 00:00 GMT+0200 (FLE Standard Time)"),
                        6,
                        "hours"
                    ), new Date("2012/03/25 06:00 GMT+0300 (FLE Daylight Time)")
                );
            });

            test("Adding hours skips DST start", function() {
                deepEqual(addDuration(new Date("2012/03/25 02:00"), 1, "hours"),
                     new Date("2012/03/25 04:00:00")
                );
            });

            test("Adding minutes skips DST start", function() {
                deepEqual(addDuration(new Date("2012/03/25 02:00"), 60, "minutes"),
                     new Date("2012/03/25 04:00:00")
                );
            });

            test("Adding hours skips DST end", function() {
                deepEqual(addDuration(new Date("2012/10/28 03:00"), 1, "hours"),
                     new Date("2012/10/28 04:00:00")
                );
            });

            test("Adding minutes repeats DST end", function() {
                deepEqual(addDuration(new Date("2012/10/28 02:00"), 150, "minutes"),
                     new Date("2012/10/28 03:30:00")
                );
            });

            test("rounds date to minutes", function() {
                deepEqual(addDuration(dateA, 75, "minutes"), new Date("2010/01/01 11:15"));
            });

            // ------------------------------------------------------------
            var toDate = dataviz.toDate;

            module("Date helpers / toDate");

            test("Returns date unchanged", function() {
                var date = new Date();

                deepEqual(date, toDate(date));
            });

            test("Returns array of dates unchanged", function() {
                var dates = [new Date(), new Date()];

                deepEqual(dates, toDate(dates));
            });

            test("Converts string to date", function() {
                var date = "2012/01/01 00:00";

                deepEqual(new Date(date), toDate(date));
            });

            test("Converts array of strings to dates", function() {
                var dates = ["2012/01/01 00:00", "2012/01/02 00:00"];

                deepEqual([new Date(dates[0]), new Date(dates[1])], toDate(dates));
            });

            test("Converts time to date", function() {
                var time = 1325368800000;

                deepEqual(new Date(time), toDate(time));
            });

            test("Converts array of times to dates", function() {
                var times = [1325368800000, 1325455200000];

                deepEqual([new Date(times[0]), new Date(times[1])], toDate(times));
            });

            test("Converts MS JSON string to date", function() {
                var jsonDate = "/Date(1325368800000)/";

                deepEqual(new Date("2012/01/01 00:00"), toDate(jsonDate));
            });

            test("Converts array of MS JSON strings to dates", function() {
                var jsonDates = ["/Date(1325368800000)/", "/Date(1325455200000)/"];

                deepEqual([new Date("2012/01/01 00:00"), new Date("2012/01/02 00:00")], toDate(jsonDates));
            });

            // ------------------------------------------------------------
            var autoFormat = dataviz.autoFormat;

            module("autoFormat");

            test("Applies standard format with one argument", function() {
                equal(autoFormat("{0:N2}", 1), "1.00");
            });

            test("Applies standard format with one argument", function() {
                equal(autoFormat("{0:N2} {1:N2}", 1, 2), "1.00 2.00");
            });

            test("Applies simple format", function() {
                equal(autoFormat("N2", 1), "1.00");
            });

            (function() {
                // ------------------------------------------------------------
                var Aggregates = kendo.dataviz.Aggregates;
                var values = [1, 2, 3];

                module("Aggregates");

                test("min", function() {
                    equal(Aggregates.min(values), 1);
                });

                test("max", function() {
                    equal(Aggregates.max(values), 3);
                });

                test("sum", function() {
                    equal(Aggregates.sum(values), 6);
                });

                test("avg", function() {
                    equal(Aggregates.avg(values), 2);
                });

                test("count", function() {
                    equal(Aggregates.count(values), 3);
                });
            })();

            (function() {
                // ------------------------------------------------------------
                var validNumbers = kendo.dataviz.validNumbers;

                module("Misc");

                test("validNumbers returns true if all numbers are finite", function() {
                    ok(validNumbers([1, 2, 3]));
                });

                test("validNumbers returns false if array contains null", function() {
                    ok(!validNumbers([1, 2, null]));
                });

                test("validNumbers returns false if array contains undefined", function() {
                    ok(!validNumbers([1, 2, undefined]));
                });

                test("validNumbers returns false if array contains NaN", function() {
                    ok(!validNumbers([1, 2, NaN]));
                });

                test("sparseArrayLimits ignores undefined values", function() {
                    var l = dataviz.sparseArrayLimits([1, undefined, 2]);
                    equal(l.min, 1);
                    equal(l.max, 2);
                });

                test("sparseArrayLimits returns undefined for empty array", function() {
                    var l = dataviz.sparseArrayLimits([]);
                    equal(l.min, undefined);
                    equal(l.max, undefined)
                });

            })();

            (function() {
                var lru;

                // ------------------------------------------------------------
                module("LRUCache", {
                    setup: function() {
                        lru = new dataviz.LRUCache(4);
                        lru.put("a", 1);
                        lru.put("b", 2);
                        lru.put("c", 3);
                    }
                });

                test("put sets head", function() {
                    deepEqual(lru._head.value, 1);
                });

                test("put sets tail", function() {
                    deepEqual(lru._tail.value, 3);
                });

                test("put sets newer ref", function() {
                    equal(lru._head.newer.value, 2);
                });

                test("put sets older ref", function() {
                    equal(lru._tail.older.value, 2);
                });

                test("put does not clean last element if within size", function() {
                    lru.put("d", 4);
                    equal(lru._head.value, 1);
                });

                test("put cleans last element if exceeding size", function() {
                    lru.put("d", 4);
                    lru.put("e", 5);
                    equal(lru._head.value, 2);
                    deepEqual(lru._head.older, null);
                    deepEqual(lru._map["a"], null);
                });

                test("get retrieves value by key", function() {
                    equal(lru.get("a"), 1);
                });

                test("get retrieves single value", function() {
                    lru = new dataviz.LRUCache(1);
                    lru.put("a", 1);
                    equal(lru.get("a"), 1);
                });

                test("get moves head to tail", function() {
                    equal(lru.get("a"), 1);
                    equal(lru._tail.value, 1);
                });

                test("get patches head reference", function() {
                    equal(lru.get("a"), 1);
                    equal(lru._head.value, 2);
                    equal(lru._head.older, null);
                });

                test("get moves middle to tail", function() {
                    equal(lru.get("b"), 2);
                    equal(lru._tail.value, 2);
                });

                test("get patches middle references", function() {
                    equal(lru.get("b"), 2);
                    deepEqual(lru._head.newer.older, lru._head);
                });

                test("get keeps tail in place", function() {
                    equal(lru.get("c"), 3);
                    equal(lru._tail.value, 3);
                });
            })();

            (function() {
                // ------------------------------------------------------------
                var pool;

                module("IDPool", {
                    setup: function() {
                        pool = new dataviz.IDPool(3, "k", 100);
                    }
                });

                test("returns ascending IDs", function() {
                    equal(pool.alloc(), "k100");
                    equal(pool.alloc(), "k101");
                });

                test("reuses IDs", function() {
                    var id = pool.alloc();
                    pool.free(id);
                    equal(pool.alloc(), id);
                });

                test("pool does not grow beyond max size", function() {
                    for (var i = 0; i < 10; i++) {
                        pool.free("id" + i);
                    }

                    equal(pool._pool.length, 3);
                });

                test("pool does not accept duplicates", function() {
                    pool.free("foo");
                    pool.free("foo");

                    equal(pool._pool.length, 1);
                });

                test("pool clears duplicates after alloc", function() {
                    pool.free("foo");
                    pool.alloc();
                    pool.free("foo");

                    equal(pool._pool.length, 1);
                });
            })();

            (function() {
                var expandOptions = dataviz.expandOptions;

                // ------------------------------------------------------------
                module("Functional options");

                test("replaces function with its result", function() {
                    var opts = { foo: function() { return "bar" } };
                    expandOptions(opts);

                    equal(opts.foo, "bar");
                });

                test("executes functions with context", function() {
                    var opts = { foo: function(context) { return context; } };
                    expandOptions(opts, "baz");

                    equal(opts.foo, "baz");
                });

                test("replaces function in nested object with its result", function() {
                    var opts = { baz: { foo: function() { return "bar" } } };
                    expandOptions(opts);

                    equal(opts.baz.foo, "bar");
                })

                test("expands functions up to 8 levels deep", function() {
                    var opts = {};

                    for (var i = 0, root = opts; i < 9; i++) {
                        var child = root["n" + i] = {};
                        child.foo = function() { return "bar" };

                        root = root["n" + i];
                    }

                    expandOptions(opts);

                    equal(opts.n0.n1.n2.n3.n4.n5.n6.n7.foo, "bar");
                    ok($.isFunction(opts.n0.n1.n2.n3.n4.n5.n6.n7.n8.foo));
                });

                test("excluded options are ignored", function() {
                    var opts = { bar: function() { } };
                    expandOptions(opts, {}, { excluded: ["bar"] });

                    ok($.isFunction(opts.bar));
                });

                test("excluded options children are ignored", function() {
                    var opts = { bar: { baz: function() { } } };
                    expandOptions(opts, {}, { excluded: ["bar"] });

                    ok($.isFunction(opts.bar.baz));
                });

                test("undefined result is replaced by default value", function() {
                    var opts = { bar: function() {} };
                    expandOptions(opts, {}, { defaults: { bar: "foo" } });

                    equal(opts.bar, "foo");
                });

            })();
        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html> 
