<!DOCTYPE html>
<html>
    <head>
        <title>kendo.chart</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <link href="../qunit/qunit/qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.dataviz.core.js"></script>
        <script src="../../src/kendo.dataviz.chart.js"></script>
        <script src="../../src/kendo.dataviz.themes.js"></script>
        <script src="../../src/kendo.dataviz.svg.js"></script>
        <script src="../../src/kendo.dataviz.vml.js"></script>
        <script type="text/javascript">
            var dataviz = kendo.dataviz,
                highlight,
                viewMock,
                element,
                RED = "rgb(255,0,0)",
                GREEN = "rgb(0,255,0)",
                BLUE = "rgb(0,0,255)";

            function createHighlight(options) {
                viewMock = {
                    renderElement: function(element) {
                        return $("<div class='" + element.type + "'></div>")[0];
                    }
                };

                highlight = new dataviz.Highlight(viewMock, $("#viewElement")[0], options);
            }

            (function() {
                var ElementStub = {
                    highlightOverlay: function() {
                        return { type: "overlay" };
                    }
                }

                // ------------------------------------------------------------
                module("Highlight / Overlay", {
                    setup: function() {
                        createHighlight({
                            fill: "#cf0",
                            fillOpacity: 0.5
                        });
                    },
                    teardown: function() {
                        $("#viewElement").empty();
                    }
                });

                test("Retrieves overlay element", 1, function() {
                    highlight.show({
                        highlightOverlay: function() {
                            ok(true);
                        }
                    });
                });

                test("Does not retrieve overlay element when highlight is disabled", function() {
                    highlight.show({
                        options: {
                            highlight: {
                                visible: false
                            }
                        },
                        highlightOverlay: function() {
                            ok(false);
                        }
                    });
                });

                test("Sets fill on overlay element", 1, function() {
                    highlight.show({
                        highlightOverlay: function(definition, options) {
                            equal(options.fill, "#cf0");
                        }
                    });
                });

                test("Sets fill opacity on overlay element", 1, function() {
                    highlight.show({
                        highlightOverlay: function(definition, options) {
                            equal(options.fillOpacity, 0.5);
                        }
                    });
                });

                test("Renders overlay element", function() {
                    highlight.show(ElementStub);
                    equal($(".overlay").length, 1);
                });

                test("Does not render overlay if no overlay element exists", function() {
                    highlight.show({ highlightOverlay: function() { } });
                    equal($(".overlay").length, 0);
                });

                test("Removes overlay element", function() {
                    highlight.show(ElementStub);
                    highlight.hide();
                    equal($(".overlay").length, 0);
                });

                // ------------------------------------------------------------
                module("Highlight / Overlay / Multiple points", {
                    setup: function() {
                        createHighlight();
                    },
                    teardown: function() {
                        $("#viewElement").empty();
                    }
                });

                test("Retrieves overlay elements", 2, function() {
                    highlight.show([{
                        highlightOverlay: function() {
                            ok(true);
                        }
                    }, {
                        highlightOverlay: function() {
                            ok(true);
                        }
                    }]);
                });

                test("Renders overlay elements", function() {
                    highlight.show([ElementStub, ElementStub]);
                    equal($(".overlay").length, 2);
                });

                test("Removes overlay elements", function() {
                    highlight.show([ElementStub, ElementStub]);
                    highlight.hide();
                    equal($(".overlay").length, 0);
                });

            })();

            (function() {
                var ElementStub = {
                    toggleHighlight: function() {
                    }
                }

                // ------------------------------------------------------------
                module("Highlight / Toggle", {
                    setup: function() {
                        createHighlight({
                            fill: "#cf0",
                            fillOpacity: 0.5
                        });
                    },
                    teardown: function() {
                        $("#viewElement").empty();
                    }
                });

                test("Calls toggleHighlight on show", 1, function() {
                    highlight.show({
                        toggleHighlight: function(view) {
                            ok(true);
                        }
                    });
                });

                test("Does not call toggleHighlight on show (highlight disabled)", function() {
                    highlight.show({
                        options: {
                            highlight: {
                                visible: false
                            }
                        },
                        toggleHighlight: function() {
                            ok(false);
                        }
                    });
                });

                test("Calls toggleHighlight on hide", 2, function() {
                    highlight.show({
                        toggleHighlight: function(view) {
                            ok(true);
                        }
                    });
                    highlight.hide();
                });

                test("Does not call toggleHighlight on hide (highlight disabled)", function() {
                    highlight.show({
                        options: {
                            highlight: {
                                visible: false
                            }
                        },
                        toggleHighlight: function() {
                            ok(false);
                        }
                    });
                    highlight.hide();
                });

                // ------------------------------------------------------------
                module("Highlight / Toggle / Multiple points", {
                    setup: function() {
                        createHighlight();
                    },
                    teardown: function() {
                        $("#viewElement").empty();
                    }
                });

                test("Calls toggleHighlight on show", 2, function() {
                    highlight.show([{
                        toggleHighlight: function(view) {
                            ok(true);
                        }
                    }, {
                        toggleHighlight: function(view) {
                            ok(true);
                        }
                    }]);
                });

                test("Calls toggleHighlight on hide", 4, function() {
                    highlight.show([{
                        toggleHighlight: function(view) {
                            ok(true);
                        }
                    }, {
                        toggleHighlight: function(view) {
                            ok(true);
                        }
                    }]);
                    highlight.hide();
                });

            })();
        </script>

        <div id="viewElement"></div>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
