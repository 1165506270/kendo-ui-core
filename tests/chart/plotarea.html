<!DOCTYPE html>
<html>
    <head>
        <title>UI5.Chart Tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <link href="../qunit/qunit/qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.dataviz.core.js"></script>
        <script src="../../src/kendo.dataviz.chart.js"></script>
        <script src="../../src/kendo.dataviz.themes.js"></script>
        <script src="../../src/kendo.dataviz.svg.js"></script>
        <script src="../../src/kendo.dataviz.vml.js"></script>
        <script src="util.js"></script>
        <script type="text/javascript">

            var dataviz = kendo.dataviz,
                Box2D = dataviz.Box2D,
                chartBox = new Box2D(100, 100, 1000, 1000),
                view,
                TOLERANCE = 1,
                MARGIN = 10,
                GAP = 4,
                chartSeries;

            function moduleSetup() {
                view = new ViewStub();
            }

            (function() {
                var plotArea,
                    categoryAxis,
                    namedCategoryAxes,
                    secondaryCategoryAxis,
                    namedValueAxes,
                    valueAxis,
                    secondaryValueAxis,
                    barSeriesData = [{
                        name: "Value A",
                        type: "bar",
                        data: [100, 200, 300],
                        gap: GAP
                    }, {
                        name: "Value B",
                        type: "bar",
                        data: [10, 20, 30]
                    }],
                    columnSeriesData = [{
                        name: "Value A",
                        type: "column",
                        data: [100, 200, 300],
                        gap: GAP
                    }, {
                        name: "Value B",
                        type: "column",
                        data: [10, 20, 30]
                    }],
                    lineSeriesData = [{
                        name: "Value A",
                        type: "line",
                        data: [100, 200, 300]
                    }, {
                        name: "Value B",
                        type: "line",
                        data: [10, 20, 30]
                    },
                    verticalLineSeriesData = [{
                        name: "Value A",
                        type: "verticalLine",
                        data: [100, 200, 300]
                    }, {
                        name: "Value B",
                        type: "verticalLine",
                        data: [10, 20, 30]
                    }]],
                    areaSeriesData = [{
                        name: "Value A",
                        type: "area",
                        data: [100, 200, 300]
                    }, {
                        name: "Value B",
                        type: "area",
                        data: [10, 20, 30]
                    },
                    verticalAreaSeriesData = [{
                        name: "Value A",
                        type: "verticalArea",
                        data: [100, 200, 300]
                    }, {
                        name: "Value B",
                        type: "verticalArea",
                        data: [10, 20, 30]
                    }]];

                function createPlotArea(series, options) {
                    plotArea = new dataviz.CategoricalPlotArea(series,
                        $.extend({
                        categoryAxis: {
                            categories: ["A", "B", "C"]
                        }
                    }, options));

                    categoryAxis = plotArea.categoryAxis;
                    valueAxis = plotArea.valueAxis;
                    namedCategoryAxes = plotArea.namedCategoryAxes;
                    secondaryCategoryAxis = namedCategoryAxes.secondary;
                    namedValueAxes = plotArea.namedValueAxes;
                    secondaryValueAxis = namedValueAxes.secondary;

                    chartSeries = plotArea.charts[0];
                }

                // ------------------------------------------------------------
                module("Categorical PlotArea / Axes", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData);
                    }
                });

                test("appends primary value axis to children collection", function() {
                    ok($.inArray(valueAxis, plotArea.children) >= 0);
                });

                test("appends category axis to children collection", function() {
                    ok($.inArray(categoryAxis, plotArea.children) >= 0);
                });

                test("aligns axes at default crossing values", function() {
                    var axisX = categoryAxis,
                        axisY = valueAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1]);
                });

                test("aligns reversed axes at default crossing values", function() {
                    createPlotArea(columnSeriesData, {
                        categoryAxis: { reverse: true },
                        valueAxis: { reverse: true }
                    });

                    var axisX = categoryAxis,
                        axisY = valueAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x2, crossingSlotY.y2], [crossingSlotX.x2, crossingSlotX.y2]);
                });

                test("aligns axises at non-default crossing values", function() {
                    var axisX = categoryAxis,
                        axisY = valueAxis;

                    axisY.options.axisCrossingValue = 10;
                    axisX.options.axisCrossingValue = 1;
                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1], TOLERANCE);
                });

                test("reads crossing values from axisCrossingValues alias", function() {
                    var axisX = categoryAxis,
                        axisY = valueAxis;

                    axisY.options.axisCrossingValues = 10;
                    axisX.options.axisCrossingValues = 1;
                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValues),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValues);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1], TOLERANCE);
                });

                test("aligns reversed axes at non-default crossing values", function() {
                    createPlotArea(columnSeriesData, {
                        categoryAxis: { reverse: true, axisCrossingValue: 3 },
                        valueAxis: { reverse: true }
                    });

                    var axisX = categoryAxis,
                        axisY = valueAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x2, crossingSlotY.y2], [crossingSlotX.x2, crossingSlotX.y2]);
                });

                test("axis limit is [0, 1] when no series are configured", 2, function() {
                    stubMethod(dataviz.CategoricalPlotArea.fn, "createValueAxes",
                        function() {
                            equal(this.valueAxisRangeTracker.query("primary").min, 0);
                            equal(this.valueAxisRangeTracker.query("primary").max, 1);
                        },
                        function() {
                            plotArea = new dataviz.CategoricalPlotArea([]);
                        }
                    );
                });

                test("adds categories to match actual data", function() {
                    var plotArea = new dataviz.CategoricalPlotArea(columnSeriesData, {
                        categoryAxis: {
                            categories: ["A", "B"]
                        }
                    });

                    equals(plotArea.categoryAxis.options.categories.length, 3);
                });

                test("accepts extra categories", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "column",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"]
                        }
                    });

                    equals(plotArea.categoryAxis.options.categories.length, 2);
                });

                test("categoryAxis justified is not altered with line series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "line",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            justified: true
                        }
                    });

                    equals(plotArea.categoryAxis.options.justified, true);
                });

                test("categoryAxis justified is set to false with bar series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "bar",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            justified: true
                        }
                    });

                    equals(plotArea.categoryAxis.options.justified, false);
                });

                test("categoryAxis justified is set to false with column series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "column",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            justified: true
                        }
                    });

                    equals(plotArea.categoryAxis.options.justified, false);
                });

                test("categoryAxis justified is set to false with OHLC series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "ohlc",
                            data: [[]]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            justified: true
                        }
                    });

                    equals(plotArea.categoryAxis.options.justified, false);
                });

                test("categoryAxis justified is set to false with candlestick series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "candlestick",
                            data: [[]]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            justified: true
                        }
                    });

                    equals(plotArea.categoryAxis.options.justified, false);
                });

                test("categoryAxis justified is not altered with bar series on secondary axis", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "line",
                            data: [100]
                        }, {
                            type: "bar",
                            data: [200],
                            categoryAxis: "secondary"
                        }], {
                        categoryAxis: [{
                            categories: ["A", "B"],
                            justified: true
                        }, {
                            name: "secondary",
                            categories: ["a", "b"]
                        }]
                    });

                    equals(plotArea.categoryAxis.options.justified, true);
                })

                test("categoryAxis justified is not altered with bar series on primary axis", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "line",
                            data: [100]
                        }, {
                            type: "bar",
                            data: [200]
                        }], {
                        categoryAxis: [{
                            categories: ["A", "B"]
                        }, {
                            categories: ["a", "b"],
                            justified: true
                        }]
                    });

                    equals(plotArea.axes[1].options.justified, true);
                });

                test("categoryAxis roundToBaseUnit is not altered with line series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "line",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            roundToBaseUnit: false
                        }
                    });

                    equals(plotArea.categoryAxis.options.roundToBaseUnit, false);
                });

                test("categoryAxis roundToBaseUnit is set to true with bar series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "bar",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            roundToBaseUnit: false
                        }
                    });

                    equals(plotArea.categoryAxis.options.roundToBaseUnit, true);
                });

                test("categoryAxis roundToBaseUnit is set to true with column series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "column",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            roundToBaseUnit: false
                        }
                    });

                    equals(plotArea.categoryAxis.options.roundToBaseUnit, true);
                });

                test("categoryAxis roundToBaseUnit is set to true with OHLC series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "ohlc",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            roundToBaseUnit: false
                        }
                    });

                    equals(plotArea.categoryAxis.options.roundToBaseUnit, true);
                });

                test("categoryAxis roundToBaseUnit is set to true with candlestick series", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "candlestick",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            roundToBaseUnit: false
                        }
                    });

                    equals(plotArea.categoryAxis.options.roundToBaseUnit, true);
                });

                test("categoryAxis roundToBaseUnit is not altered with bar series on other axis", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "line",
                            data: [100]
                        }, {
                            type: "bar",
                            data: [200],
                            categoryAxis: "secondary"
                        }], {
                        categoryAxis: [{
                            categories: ["A", "B"],
                            roundToBaseUnit: false
                        }, {
                            name: "secondary",
                            categories: ["a", "b"]
                        }]
                    });

                    equals(plotArea.categoryAxis.options.roundToBaseUnit, false);
                });

                test("categoryAxis justified is not altered with bar series on primary axis", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "line",
                            data: [100]
                        }, {
                            type: "bar",
                            data: [200]
                        }], {
                        categoryAxis: [{
                            categories: ["A", "B"]
                        }, {
                            categories: ["a", "b"],
                            roundToBaseUnit: false
                        }]
                    });

                    equals(plotArea.axes[1].options.roundToBaseUnit, false);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Multiple Value Axes", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData, {
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("secondary axis added to children collection", function() {
                    ok($.inArray(secondaryValueAxis, plotArea.children) >= 0);
                });

                test("crosses category axis at default value", function() {
                    plotArea.reflow(chartBox);

                    var slotX = categoryAxis.getSlot(categoryAxis.options.axisCrossingValue),
                        slotY = valueAxis.getSlot(valueAxis.options.axisCrossingValue);

                    equals(slotX.y1, slotY.y1);
                });

                test("Throws error when value axis name is duplicate", function() {
                    raises(function() {
                        plotArea = new dataviz.CategoricalPlotArea([{
                                type: "column",
                                data: [100]
                            }], {
                            valueAxis: [{
                                name: "b"
                            }, {
                                name: "b"
                            }]
                        });
                    },
                    /Value axis with name b is already defined/);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Multiple Value Axes / Stacked Left", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData, {
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("overlapping axes are stacked to the left", function() {
                    var margin = secondaryValueAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.box.x2, secondaryValueAxis.box.y1],
                         [valueAxis.box.x1 - margin, valueAxis.box.y1]
                    );
                });

                test("stacked axes on left are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.lineBox().y1, secondaryValueAxis.lineBox().y2],
                         [valueAxis.lineBox().y1, valueAxis.lineBox().y2]
                    );
                });

                test("stacked axes on the left are not mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(!valueAxis.options.labels.mirror);
                    ok(!secondaryValueAxis.options.labels.mirror);
                });

                test("user set mirror option is not changed", function() {
                    valueAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(valueAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Multiple Value Axes / Stacked Right", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData, {
                            categoryAxis: {
                                axisCrossingValue: 100
                            },
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("overlapping axes are shifted to the right", function() {
                    var margin = secondaryValueAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.box.x1, secondaryValueAxis.box.y1],
                         [valueAxis.box.x2 + margin, valueAxis.box.y1]
                    );
                });

                test("stacked axes on right are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.lineBox().y1, secondaryValueAxis.lineBox().y2],
                         [valueAxis.lineBox().y1, valueAxis.lineBox().y2]
                    );
                });

                test("plot area bounding box wraps axis", function() {
                    plotArea.reflow(chartBox);

                    var axisBox = secondaryValueAxis.box;
                    ok(axisBox.x1 >= plotArea.box.x1 && axisBox.y1 >= plotArea.box.x1);
                });

                test("stacked axes on the right are mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(valueAxis.options.labels.mirror);
                    ok(secondaryValueAxis.options.labels.mirror);
                });

                test("mirroring inverts the mirror option", function() {
                    valueAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(!valueAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Inverted / Multiple Value Axes / Stacked Top", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(barSeriesData, {
                            categoryAxis: {
                                axisCrossingValue: 0
                            },
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("overlapping axes are shifted to the top", function() {
                    var margin = secondaryValueAxis.options.margin;

                    plotArea.reflow(chartBox);

                    equals(secondaryValueAxis.box.y2, valueAxis.box.y1 - margin);
                });

                test("stacked axes on top are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.lineBox().x1, secondaryValueAxis.lineBox().x2],
                         [valueAxis.lineBox().x1, valueAxis.lineBox().x2]
                    );
                });

                test("stacked axes on the top are mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(valueAxis.options.labels.mirror);
                    ok(secondaryValueAxis.options.labels.mirror);
                });

                test("mirroring inverts the mirror option", function() {
                    valueAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(!valueAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Inverted / Multiple Value Axes / Stacked Bottom", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(barSeriesData, {
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("overlapping axes are shifted to the bottom", function() {
                    var margin = secondaryValueAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same(secondaryValueAxis.box.y1, valueAxis.box.y2 + margin);
                });

                test("stacked axes on bottom are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.lineBox().x1, secondaryValueAxis.lineBox().x2],
                         [valueAxis.lineBox().x1, valueAxis.lineBox().x2]
                    );
                });

                test("stacked axes on the bottom are not mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(!valueAxis.options.labels.mirror);
                    ok(!secondaryValueAxis.options.labels.mirror);
                });

                test("user set mirror option is not changed", function() {
                    valueAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(valueAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Multiple Category Axes", {
                    setup: function() {
                    }
                });

                test("axes are accessible by name", function() {
                    createPlotArea(columnSeriesData, {
                        categoryAxis: [{
                                name: "a"
                            }, {
                                name: "b"
                            }]
                    });

                    ok(plotArea.namedCategoryAxes["a"]);
                    ok(plotArea.namedCategoryAxes["b"]);
                });

                test("first axis is set as primary category axis", function() {
                    createPlotArea(columnSeriesData, {
                        categoryAxis: [{
                                name: "a"
                            }, {
                                name: "b"
                            }]
                    });

                    ok(plotArea.categoryAxis === plotArea.namedCategoryAxes["a"]);
                });

                test("secondary category axis is added to children collection", function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData, {
                            categoryAxis: [{}, {
                                name: "secondary"
                            }]
                        });

                    ok($.inArray(secondaryCategoryAxis, plotArea.children) >= 0);
                });

                test("adds categories to match actual data", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                        type: "column",
                        data: [1, 2, 3],
                        categoryAxis: "b"
                    }], {
                        categoryAxis: [{
                            }, {
                            name: "b",
                            categories: ["A", "B"]
                        }]
                    });

                    equals(plotArea.namedCategoryAxes.b.options.categories.length, 3);
                });

                test("accepts extra categories", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "column",
                            data: [100],
                            categoryAxis: "b"
                        }], {
                        categoryAxis: [{
                            }, {
                            name: "b",
                            categories: ["A", "B"]
                        }]
                    });

                    equals(plotArea.namedCategoryAxes.b.options.categories.length, 2);
                });

                test("Throws error when unable to locate category axis", function() {
                    raises(function() {
                        createPlotArea([{
                            data: [100, 200, 300],
                            categoryAxis: "b"
                        }])},
                        /Unable to locate category axis with name b/);
                });

                test("Throws error when category axis name is duplicate", function() {
                    raises(function() {
                        plotArea = new dataviz.CategoricalPlotArea([{
                                type: "column",
                                data: [100]
                            }], {
                            categoryAxis: [{
                                name: "b"
                            }, {
                                name: "b"
                            }]
                        });
                    },
                    /Category axis with name b is already defined/);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Column series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData);
                    }
                });

                test("value axis is vertical", function() {
                    ok(valueAxis.options.vertical);
                });

                test("category axis is horizontal", function() {
                    ok(!categoryAxis.options.vertical);
                });

                test("value axis crosses at first category", function() {
                    equal(valueAxis.options.axisCrossingValue, 0);
                });

                test("category axis crossing value can be changed", function() {
                    plotArea = new dataviz.CategoricalPlotArea(columnSeriesData, {
                        categoryAxis: {
                            categories: ["A", "B", "C"],
                            axisCrossingValue: 2
                        }
                    });
                    equal(plotArea.categoryAxis.options.axisCrossingValue, 2);
                });

                test("creates bar chart", function() {
                    ok(chartSeries instanceof dataviz.BarChart);
                });

                test("groups bar series into bar chart", function() {
                    equal(chartSeries.options.series.length, 2);
                });

                test("sets axis min/max to series limits", 2, function() {
                    stubMethod(dataviz.CategoricalPlotArea.fn, "createValueAxes",
                        function() {
                            equal(this.valueAxisRangeTracker.query().min, 10);
                            equal(this.valueAxisRangeTracker.query().max, 300);
                        },
                        function() {
                            createPlotArea(columnSeriesData);
                        }
                    );
                });

                test("applies gap from first series", function() {
                    equals(chartSeries.options.gap, GAP);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Line series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(lineSeriesData);
                    }
                });

                test("value axis is vertical", function() {
                    ok(valueAxis.options.vertical);
                });

                test("category axis is horizontal", function() {
                    ok(!categoryAxis.options.vertical);
                });

                test("creates line chart", function() {
                    ok(chartSeries instanceof dataviz.LineChart);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "line", data: [], stack: true }, { type: "line", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "line", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Vertical line series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(verticalLineSeriesData);
                    }
                });

                test("value axis is horizontal", function() {
                    ok(!valueAxis.options.vertical);
                });

                test("category axis is vertical", function() {
                    ok(categoryAxis.options.vertical);
                });

                test("creates line chart", function() {
                    ok(chartSeries instanceof dataviz.LineChart);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "verticalLine", data: [], stack: true }, { type: "verticalLine", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "verticalLine", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Area series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(areaSeriesData);
                    }
                });

                test("value axis is vertical", function() {
                    ok(valueAxis.options.vertical);
                });

                test("category axis is horizontal", function() {
                    ok(!categoryAxis.options.vertical);
                });

                test("creates area chart", function() {
                    ok(chartSeries instanceof dataviz.AreaChart);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "area", data: [], stack: true }, { type: "area", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "area", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Verical area series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(verticalAreaSeriesData);
                    }
                });

                test("value axis is horizontal", function() {
                    ok(!valueAxis.options.vertical);
                });

                test("category axis is vertical", function() {
                    ok(categoryAxis.options.vertical);
                });

                test("creates area chart", function() {
                    ok(chartSeries instanceof dataviz.AreaChart);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "verticalArea", data: [], stack: true }, { type: "verticalArea", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "verticalArea", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Bar series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(barSeriesData);
                    }
                });

                test("value axis is horizontal", function() {
                    ok(!valueAxis.options.vertical);
                });

                test("category axis is vertical", function() {
                    ok(categoryAxis.options.vertical);
                });

                test("value axis crosses at last category", function() {
                    equal(plotArea.categoryAxis.options.axisCrossingValue, 3);
                });

                test("value axis crossing can be changed", function() {
                    plotArea = new dataviz.CategoricalPlotArea(barSeriesData, {
                        categoryAxis: {
                            categories: ["A", "B", "C"],
                            axisCrossingValue: 2
                        }
                    });
                    equal(plotArea.categoryAxis.options.axisCrossingValue, 2);
                });

                test("applies gap from first series", function() {
                    equals(chartSeries.options.gap, GAP);
                });

                test("aligns axes at default crossing values", function() {
                    var axisX = valueAxis,
                        axisY = categoryAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1]);
                });

                test("aligns reversed axes at default crossing values", function() {
                    createPlotArea(barSeriesData, {
                        categoryAxis: { reverse: true },
                        valueAxis: { reverse: true }
                    });

                    var axisX = valueAxis,
                        axisY = categoryAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);

                    same([crossingSlotY.x2, crossingSlotY.y2], [crossingSlotX.x2, crossingSlotX.y2]);
                });

                test("aligns reversed axes at non-default crossing values", function() {
                    createPlotArea(barSeriesData, {
                        categoryAxis: { reverse: true, axisCrossingValue: 0 },
                        valueAxis: { reverse: true }
                    });

                    var axisX = valueAxis,
                        axisY = categoryAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);

                    same([crossingSlotY.x2, crossingSlotY.y2], [crossingSlotX.x2, crossingSlotX.y2]);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "bar", data: [], stack: true }, { type: "bar", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "bar", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                var dateCategoryAxis = {
                    type: "date",
                    categories: ["2012-02-01", "2012-02-02", "2012-02-04"]
                };

                module("Categorical PlotArea / Date series", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("Accepts capitalized type", function() {
                    createPlotArea([{
                            data: [100, 200, 300]
                        }], {
                        categoryAxis: {
                            type: "Date",
                            categories: ["2012-02-01", "2012-02-02", "2012-02-04"]
                        }
                    });

                    same(plotArea.categoryAxis.options.categories[0].constructor, Date);
                });

                test("Automatically detects date category axis", function() {
                    createPlotArea([{
                            data: [100, 200, 300]
                        }], {
                        categoryAxis: {
                            categories: [
                                new Date(2012, 02, 01),
                                new Date(2012, 02, 02),
                                new Date(2012, 02, 04)
                            ]
                        }
                    });

                    same(plotArea.categoryAxis.options.type, "date");
                    same(plotArea.series[0].data, [100, 200, undefined, 300]);
                });

                test("User can override automatic category axis type", function() {
                    createPlotArea([{
                            data: [100, 200, 300]
                        }], {
                        categoryAxis: {
                            type: "category",
                            categories: [
                                new Date(2012, 02, 01),
                                new Date(2012, 02, 02),
                                new Date(2012, 02, 04)
                            ]
                        }
                    });

                    same(plotArea.categoryAxis.options.type, "category");
                    same(plotArea.series[0].data, [100, 200, 300]);
                });

                test("Does not alter data points when no grouping is done", function() {
                    createPlotArea([{
                        data: [100, 200, 300]
                    }], {
                        categoryAxis: dateCategoryAxis
                    });

                    same(plotArea.series[0].data, [100, 200, undefined, 300]);
                });

                test("Does not alter data items when no grouping is done", function() {
                    createPlotArea([{
                        data: ["a", "b", "c"]
                    }], {
                        categoryAxis: dateCategoryAxis
                    });

                    same(plotArea.series[0].data, ["a", "b", undefined, "c"]);
                });

                test("Does not alter original series data", function() {
                    var series = [{
                        data: [100, 200, 300]
                    }];

                    createPlotArea(series, {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    });

                    same(series[0].data, [100, 200, 300]);
                });

                test("Does not alter original series data items", function() {
                    var series = [{
                        data: [100, 200, 300],
                        dataItems: ["a", "b", "c"]
                    }];

                    createPlotArea(series, {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    });

                    same(series[0].dataItems, ["a", "b", "c"]);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Date series / Aggregates");

                test("Aggregates series data using max by default", function() {
                    createPlotArea([{
                        data: [100, 200, 300]
                    }], {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    });

                    same(plotArea.series[0].data, [300]);
                });

                test("Aggregates bound series data", function() {
                    createPlotArea([{
                        data: [{ value: 100 }, { value: 200 }, { value: 300 }]
                    }], {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    });

                    same(plotArea.series[0].data, [300]);
                });

                test("Aggregates series data with predefined function", function() {
                    createPlotArea([{
                        data: [100, 200, 300],
                        aggregate: "min"
                    }], {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    });

                    same(plotArea.series[0].data, [100]);
                });

                test("Aggregates series data with user function", 1, function() {
                    createPlotArea([{
                        data: [100, 200, 300],
                        aggregate: function(values, series) {
                            same(values, series.data);
                            return 0;
                        }
                    }], {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    });
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Date series / Multiple Category Axes", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("Aggregates series on secondary axis", function() {
                    createPlotArea([{
                        data: [100, 200, 300],
                        categoryAxis: "b"
                    }], {
                        categoryAxis: [
                            { },
                            kendo.deepExtend({
                                name: "b", baseUnit: "months"
                            }, dateCategoryAxis)
                        ]
                    });

                    same(plotArea.series[0].data, [300]);
                });

                test("Throws error when unable to locate category axis", function() {
                    raises(function() {
                        createPlotArea([{
                            data: [100, 200, 300],
                            categoryAxis: "b"
                        }], {
                            categoryAxis:
                                kendo.deepExtend({
                                    baseUnit: "months"
                                }, dateCategoryAxis)
                        })},
                        /Unable to locate category axis with name b/);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Date series / OHLC Aggregates");

                test("Series data using aggregate", function() {
                    createPlotArea([{
                        type: "candlestick",
                        aggregate: {
                            "open": "max",
                            "high": "max",
                            "low": "min",
                            "close": "max",
                        },
                        data: [[1,4,0,2], [2,5,1,3], [3,6,2,4]]
                    }], {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    }),
                    point = plotArea.series[0].data[0];

                    same([point.open, point.high, point.low, point.close], [3,6,0,4]);
                });

                test("Series data with predefined function", function() {
                    createPlotArea([{
                        type: "candlestick",
                        aggregate: {
                            "open": "min",
                            "high": "min",
                            "low": "min",
                            "close": "min",
                        },
                        data: [[1,4,0,2], [2,5,1,3], [3,6,2,4]]
                    }], {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    }),
                    point = plotArea.series[0].data[0];

                    same([point.open, point.high, point.low, point.close], [1,4,0,2]);
                });

                test("Series data with user function", 1, function() {
                    var data = [[1,4,0,2], [2,5,1,3], [3,6,2,4]];
                    createPlotArea([{
                        type: "candlestick",
                        aggregate: {
                            "open": function(values, series) {
                                same(data, series.data);
                                return 0;
                            }
                        },
                        data: data
                    }], {
                        categoryAxis: kendo.deepExtend({
                            baseUnit: "months"
                        }, dateCategoryAxis)
                    });
                });

            })();

            (function() {
                var plotArea,
                    barSeriesData = [{
                        name: "Value A",
                        type: "bar",
                        data: [100]
                    }];

                function createPlotArea(categoryAxis, valueAxis, options) {
                    plotArea = new dataviz.CategoricalPlotArea(barSeriesData, kendo.deepExtend({
                        categoryAxis: categoryAxis,
                        valueAxis: valueAxis
                    }, options));

                    stubMethod(dataviz.NumericAxis.fn, "getViewElements", function() { return []; },
                        function() {
                            stubMethod(dataviz.CategoryAxis.fn, "getViewElements", function() { return []; },
                                function() {
                                    plotArea.reflow(chartBox);
                                    plotArea.getViewElements(view);
                                }
                    )});
                }

                // ------------------------------------------------------------
                module("Categorical PlotArea / Major Gridlines", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("renders gridlines", function() {
                    createPlotArea({
                        categories: ["A"],
                        majorGridLines: {
                            visible: true
                        }
                    });

                    equal(view.log.line.length, 7);
                });

                test("renders gridlines over hidden value axis", function() {
                    createPlotArea({
                        categories: ["A"],
                        majorGridLines: {
                            visible: true
                        }
                    }, {
                        line: {
                            visible: false
                        }
                    });

                    equal(view.log.line.length, 8);
                });

                test("should not render gridlines for numeric axis", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 1);
                });

                test("should not render gridlines for category axis", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        };

                    createPlotArea(categoryAxis);

                    equal(view.log.line.length, 6);
                });

                test("should not render gridlines", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: false
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 0);
                });

                test("gridlines extend to secondary axis end", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            min: 0,
                            max: 10,
                            majorUnit: 3,
                            majorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);
                    equals(view.log.line[0].x2, plotArea.valueAxis.lineBox().x2);
                });

                test("should not render gridlines for secondary value axis", function() {
                    createPlotArea({
                        categories: ["A"]
                    }, [{}, {}]);

                    equal(view.log.line.length, 6);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Major Gridlines / Panes", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("renders gridlines when value axis is in different pane", function() {
                    createPlotArea({
                            categories: ["A"],
                            majorGridLines: {
                                visible: true
                            }
                        }, {
                            pane: "bottom"
                        }, {
                            panes: [{
                                name: "top"
                            }, {
                                name: "bottom"
                            }]
                    });

                    equal(view.log.line.length, 8);
                });

                test("renders grid lines in each pane", function() {
                    createPlotArea({
                            categories: ["A"],
                            majorGridLines: {
                                visible: true
                            }
                        }, [{
                            pane: "top"
                        },{
                            pane: "bottom"
                        }], {
                            panes: [{
                                name: "top"
                            }, {
                                name: "bottom"
                            }]
                    });

                    equal(view.log.line.length, 15);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Minor Gridlines", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("renders gridlines", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: true
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 32);
                });

                test("should not render gridlines for numeric axis", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 2);
                });

                test("should not render gridlines for category axis", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: true
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 30);
                });

                test("should not render gridlines", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 0);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Major and Minor GridLines", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("should not render minor and major gridline to a same point", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: true
                            },
                            minorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: true
                            },
                            minorGridLines: {
                                visible: true
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 32);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Configuration", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("applies margin", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            labels: { font: SANS12 }
                        },
                        valueAxis: {
                            labels: { font: SANS12 }
                        },
                        plotArea: {
                            margin: MARGIN,
                            background: "red"
                        }
                    });

                    plotArea.reflow(chartBox);

                    sameBox(plotArea.box, new Box2D(110, 110, 990, 990), TOLERANCE);
                });

                test("should render plot area with borders", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        },
                        valueAxis = { };

                    createPlotArea(categoryAxis, valueAxis, {
                        plotArea: {
                            border: {
                                color: "red",
                                width: 2,
                                dashType: "dot"
                            }
                        }
                    });

                    var rect = view.log.rect[2];
                    equal(rect.style.dashType, "dot");
                    equal(rect.style.stroke, "red");
                    equal(rect.style.strokeWidth, 2);
                    same([rect.x1, rect.y1, rect.x2, rect.y2], [116, 100, 989.5, 976], TOLERANCE);
                });

                test("should render plot area background", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        },
                        valueAxis = { };

                    createPlotArea(categoryAxis, valueAxis, {
                        plotArea: {
                            background: "color"
                        }
                    });

                    var rect = view.log.rect[1];
                    equal(rect.style.fill, "color");
                    same([rect.x1, rect.y1, rect.x2, rect.y2], [116, 100, 989.5, 976], TOLERANCE);
                });

                test("should set plot area background opacity", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        },
                        valueAxis = { };

                    createPlotArea(categoryAxis, valueAxis, {
                        plotArea: {
                            background: "color",
                            opacity: 0.5
                        }
                    });

                    equal(view.log.rect[1].style.fillOpacity, 0.5);
                });

            })();

            (function() {
                var plotArea;

                function createPlotArea(options) {
                    plotArea = new dataviz.CategoricalPlotArea([{
                        name: "Value A",
                        type: "column",
                        data: [100]
                    }], kendo.deepExtend({
                        categoryAxis: {
                            categories: ["A"]
                        },
                        valueAxis: { },
                    }, options));

                    plotArea.reflow(chartBox);
                }

                // ------------------------------------------------------------
                module("Categorical PlotArea / Panes / Vertical", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("default pane is created", function() {
                    createPlotArea();

                    equals(plotArea.panes.length, 1);
                });

                test("default pane height is same as plot area height", function() {
                    createPlotArea();

                    equals(plotArea.panes[0].box.height(), plotArea.box.height());
                });

                test("default pane width is same as plot area width", function() {
                    createPlotArea();

                    equals(plotArea.panes[0].box.width(), plotArea.box.width());
                });

                test("panes are created", function() {
                    createPlotArea({
                        panes: [{ name: "a" }, { name: "b" }]
                    });

                    equals(plotArea.panes.length, 2);
                });

                test("one chart is created per pane", function() {
                    plotArea = new dataviz.CategoricalPlotArea([{
                        name: "Value A",
                        type: "column",
                        data: [100]
                    }, {
                        name: "Value B",
                        type: "column",
                        data: [200]
                    }], { });

                    equals(plotArea.charts.length, 1);
                });

                test("two panes occupy 50% height each by default", function() {
                    createPlotArea({
                        panes: [{ name: "a" }, { name: "b" }]
                    });

                    var halfHeight = plotArea.box.height() / 2;
                    equals(plotArea.panes[0].box.height(), halfHeight);
                    equals(plotArea.panes[1].box.height(), halfHeight);
                });

                test("second pane is positioned below the first", function() {
                    createPlotArea({
                        panes: [{ name: "a" }, { name: "b" }]
                    });

                    equals(plotArea.panes[0].box.y1, 100);
                    equals(plotArea.panes[1].box.y1, 550);
                });

                test("pane occupies set height in pixels", function() {
                    createPlotArea({
                        panes: [{ name: "a", height: 200 }, { name: "b" }]
                    });

                    equals(plotArea.panes[0].box.height(), 200);
                });

                test("pane occupies remaining height (in pixels)", function() {
                    createPlotArea({
                        panes: [{ name: "a", height: 200 }, { name: "b" }]
                    });

                    equals(plotArea.panes[1].box.height(), 700);
                });

                test("first pane occupies set height in percents", function() {
                    createPlotArea({
                        panes: [{ name: "a", height: "30%" }, { name: "b" }]
                    });

                    equals(plotArea.panes[0].box.height(), 270);
                });

                test("second pane occupies remaining height (in percents)", function() {
                    createPlotArea({
                        panes: [{ name: "a", height: "30%" }, { name: "b" }]
                    });

                    equals(plotArea.panes[1].box.height(), 630);
                });

                test("second pane occupies set height in percents", function() {
                    createPlotArea({
                        panes: [{ name: "a" }, { name: "b", height: "30%" }]
                    });

                    equals(plotArea.panes[1].box.height(), 270);
                });

                test("first pane occupies remaining height (in percents)", function() {
                    createPlotArea({
                        panes: [{ name: "a" }, { name: "b", height: "30%" }]
                    });

                    equals(plotArea.panes[0].box.height(), 630);
                });

                test("top margin is included in pane height", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", height: 200, margin: { top: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.panes[0].box.height(), 200);
                    equals(plotArea.panes[1].box.height(), 700);
                });

                test("top margin is applied", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", height: 200, margin: { top: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.panes[0].paddingBox.y1, 110);
                });

                test("bottom margin is included in pane height", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", height: 200, margin: { bottom: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.panes[0].box.height(), 200);
                    equals(plotArea.panes[1].box.height(), 700);
                });

                test("bottom margin is applied", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", height: 200, margin: { bottom: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.panes[0].paddingBox.y2, 290);
                });

                test("left margin is included in pane width", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", margin: { left: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.panes[0].box.width(), plotArea.panes[1].box.width());
                });

                test("left margin is applied to pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", margin: { left: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.panes[0].paddingBox.x1, 110);
                });

                test("left margin offsets value axis", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", margin: { left: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.valueAxis.box.x1, 110);
                });

                test("right margin is included in pane width", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", margin: { right: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.panes[0].box.width(), plotArea.panes[1].box.width());
                });

                test("right margin is applied to pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", margin: { right: 10 }
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.panes[0].paddingBox.x2, 990);
                });

                test("right margin offsets value axis", function() {
                    createPlotArea({
                        panes: [{
                            name: "a", margin: { right: 10 }
                        }, {
                            name: "b"
                        }],
                        categoryAxis: {
                            axisCrossingValue: 1
                        }
                    });

                    equals(plotArea.valueAxis.box.x2, 990);
                });

                test("value axis is rendered in the first pane by default", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.valueAxis.box.y1, 100);
                });

                test("category axis is rendered in the first pane by default", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }]
                    });

                    equals(plotArea.categoryAxis.box.y1, 526);
                });

                test("value axis is moved to the associated pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: {
                            pane: "b"
                        }
                    });

                    equals(plotArea.valueAxis.box.y1, 550);
                });

                test("value axis height matches the associated pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: {
                            pane: "b"
                        }
                    });

                    var axisBox = plotArea.valueAxis.box;
                    var paneBox = plotArea.panes[1].box;

                    equals(axisBox.y1, paneBox.y1);
                    equals(axisBox.y2, paneBox.y2);
                });

                test("category axis remains in the first pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: {
                            pane: "b"
                        }
                    });

                    equals(plotArea.categoryAxis.box.y1, 526);
                });

                test("category axis fits in the first pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: {
                            pane: "b"
                        }
                    });

                    equals(plotArea.categoryAxis.box.y2, plotArea.panes[0].box.y2);
                });

                test("category axis fits in the second pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        categoryAxis: {
                            pane: "b"
                        }
                    });

                    equals(plotArea.categoryAxis.box.y2, plotArea.panes[1].box.y2);
                });

                test("right aligned value axis fits in the associated pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: {
                            pane: "b"
                        },
                        categoryAxis: {
                            axisCrossingValue: 1
                        }
                    });

                    equals(plotArea.valueAxis.box.x2,
                           plotArea.panes[1].box.x2);
                });

                test("right aligned value axis height matches the associated pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: {
                            pane: "b"
                        },
                        categoryAxis: {
                            axisCrossingValue: 1
                        }
                    });

                    var axisBox = plotArea.valueAxis.box;
                    var paneBox = plotArea.panes[1].box;

                    equals(axisBox.y1, paneBox.y1);
                    equals(axisBox.y2, paneBox.y2);
                });

                test("secondary value axis is positioned in the designated pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: [{
                        }, {
                            name: "secondary",
                            pane: "b"
                        }]
                    });

                    equals(plotArea.namedValueAxes["secondary"].box.y1, 550);
                });

                test("secondary value axis is aligned to category axis", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: [{
                        }, {
                            name: "secondary",
                            pane: "b",
                            labels: {
                                template: "long text"
                            }
                        }]
                    });

                    equals(plotArea.namedValueAxes["secondary"].lineBox().x1,
                           plotArea.categoryAxis.lineBox().x1);
                });

                test("secondary value axis is aligned to category axis end", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: [{
                        }, {
                            name: "secondary",
                            pane: "b"
                        }],
                        categoryAxis: {
                            axisCrossingValue: [0, 1]
                        }
                    });

                    equals(plotArea.namedValueAxes["secondary"].lineBox().x1,
                           plotArea.categoryAxis.lineBox().x2);
                });

                test("right aligned secondary value axis fits in the associated pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: [{
                        }, {
                            name: "secondary",
                            pane: "b"
                        }],
                        categoryAxis: {
                            axisCrossingValue: [0, 1]
                        }
                    });

                    equals(plotArea.namedValueAxes["secondary"].box.x2 -
                           plotArea.panes[1].box.x2, 0);
                });

                test("left anchor axis is assigned per pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                        }, {
                            name: "b"
                        }],
                        valueAxis: [{
                        }, {
                            name: "secondary",
                            pane: "b"
                        }]
                    });

                    equals(plotArea.namedValueAxes["secondary"].box.x2,
                           plotArea.valueAxis.box.x2);
                });

                test("right anchor axis is assigned per pane", function() {
                    createPlotArea({
                        panes: [{
                            name: "a"
                        }, {
                            name: "b"
                        }],
                        valueAxis: [{
                        }, {
                            name: "secondary",
                            pane: "b"
                        }],
                        categoryAxis: {
                            axisCrossingValue: [1, 1]
                        }
                    });

                    equals(plotArea.namedValueAxes["secondary"].box.x1,
                           plotArea.valueAxis.box.x1);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Panes / Title", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("title is not visible by default", function() {
                    createPlotArea({
                        panes: [{
                            name: "a"
                        }]
                    });

                    var textBox = plotArea.panes[0].title;
                    equals(textBox, null);
                });

                test("title is aligned in pane center", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                            title: {
                                text: "Title",
                                align: "center"
                            }
                        }]
                    });

                    var textBox = plotArea.panes[0].title.children[0];
                    equals(textBox.box.x1, 528.5, TOLERANCE);
                });

                test("title is aligned left by default", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                            title: {
                                text: "Title"
                            }
                        }]
                    });

                    var textBox = plotArea.panes[0].title.children[0];
                    equals(textBox.box.x1, 100);
                });

                test("title is aligned right", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                            title: {
                                text: "Title",
                                align: "right"
                            }
                        }]
                    });

                    var textBox = plotArea.panes[0].title.children[0];
                    equals(textBox.box.x1, 957, TOLERANCE);
                });

                test("title text can be set directly", function() {
                    createPlotArea({
                        panes: [{
                            name: "a",
                            title: "Title"
                        }]
                    });

                    var textBox = plotArea.panes[0].title.children[0];
                    equals(textBox.children[0].content, "Title");
                });

            })();

            (function() {
                var chart,
                    bar,
                    barElement,
                    plotArea;

                var TOLERANCE = 5;

                function createBarChart(options) {
                    chart = createChart($.extend({
                        series: [{
                            type: "bar",
                            data: [1, 2]
                        }],
                        categoryAxis: {
                            categories: ["A", "B"]
                        }
                    }, options));

                    plotArea = chart._model.children[1];
                    bar = plotArea.charts[0].points[0];
                    barElement = $("#" + bar.options.id);
                }

                // ------------------------------------------------------------
                module("Categorical Plot Area / Events / plotAreaClick", {
                    teardown: destroyChart
                });

                test("point click bubbles to plot area", 1, function() {
                    createBarChart({
                        plotAreaClick: function() { ok(true); }
                    });

                    barElement.trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("fires when clicking plot area directly", 1, function() {
                    createBarChart({
                        plotAreaClick: function() { ok(true); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("does not fire when clicking outside of axis range", 0, function() {
                    createBarChart({
                        plotAreaClick: function() { ok(false); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 580
                    });
                });

                test("does not fire when clicking on axes", 0, function() {
                    createBarChart({
                        plotAreaClick: function() { ok(false); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 3000, clientY: 0
                    });
                });

                test("event arguments contain value", 1, function() {
                    createBarChart({
                        plotAreaClick: function(e) { equals(e.value, 0.4, TOLERANCE); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("event arguments contain multiple values", 1, function() {
                    createBarChart({
                        valueAxis: [{}, { name: "b", min: 100, max: 1000 }],
                        plotAreaClick: function(e) { same(e.value, [1, 255], TOLERANCE); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("event arguments contain category", 1, function() {
                    createBarChart({
                        plotAreaClick: function(e) { equals(e.category, "B"); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("event arguments contain empty category", 1, function() {
                    createBarChart({
                        categoryAxis: {
                            categories: ["A"]
                        },
                        plotAreaClick: function(e) { equals(e.category, ""); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("event arguments contain all categories", 1, function() {
                    createBarChart({
                        categoryAxis: [{
                            categories: ["A", "B"]
                        }, {
                            categories: ["a", "b"]
                        }],
                        plotAreaClick: function(e) { same(e.category, ["B", "b"]); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("event arguments contain categories when second axis is moved", 1, function() {
                    createBarChart({
                        categoryAxis: [{
                            categories: ["A", "B"]
                        }, {
                            categories: ["a", "b"]
                        }],
                        valueAxis: {
                            axisCrossingValue: [0, 100]
                        },
                        plotAreaClick: function(e) { same(e.category, ["B", "b"]); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("event arguments contain date category", 1, function() {
                    var date = new Date("2012/09/15");
                    createBarChart({
                        categoryAxis: {
                            categories: [date]
                        },
                        plotAreaClick: function(e) { equals(e.category.toString(), date.toString()); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                // ------------------------------------------------------------
                function createChartWithPanes(plotAreaClick) {
                    chart = createChart({
                        panes: [{
                            name: "top"
                        }, {
                            name: "bottom"
                        }],
                        categoryAxis: [{
                            name: "catA",
                            pane: "top",
                            categories: ["A", "B"]
                        }, {
                            name: "catB",
                            pane: "bottom",
                            categories: ["C"]
                        }],
                        valueAxis: [{
                            name: "valA",
                            pane: "top"
                        }, {
                            name: "valB",
                            pane: "bottom"
                        }],
                        series: [{
                            axis: "valA",
                            categoryAxis: "catA",
                            data: [1, 2]
                        }, {
                            axis: "valB",
                            categoryAxis: "catB",
                            data: [10]
                        }],
                        plotAreaClick: plotAreaClick
                    });

                    plotArea = chart._model.children[1];
                }

                module("Categorical Plot Area / Events / plotAreaClick / Panes", {
                    teardown: destroyChart
                });

                test("categories are scoped to pane", 1, function() {
                    createChartWithPanes(
                        function(e) {
                            same(e.category, "C");
                        }
                    );

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 450
                    });
                });

                test("values are scoped to pane", 1, function() {
                    createChartWithPanes(
                        function(e) {
                            same(e.value, 9, TOLERANCE);
                        }
                    );

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 450
                    });
                });

                test("uses primary category axis if the pane lacks one", 1, function() {
                    chart = createChart({
                        panes: [{
                            name: "top"
                        }, {
                            name: "bottom"
                        }],
                        categoryAxis: {
                            pane: "bottom",
                            categories: ["A", "B"]
                        },
                        valueAxis: {
                            pane: "top"
                        },
                        series: [{
                            data: [1, 2]
                        }],
                        plotAreaClick: function(e) {
                            equals(e.category, "A")
                        }
                    });

                    plotArea = chart._model.children[1];

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

            })();

            (function() {
                var plotArea,
                    categoryAxis,
                    namedXAxes,
                    namedYAxes,
                    axisX,
                    secondaryXAxis,
                    axisY,
                    secondaryYAxis,
                    scatterSeriesData = [{
                        name: "Value A",
                        type: "scatter",
                        data: [[100, 100], [200, 200], [300, 300]]
                    }, {
                        name: "Value B",
                        type: "scatter",
                        data: [[10, 10], [20, 20], [30, 30]]
                    }];

                function createPlotArea(series, options) {
                    plotArea = new dataviz.XYPlotArea(series, options);

                    axisX = plotArea.axisX;
                    axisY = plotArea.axisY;
                    namedXAxes = plotArea.namedXAxes;
                    namedYAxes = plotArea.namedYAxes;
                    secondaryXAxis = namedXAxes.secondary;
                    secondaryYAxis = namedYAxes.secondary;

                    chartSeries = plotArea.charts[0];
                }

                // ------------------------------------------------------------
                module("XY PlotArea / Axes", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData);
                    }
                });

                test("appends primary X axis to children collection", function() {
                    ok($.inArray(axisX, plotArea.children) >= 0);
                });

                test("appends primary Y axis to children collection", function() {
                    ok($.inArray(axisY, plotArea.children) >= 0);
                });

                test("aligns axes at default crossing values", function() {
                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1]);
                });

                test("aligns axises at non-default crossing values", function() {
                    axisY.options.axisCrossingValue = 10;
                    axisX.options.axisCrossingValue = 1;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1], TOLERANCE);
                });

                test("X axis limit is [0, 1] when no series are configured", 2, function() {
                    stubMethod(dataviz.XYPlotArea.fn, "createAxes",
                        function() {
                            equal(this.xAxisRangeTracker.query("primary").min, 0);
                            equal(this.xAxisRangeTracker.query("primary").max, 1);
                        },
                        function() {
                            plotArea = new dataviz.XYPlotArea([]);
                        }
                    );
                });

                test("Y axis limit is [0, 1] when no series are configured", 2, function() {
                    stubMethod(dataviz.XYPlotArea.fn, "createAxes",
                        function() {
                            equal(this.yAxisRangeTracker.query("primary").min, 0);
                            equal(this.yAxisRangeTracker.query("primary").max, 1);
                        },
                        function() {
                            plotArea = new dataviz.XYPlotArea([]);
                        }
                    );
                });

                test("creates Numeric axes by default", function() {
                    ok(plotArea.axisX instanceof dataviz.NumericAxis);
                    ok(plotArea.axisY instanceof dataviz.NumericAxis);
                });

                test("creates Date value axes", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: {
                            type: "date"
                        },
                        yAxis: {
                            type: "date"
                        }
                    });

                    ok(plotArea.axisX instanceof dataviz.DateValueAxis);
                    ok(plotArea.axisY instanceof dataviz.DateValueAxis);
                });

                test("creates Date value axes with capitalized type", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: {
                            type: "Date"
                        },
                        yAxis: {
                            type: "Date"
                        }
                    });

                    ok(plotArea.axisX instanceof dataviz.DateValueAxis);
                    ok(plotArea.axisY instanceof dataviz.DateValueAxis);
                });

                test("Automatically detects date X axis", function() {
                    createPlotArea([{
                        name: "Value A",
                        type: "scatter",
                        data: [[new Date(2012, 02, 01), 100]]
                    }]);

                    same(plotArea.axisX.options.type, "date");
                });

                test("Automatically detects date X axis for bound series", function() {
                    createPlotArea([{
                        name: "Value A",
                        type: "scatter",
                        xField: "x",
                        yField: "y",
                        data: [{ x: new Date(2012, 02, 01), y: 100 }]
                    }]);

                    same(plotArea.axisX.options.type, "date");
                });

                test("Automatic detection of X axis can be overriden", function() {
                    createPlotArea([{
                        name: "Value A",
                        type: "scatter",
                        data: [[new Date(2012, 02, 01), 100]]
                    }], {
                        xAxis: {
                            type: "numeric"
                        }
                    });

                    ok(plotArea.axisX instanceof kendo.dataviz.NumericAxis);
                });

                test("Automatic detection of X axis can be overriden (capitalized)", function() {
                    createPlotArea([{
                        name: "Value A",
                        type: "scatter",
                        data: [[new Date(2012, 02, 01), 100]]
                    }], {
                        xAxis: {
                            type: "Numeric"
                        }
                    });

                    ok(plotArea.axisX instanceof kendo.dataviz.NumericAxis);
                });

                test("Automatically detects date Y axis", function() {
                    createPlotArea([{
                        name: "Value A",
                        type: "scatter",
                        data: [[100, new Date(2012, 02, 01)]]
                    }]);

                    same(plotArea.axisY.options.type, "date");
                });

                test("Automatically detects date Y axis for bound series", function() {
                    createPlotArea([{
                        name: "Value A",
                        type: "scatter",
                        xField: "x",
                        yField: "y",
                        data: [{ x: 100, y: new Date(2012, 02, 01) }]
                    }]);

                    same(plotArea.axisY.options.type, "date");
                });

                test("Automatic detection of Y axis can be overriden", function() {
                    createPlotArea([{
                        name: "Value A",
                        type: "scatter",
                        data: [[100, new Date(2012, 02, 01)]]
                    }], {
                        yAxis: {
                            type: "numeric"
                        }
                    });

                    ok(plotArea.axisY instanceof kendo.dataviz.NumericAxis);
                });

                test("Automatic detection of Y axis can be overriden (capitalized)", function() {
                    createPlotArea([{
                        name: "Value A",
                        type: "scatter",
                        data: [[100, new Date(2012, 02, 01)]]
                    }], {
                        yAxis: {
                            type: "Numeric"
                        }
                    });

                    ok(plotArea.axisY instanceof kendo.dataviz.NumericAxis);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            xAxis: [{}, {
                                name: "secondary"
                            }],
                            yAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("assigns axisX alias to first named X axis", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: [{ name: "a" }, { name: "b" }]
                    });

                    equals(plotArea.axisX.options.name, "a");
                });

                test("assigns axisY alias to first named Y axis", function() {
                    createPlotArea(scatterSeriesData, {
                        yAxis: [{ name: "a" }, { name: "b" }]
                    });

                    equals(plotArea.axisY.options.name, "a");
                });

                test("secondary X axis added to children collection", function() {
                    ok($.inArray(secondaryXAxis, plotArea.children) >= 0);
                });

                test("secondary Y axis added to children collection", function() {
                    ok($.inArray(secondaryYAxis, plotArea.children) >= 0);
                });

                test("aligns primary axes at default crossing values", function() {
                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1]);
                });

                test("secondary X axis on the right is contained in plot area", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: [{ min: -350 }, { name: "secondary" }],
                        yAxis: { axisCrossingValue: [0, 100], min: -350 }
                    });

                    plotArea.reflow(chartBox);

                    equals(secondaryXAxis.lineBox().x2, axisX.lineBox().x2);
                });

                test("secondary X axis on the left is contained in plot area", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: [{ min: -350 }, { name: "secondary", min: -1, max: 0 }],
                        yAxis: { axisCrossingValue: [0, 100], min: -350 }
                    });

                    plotArea.reflow(chartBox);

                    equals(secondaryXAxis.lineBox().x1, axisX.lineBox().x1);
                });

                test("secondary Y axis on top is contained in plot area", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: { axisCrossingValue: [0, 100], min: -350 },
                        yAxis: [{ min: -350 }, { name: "secondary" }]
                    });

                    plotArea.reflow(chartBox);

                    equals(secondaryYAxis.lineBox().y1, axisY.lineBox().y1, TOLERANCE);
                });

                test("secondary Y axis on bottom is contained in plot area", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: { axisCrossingValue: [0, 100], min: -350 },
                        yAxis: [{ min: -350 }, { name: "secondary", min: -1, max: 0 }]
                    });

                    plotArea.reflow(chartBox);

                    equals(secondaryYAxis.lineBox().y2, axisY.lineBox().y2);
                });

                test("Throws error when X axis name is duplicate", function() {
                    raises(function() {
                        plotArea = createPlotArea(scatterSeriesData, {
                            xAxis: [{
                                name: "b"
                            }, {
                                name: "b"
                            }]
                        });
                    },
                    /X axis with name b is already defined/);
                });

                test("Throws error when Y axis name is duplicate", function() {
                    raises(function() {
                        plotArea = createPlotArea(scatterSeriesData, {
                            yAxis: [{
                                name: "b"
                            }, {
                                name: "b"
                            }]
                        });
                    },
                    /Y axis with name b is already defined/);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes / Stacked Top", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            xAxis: [{}, { name: "secondary" }],
                            yAxis: { axisCrossingValue: 10000 }
                        });
                    }
                });

                test("overlapping X axes are shifted to the top", function() {
                    var margin = secondaryXAxis.options.margin;

                    plotArea.reflow(chartBox);

                    equals(secondaryXAxis.box.y2, axisX.box.y1 - margin);
                });

                test("stacked X axes on top are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryXAxis.lineBox().x1, secondaryXAxis.lineBox().x2],
                         [axisX.lineBox().x1, axisX.lineBox().x2]
                    );
                });

                test("stacked X axes on the top are mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(axisX.options.labels.mirror);
                    ok(secondaryXAxis.options.labels.mirror);
                });

                test("mirroring inverts the mirror option", function() {
                    axisX.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(!axisX.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes / Stacked Right", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            xAxis: { axisCrossingValue: 10000 },
                            yAxis: [{}, { name: "secondary" }]
                        });
                    }
                });

                test("overlapping Y axes are shifted to the right", function() {
                    var margin = secondaryYAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same([secondaryYAxis.box.x1, secondaryYAxis.box.y1],
                         [axisY.box.x2 + margin, axisY.box.y1]
                    );
                });

                test("stacked Y axes on right are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryYAxis.lineBox().y1, secondaryYAxis.lineBox().y2],
                         [axisY.lineBox().y1, axisY.lineBox().y2]
                    );
                });

                test("stacked Y axes on the right are mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(axisY.options.labels.mirror);
                    ok(secondaryYAxis.options.labels.mirror);
                });

                test("mirroring inverts the mirror option", function() {
                    axisY.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(!axisY.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes / Stacked Bottom", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            xAxis: [{}, { name: "secondary" }]
                        });
                    }
                });

                test("overlapping X axes are shifted to the bottom", function() {
                    var margin = secondaryXAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same(secondaryXAxis.box.y1, axisX.box.y2 + margin);
                });

                test("stacked X axes on bottom are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryXAxis.lineBox().x1, secondaryXAxis.lineBox().x2],
                         [axisX.lineBox().x1, axisX.lineBox().x2]
                    );
                });

                test("stacked X axes on the bottom are not mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(!axisX.options.labels.mirror);
                    ok(!secondaryXAxis.options.labels.mirror);
                });

                test("user set mirror option is not changed", function() {
                    axisX.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(axisX.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes / Stacked Left", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            yAxis: [{}, { name: "secondary" }]
                        });
                    }
                });

                test("overlapping Y axes are stacked to the left", function() {
                    var margin = secondaryYAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same([secondaryYAxis.box.x2, secondaryYAxis.box.y1],
                         [axisY.box.x1 - margin, axisY.box.y1]
                    );
                });

                test("stacked Y axes on left are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryYAxis.lineBox().y1, secondaryYAxis.lineBox().y2],
                         [axisY.lineBox().y1, axisY.lineBox().y2]
                    );
                });

                test("stacked Y axes on the left are not mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(!axisY.options.labels.mirror);
                    ok(!secondaryYAxis.options.labels.mirror);
                });

                test("user set mirror option is not changed", function() {
                    axisY.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(axisY.options.labels.mirror);
                });

            })();

            (function() {
                var chart,
                    point,
                    pointElement,
                    plotArea,
                    TOLERANCE = 1;

                function createScatterChart(options) {
                    chart = createChart($.extend({
                        series: [{
                            name: "Value A",
                            type: "scatter",
                            data: [[100, 100]]
                        }]
                    }, options));

                    plotArea = chart._model.children[1];
                    point = plotArea.charts[0].points[0];
                    pointElement = $("#" + point.options.id);
                }

                // ------------------------------------------------------------
                module("XY Plot Area / Events / plotAreaClick", {
                    teardown: destroyChart
                });

                test("point click bubbles to plot area", 1, function() {
                    createScatterChart({
                        plotAreaClick: function() { ok(true); }
                    });

                    pointElement.trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("fires when clicking plot area directly", 1, function() {
                    createScatterChart({
                        plotAreaClick: function() { ok(true); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 300, clientY: 300
                    });
                });

                test("does not fire when clicking outside of axis range", 0, function() {
                    createScatterChart({
                        plotAreaClick: function() { ok(false); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 3000, clientY: 0
                    });
                });

                test("event arguments contain x axis value", 1, function() {
                    createScatterChart({
                        plotAreaClick: function(e) { equals(e.x, 12, TOLERANCE); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 200, clientY: 500
                    });
                });

                test("event arguments contain multiple x axis values", 1, function() {
                    createScatterChart({
                        xAxis: [{}, { name: "b", min: 100, max: 1000 }],
                        plotAreaClick: function(e) { same(e.x, [12, 193], TOLERANCE); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 200, clientY: 500
                    });
                });

                test("event arguments contain y axis value", 1, function() {
                    createScatterChart({
                        plotAreaClick: function(e) { equals(e.y, 24, TOLERANCE); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 200, clientY: 500
                    });
                });

                test("event arguments contain multiple y axis values", 1, function() {
                    createScatterChart({
                        yAxis: [{}, { name: "b", min: 100, max: 1000 }],
                        plotAreaClick: function(e) { same(e.y, [24, 278], TOLERANCE); }
                    });

                    $("#" + plotArea.options.id).trigger({
                        type: "click", clientX: 200, clientY: 500
                    });
                });

            })();
        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <div style="position: absolute; top: 200px; left: 8px;">
            <div id="container" style="width: 1664px; height: 400px;">
            </div>
        </div>

    </body>
</html>
