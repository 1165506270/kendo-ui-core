<!DOCTYPE html>
<html>
    <head>
        <title>UI5.Chart Tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <link href="../qunit/qunit/qunit.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.dataviz.core.js"></script>
        <script src="../../src/kendo.dataviz.chart.js"></script>
        <script src="../../src/kendo.dataviz.themes.js"></script>
        <script src="../../src/kendo.dataviz.svg.js"></script>
        <script src="../../src/kendo.dataviz.vml.js"></script>
        <script src="util.js"></script>
        <script type="text/javascript">

            var dataviz = kendo.dataviz,
                Box2D = dataviz.Box2D,
                chartBox = new Box2D(100, 100, 1000, 1000),
                view,
                TOLERANCE = 1,
                MARGIN = 10,
                GAP = 4,
                chartSeries;

                function moduleSetup() {
                    view = new ViewStub();
                }

            (function() {
                var plotArea,
                    categoryAxis,
                    namedValueAxes,
                    primaryValueAxis,
                    secondaryValueAxis,
                    barSeriesData = [{
                        name: "Value A",
                        type: "bar",
                        data: [100, 200, 300],
                        gap: GAP
                    }, {
                        name: "Value B",
                        type: "bar",
                        data: [10, 20, 30]
                    }],
                    columnSeriesData = [{
                        name: "Value A",
                        type: "column",
                        data: [100, 200, 300],
                        gap: GAP
                    }, {
                        name: "Value B",
                        type: "column",
                        data: [10, 20, 30]
                    }],
                    lineSeriesData = [{
                        name: "Value A",
                        type: "line",
                        data: [100, 200, 300]
                    }, {
                        name: "Value B",
                        type: "line",
                        data: [10, 20, 30]
                    },
                    verticalLineSeriesData = [{
                        name: "Value A",
                        type: "verticalLine",
                        data: [100, 200, 300]
                    }, {
                        name: "Value B",
                        type: "verticalLine",
                        data: [10, 20, 30]
                    }]],
                    areaSeriesData = [{
                        name: "Value A",
                        type: "area",
                        data: [100, 200, 300]
                    }, {
                        name: "Value B",
                        type: "area",
                        data: [10, 20, 30]
                    },
                    verticalAreaSeriesData = [{
                        name: "Value A",
                        type: "verticalArea",
                        data: [100, 200, 300]
                    }, {
                        name: "Value B",
                        type: "verticalArea",
                        data: [10, 20, 30]
                    }]];

                function createPlotArea(series, options) {
                    plotArea = new dataviz.CategoricalPlotArea(series,
                        $.extend({
                        categoryAxis: {
                            categories: ["A", "B", "C"]
                        }
                    }, options));

                    categoryAxis = plotArea.categoryAxis;
                    namedValueAxes = plotArea.namedValueAxes;
                    primaryValueAxis = plotArea.namedValueAxes.primary;
                    secondaryValueAxis = plotArea.namedValueAxes.secondary;

                    chartSeries = plotArea.charts[0];
                }

                // ------------------------------------------------------------
                module("Categorical PlotArea / Axes", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData);
                    }
                });

                test("appends primary value axis to children collection", function() {
                    ok($.inArray(primaryValueAxis, plotArea.children) >= 0);
                });

                test("appends category axis to children collection", function() {
                    ok($.inArray(categoryAxis, plotArea.children) >= 0);
                });

                test("aligns axes at default crossing values", function() {
                    var axisX = categoryAxis,
                        axisY = primaryValueAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1]);
                });

                test("aligns reversed axes at default crossing values", function() {
                    createPlotArea(columnSeriesData, {
                        categoryAxis: { reverse: true },
                        valueAxis: { reverse: true }
                    });

                    var axisX = categoryAxis,
                        axisY = primaryValueAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x2, crossingSlotY.y2], [crossingSlotX.x2, crossingSlotX.y2]);
                });

                test("aligns axises at non-default crossing values", function() {
                    var axisX = categoryAxis,
                        axisY = primaryValueAxis;

                    axisY.options.axisCrossingValue = 10;
                    axisX.options.axisCrossingValue = 1;
                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1], TOLERANCE);
                });

                test("aligns reversed axes at non-default crossing values", function() {
                    createPlotArea(columnSeriesData, {
                        categoryAxis: { reverse: true, axisCrossingValue: 3 },
                        valueAxis: { reverse: true }
                    });

                    var axisX = categoryAxis,
                        axisY = primaryValueAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x2, crossingSlotY.y2], [crossingSlotX.x2, crossingSlotX.y2]);
                });

                test("axis limit is [0, 1] when no series are configured", 2, function() {
                    stubMethod(dataviz.CategoricalPlotArea.fn, "createAxes",
                        function() {
                            equal(this.valueAxisRangeTracker.query("primary").min, 0);
                            equal(this.valueAxisRangeTracker.query("primary").max, 1);
                        },
                        function() {
                            plotArea = new dataviz.CategoricalPlotArea([]);
                        }
                    );
                });

                test("adds categories to match actual data", function() {
                    var plotArea = new dataviz.CategoricalPlotArea(columnSeriesData, {
                        categoryAxis: {
                            categories: ["A", "B"]
                        }
                    });

                    equals(plotArea.categoryAxis.options.categories.length, 3);
                });

                test("accepts extra categories", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            type: "column",
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"]
                        }
                    });

                    equals(plotArea.categoryAxis.options.categories.length, 2);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Multiple Axes", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData, {
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("secondary axis added to children collection", function() {
                    ok($.inArray(secondaryValueAxis, plotArea.children) >= 0);
                });

                test("crosses category axis at default value", function() {
                    plotArea.reflow(chartBox);

                    var slotX = categoryAxis.getSlot(categoryAxis.options.axisCrossingValue),
                        slotY = primaryValueAxis.getSlot(primaryValueAxis.options.axisCrossingValue);

                    equals(slotX.y1, slotY.y1);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Multiple Axes / Stacked Left", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData, {
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("overlapping axes are stacked to the left", function() {
                    var margin = secondaryValueAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.box.x2, secondaryValueAxis.box.y1],
                         [primaryValueAxis.box.x1 - margin, primaryValueAxis.box.y1]
                    );
                });

                test("stacked axes on left are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.lineBox().y1, secondaryValueAxis.lineBox().y2],
                         [primaryValueAxis.lineBox().y1, primaryValueAxis.lineBox().y2]
                    );
                });

                test("stacked axes on the left are not mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(!primaryValueAxis.options.labels.mirror);
                    ok(!secondaryValueAxis.options.labels.mirror);
                });

                test("user set mirror option is not changed", function() {
                    primaryValueAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(primaryValueAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Multiple Axes / Stacked Right", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData, {
                            categoryAxis: {
                                axisCrossingValue: 100
                            },
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("overlapping axes are shifted to the right", function() {
                    var margin = secondaryValueAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.box.x1, secondaryValueAxis.box.y1],
                         [primaryValueAxis.box.x2 + margin, primaryValueAxis.box.y1]
                    );
                });

                test("stacked axes on right are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.lineBox().y1, secondaryValueAxis.lineBox().y2],
                         [primaryValueAxis.lineBox().y1, primaryValueAxis.lineBox().y2]
                    );
                });

                test("plot area bounding box wraps axis", function() {
                    plotArea.reflow(chartBox);

                    var axisBox = secondaryValueAxis.box;
                    ok(axisBox.x1 >= plotArea.box.x1 && axisBox.y1 >= plotArea.box.x1);
                });

                test("stacked axes on the right are mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(primaryValueAxis.options.labels.mirror);
                    ok(secondaryValueAxis.options.labels.mirror);
                });

                test("mirroring inverts the mirror option", function() {
                    primaryValueAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(!primaryValueAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Inverted / Multiple Axes / Stacked Top", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(barSeriesData, {
                            categoryAxis: {
                                axisCrossingValue: 0
                            },
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("overlapping axes are shifted to the top", function() {
                    var margin = secondaryValueAxis.options.margin;

                    plotArea.reflow(chartBox);

                    equals(secondaryValueAxis.box.y2, primaryValueAxis.box.y1 - margin);
                });

                test("stacked axes on top are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.lineBox().x1, secondaryValueAxis.lineBox().x2],
                         [primaryValueAxis.lineBox().x1, primaryValueAxis.lineBox().x2]
                    );
                });

                test("stacked axes on the top are mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(primaryValueAxis.options.labels.mirror);
                    ok(secondaryValueAxis.options.labels.mirror);
                });

                test("mirroring inverts the mirror option", function() {
                    primaryValueAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(!primaryValueAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Inverted / Multiple Axes / Stacked Bottom", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(barSeriesData, {
                            valueAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("overlapping axes are shifted to the bottom", function() {
                    var margin = secondaryValueAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same(secondaryValueAxis.box.y1, primaryValueAxis.box.y2 + margin);
                });

                test("stacked axes on bottom are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryValueAxis.lineBox().x1, secondaryValueAxis.lineBox().x2],
                         [primaryValueAxis.lineBox().x1, primaryValueAxis.lineBox().x2]
                    );
                });

                test("stacked axes on the bottom are not mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(!primaryValueAxis.options.labels.mirror);
                    ok(!secondaryValueAxis.options.labels.mirror);
                });

                test("user set mirror option is not changed", function() {
                    primaryValueAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(primaryValueAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Column series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(columnSeriesData);
                    }
                });

                test("value axis is vertical", function() {
                    ok(primaryValueAxis.options.vertical);
                });

                test("category axis is horizontal", function() {
                    ok(!categoryAxis.options.vertical);
                });

                test("value axis crosses at first category", function() {
                    equal(primaryValueAxis.options.axisCrossingValue, 0);
                });

                test("category axis crossing value can be changed", function() {
                    plotArea = new dataviz.CategoricalPlotArea(columnSeriesData, {
                        categoryAxis: {
                            categories: ["A", "B", "C"],
                            axisCrossingValue: 2
                        }
                    });
                    equal(plotArea.categoryAxis.options.axisCrossingValue, 2);
                });

                test("creates bar chart", function() {
                    ok(chartSeries instanceof dataviz.BarChart);
                });

                test("groups bar series into bar chart", function() {
                    equal(chartSeries.options.series.length, 2);
                });

                test("sets axis min/max to series limits", 2, function() {
                    stubMethod(dataviz.CategoricalPlotArea.fn, "createAxes",
                        function() {
                            equal(this.valueAxisRangeTracker.query("primary").min, 10);
                            equal(this.valueAxisRangeTracker.query("primary").max, 300);
                        },
                        function() {
                            createPlotArea(columnSeriesData);
                        }
                    );
                });

                test("applies gap from first series", function() {
                    equals(chartSeries.options.gap, GAP);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Line series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(lineSeriesData);
                    }
                });

                test("value axis is vertical", function() {
                    ok(primaryValueAxis.options.vertical);
                });

                test("category axis is horizontal", function() {
                    ok(!categoryAxis.options.vertical);
                });

                test("creates line chart", function() {
                    ok(chartSeries instanceof dataviz.LineChart);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "line", data: [], stack: true }, { type: "line", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "line", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Vertical line series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(verticalLineSeriesData);
                    }
                });

                test("value axis is horizontal", function() {
                    ok(!primaryValueAxis.options.vertical);
                });

                test("category axis is vertical", function() {
                    ok(categoryAxis.options.vertical);
                });

                test("creates line chart", function() {
                    ok(chartSeries instanceof dataviz.LineChart);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "verticalLine", data: [], stack: true }, { type: "verticalLine", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "verticalLine", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Area series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(areaSeriesData);
                    }
                });

                test("value axis is vertical", function() {
                    ok(primaryValueAxis.options.vertical);
                });

                test("category axis is horizontal", function() {
                    ok(!categoryAxis.options.vertical);
                });

                test("creates area chart", function() {
                    ok(chartSeries instanceof dataviz.AreaChart);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "area", data: [], stack: true }, { type: "area", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "area", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Verical area series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(verticalAreaSeriesData);
                    }
                });

                test("value axis is horizontal", function() {
                    ok(!primaryValueAxis.options.vertical);
                });

                test("category axis is vertical", function() {
                    ok(categoryAxis.options.vertical);
                });

                test("creates area chart", function() {
                    ok(chartSeries instanceof dataviz.AreaChart);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "verticalArea", data: [], stack: true }, { type: "verticalArea", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "verticalArea", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Bar series", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(barSeriesData);
                    }
                });

                test("value axis is horizontal", function() {
                    ok(!primaryValueAxis.options.vertical);
                });

                test("category axis is vertical", function() {
                    ok(categoryAxis.options.vertical);
                });

                test("value axis crosses at last category", function() {
                    equal(plotArea.categoryAxis.options.axisCrossingValue, 3);
                });

                test("value axis crossing can be changed", function() {
                    plotArea = new dataviz.CategoricalPlotArea(barSeriesData, {
                        categoryAxis: {
                            categories: ["A", "B", "C"],
                            axisCrossingValue: 2
                        }
                    });
                    equal(plotArea.categoryAxis.options.axisCrossingValue, 2);
                });

                test("applies gap from first series", function() {
                    equals(chartSeries.options.gap, GAP);
                });

                test("aligns axes at default crossing values", function() {
                    var axisX = primaryValueAxis,
                        axisY = categoryAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1]);
                });

                test("aligns reversed axes at default crossing values", function() {
                    createPlotArea(barSeriesData, {
                        categoryAxis: { reverse: true },
                        valueAxis: { reverse: true }
                    });

                    var axisX = primaryValueAxis,
                        axisY = categoryAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);

                    same([crossingSlotY.x2, crossingSlotY.y2], [crossingSlotX.x2, crossingSlotX.y2]);
                });

                test("aligns reversed axes at non-default crossing values", function() {
                    createPlotArea(barSeriesData, {
                        categoryAxis: { reverse: true, axisCrossingValue: 0 },
                        valueAxis: { reverse: true }
                    });

                    var axisX = primaryValueAxis,
                        axisY = categoryAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);

                    same([crossingSlotY.x2, crossingSlotY.y2], [crossingSlotX.x2, crossingSlotX.y2]);
                });

                test("sets isStacked when first series is stacked", function() {
                    createPlotArea([{ type: "bar", data: [], stack: true }, { type: "bar", data: [] }]);
                    ok(chartSeries.options.isStacked);
                });

                test("does not set isStacked when first and only series is stacked", function() {
                    createPlotArea([{ type: "bar", data: [], stack: true }]);
                    ok(!chartSeries.options.isStacked);
                });

            })();

            (function() {
                var plotArea,
                    barSeriesData = [{
                        name: "Value A",
                        type: "bar",
                        data: [100]
                    }];

                function createPlotArea(categoryAxis, valueAxis, options) {
                    plotArea = new dataviz.CategoricalPlotArea(barSeriesData, {
                        categoryAxis: categoryAxis,
                        valueAxis: valueAxis,
                        plotArea: options
                    });

                    stubMethod(dataviz.NumericAxis.fn, "getViewElements", function() { return []; },
                        function() {
                            stubMethod(dataviz.CategoryAxis.fn, "getViewElements", function() { return []; },
                                function() {
                                    plotArea.reflow(chartBox);
                                    plotArea.getViewElements(view);
                                }
                    )});
                }

                // ------------------------------------------------------------
                module("Categorical PlotArea / Major Gridlines", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("renders gridlines", function() {
                    createPlotArea({
                        categories: ["A"],
                        majorGridLines: {
                            visible: true
                        }
                    });

                    equal(view.log.line.length, 7);
                });

                test("should not render gridlines for numeric axis", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 1);
                });

                test("should not render gridlines for category axis", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        };

                    createPlotArea(categoryAxis);

                    equal(view.log.line.length, 6);
                });

                test("should not render gridlines", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: false
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 0);
                });

                test("gridlines extend to secondary axis end", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            min: 0,
                            max: 10,
                            majorUnit: 3,
                            majorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);
                    equals(view.log.line[0].x2, plotArea.namedValueAxes.primary.lineBox().x2);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Minor Gridlines", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("renders gridlines", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: true
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 32);
                });

                test("should not render gridlines for numeric axis", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 2);
                });

                test("should not render gridlines for category axis", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            },
                            minorGridLines: {
                                visible: true
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 30);
                });

                test("should not render gridlines", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: false
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 0);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Major and Minor GridLines", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("should not render minor and major gridline to a same point", function() {
                    var categoryAxis = {
                            categories: ["A"],
                            majorGridLines: {
                                visible: true
                            },
                            minorGridLines: {
                                visible: true
                            }
                        },
                        valueAxis = {
                            majorGridLines: {
                                visible: true
                            },
                            minorGridLines: {
                                visible: true
                            }
                        };

                    createPlotArea(categoryAxis, valueAxis);

                    equal(view.log.line.length, 32);
                });

                // ------------------------------------------------------------
                module("Categorical PlotArea / Configuration", {
                    setup: function() {
                        moduleSetup();
                    }
                });

                test("applies margin", function() {
                    var plotArea = new dataviz.CategoricalPlotArea([{
                            data: [100]
                        }], {
                        categoryAxis: {
                            categories: ["A", "B"],
                            labels: { font: SANS12 }
                        },
                        valueAxis: {
                            labels: { font: SANS12 }
                        },
                        plotArea: {
                            margin: MARGIN
                        }
                    });

                    plotArea.reflow(chartBox);

                    sameBox(plotArea.box, new Box2D(110, 110, 990, 990), TOLERANCE);
                });

                test("should not render plot area with borders", function() {
                    var categoryAxis = {
                            categories: ["A"]
                        },
                        valueAxis = { };

                    createPlotArea(categoryAxis, valueAxis, {
                        border: {
                            color: "red",
                            width: 2,
                            dashType: "dot"
                        }
                    });

                    var plotAreaRect = view.log.rect[2];
                    equal(plotAreaRect.style.dashType, "dot");
                    equal(plotAreaRect.style.stroke, "red");
                    equal(plotAreaRect.style.strokeWidth, 2);
                });

            })();

            (function() {
                var plotArea,
                    categoryAxis,
                    namedXAxes,
                    namedYAxes,
                    primaryXAxis,
                    secondaryXAxis,
                    primaryYAxis,
                    secondaryYAxis,
                    scatterSeriesData = [{
                        name: "Value A",
                        type: "scatter",
                        data: [[100, 100], [200, 200], [300, 300]]
                    }, {
                        name: "Value B",
                        type: "scatter",
                        data: [[10, 10], [20, 20], [30, 30]]
                    }];

                function createPlotArea(series, options) {
                    plotArea = new dataviz.XYPlotArea(series, options);

                    namedXAxes = plotArea.namedXAxes;
                    namedYAxes = plotArea.namedYAxes;

                    primaryXAxis = namedXAxes.primary;
                    primaryYAxis = namedYAxes.primary;
                    secondaryXAxis = namedXAxes.secondary;
                    secondaryYAxis = namedYAxes.secondary;

                    chartSeries = plotArea.charts[0];
                }

                // ------------------------------------------------------------
                module("XY PlotArea / Axes", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData);
                    }
                });

                test("appends primary X axis to children collection", function() {
                    ok($.inArray(namedXAxes.primary, plotArea.children) >= 0);
                });

                test("appends primary Y axis to children collection", function() {
                    ok($.inArray(namedYAxes.primary, plotArea.children) >= 0);
                });

                test("aligns axes at default crossing values", function() {
                    var axisX = namedXAxes.primary,
                        axisY = namedYAxes.primary;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1]);
                });

                test("aligns axises at non-default crossing values", function() {
                    var axisX = namedXAxes.primary,
                        axisY = namedYAxes.primary;

                    axisY.options.axisCrossingValue = 10;
                    axisX.options.axisCrossingValue = 1;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1], TOLERANCE);
                });

                test("X axis limit is [0, 1] when no series are configured", 2, function() {
                    stubMethod(dataviz.XYPlotArea.fn, "createAxes",
                        function() {
                            equal(this.xAxisRangeTracker.query("primary").min, 0);
                            equal(this.xAxisRangeTracker.query("primary").max, 1);
                        },
                        function() {
                            plotArea = new dataviz.XYPlotArea([]);
                        }
                    );
                });

                test("Y axis limit is [0, 1] when no series are configured", 2, function() {
                    stubMethod(dataviz.XYPlotArea.fn, "createAxes",
                        function() {
                            equal(this.yAxisRangeTracker.query("primary").min, 0);
                            equal(this.yAxisRangeTracker.query("primary").max, 1);
                        },
                        function() {
                            plotArea = new dataviz.XYPlotArea([]);
                        }
                    );
                });

                test("creates Numeric axes by default", function() {
                    ok(plotArea.axisX instanceof dataviz.NumericAxis);
                    ok(plotArea.axisY instanceof dataviz.NumericAxis);
                });

                test("creates Date value axes", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: {
                            type: "Date"
                        },
                        yAxis: {
                            type: "Date"
                        }
                    });

                    ok(plotArea.axisX instanceof dataviz.DateValueAxis);
                    ok(plotArea.axisY instanceof dataviz.DateValueAxis);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            xAxis: [{}, {
                                name: "secondary"
                            }],
                            yAxis: [{}, {
                                name: "secondary"
                            }]
                        });
                    }
                });

                test("assigns axisX alias to first named X axis", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: [{ name: "a" }, { name: "b" }]
                    });

                    equals(plotArea.axisX.options.name, "a");
                });

                test("assigns axisY alias to first named Y axis", function() {
                    createPlotArea(scatterSeriesData, {
                        yAxis: [{ name: "a" }, { name: "b" }]
                    });

                    equals(plotArea.axisY.options.name, "a");
                });

                test("secondary X axis added to children collection", function() {
                    ok($.inArray(secondaryXAxis, plotArea.children) >= 0);
                });

                test("secondary Y axis added to children collection", function() {
                    ok($.inArray(secondaryYAxis, plotArea.children) >= 0);
                });

                test("aligns primary axes at default crossing values", function() {
                    var axisX = primaryXAxis,
                        axisY = primaryYAxis;

                    plotArea.reflow(chartBox);

                    var crossingSlotY = axisY.getSlot(axisY.options.axisCrossingValue),
                        crossingSlotX = axisX.getSlot(axisX.options.axisCrossingValue);
                    same([crossingSlotY.x1, crossingSlotY.y1], [crossingSlotX.x1, crossingSlotX.y1]);
                });

                test("secondary X axis on the right is contained in plot area", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: [{ min: -350 }, { name: "secondary" }],
                        yAxis: { axisCrossingValue: [0, 100], min: -350 }
                    });

                    plotArea.reflow(chartBox);

                    equals(secondaryXAxis.lineBox().x2, primaryXAxis.lineBox().x2);
                });

                test("secondary X axis on the left is contained in plot area", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: [{ min: -350 }, { name: "secondary", min: -1, max: 0 }],
                        yAxis: { axisCrossingValue: [0, 100], min: -350 }
                    });

                    plotArea.reflow(chartBox);

                    equals(secondaryXAxis.lineBox().x1, primaryXAxis.lineBox().x1);
                });

                test("secondary Y axis on top is contained in plot area", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: { axisCrossingValue: [0, 100], min: -350 },
                        yAxis: [{ min: -350 }, { name: "secondary" }]
                    });

                    plotArea.reflow(chartBox);

                    equals(secondaryYAxis.lineBox().y1, primaryYAxis.lineBox().y1, TOLERANCE);
                });

                test("secondary Y axis on bottom is contained in plot area", function() {
                    createPlotArea(scatterSeriesData, {
                        xAxis: { axisCrossingValue: [0, 100], min: -350 },
                        yAxis: [{ min: -350 }, { name: "secondary", min: -1, max: 0 }]
                    });

                    plotArea.reflow(chartBox);

                    equals(secondaryYAxis.lineBox().y2, primaryYAxis.lineBox().y2);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes / Stacked Top", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            xAxis: [{}, { name: "secondary" }],
                            yAxis: { axisCrossingValue: 10000 }
                        });
                    }
                });

                test("overlapping X axes are shifted to the top", function() {
                    var margin = secondaryXAxis.options.margin;

                    plotArea.reflow(chartBox);

                    equals(secondaryXAxis.box.y2, primaryXAxis.box.y1 - margin);
                });

                test("stacked X axes on top are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryXAxis.lineBox().x1, secondaryXAxis.lineBox().x2],
                         [primaryXAxis.lineBox().x1, primaryXAxis.lineBox().x2]
                    );
                });

                test("stacked X axes on the top are mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(primaryXAxis.options.labels.mirror);
                    ok(secondaryXAxis.options.labels.mirror);
                });

                test("mirroring inverts the mirror option", function() {
                    primaryXAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(!primaryXAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes / Stacked Right", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            xAxis: { axisCrossingValue: 10000 },
                            yAxis: [{}, { name: "secondary" }]
                        });
                    }
                });

                test("overlapping Y axes are shifted to the right", function() {
                    var margin = secondaryYAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same([secondaryYAxis.box.x1, secondaryYAxis.box.y1],
                         [primaryYAxis.box.x2 + margin, primaryYAxis.box.y1]
                    );
                });

                test("stacked Y axes on right are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryYAxis.lineBox().y1, secondaryYAxis.lineBox().y2],
                         [primaryYAxis.lineBox().y1, primaryYAxis.lineBox().y2]
                    );
                });

                test("stacked Y axes on the right are mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(primaryYAxis.options.labels.mirror);
                    ok(secondaryYAxis.options.labels.mirror);
                });

                test("mirroring inverts the mirror option", function() {
                    primaryYAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(!primaryYAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes / Stacked Bottom", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            xAxis: [{}, { name: "secondary" }]
                        });
                    }
                });

                test("overlapping X axes are shifted to the bottom", function() {
                    var margin = secondaryXAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same(secondaryXAxis.box.y1, primaryXAxis.box.y2 + margin);
                });

                test("stacked X axes on bottom are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryXAxis.lineBox().x1, secondaryXAxis.lineBox().x2],
                         [primaryXAxis.lineBox().x1, primaryXAxis.lineBox().x2]
                    );
                });

                test("stacked X axes on the bottom are not mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(!primaryXAxis.options.labels.mirror);
                    ok(!secondaryXAxis.options.labels.mirror);
                });

                test("user set mirror option is not changed", function() {
                    primaryXAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(primaryXAxis.options.labels.mirror);
                });

                // ------------------------------------------------------------
                module("XY PlotArea / Multiple Axes / Stacked Left", {
                    setup: function() {
                        moduleSetup();

                        createPlotArea(scatterSeriesData, {
                            yAxis: [{}, { name: "secondary" }]
                        });
                    }
                });

                test("overlapping Y axes are stacked to the left", function() {
                    var margin = secondaryYAxis.options.margin;

                    plotArea.reflow(chartBox);

                    same([secondaryYAxis.box.x2, secondaryYAxis.box.y1],
                         [primaryYAxis.box.x1 - margin, primaryYAxis.box.y1]
                    );
                });

                test("stacked Y axes on left are aligned", function() {
                    plotArea.reflow(chartBox);

                    same([secondaryYAxis.lineBox().y1, secondaryYAxis.lineBox().y2],
                         [primaryYAxis.lineBox().y1, primaryYAxis.lineBox().y2]
                    );
                });

                test("stacked Y axes on the left are not mirrored", function() {
                    plotArea.reflow(chartBox);

                    ok(!primaryYAxis.options.labels.mirror);
                    ok(!secondaryYAxis.options.labels.mirror);
                });

                test("user set mirror option is not changed", function() {
                    primaryYAxis.options.labels.mirror = true;

                    plotArea.reflow(chartBox);

                    ok(primaryYAxis.options.labels.mirror);
                });

            })();
        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
