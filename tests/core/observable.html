<!DOCTYPE html>
<html>
    <head>
        <title>kendo.core.Observable Tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <link rel="stylesheet" href="../qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">kendo.core.Observable Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <script src="../../src/kendo.core.js"></script>
        <script>
            var Observable = kendo.Observable;

            test("bind returns this", function() {
                var observable = new Observable();

                ok(observable.bind("foo") === observable)
            });

            test("bind stores the handler to the events list", function() {
                var observable = new Observable(),
                    handler = $.nop;

                observable.bind("foo", handler);

                equal(observable._events["foo"][0], handler);
            });

            test("bind stores multiple events", function() {
                var observable = new Observable(),
                    handler = $.nop;

                observable.bind("foo", handler);
                observable.bind("foo", handler);

                equal(observable._events["foo"][0], handler);
                equal(observable._events["foo"][1], handler);
            });

            test("trigger calls the handler", function() {
                var observable = new Observable(),
                    handlerWasCalled = false;

                observable.bind("foo", function() {
                    handlerWasCalled = true;
                });
                observable.trigger("foo");
                ok(handlerWasCalled);
            });

            test("trigger returns this", function() {
                var observable = new Observable();

                ok(observable.trigger() === observable);
            });

            test("this in trigger is the observable", function() {
                var observable = new Observable(), that;

                observable.bind("foo", function() {
                    that = this;
                });

                observable.trigger("foo");

                ok(that === observable);
            });

            test("trigger calls all bound events", function() {
                var observable = new Observable(), calls = 0;

                observable.bind("foo", function() {
                    calls++;
                });

                observable.bind("foo", function() {
                    calls++;
                });

                observable.trigger("foo");
                equal(calls, 2);
            });

            test("trigger passes the arguments to the handler", function() {
                var observable = new Observable(), argument;

                observable.bind("foo", function(bar) {
                    argument = bar;
                });

                observable.trigger("foo", "bar");

                equal(argument, "bar");

            });

            test("unbind without handler removes all events", function() {
                var observable = new Observable();

                observable.bind("foo", $.nop);

                observable.unbind("foo");

                equal(observable._events.foo.length, 0);
            });

            test("unbind returns this", function() {
                var observable = new Observable();

                ok(observable.unbind() === observable);
            });

            test("unbind removes the specified handler", function() {
                var observable = new Observable(),
                    first = function() {},
                    second = function() {};

                observable.bind("foo", first).bind("foo", second);

                observable.unbind("foo", first);

                equal(observable._events.foo.length, 1);
                equal(observable._events.foo[0], second);
            });
        </script>
    </body>
</html>
