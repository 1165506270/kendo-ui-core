<!DOCTYPE html>
<html>
    <script src="../../src/jquery.js"></script>
    <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
    <script type="text/javascript" src="../qunit-runner.js"></script>
    <script type="text/javascript" src="../jquery.mockjax.js"></script>
    <script src="../../src/kendo.core.js"></script>
    <script src="../../src/kendo.data.js"></script>
    <script src="../../src/aspnetmvc/kendo.data.aspnetmvc.js"></script>

    <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />

    <body>
        <h1 id="qunit-header">QUnit example</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var Transport = kendo.data.transports["aspnetmvc-ajax"];

            QUnit.config.testTimeout = 100;

            module("AspNetMvc transport", {
                setup: function() {
                    $.mockjaxSettings.contentType = "text/json";
                    $.mockjaxSettings.responseTime = 0;
                },
                teardown: function() {
                    $.mockjaxClear();
                }
            });

            test("read url is requested if no data is set", 1, function() {
                var transport = new Transport({
                        read: {
                            url: "foo"
                        }
                    });

                $.mockjax({
                    url: "foo",
                    response: function() {
                       start();
                       ok(true);
                    }
                });
                stop();
                transport.read({});
            });

            test("data is loaded from the options if both data and url are set", 1, function() {
                var data = [{foo: "bar" }],
                    transport = new Transport({
                        data: {
                            Data: data,
                            Total: 10
                        },
                        read: {
                            url: "foo"
                        }
                    });

                $.mockjax({
                    url: "foo",
                    response: function() {
                        ok(false);
                    }
                });
                stop();
                transport.read({
                    success: function(e) {
                       start();
                       same(e.Data, data);
                    }
                });
            });

            test("data is loaded from the options if set", 1, function() {
                var data = [{foo: "bar" }],
                    transport = new Transport({
                        data: {
                            Data: data,
                            Total: 10
                        }
                    });

                transport.read({
                    success: function(e) {
                       same(e.Data, data);
                    }
                });
            });
            test("data is loaded from the url if both data and url are set on the second request", 2, function() {
                var data = [{foo: "bar" }],
                    transport = new Transport({
                        data: {
                            Data: data,
                            Total: 10
                        },
                        read: {
                            url: "foo"
                        }
                    });

                $.mockjax({
                    url: "foo",
                    response: function() {
                        start();
                        ok(true);
                    }
                });
                transport.read({
                    success: function(e) {
                       start();
                       same(e.Data, data);
                    }
                });
                stop();
                transport.read({
                    success: function(e) {
                    }
                });
            });
        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>


