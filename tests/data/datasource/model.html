<!DOCTYPE html>
<html>
    <head>
        <title>DataSource model handling</title>
        <script src="../../../src/jquery.js"></script>
        <script type="text/javascript" src="../../qunit/qunit/qunit.js"></script>
        <script type="text/javascript" src="../../qunit-runner.js"></script>
        <script src="../../../src/kendo.core.js"></script>
        <script src="../../../src/kendo.data.js"></script>
        <script src="../../../src/kendo.model.js"></script>
        <link rel="stylesheet" href="../../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">DataSource model handling</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>

            var dataSource;

            function setup(source) {
                data = source || [{ id:1, bar: "foo" },{ id: 2, bar: "foo" }];

                dataSource = new kendo.data.DataSource( {
                    data: data,
                    schema: {
                        model: {
                            id: "id"
                        }
                    }
                });

                dataSource.read();
            }


            module("DataSource", {
                setup: setup
            });

            test("get returns undefined if no model exist with the specified id", function() {
                equal(dataSource.get(3), undefined, "result is undefined");
            });

            test("get returns the model instance with the specified id", function() {
                var model = dataSource.get(1);
                ok(model);
                ok(model instanceof kendo.data.Model);
            });

            test("get returns the model instance with the specified id as string", function() {
                var model = dataSource.get(1);
                equal(model.id, 1);
            });

            test("add appends the specified values", function() {
                dataSource.add( { foo: "bar" } );

                equal(dataSource.data().length, 3);
                equal(dataSource.data()[2].foo, "bar");
            });

            test("add returns the new model istance", function() {
                var model = dataSource.add( { foo: "bar" } );

                ok(model instanceof kendo.data.Model);
                equal(model.foo, "bar");
            });

            test("add appends specified model instance", function() {
                var model = new kendo.data.Model({ foo: "bar" });

                equal(dataSource.add(model), model);
            });

            test("inserts specified values at specified position", function() {
                dataSource.insert(0, { foo: "bar" } );

                equal(dataSource.data().length, 3);
                equal(dataSource.data()[0].foo, "bar");
            });

            test("inserts the specified values at first position if index is not specified", function() {
                dataSource.insert({ foo: "bar" } );

                equal(dataSource.data()[0].foo, "bar");
            });

            test("insert returns the new model istance", function() {
                var model = dataSource.insert({ foo: "bar" });

                ok(model instanceof kendo.data.Model);
            });

            test("removes the specified model", function() {
                var model = dataSource.get(1);
                dataSource.remove(model);

                equal(dataSource.data().length, 1);
            });

            test("remove returns the removed model", function() {
                var model = dataSource.get(1);

                equal(dataSource.remove(model), model);
            });

        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
