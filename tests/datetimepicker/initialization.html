<!DOCTYPE html>
<html>
    <head>
        <title>DateTimePicker Initialization</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.calendar.js"></script>
        <script src="../../src/kendo.datepicker.js"></script>
        <script src="../../src/kendo.timepicker.js"></script>
        <script src="../../src/kendo.datetimepicker.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">DateTimePicker Initialization</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            kendo.ns = "kendo-";

            var DateTimePicker = kendo.ui.DateTimePicker,
                input;

            QUnit.config.testTimeout = 800;
            QUnit.config.reorder = false;

            module("kendo.ui.DateTimePicker initialization", {
                setup: function() {
                    input = $("<input />").appendTo(document.body);
                },
                teardown: function() {
                    input.parents(".k-widget").andSelf().remove();
                }
            });

            /*test("get value of the input if", function() {
                input.val("10/10/2000");

                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker");

                equal(+datetimepicker.value(), +new Date(2000, 9, 10));
            });*/

            test("_wrapper() wraps input element", function() {
                input.css("width", "200");

                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker");

                ok(input.parent().hasClass("k-picker-wrap k-state-default"));
                equal(datetimepicker.wrapper.attr("class"), "k-widget k-datetimepicker k-header");
            });

            test("DateTimePicker adds k-input class to the element", function() {
                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker");

                ok(datetimepicker.element.hasClass("k-input"));
            });

            test("_icons method creates calendar and clock button", function() {
                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker"),
                    icons = datetimepicker.wrapper.find(".k-select");

                ok(icons.is("span"));
                ok(icons.hasClass("k-select"));

                ok(icons.children(":first").hasClass("k-icon k-i-calendar"));
                ok(icons.children(":last").hasClass("k-icon k-i-clock"));
            });

            test("DateTimePicker creates DateView", function() {
                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker");

                ok(datetimepicker.dateView);
            });

            test("DateTimePicker sets correct options to DateView", function() {
                var datetimepicker = input.kendoDateTimePicker({open: function() {}, close: $.noop}).data("kendoDateTimePicker"),
                    dateView = datetimepicker.dateView,
                    options = dateView.options,
                    dpOptions = datetimepicker.options;

                ok(dateView.options);
                equal(options.anchor, datetimepicker.wrapper);
                equal(options.value, dpOptions.value);
                equal(+options.min, +dpOptions.min);
                equal(+options.max, +dpOptions.max);
            });

            test("DateTimePicker creates TimeView", function() {
                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker");

                ok(datetimepicker.timeView);
            });

            test("DateTimePicker sets correct options to TimeView", function() {
                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker"),
                    timeView = datetimepicker.timeView;

                equal(timeView.options.anchor, datetimepicker.wrapper);
                equal(timeView.options.format, datetimepicker.options.timeFormat);
                equal(timeView.options.interval, datetimepicker.options.interval);
            });

            test("datetimepicker wire date icon click", function() {
                var datetimepicker = new DateTimePicker(input);

                datetimepicker.close();
                datetimepicker._dateIcon.click();
                ok(datetimepicker.dateView.popup.visible());
            });

            test("datetimepicker wire clock icon click", function() {
                var datetimepicker = new DateTimePicker(input);

                datetimepicker.close("time");
                datetimepicker._timeIcon.click();
                ok(datetimepicker.timeView.popup.visible());
            });

            test("datetimepicker disables widget if input has disabled attribute", function() {
                var datetimepicker = new DateTimePicker(input.attr("disabled", "disabled"));

                ok(datetimepicker.wrapper.children(":first").hasClass("k-state-disabled"));
            });

            asyncTest("form reset support", 2, function() {
                input.attr("value", "12/12/2000 12:00 AM");

                var form = $("<form/>").appendTo(document).append(input),
                    datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker");

                datetimepicker.open();
                datetimepicker.value("12/12/2010 12:00 AM");

                form[0].reset();

                setTimeout(function() {
                    equal(datetimepicker.element.val(), "12/12/2000 12:00 AM");
                    equal(datetimepicker.dateView.calendar.value().getFullYear(), "2000");
                    start();
                }, 100);
            });

            test("extend popup options if datetimepicker.options.popup", function() {
                var appendTo = "body",
                    datetimepicker = new kendo.ui.DateTimePicker(input, {
                        popup: {
                            appendTo: appendTo
                        }
                    });

                equal(datetimepicker.dateView.popup.options.appendTo[0], $(appendTo)[0]);
            });

            test("DateTimePicker strips the format from {0:format}", function() {
                var datetimepicker = new kendo.ui.DateTimePicker(input, {
                    format: "{0:MM/dd/yyyy hh:mm}",
                    timeFormat: "{0:hh:mm}"
                });

                equal(datetimepicker.options.format, "MM/dd/yyyy hh:mm");
                equal(datetimepicker.options.timeFormat, "hh:mm");
            });

            test("DateTimePicker adds format to the parseFormats array", function() {
                var datetimepicker = input.kendoDateTimePicker({
                    parseFormats: ["MM/dd/yy"]
                }).data("kendoDateTimePicker");

                equal(datetimepicker.options.parseFormats[0], datetimepicker.options.format);
                equal(datetimepicker.options.parseFormats[1], datetimepicker.options.timeFormat);
                equal(datetimepicker.options.parseFormats[2], "MM/dd/yy");
            });

            test("DateTimePicker uses options.dates instead of auto-generated hours", function() {
                var datetimepicker = input.kendoDateTimePicker({
                    dates: [new Date(2000, 10, 10, 18, 0, 0)]
                }).data("kendoDateTimePicker");

                datetimepicker.open("time");

                equal(datetimepicker.timeView.ul.children().length, 1);
                equal(datetimepicker.timeView.ul.children(":first").text(), "6:00 PM");
            });

            test("DateTimePicker copies input's className to the wrapper", function() {
                var datetimepicker = input.addClass("test").kendoDateTimePicker().data("kendoDateTimePicker");

                ok(datetimepicker.wrapper.hasClass("test"));
            });

            test("DateTimePicker updates calendar if empty input element on open", function() {
                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker");

                datetimepicker.value(new Date());

                input.focus().val("");
                datetimepicker.open();

                equal(datetimepicker.dateView.calendar.value(), null);
            });

            test("DateTimePicker updates calendar's focused date", function() {
                var datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker"),
                    date = new Date(2000, 10, 10);

                datetimepicker.value(new Date(2000, 9, 1));

                input.focus().val(kendo.toString(date, "MM/dd/yyyy hh:mm tt"));
                datetimepicker.open();

                var link = datetimepicker.dateView.calendar.element.find(".k-state-focused > .k-link");

                equal(+datetimepicker.dateView.calendar.value(), +datetimepicker.value());
                equal(link.html(), date.getDate());
            });

            if (!kendo.support.touch) {
                test("DateTimePicker changes the type of the input", function() {
                    var input = $("<input type='date'/>"),
                        datetimepicker = input.kendoDateTimePicker().data("kendoDateTimePicker");

                    equal(datetimepicker.element[0].type, "text");
                });
            }
        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
