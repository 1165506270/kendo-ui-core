<!DOCTYPE html>
<html>
    <head>
        <title>DropDownList Searching</title>
        <script src="../../src/jquery.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.list.js"></script>
        <script src="../../src/kendo.dropdownlist.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">DropDownList Searching</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var DropDownList = kendo.ui.DropDownList,
                data = [{text: "Foo", value: 1}, {text:"Bar", value:2}, {text:"Baz", value:3}],
                input;

            $.fn.press = function(key) {
                return this.trigger({ type: "keypress", keyCode: key } );
            }

            module("kendo.ui.DropDownList searching", {
                setup: function() {
                    input = $("<input />").appendTo(document.body);
                },
                teardown: function() {
                    input.add($("ul")).parent(".k-widget").remove();
                }
            });

            test("search select first match", function() {
                var dropdownlist = new DropDownList(input, {
                    dataTextField: "text",
                    dataValueField: "value",
                    dataSource: data
                });

                dropdownlist.search("b");

                ok(dropdownlist.ul.children().eq(1).hasClass("k-state-selected"));
            });

            test("search select item if text number", function() {
                var dropdownlist = new DropDownList(input, {
                    dataTextField: "text",
                    dataValueField: "value",
                    dataSource: [{text: "Foo", value: 1}, {text:10, value:2}]
                });

                dropdownlist.search("1");

                ok(dropdownlist.ul.children().eq(1).hasClass("k-state-selected"));
            });

            test("search select item if text is 0", function() {
                var dropdownlist = new DropDownList(input, {
                    dataTextField: "text",
                    dataValueField: "value",
                    dataSource: [{text: "Foo", value: 1}, {text:0, value:2}]
                });

                dropdownlist.search("0");

                ok(dropdownlist.ul.children().eq(1).hasClass("k-state-selected"));
            });

            test("search should raise error if word is null", function() {
                var dropdownlist = new DropDownList(input, {
                    dataTextField: "text",
                    dataValueField: "value",
                    dataSource: data
                });

                dropdownlist.search();

                ok(true);
            });

            test("typing should trigger search", function() {
                var dropdownlist = new DropDownList(input, {
                    dataSource: data
                });

                dropdownlist._search = function() {
                    ok(true);
                    start();
                }
                input.val("f").press("f".charCodeAt(0));
                stop(1);
            });

            test("search method supports a case sensitive search", function() {
                var dropdownlist = new DropDownList(input, {
                    dataSource: ["TEXT", "text", "3text"],
                    ignoreCase: false
                });

                dropdownlist.search("t");

                equal(dropdownlist.selectedIndex, 1);
            });

            asyncTest("_search method select next item if starts with same character", 1, function() {
                var dropdownlist = new DropDownList(input, {
                    dataSource: ["text1", "text2", "text3"]
                });

                dropdownlist._keypress({
                    keyCode: 116 //"t"
                });

                dropdownlist._keypress({
                    keyCode: 116 //"t"
                });

                setTimeout(function() {
                    equal(dropdownlist.selectedIndex, 1);
                    start();
                });
            });

            asyncTest("_search method loops matched items", 1, function() {
                var dropdownlist = new DropDownList(input, {
                    dataSource: ["text1", "text2"]
                });

                dropdownlist._last = "t";
                dropdownlist._keypress({
                    keyCode: 116 //"t"
                });

                dropdownlist._keypress({
                    keyCode: 116 //"t"
                });

                setTimeout(function() {
                    equal(dropdownlist.selectedIndex, 0);
                    start();
                });
            });

            asyncTest("_search method trigger change", 1, function() {
                var dropdownlist = new DropDownList(input, {
                    dataSource: ["text1", "text2", "text3"],
                    change: function() {
                        ok(true);
                        start();
                    }
                });

                dropdownlist._last = "t";
                dropdownlist._keypress({
                    keyCode: 116 //"t"
                });
            });

            asyncTest("_search method honor ignoreCase option", 1, function() {
                var dropdownlist = new DropDownList(input, {
                    dataSource: ["text1", "Text2", "Text3"],
                    ignoreCase: true
                });

                dropdownlist.select(1);
                dropdownlist._last = "t";
                dropdownlist._keypress({
                    keyCode: 116 //"t"
                });

                setTimeout(function() {
                    equal(dropdownlist.selectedIndex, 2);
                    start();
                });
            });

        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
