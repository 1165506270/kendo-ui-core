<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>kendo.ui.Editor Tests</title>

        <script src="../jquery-loader.js"></script>
        <script src="test-scripts.js"></script>

        <style> html { font-size: 12px; } </style>
    </head>
    <body>

        <div><textarea cols="20" rows="4" id="Editor1" name="Editor1"></textarea></div>

        <script>

            editor = $("#Editor1").kendoEditor().data("kendoEditor");

            var DeleteRowCommand = kendo.ui.editor.DeleteRowCommand;

            function execDeleteRowCommand(options) {
                var command = new DeleteRowCommand(options);
                command.editor = editor;
                command.exec();

                return command;
            }

            module("Editor / DeleteRowCommand");

            var range;

            test("exec creates row below cursor", function() {
                range = createRangeFromText(editor, "<table><tr><td>f||oo</td></tr><tr><td>bar</td></tr></table>");

                execDeleteRowCommand({ range:range });

                var dom = $(editor.value());

                equal(dom.find("tr").length, 1);
                equal(dom.find("td").length, 1);
                equal(dom.find("td").text(), "bar");
            });

            test("deleting last row removes table", function() {
                range = createRangeFromText(editor, "<table><tr><td>f||oo</td></tr></table>");

                execDeleteRowCommand({ range:range });

                equal(editor.value(), "");
            });

            test("deleting last row focuses next paragraph", function() {
                range = createRangeFromText(editor, "<table><tr><td>f||oo</td></tr></table><p>bar</p>");

                execDeleteRowCommand({ range:range });

                editor.getRange().insertNode(editor.document.createElement("a"));

                equal(editor.value(), "<p><a></a>bar</p>");
            });

            test("deleting last row focuses previous paragraph, if table was at end of document", function() {
                range = createRangeFromText(editor, "<p>bar</p><table><tr><td>f||oo</td></tr></table>");

                execDeleteRowCommand({ range:range });

                editor.getRange().insertNode(editor.document.createElement("a"));

                equal(editor.value(), "<p><a></a>bar</p>");
            });

            test("selection is moved to bottom row after deleting a row", function() {
                range = createRangeFromText(editor, "<table><tr><td>|foo|</td></tr><tr><td>bar</td></tr></table>");

                execDeleteRowCommand({ range:range });

                range = editor.getRange();

                range.insertNode(editor.document.createElement("a"));

                equal(editor.value(), "<table><tbody><tr><td><a></a>bar</td></tr></tbody></table>");
            });

            test("selection is moved to top row after deleting last row", function() {
                range = createRangeFromText(editor, "<table><tr><td>foo</td></tr><tr><td>b||ar</td></tr></table>");

                execDeleteRowCommand({ range:range });

                range = editor.getRange();

                range.insertNode(editor.document.createElement("a"));

                equal(editor.value(), "<table><tbody><tr><td><a></a>foo</td></tr></tbody></table>");
            });

            test("selection algorithm skips whitespace nodes", function() {
                range = createRangeFromText(editor, "<table><tr><td>foo</td></tr>  <tr><td>b||ar</td></tr></table>");

                execDeleteRowCommand({ range:range });

                range = editor.getRange();

                range.insertNode(editor.document.createElement("a"));

                equal(editor.value(), "<table><tbody><tr><td><a></a>foo</td></tr></tbody></table>");
            });

        </script>

        <h1 id="qunit-header">kendo.ui.Editor Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
