<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>kendo.ui.Editor Tests</title>

    <script src="../jquery-loader.js"></script>
    <script src="test-scripts.js"></script>

    <style>
        html { font-size: 12px; }

        .foo {
            color: red;
        }
    </style>
</head>
<body>

    <div><textarea cols="20" rows="4" id="Editor1" name="Editor1"></textarea></div>

    <div contentEditable id="inline"></div>

    <script>

        var StyleCommand = kendo.ui.editor.StyleCommand,
            Dom = kendo.ui.editor.Dom;

        var editor = $("#Editor1").kendoEditor({
                tools: [
                    { name: "style", items: [
                        { text: "foo", value: "bar" }
                    ] }
                ],
                stylesheets: [
                    "editorStyles.css"
                ]
            }).data("kendoEditor");

        var inline = $('#inline').appendTo("body")
            .kendoEditor({
                tools: [
                    { name: "style", items: [
                        { text: "foo", value: "foo" }
                    ] }
                ]
            })
            .data("kendoEditor");


        module("Style");

        test("exec applies css class to inline element", function() {
            var range = createRangeFromText(editor, '<span>|foo|</span>');
            editor.selectRange(range);
            editor.exec("style", {value:"bar"});
            equal(editor.value(), '<span class="bar">foo</span>');
        });

        function styleTool(editor) {
            return editor.toolbar.items().filter(".k-style").data("kendoSelectBox");
        }

        function styleInput(editor) {
            return styleTool(editor).wrapper.find(".k-input");
        }

        test("tool displays styles initially", function() {
            editor.focus();
            editor.value("");
            editor.trigger("select");
            equal(styleInput(editor).text(), "Styles");
        });

        test("tool displays known values", function() {
            styleInput(editor).click();
            editor.focus();
            var range = createRangeFromText(editor, '<span class="bar">|foo|</span>');
            editor.selectRange(range);
            editor.trigger("select");
            equal(styleInput(editor).text(), "foo");
        });

        test("tool selects know values for inline editor", function() {
            var range = createRangeFromText(inline, '<p class="foo">f||oo</p>');
            inline.selectRange(range);
            inline.trigger("select");

            equal(inline.toolbar.items().filter(".k-style").val(), "foo");
        });

        function propertyFrom(className, property) {
            var element = $("<b class='foo' />").appendTo("body");
            var result = element.css("color");

            element.remove();

            return result;
        }

        test("tool items are styled for inline editor", function() {
            var range = createRangeFromText(inline, '<p class="foo">f||oo</p>');
            inline.selectRange(range);
            inline.trigger("select");

            var popup = styleTool(inline).popup.element;

            equal(popup.find(".k-item span").length, 1);
            equal(popup.find(".k-item span").css("color"), propertyFrom("foo", "color"));
        });

    </script>

    <h1 id="qunit-header">kendo.ui.Editor Tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
    <ul id="log"></ul>

</body>
</html>
