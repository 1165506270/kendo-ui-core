<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>kendo.ui.Editor Tests</title>

        <script src="../jquery-loader.js"></script>
        <script src="test-scripts.js"></script>

        <style> html { font-size: 12px; } </style>
    </head>
    <body>

        <div><textarea cols="20" rows="4" id="Editor1" name="Editor1"></textarea></div>

        <script>

            $("#Editor1").kendoEditor();

            var TableCommand = kendo.ui.editor.TableCommand;

            function execTableCommand(options) {
                var command = new TableCommand(options);
                command.editor = editor;
                command.exec();

                return command;
            }

            module("Editor / TableCommand", {
                setup: function() {
                    editor = getEditor();
                },
                teardown: function() {
                    $(".k-window,.k-overlay").remove();
                }
            });

            var range, command;

            test("exec createTable creates table at cursor", function() {
                range = createRangeFromText(editor, 'foo||');

                execTableCommand({ range:range });

                equal(editor.value(), "foo<table><tbody><tr><td></td></tr></tbody></table>");
            });

            test("exec createTable creates table with given row/columns", function() {
                editor.value("foo");

                range = editor.createRange();
                range.setStart(editor.body.firstChild, 0);
                range.collapse(true);

                execTableCommand({ range:range, rows: 1, columns: 2 });

                equal(editor.value(), "<table><tbody><tr><td></td><td></td></tr></tbody></table>foo");
            });

            function stripAttr(html) {
                return html.replace(/<(\w+)[^>]*>/i, "<$1>");
            }

            test("empty table cells have the empty element content", function() {
                range = createRangeFromText(editor, '||');

                execTableCommand({ range:range });

                equal(stripAttr(editor.document.getElementsByTagName("td")[0].innerHTML), stripAttr(kendo.ui.editor.emptyElementContent));
            });

            test("table has k-table class", function() {
                range = createRangeFromText(editor, '||');

                execTableCommand({ range:range });

                equal(editor.document.getElementsByTagName("table")[0].className, "k-table");
            });

            test("exec splits paragraph", function() {
                range = createRangeFromText(editor, '<p>foo||bar</p>');

                execTableCommand({ range:range });

                equal(editor.value(), "<p>foo</p><table><tbody><tr><td></td></tr></tbody></table><p>bar</p>");
            });

            test("first cell is focused after insertion", function() {
                range = createRangeFromText(editor, 'foo||');

                execTableCommand({ range:range });

                range = editor.getRange();
                range.insertNode(editor.document.createElement("a"));

                equal(editor.value(), "foo<table><tbody><tr><td><a></a></td></tr></tbody></table>");
            });

        </script>

        <h1 id="qunit-header">kendo.ui.Editor Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
