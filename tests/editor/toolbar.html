<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>kendo.ui.Editor Tests</title>

    <script src="../jquery-loader.js"></script>
        <script src="test-scripts.js"></script>

        <style> html { font-size: 12px; } </style>
    </head>
    <body>

        <div><textarea cols="20" rows="4" id="Editor1" name="Editor1"></textarea></div>

        <script>

            var editor = $("#Editor1").kendoEditor({
                tools: [
                    "bold",
                    "italic",
                    "underline",
                    "strikethrough",
                    "fontName",
                    "fontSize",
                    "foreColor",
                    "backColor",
                    "justifyLeft",
                    "justifyCenter",
                    "justifyRight",
                    "justifyFull",
                    "insertUnorderedList",
                    "insertOrderedList",
                    "indent",
                    "outdent",
                    "formatBlock",
                    "createLink",
                    "unlink",
                    "insertImage",
                    "createTable"
                ],
                messages: {
                    unlink: "unlink foo"
                }
            }).data("kendoEditor");

            var componentType = kendo.support.browser.msie || kendo.support.touch ? 'kendoDropDownList' : 'kendoComboBox';

            var Editor = kendo.ui.Editor;

            module("Toolbar", {
                teardown: function() {
                    editor.trigger("select");
                }
            });

            function value($ui) {
                if (kendo.support.browser.msie) {
                    return $.trim($ui.parent().find("span.k-input").text());
                } else {
                    return $ui.val();
                }
            }

            test('initially fontName should have "inherit" value', function () {
                editor.value("foo");

                var component = $('select.k-fontSize').data(componentType);

                equal(component.value(), 'inherit');
            });

            test('exec with node parameter calls exec', function() {
                var execArgs = [];

                withMock(editor, "exec", function() { execArgs = arguments; }, function() {
                    $('.k-bold', editor.wrapper).click();

                    equal(execArgs.length, 1);
                    equal(execArgs[0], 'bold');
                });
            });

            test('popup buttons do not call exec', function() {
                var called;

                withMock(editor, "exec", function() { called = true; }, function() {
                    $('[data-popup]', editor.wrapper).click();

                    ok(!called);
                });
            });

            test('handle carret selection', function() {
                editor.value('<strong>foo</strong>')
                var range = editor.createRange();
                range.setStart(editor.body.firstChild.firstChild, 1);
                range.setEnd(editor.body.firstChild.firstChild, 1);

                editor.getSelection().removeAllRanges();
                editor.getSelection().addRange(range);

                editor.trigger('select');

                ok($('.k-bold', editor.wrapper).hasClass('k-state-active'));
            });

            test('handle word selection', function() {
                editor.value('<strong>foo</strong>')
                var range = editor.createRange();
                range.selectNodeContents(editor.body.firstChild);

                editor.getSelection().removeAllRanges();
                editor.getSelection().addRange(range);

                editor.trigger('select');

                ok($('.k-bold', editor.wrapper).hasClass('k-state-active'));
            });

            test('handle mixed selection', function() {
                editor.value('<ul><li>foo</li></ul><ul><li>bar</li></ul>')
                var range = editor.createRange();
                range.setStart(editor.body.firstChild.firstChild.firstChild, 1);
                range.setEnd(editor.body.firstChild.firstChild.firstChild, 1);

                editor.getSelection().removeAllRanges();
                editor.getSelection().addRange(range);

                editor.trigger('select');

                ok(!$('k-insertUnorderedList', editor.wrapper).hasClass('k-state-active'));
            });

            test('handle image selection', function() {
                editor.value('<img style="float:right" src="foo" />');
                var range = editor.createRange();
                range.selectNode(editor.body.firstChild);

                editor.getSelection().removeAllRanges();
                editor.getSelection().addRange(range);

                editor.trigger('select');

                ok($('.k-justifyRight', editor.wrapper).hasClass('k-state-active'));
            });

            if (!kendo.support.browser.msie) {
                // select box does not show custom values

                test('font size combobox on mixed content', function() {
                    editor.selectRange(createRangeFromText(editor, '|foo<span style="font-size:8px;">bar|</span>'));

                    editor.trigger('select');

                    equal(value($('.k-fontSize', editor.wrapper)), '');
                });

                test('font size combobox on custom font size', function() {
                    editor.selectRange(createRangeFromText(editor, '<span style="font-size:8px;">f|o|o</span>'));

                    editor.trigger('select');

                    equal(value($('.k-fontSize', editor.wrapper)), '8px');
                });
            }

            test('inherited font size', function() {
                editor.selectRange(createRangeFromText(editor, '<span>f|o|o</span>'));

                editor.trigger('select');

                equal(value($('.k-fontSize', editor.wrapper)), editor.options.messages.fontSizeInherit);
            });

            test('font size combobox on relative font size', function() {
                editor.selectRange(createRangeFromText(editor, '<span style="font-size:x-small;">f|o|o</span>'));

                editor.trigger('select');

                equal(value($('.k-fontSize', editor.wrapper)), '2 (10pt)');
            });

            test('clicking disabled links should not navigate', function() {
                var isDefaultPrevented = false,
                navigationListener = function(e) {
                    isDefaultPrevented = e.isDefaultPrevented();
                };

                editor.wrapper.bind('click', navigationListener);

                $('.k-editor-button .k-tool-icon.k-state-disabled').trigger('click');

                editor.wrapper.unbind('click', navigationListener);

                ok(isDefaultPrevented);
            });

            test("unlink applies custom title", function() {
                equal(editor.wrapper.find(".k-unlink").attr("title"), "unlink foo");
            });

        </script>

        <h1 id="qunit-header">kendo.ui.Editor Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
