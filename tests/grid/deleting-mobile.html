<!DOCTYPE html>
<html>
    <head>
        <title>Grid Deleting Mobile</title>
        <script src="../../src/jquery.min.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.model.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.draganddrop.js"></script>
        <script src="../../src/kendo.groupable.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <script src="../../src/kendo.validator.js"></script>
        <script src="../../src/kendo.editable.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.fx.js"></script>
        <script src="../../src/kendo.mobile.scroller.js"></script>
        <script src="../../src/kendo.mobile.loader.js"></script>
        <script src="../../src/kendo.mobile.view.js"></script>
        <script src="../../src/kendo.mobile.shim.js"></script>
        <script src="../../src/kendo.mobile.popover.js"></script>
        <script src="../../src/kendo.mobile.actionsheet.js"></script>
        <script src="../../src/kendo.mobile.pane.js"></script>
        <script src="../../src/kendo.grid.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Grid Mobile Deleting</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <script>
            var Grid = kendo.ui.Grid,
                table,
                DataSource = kendo.data.DataSource,
                Model = kendo.data.Model,
                dataSource;

            function setup(options) {
                options = $.extend({}, {
                editable: true,
                dataSource: new DataSource({
                        schema: {
                            model: {
                                id: "foo",
                                fields: {
                                    name: "name",
                                    foo: "foo"
                                }
                            }
                        },
                        data: [{ foo: "bar", name: "tom" }, { foo: "baz", name: "jerry" }]
                    })
                }, options);
                dataSource = options.dataSource;

                return table.kendoGrid(options).data("kendoGrid");
            }

            QUnit.config.reorder = false;

            module("grid mobile deleting", {
                setup: function() {
                    table = document.createElement("table");
                    document.body.appendChild(table);

                    table = $(table);

                    kendo.support.mobileOS = { name: "ios" };
                },
                teardown: function() {
                    kendo.support.mobileOS = false;

                    table.closest(".k-grid").remove();
                    kendo.destroy(document.body);
                }
            });

            test("actionsheet is created for delete confirm dialog", function() {
                var grid = setup();

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));

                equal(actionsheet.length, 1);
                ok(actionsheet.data("kendoMobileActionSheet"));
            });

            test("actionsheet is destroyed on close", function() {
                var grid = setup();

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));
                actionsheet.find(".km-actionsheet-cancel>a").mouseup();

                equal($(kendo.roleSelector("actionsheet")).length, 0);
            });

            test("actionsheet is not created when editable is disabled", function() {
                var grid = setup({
                    editable: false
                });

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));

                equal(actionsheet.length, 0);
            });

            test("actionsheet is not created when editable confirmation is disabled", function() {
                var grid = setup({
                    editable: {
                        confirmation: false
                    }
                });

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));

                equal(actionsheet.length, 0);
                equal(grid.dataSource.view().length, 1);
            });

            test("click on cancel button doesn't remove the item", function() {
                var grid = setup();

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));
                actionsheet.find(".km-actionsheet-cancel>a").mouseup();

                equal(grid.dataSource.view().length, 2);
            });

            test("click on confirm button removes the item", function() {
                var grid = setup();

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));
                actionsheet.find("li>a:first").mouseup();

                equal(grid.dataSource.view().length, 1);
            });

            test("actionsheet title change", function() {
                var grid = setup({
                    editable: {
                        confirmation: "foo"
                    }
                });

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));

                equal(actionsheet.find(".km-actionsheet-title").text(), "foo");
            });

            test("actionsheet cancel button default text", function() {
                var grid = setup({
                    editable: true
                });

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));

                equal(actionsheet.find(".km-actionsheet-cancel").text(), "Cancel");
            });

            test("actionsheet delete button default text", function() {
                var grid = setup({
                    editable: true
                });

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));

                equal(actionsheet.find("li>a:first").text(), "Delete");
            });

            test("actionsheet cancel button text change", function() {
                var grid = setup({
                    editable: {
                        confirmation: true,
                        cancelDelete: "No"
                    }
                });

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));

                equal(actionsheet.find(".km-actionsheet-cancel").text(), "No");
            });

            test("actionsheet confirm button text change", function() {
                var grid = setup({
                    editable: {
                        confirmation: true,
                        confirmDelete: "Yes"
                    }
                });

                grid.removeRow(grid.items().eq(0));

                var actionsheet = $(kendo.roleSelector("actionsheet"));

                equal(actionsheet.find("li>a:first").text(), "Yes");
            });

        </script>
    </body>
</html>
