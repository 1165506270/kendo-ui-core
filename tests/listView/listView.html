<!DOCTYPE html>
<html>
    <head>
        <title>kendo.ui.ListView Tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.selectable.js"></script>
        <script src="../../src/kendo.listView.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">kendo.ui.ListView Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <script>
            var DataSource = kendo.data.DataSource,
                dataSource;

            $.fn.press = function(key, ctrl, shift) {
                return this.trigger( { type: "keydown", keyCode: key, ctrlKey: ctrl, shiftKey: shift } );
            }

            function setup(options) {
                options = $.extend({
                    template: "<li></li>",
                    dataSource: dataSource = new DataSource({ data: [1,2,3,4,5] })
                }, options);
                return $("<ul/>").kendoListView(options);
            }

            test("kendoListView attaches listView to element", function() {
                var ul = setup();

                ok(ul.data("kendoListView") instanceof kendo.ui.ListView);
            });

            test("renders item for dataSource items", function() {
                var ul = setup();
                equal(ul.find("li").length, 5);
            });

            test("dataBound event should be raised when bound", function() {
                var called = false,
                    ul = setup({
                        dataBound: function() {
                            called = true;
                        }
                    });
                ok(called);
            });

            test("focusing grid element focus first item ", function() {
                var listView = setup();
                listView.focus();
                ok(listView.find("li").first().is(".k-state-focused"));
            });

            test("down arrow moves focus on the next row same cell", function() {
                var listView = setup();
                listView.focus().press(kendo.keys.DOWN);
                ok(listView.find("li:eq(1)").hasClass("k-state-focused"));
            });

            test("right arrow moves focus on the next cell on the same row", function() {
                var listView = setup();
                listView.focus().press(kendo.keys.RIGHT);
                ok(listView.find("li:eq(0)").hasClass("k-state-focused"));
            });

            test("left arrow moves focus on the prev cell on the same row", function() {
                var listView = setup();
                listView.focus().press(kendo.keys.RIGHT).press(kendo.keys.LEFT);
                ok(listView.find("li:eq(0)").hasClass("k-state-focused"));
            });

            test("up arrow moves focus on the prev row same cell", function() {
                var listView = setup();
                listView.focus().press(kendo.keys.DOWN).press(kendo.keys.UP);
                ok(listView.find("li:eq(0)").hasClass("k-state-focused"));
            });

            test("space key select the focused item", function() {
                    var listView = setup();

                    listView.focus().press(kendo.keys.DOWN).press(kendo.keys.SPACEBAR);

                    ok(listView.find("li:eq(1)").hasClass("k-state-selected"));
            });
            test("autoBind false does not populate listView", function() {
                var ul = setup({autoBind: false});
                equal(ul.find("li").length, 0);
            });

        </script>
    </body>
</html>
