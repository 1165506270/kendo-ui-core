<!DOCTYPE html>
<html>
<head>
    <title>Spatial reference systems</title>
    <script src="../jquery-loader.js"></script>
    <script src="../qunit/qunit/qunit.js"></script>
    <script src="../qunit/addons/close-enough/qunit-close-enough.js"></script>
    <script src="../kendo-test-helpers.js"></script>
    <link href="../qunit/qunit/qunit.css" rel="stylesheet"/>
</head>
<body>
    <script src="../../src/kendo.core.js"></script>
    <script src="../../src/kendo.dataviz.core.js"></script>
    <script src="../../src/dataviz/util.js"></script>
    <script src="../../src/dataviz/geometry.js"></script>
    <script src="../../src/kendo.dataviz.map.js"></script>
    <script>
        var TOLERANCE = 1e-3;

        var dataviz = kendo.dataviz,
            Point = dataviz.Point2D,

            map = dataviz.map,
            Location = map.Location;

        function toPoint(crs, loc, point, scale) {
            var scale = scale || 1;
            var p = crs.toPoint(loc, scale);
            close(p.x, point.x * scale, TOLERANCE, "X");
            close(p.y, point.y * scale, TOLERANCE, "Y");
        }

        function toLocation(crs, point, scale) {
            var l = crs.toLocation(point, scale);
            var p = crs.toPoint(l, scale);
            scale = scale || 1;
            close(p.x, point.x, TOLERANCE, "X");
            close(p.y, point.y, TOLERANCE, "Y");
        }

        (function() {

            // [[LAT, LONG], [Screen X, Screen Y]]
            // Top left is [0, 0], bottom right is [1, 1]
            var identities = [
                    // Center
                    [[0, 0], [0.5, 0.5]],

                    // NE corner
                    [[90, 180],
                     [1, 0]],

                    // SW corner
                    [[-90, -180],
                     [0, 1]],

                    // Test points
                    [[42.7175, 24.916667],
                     [0.569213, 0.36852]],

                    [[51.9371170300465, 80.11230468750001],
                     [0.722534, 0.330599]],

                    [[52.4827802220782, -5.625],
                     [0.484375, 0.328125]]
                ];

            var crs;

            // ------------------------------------------------------------
            module("EPSG3857", {
                setup: function() {
                    crs = new map.crs.EPSG3857();
                }
            });

            test("projects location to screen coordinates", function() {
                $.each(identities, function() {
                    var point = this[1];

                    toPoint(crs,
                        Location.fromLatLng(this[0]),
                        new Point(point[0], point[1]));
                });
            });

            test("maps screen coordinates to location", function() {
                $.each(identities, function() {
                    var point = this[1];

                    toLocation(crs, new Point(point[0], point[1]));
                });
            });

            test("projects location to screen coordinates at scale", function() {
                $.each(identities, function() {
                    var point = this[1];

                    toPoint(crs,
                        Location.fromLatLng(this[0]),
                        new Point(point[0], point[1]),
                        1000);
                });
            });

            test("maps screen coordinates to location scale", function() {
                $.each(identities, function() {
                    var point = this[1];

                    toLocation(crs,
                        new Point(point[0], point[1]),
                        1000);
                });
            });

        })();

    </script>

    <h1 id="qunit-header">kendo.chart</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
    <ul id="log"></ul>

</body>
</html>
