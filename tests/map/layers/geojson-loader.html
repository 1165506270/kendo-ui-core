<!DOCTYPE html>
<html>
<head>
    <title>Shape layer</title>
    <script src="../../jquery-loader.js"></script>
    <script src="../../qunit/qunit/qunit.js"></script>
    <script src="../../qunit/addons/close-enough/qunit-close-enough.js"></script>
    <script src="../../kendo-test-helpers.js"></script>
    <link href="../../qunit/qunit/qunit.css" rel="stylesheet"/>
</head>
<body>
    <script src="../../../src/kendo.core.js"></script>
    <script src="../../../src/kendo.dataviz.core.js"></script>
    <script src="../../../src/kendo.dataviz.core.js"></script>
    <script src="../../../src/dataviz/util.js"></script>
    <script src="../../../src/dataviz/geometry.js"></script>
    <script src="../../../src/dataviz/drawing/core.js"></script>
    <script src="../../../src/dataviz/drawing/shapes.js"></script>
    <script src="../../../src/dataviz/drawing/svg.js"></script>
    <script src="../../../src/dataviz/drawing/canvas.js"></script>
    <script src="../../../src/map/location.js"></script>
    <script src="../../../src/map/crs.js"></script>
    <script src="../../../src/map/layers/shape.js"></script>
    <script>
        var dataviz = kendo.dataviz,
            g = dataviz.geometry,
            d = dataviz.drawing,

            map = dataviz.map,
            ShapeLayer = map.layers.ShapeLayer,
            Location = map.Location;

        var locator = {
            locationToView: function(loc) {
                return new g.Point(loc.lng, loc.lat);
            }
        };

        var style = {
            fill: {
                color: "red"
            },
            stroke: {
                color: "black"
            }
        };

        (function() {
            var loader;
            var item;
            var result;

            // ------------------------------------------------------------
            module("GeoJSON Loader / LineString", {
                setup: function() {
                    loader = new map.GeoJSONLoader(locator, style);
                    item = {
                        "type": "LineString",
                        "coordinates": [ [100.0, 0.0], [101.0, 1.0] ]
                    };
                    result = loader.parse(item);
                }
            });

            test("parsers to path", function() {
                ok(result instanceof d.Path);
            });

            test("does not set fill", function() {
                equal(result.options.fill, null);
            });
        })();

        (function() {
            var loader;
            var item;
            var result;

            // ------------------------------------------------------------
            module("GeoJSON Loader / MultiLineString", {
                setup: function() {
                    loader = new map.GeoJSONLoader(locator, style);
                    item = { "type": "MultiLineString",
                        "coordinates": [
                            [ [100.0, 0.0], [101.0, 1.0] ],
                            [ [102.0, 2.0], [103.0, 3.0] ]
                        ]
                    };
                    result = loader.parse(item);
                }
            });

            test("parses to a group", function() {
                ok(result instanceof d.Group);
            });

            test("parses paths to child paths", function() {
                ok(result.children[0] instanceof d.Path);
                ok(result.children[1] instanceof d.Path);
                equal(result.children.length, 2);
            });
        })();

        (function() {
            var loader;
            var item;
            var result;

            // ------------------------------------------------------------
            module("GeoJSON Loader / Polygon", {
                setup: function() {
                    loader = new map.GeoJSONLoader(locator, style);
                    item = {
                        "type": "Polygon",
                        "coordinates": [
                            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0],
                                [100.0, 1.0], [100.0, 0.0] ]
                        ]
                    };
                    result = loader.parse(item);
                }
            });

            test("parses to a path", function() {
                ok(result instanceof d.Path);
            });
        })();

        (function() {
            var loader;
            var item;
            var result;

            // ------------------------------------------------------------
            module("GeoJSON Loader / MultiPolygon", {
                setup: function() {
                    loader = new map.GeoJSONLoader(locator, style);
                    item = { "type": "MultiPolygon",
                        "coordinates": [
                            [[[102.0, 2.0], [103.0, 2.0], [103.0, 3.0], [102.0, 3.0], [102.0, 2.0]]],
                            [[[100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0]]]
                        ]
                    };
                    result = loader.parse(item);
                }
            });

            test("parses to a group", function() {
                ok(result instanceof d.Group);
            });

            test("parses polygons to child paths", function() {
                ok(result.children[0] instanceof d.Path);
                ok(result.children[1] instanceof d.Path);
                equal(result.children.length, 2);
            });
        })();

        (function() {
            var loader;
            var item;
            var result;

            // ------------------------------------------------------------
            module("GeoJSON Loader / Feature", {
                setup: function() {
                    loader = new map.GeoJSONLoader(locator, style);
                    item = { "type": "Feature",
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [-180.0, 10.0], [20.0, 90.0], [180.0, -5.0], [-30.0, -90.0]
                            ]]
                        }
                    };
                    result = loader.parse(item);
                }
            });

            test("parses to a path", function() {
                ok(result instanceof d.Path);
            });
        })();
    </script>

    <h1 id="qunit-header">kendo.chart</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
    <ul id="log"></ul>

</body>
</html>
