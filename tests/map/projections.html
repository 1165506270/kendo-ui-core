<!DOCTYPE html>
<html>
    <head>
        <title>Chart helpers</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit/addons/close-enough/qunit-close-enough.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <link href="../qunit/qunit/qunit.css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.dataviz.core.js"></script>
        <script src="../../src/kendo.dataviz.map.js"></script>
        <script>
            var TOLERANCE = Math.pow(10, -6);

            var dataviz = kendo.dataviz,
                Point = dataviz.Point2D,

                spatial = dataviz.spatial,
                projections = spatial.projections,
                GeoPoint = spatial.GeoPoint;

            function projectionEqual(projection, geoPoint, point) {
                var p = projection.project(geoPoint);
                close(p.x, point.x, TOLERANCE, "X");
                close(p.y, point.y, TOLERANCE, "Y");
            }

            function reverseEqual(projection, point) {
                var r = projection.reverse(point);
                var p = projection.project(r);
                close(p.x, point.x, TOLERANCE, "X");
                close(p.y, point.y, TOLERANCE, "Y");
            }

            // ------------------------------------------------------------

            // [[LAT, LONG], [X, Y]]
            // Reference values obtained by cs2cs (latitude clipped to MAX_LAT)
            // cs2cs -v -f "%.11f" -r +init=epsg:4326 +to +init=epsg:3395
            var mercatorIdentities = [
                    // Center
                    [[0, 0], [0, 0]],

                    // NE corner
                    [[90, 180],
                     [20037508.34278924763, 20037508.34277573600]],

                    // SW corner
                    [[-90, -180],
                     [-20037508.34278924763, -20037508.34277572483]],

                    // Test points
                    [[42.7175, 24.916667],
                     [2773710.68270556396, 5240075.61980005074]],

                    [[51.9371170300465, 80.11230468750001],
                     [8918060.96408808604, 6755099.41088569630]],

                    [[52.4827802220782, -5.625],
                     [-626172.1357121640, 6853979.3008168675]]
                ];

            var mercator;
            module("Projections / Mercator", {
                setup: function() {
                    mercator = new projections.Mercator();
                }
            });

            test("project", function() {
                $.each(mercatorIdentities, function() {
                    var geo = this[0];
                    var point = this[1];

                    projectionEqual(mercator,
                        new GeoPoint(geo[0], geo[1]),
                        new Point(point[0], point[1]));
                });
            });

            test("project with central meridian", function() {
                mercator = new projections.Mercator({
                    centralMeridian: 24
                });

                projectionEqual(mercator,
                    new GeoPoint(42.7175, 24.916667),
                    new Point(102042.90366699788, 5240075.61980005074)
                );
            });

            test("reverse", function() {
                $.each(mercatorIdentities, function() {
                    var point = this[1];

                    reverseEqual(mercator,
                        new Point(point[0], point[1]));
                });
            });

            test("reverse with central meridian", function() {
                mercator = new projections.Mercator({
                    centralMeridian: 24
                });

                reverseEqual(mercator,
                    new Point(102042.90366699788, 5240075.61980005074)
                );
            });

            // ------------------------------------------------------------
            module("Projections / Spherical Mercator");

        </script>

        <h1 id="qunit-header">kendo.chart</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

    </body>
</html>
