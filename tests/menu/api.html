<!DOCTYPE html>
<html>
    <head>
        <title>kendo.ui.menu Tests</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.fx.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.menu.js"></script>
        <script type="text/javascript" src="../jquery.mockjax.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
        <link type="text/css" href="../../styles/web/kendo.common.less" rel="stylesheet/less"/>
        <link type="text/css" href="../../styles/web/kendo.blueopal.less" rel="stylesheet/less"/>
        <script type="text/javascript" src="../../demos/mvc/content/shared/js/less.js"></script>
        <script type="text/javascript">

            var isRaised, isOpenRaised, isCloseRaised, isSelectRaised, selected;

             function getRootItem(index) {
                 return $('#Menu1').find('> .k-item > .k-link').eq(index)
             }

             function getMenu() {
                 return $("#Menu1").data("kendoMenu");
             }

             //handlers
             function Open() {
                 isOpenRaised = true;
             }

             function Close() {
                 isCloseRaised = true;
             }

             function Select() {
                 selected++;
                 isSelectRaised = true;
             }


             var onLoadMenu;

             function Load() {
                 isRaised = true;
                 onLoadMenu = getMenu();
             }
        </script>
    </head>
    <body onload="Load()">

    <ul id="Menu1" class="k-widget k-reset k-header k-menu" style="visibility: hidden; top: -10000px">
        <li class="k-item k-state-default" style=""><span class="k-link"><img
                src="../../playground/Icons/Suites/mvc.png" class="k-image" alt="image">ASP.NET MVC<span
                class="k-icon k-i-arrow-s"></span></span>

            <ul class="k-group">
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Mvc/Grid.png" class="k-image" alt="image">Grid</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Mvc/Menu.png" class="k-image" alt="image">Menu<span
                class="k-icon k-i-arrow-e"></span></span>
                    <ul class="k-group">
                        <li class="k-item k-state-default"><span class="k-link"><img
                                src="../../playground/Icons/Mvc/Grid.png" class="k-image" alt="image">Grid</span>
                        </li>
                        <li class="k-item k-state-default"><span class="k-link"><img
                                src="../../playground/Icons/Mvc/Menu.png" class="k-image" alt="image">Menu</span>
                        </li>
                        <li class="k-item k-state-default"><span class="k-link"><img
                                src="../../playground/Icons/Mvc/PanelBar.png" class="k-image"
                                alt="image">PanelBar</span></li>
                        <li class="k-item k-state-default"><span class="k-link"><img
                                src="../../playground/Icons/Mvc/TabStrip.png" class="k-image"
                                alt="image">TabStrip</span></li>
                    </ul>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Mvc/PanelBar.png" class="k-image"
                        alt="image">PanelBar</span></li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Mvc/TabStrip.png" class="k-image"
                        alt="image">TabStrip</span></li>
            </ul>
        </li><li class="k-item k-state-default"><span class="k-link"><img src="../../playground/Icons/Suites/sl.png"
                                                                     class="k-image" alt="image">Silverlight<span
                class="k-icon k-i-arrow-s"></span></span>
            <ul class="k-group">
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Sl/GridView.gif" class="k-image" alt="image">GridView</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Sl/Scheduler.gif" class="k-image"
                        alt="image">Scheduler</span></li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Sl/Docking.gif" class="k-image" alt="image">Docking</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Sl/Chart.gif" class="k-image" alt="image">Chart</span></li>
                <li class="k-item k-state-default"><a href="http://www.telerik.com/products/silverlight.aspx"
                                                      class="k-link">... and 28 more!</a></li>
            </ul>
        </li><li class="k-item k-state-default"><span class="k-link"><img src="../../playground/Icons/Suites/ajax.png"
                                                                     class="k-image" alt="image">ASP.NET AJAX<span
                class="k-icon k-i-arrow-s"></span></span>
            <ul class="k-group">
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Ajax/Grid.png" class="k-image" alt="image">Grid</span></li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Ajax/Editor.png" class="k-image" alt="image">Editor</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Ajax/Scheduler.png" class="k-image"
                        alt="image">Scheduler</span></li>
                <li class="k-item k-state-default"><a href="http://www.telerik.com/products/aspnet-ajax.aspx"
                                                      class="k-link">... and 28 more!</a></li>
            </ul>
        </li><li class="k-item k-state-default"><a href="#Menu-4" class="k-link"><img
                src="../../playground/Icons/Suites/orm.png" class="k-image" alt="image">OpenAccess ORM<span
                class="k-icon k-i-arrow-s"></span></a>
            <ul class="k-group">
                <li class="k-item">
                    <div id="Menu-4" class="k-content">
                        <img alt="Telerik OpenAccess" src="../../playground/Icons/orm-comparison.png">
                        <a href="http://www.telerik.com/purchase/individual/orm.aspx" id="buy">
                            Telerik OpenAccess ORM
                        </a>
                        <a href="http://www.telerik.com/community/license-agreement.aspx?pId=639" id="express">
                            Telerik OpenAccess ORM Express
                        </a>
                    </div>
                </li>
            </ul>
        </li><li class="k-item k-state-default"><span class="k-link"><img src="../../playground/Icons/Suites/rep.png"
                class="k-image" alt="image">Reporting</span></li><li class="k-item k-state-default"><span class="k-link"><img
                src="../../playground/Icons/Suites/sitefinity.png" class="k-image" alt="image">Sitefinity ASP.NET CMS</span>
        </li><li style="border-right: 0;" class="k-item k-state-default"><span class="k-link">Other products<span
                class="k-icon k-i-arrow-s"></span></span>
            <ul class="k-group">
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Suites/test.png" class="k-image" alt="image">Web Testing Tools</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Suites/win.png" class="k-image" alt="image">WinForms UI Controls</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Suites/wpf.png" class="k-image"
                        alt="image">WPF UI Controls</span></li>
            </ul>
        </li>
    </ul>

<script type="text/javascript">

        $("#Menu1").kendoMenu({ animation: false, select: Select, open: Open, close: Close, hoverDelay: 0, popupCollision: "flip" });

        var menu,
            CLICK = kendo.support.touch ? "touchend" : "click";

        module("Menu / ClientSideAPI", {
            setup: function () {
                menu = getMenu();
            }
        });

        test('click method should set handled flag and select event is only fired once', function() {
            var link = getRootItem(7);
            var isCalled = false;

            var e = { target: link[0], stopPropagation: function () {}, preventDefault: function () {} };

            selected = 0;
            menu._click(e);

            ok(e.handled);
            ok(selected == 1);
        });

        asyncTest('hovering root item opens it and raises open event', function() {
            var item = getRootItem(1).parent();

            menu._mouseenter({ currentTarget: item[0], delegateTarget: menu.element[0] });

            setTimeout(function () {
                ok(isOpenRaised);
                start();
            }, 1);
        });

        asyncTest('leaving root item closes it and raises close event', function() {
            var item = getRootItem(1).parent();

            menu._mouseleave({ currentTarget: item[0] });

            setTimeout(function () {
                ok(isCloseRaised);
                start();
            }, 1);
        });

        test('clicking should raise select event', function() {
            var link = getRootItem(2);

            isSelectRaised = false;

            link.trigger(CLICK);

            ok(isSelectRaised);
        });

        test('clicking on sub item should close the menu', function() {
            var link = getRootItem(1);

            menu._mouseenter({currentTarget: link[0]});

            var e = { stopPropagation: function () {}, preventDefault: function () {} };

            link.trigger(CLICK);

            ok(link.parent().is(":visible"));
        });

        asyncTest('open should open item even if disabled', function() {
            var item = getRootItem(6).parent();

            menu.disable(item);
            menu.open(item);

            setTimeout(function () {
                ok(item.find('.k-group').is(":visible"));
                start();
            }, 1);
        });

        asyncTest('open should apply max-height and overflow styles to group UL', function() {
            var item = getRootItem(1).parent(),
                ul = item.find(".k-group");

            menu.open(item);

            setTimeout(function () {
                var maxHeightStyle = parseInt(ul.css("max-height"), 10),
                    overflowStyle = ul.css("overflow"),
                    windowHeight = parseInt($(window).height(), 10);

                ok(!isNaN(maxHeightStyle));
                equal(overflowStyle, "auto");
                equal(maxHeightStyle, windowHeight);
                start();
            }, 1);
        });

        asyncTest('open should not apply max-height and overflow styles to group UL if it has children groups', function() {
            var item = getRootItem(0).parent(),
                ul = item.find(".k-group").css({maxHeight: 1, overflow: "auto"});

            menu.open(item);

            setTimeout(function () {
                var maxHeightStyle = parseInt(ul.css("max-height"), 10),
                    overflowStyle = ul.css("overflow");

                ok(isNaN(maxHeightStyle));
                notEqual(overflowStyle, "auto");
                start();
            }, 1);
        });

        test('clicking should not open item if disabled', function() {
            var item = getRootItem(4).parent();

            menu.disable(item);

            item.children(".k-link").trigger(CLICK);

            ok(!item.find('.k-group').is(":visible"));
        });

        test('disable method should disable enabled item', function() {
            var item = getRootItem(2).parent();

            menu.disable(item);

            ok(item.hasClass('k-state-disabled'));
        });

        test('enable method should enable disabled item', function() {
            var item = getRootItem(3).parent();

            menu.enable(item);

            ok(item.hasClass('k-state-default'));
        });

        asyncTest('configure with popupCollision overrides the default', function() {
            var item = getRootItem(3).parent();

            menu.open(item);

            setTimeout(function () {
                ok(item.find(".k-group").eq(0).data("kendoPopup").options.collision == "flip");
                start();
            }, 1);
        });

        test('setOptions resets the animation', function() {
            var m = new kendo.ui.Menu("<div />");

            ok(!("effects" in m.options.animation.open));

            m.setOptions({ animation: false });

            ok("effects" in m.options.animation.open);
            ok(kendo.size(m.options.animation.open.effects) == 0);
            m.destroy();
        });

        test('setOptions resets the dataSource object', function() {
            var m = new kendo.ui.Menu("<div />", { dataSource: [ { text: "Item 1" } ] });

            ok(m.element.find("li").text() == "Item 1");

            m.setOptions({ dataSource: [ { text: "Changed" } ] });

            ok(m.element.find("li").text() == "Changed");
            m.destroy();
        });

        test("Element with class k-icon doesn't get removed in an item", function () {
            var m = new kendo.ui.Menu("<ul><li><span class='k-icon'></span></li></ul>");

            ok(m.element.find(".k-icon")[0]);
            m.destroy();
        });

        test("Add dynamic item with cssClass", function () {
            var m = new kendo.ui.Menu("<ul></ul>");

            m.append({ text: "test", cssClass: "cssClass" });

            ok(m.element.find(".cssClass")[0]);
            m.destroy();
        });

        test("Adding dynamic content element renders properly on root and inner levels", function () {
            var m = new kendo.ui.Menu("<ul></ul>");

            m.append([
                {
                    text: "Item 1",
                    content: "Item 1 Content"
                },
                {
                    text: "Item 2",
                    items: [
                        {
                            text: "Sub Item 1",
                            content: "Sub Item 1 Content"
                        }
                    ]
                }
            ]);

            ok(m.element.children("li:first").children("div.k-content")[0]);
            ok(m.element.find("> li:last > ul > li:first").children("div.k-content")[0]);
            m.destroy();
        });

        test("Adding dynamic contentUrl element renders contents on root and inner levels", function () {
            var m = new kendo.ui.Menu("<ul></ul>");

            m.append([
                {
                    text: "Item 1",
                    contentUrl: "AjaxView1.html"
                },
                {
                    text: "Item 2",
                    items: [
                        {
                            text: "Sub Item 1",
                            contentUrl: "AjaxView2.html"
                        }
                    ]
                }
            ]);

            ok(m.element.children("li:first").children("div.k-content")[0]);
            ok(m.element.find("> li:last > ul > li:first").children("div.k-content")[0]);
            m.destroy();
        });

</script>

    <h1 id="qunit-header">kendo.ui.Menu Tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
    <ul id="log"></ul>
</body>
</html>
