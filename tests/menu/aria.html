<!doctype html>
<html>
    <head>
        <title>menu ARIA support</title>
        <script src="../../src/jquery.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script type="text/javascript" src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <script src="../../src/kendo.fx.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.draganddrop.js"></script>
        <script src="../../src/kendo.menu.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" ></div>
    </head>
    <body>
        <h1 id="qunit-header"></h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var menu;
            function setup(options) {
                menu = $("<ul />").appendTo(document.body).kendoMenu(options);
                return menu;
            }

            $.fn.press = function(key) {
                return this.trigger({ type: "keydown", keyCode: key } );
            };

            module("ARIA support", {
                teardown: function () {
                    $("ul[data-role=menu]").remove();
                }
            });

            test("menubar role is added to the wrapper", function() {
                setup();
                ok(menu.filter("[role=menubar]").length);
            });

            test("menuitem role is added to the items of bound menu", function() {
                setup({ dataSource: [ {text: "foo" } ] });
                ok(menu.find("[role=menuitem]").length);
            });

            test("menuitem role is added to the items of html created menu", function() {
                menu = $("<ul><li>foo</li></ul>")
                    .appendTo(document.body)
                    .kendoMenu();

                ok(menu.find("[role=menuitem]").length);
            });

            test("has-popup attribute is added if node has childs", function() {
                setup({ dataSource: [ {text: "foo", items: [{ text: "bar" }] } ] });

                equal(menu.find("[aria-haspopup=true] span:first").text(), "foo");
            });

            test("menu role is added to the group container", function() {
                setup({ dataSource: [ {text: "foo", items: [{ text: "bar" }] } ] });

                equal(menu.find("[role=menu] span:first").text(), "bar");
            });

            test("menu role is added to the group container when created from html", function() {
                menu = $("<ul><li>foo<ul><li>bar</li></ul></li></ul>")
                    .appendTo(document.body)
                    .kendoMenu();

                equal(menu.find("[role=menu] span:first").text(), "bar");
            });

            test("disabled attribute is added if node is disabled", function() {
                setup({ dataSource: [ { text: "foo", enabled: false } ] });

                equal(menu.find("[aria-disabled=true] span:first").text(), "foo");
            });

            test("disabled attribute is added if node is disabled via the API", function() {
                setup({ dataSource: [ { text: "foo" } ] });

                menu.data("kendoMenu").disable(menu.find("li:first"));

                equal(menu.find("[aria-disabled=true] span:first").text(), "foo");
            });

            test("disabled attribute is added if child node is disabled via the API", function() {
                setup({ dataSource: [ { text: "foo", items: [{ text: "bar" }] } ] });

                menu.data("kendoMenu").disable(menu.find(".k-group li:first"));

                equal(menu.find("[aria-disabled=true] span:first").text(), "bar");
            });

            test("disabled attribute is added if node is disabled when created from html", function() {
                menu = $("<ul><li disabled='disabled'>foo</li></ul>")
                    .appendTo(document.body)
                    .kendoMenu();

                equal(menu.find("[aria-disabled=true] span:first").text(), "foo");
            });

            test("hidden attribute is added to the group when created from html", function() {
                menu = $("<ul><li>foo<ul><li>bar</li></ul></li></ul>")
                    .appendTo(document.body)
                    .kendoMenu();

                ok(menu.find(".k-group[aria-hidden=true]").length);
            });

            test("aria-activedescendant is added to the wrapper when item is focused", function() {
                menu = $("<ul id=\"foo\"/>")
                    .appendTo(document.body)
                    .kendoMenu({ dataSource: [ {text: "foo", items: [{ text: "bar" }] } ] });

                menu[0].focus();

                ok(menu.filter("[aria-activedescendant]").length);
                ok(menu.find("li#" + menu.data("kendoMenu")._ariaId).length);
            });

            test("aria-activedescendant is added to the wrapper when item is focused", function() {
                menu = $("<ul id=\"foo\"><li id=\"bar\">foo</li></ul>")
                    .appendTo(document.body)
                    .kendoMenu();

                menu[0].focus();

                ok(menu.filter("[aria-activedescendant=bar]").length);
                ok(menu.find("li#bar").length);
            });
        </script>

        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
