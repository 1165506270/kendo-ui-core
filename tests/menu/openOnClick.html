<!DOCTYPE html>
<html>
    <head>
        <title>kendo.ui.menu Tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.menu.js"></script>
        <script type="text/javascript" src="../jquery.mockjax.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
        <link type="text/css" href="../../styles/web/kendo.common.css" rel="stylesheet"/>
        <script type="text/javascript">

            var isRaised;

             function getRootItem(index) {
                 return $('#Menu3').find('> .k-item > .k-link')[index];
             }

             function getMenu() {
                 return $("#Menu3").data("kendoMenu");
             }

        </script>
    </head>
    <body>

    <ul id="Menu3" class="k-widget k-reset k-header k-menu" style="visibility: hidden;">
        <li class="k-item k-state-default" style=""><span class="k-link"><img
                src="../../playground/Icons/Suites/mvc.png" class="k-image" alt="image">ASP.NET MVC<span
                class="k-icon k-i-arrow-s"></span></span>

            <ul class="k-group">
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Mvc/Grid.png" class="k-image" alt="image">Grid</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Mvc/Menu.png" class="k-image" alt="image">Menu<span
                class="k-icon k-i-arrow-e"></span></span>
                    <ul class="k-group">
                        <li class="k-item k-state-default"><span class="k-link"><img
                                src="../../playground/Icons/Mvc/Grid.png" class="k-image" alt="image">Grid</span>
                        </li>
                        <li class="k-item k-state-default"><span class="k-link"><img
                                src="../../playground/Icons/Mvc/Menu.png" class="k-image" alt="image">Menu</span>
                        </li>
                        <li class="k-item k-state-default"><span class="k-link"><img
                                src="../../playground/Icons/Mvc/PanelBar.png" class="k-image"
                                alt="image">PanelBar</span></li>
                        <li class="k-item k-state-default"><span class="k-link"><img
                                src="../../playground/Icons/Mvc/TabStrip.png" class="k-image"
                                alt="image">TabStrip</span></li>
                    </ul>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Mvc/PanelBar.png" class="k-image"
                        alt="image">PanelBar</span></li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Mvc/TabStrip.png" class="k-image"
                        alt="image">TabStrip</span></li>
            </ul>
        </li><li class="k-item k-state-default"><span class="k-link"><img src="../../playground/Icons/Suites/sl.png"
                                                                     class="k-image" alt="image">Silverlight<span
                class="k-icon k-i-arrow-s"></span></span>
            <ul class="k-group">
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Sl/GridView.gif" class="k-image" alt="image">GridView</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Sl/Scheduler.gif" class="k-image"
                        alt="image">Scheduler</span></li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Sl/Docking.gif" class="k-image" alt="image">Docking</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Sl/Chart.gif" class="k-image" alt="image">Chart</span></li>
                <li class="k-item k-state-default"><a href="http://www.telerik.com/products/silverlight.aspx"
                                                      class="k-link">... and 28 more!</a></li>
            </ul>
        </li><li class="k-item k-state-default"><span class="k-link"><img src="../../playground/Icons/Suites/ajax.png"
                                                                     class="k-image" alt="image">ASP.NET AJAX<span
                class="k-icon k-i-arrow-s"></span></span>
            <ul class="k-group">
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Ajax/Grid.png" class="k-image" alt="image">Grid</span></li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Ajax/Editor.png" class="k-image" alt="image">Editor</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Ajax/Scheduler.png" class="k-image"
                        alt="image">Scheduler</span></li>
                <li class="k-item k-state-default"><a href="http://www.telerik.com/products/aspnet-ajax.aspx"
                                                      class="k-link">... and 28 more!</a></li>
            </ul>
        </li><li class="k-item k-state-default"><img
                src="../../playground/Icons/Suites/orm.png" class="k-image" alt="image">OpenAccess ORM<span
                class="k-icon k-i-arrow-s"></span>
            <ul class="k-group">
                <li class="k-item">
                    <div id="Menu-4" class="k-content">
                        <img alt="Telerik OpenAccess" src="../../playground/Icons/orm-comparison.png">
                        <a href="http://www.telerik.com/purchase/individual/orm.aspx" id="buy">
                            Telerik OpenAccess ORM
                        </a>
                        <a href="http://www.telerik.com/community/license-agreement.aspx?pId=639" id="express">
                            Telerik OpenAccess ORM Express
                        </a>
                    </div>
                </li>
            </ul>
        </li><li class="k-item k-state-default"><span class="k-link"><img src="../../playground/Icons/Suites/rep.png"
                class="k-image" alt="image">Reporting</span></li><li class="k-item k-state-default"><span class="k-link"><img
                src="../../playground/Icons/Suites/sitefinity.png" class="k-image" alt="image">Sitefinity ASP.NET CMS</span>
        </li><li style="border-right: 0;" class="k-item k-state-default"><span class="k-link">Other products<span
                class="k-icon k-i-arrow-s"></span></span>
            <ul class="k-group">
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Suites/test.png" class="k-image" alt="image">Web Testing Tools</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Suites/win.png" class="k-image" alt="image">WinForms UI Controls</span>
                </li>
                <li class="k-item k-state-default"><span class="k-link"><img
                        src="../../playground/Icons/Suites/wpf.png" class="k-image"
                        alt="image">WPF UI Controls</span></li>
            </ul>
        </li>
        <li><a href="javascript:">ASP.NET MVC</a></li>
    </ul>

<script type="text/javascript">

        $("#Menu3").kendoMenu({ animation: false, openOnClick: true, hoverDelay: 0 });

        var open;
        var close;
        var menu;

        module("Menu / OpenOnClick", {
            setup: function() {
                menu = getMenu();
                open = menu.open;
                close = menu.close;
            },
            teardown: function() {
                menu.clicked = false;
                menu.open = open;
                menu.close = close;
            }
        });

        test('open on click is serialized', function() {
            ok(menu.options.openOnClick);
        });

        test('click method should call preventDefault method', function() {
            var item = getRootItem(3);
            var isCalled = false;

            var e = { target: item, preventDefault: function () { isCalled = true; }, stopPropagation: function () {} };

            menu._click(e);

            ok(isCalled);
        });

        test('click method on item with URL shouldn\'t call preventDefault method', function() {
            var item = getRootItem(7);
            var isCalled = false;

            var e = { target: item, preventDefault: function () { isCalled = true; }, stopPropagation: function () {} };

            menu._click(e);

            ok(!isCalled);
        });

        test('hovering root item does not open it', function() {
            var opend = false;

            menu.open = function() { opend = true };
            menu._mouseenter({}, $("li:first", menu.element)[0]);

            ok(!opend);
        });

        test('clicking root item should open it', function() {
            var opend = false;
            menu.open = function() { opend = true };
            var element = $("li:first", menu.element)[0];
            menu._click({ target: element, preventDefault: function () { }, stopPropagation: function () { } }, element);
            ok(opend);
            ok(menu.clicked);
        });

        test('leaving opened item does not close it', function() {
            var opend = false;
            menu.clicked = true;
            menu.open = function() { opend = true };

            menu._mouseleave({}, $("li:first", menu.element)[0]);

            ok(!opend);
        });

        test('leaving opened and hovering a sibling closes it and opens the sibling', function() {
            var opend = false;
            menu.clicked = true;
            menu.open = function() { opend = true };

            var element = $("li:first", menu.element)[0];
            menu._mouseenter({ currentTarget: element, delegateTarget: menu.element[0], indexOf: function() { }, type:'mouseenter' }, element.nextSibling);

            ok(opend);
        });

        test('clicking the document closes the open item', function() {
            menu.clicked = true;
            menu._documentClick({ target: document.body }, document );
            ok(menu.clicked === false);
        });

</script>

    <h1 id="qunit-header">kendo.ui.Menu Tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
    <ul id="log"></ul>
</body>
</html>
