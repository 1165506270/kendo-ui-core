<!DOCTYPE dom>
<html>
    <head>
        <title>kendo.ui.MobileButton Tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.mobile.core.js"></script>
        <script src="../../src/kendo.mobile.button.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">kendo.ui.MobileButton Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <script>

            var Button = kendo.ui.MobileButton,
                MOUSEDOWN = kendo.support.touch ? "touchstart" : "mousedown",
                MOUSEUP = kendo.support.touch ? "touchend" : "mouseup";

            function click(dom) {
                dom[MOUSEUP]()
            }

            test("applies css class", function() {
                expect(1);

                var dom = $("<button/>");

                var button = new Button(dom);

                ok(button.element.hasClass("km-button"), "Should have specified CSS class");
            });

            test("wraps content in a span", function() {
                expect(1);

                var dom = $("<button>foo</button>");

                var button = new Button(dom);

                ok(button.element.children().first().is("span.km-text"), "Should wrap contents");
            });

            test("reuses existing span", function() {
                expect(1);

                var dom = $("<button><span>foo</span></button>");
                var span = dom.find("span");

                var button = new Button(dom);

                ok(span.hasClass("km-text"), "Should wrap contents");
            });

            test("adds css class to children img elements", function() {
                expect(1);

                var dom = $("<button><img/>foo</button>");
                var img = dom.find("img");

                var button = new Button(dom);

                ok(img.hasClass("km-image"), "Should set css class to img");
            });

            test("raises click event when clicked", function() {
                expect(1);

                var dom = $("<button>foo</button>");

                var button = new Button(dom);

                button.bind("click", function() {
                    ok(true, "Should raise the click event");
                });

                click(dom);
            });

            test("should not raise click event when disabled", function() {
                var dom = $("<button>foo</button>");

                var button = new Button(dom);
                button.disable();

                button.bind("click", function() {
                    ok(false, "Should not raise the click event");
                });

                dom.mousedown();
            });

            test("should apply active state when pressed", function() {
                expect(1);

                var dom = $("<button>foo</button>");
                var button = new Button(dom);

                dom.trigger(MOUSEDOWN);
                ok(dom.hasClass("km-state-active"), "Should have active css class");
            });

            test("should remove active state when depressed", function() {
                expect(1);

                var dom = $("<button>foo</button>");
                var button = new Button(dom);

                dom.trigger(MOUSEDOWN);
                dom.trigger(MOUSEUP);
                ok(!dom.hasClass("km-state-active"), "Should not have active css class");
            });

            test("should not apply active state when disabled", function() {
                expect(1);

                var dom = $("<button>foo</button>");
                var button = new Button(dom);

                button.disable();

                dom.trigger(MOUSEDOWN);

                ok(!dom.hasClass("km-state-active"), "Should not have active css class");
            });

            test("disable from configuration options", function() {
                var dom = $("<button>foo</button>");

                var button = new Button(dom, { enable: false });

                button.bind("click", function() {
                    ok(false, "Should not raise the click event");
                });

                click(dom);
            });

            test("should enable disabled button", function() {
                expect(1);

                var dom = $("<button>foo</button>");

                var button = new Button(dom);

                button.disable();

                button.bind("click", function() {
                    ok(true, "Should raise the click event");
                });

                button.enable();

                click(dom);
            });

            test("calls application navigate if present", function() {
                expect(2);

                kendo.application = {};

                stub(kendo.application, "navigate");

                var dom = $('<a href="foo">foo</a>');

                var button = new Button(dom);

                click(dom);

                equal(kendo.application.calls("navigate"), 1);
                equal(kendo.application.args("navigate")[0], "foo");
            });
        </script>
    </body>
</html>
