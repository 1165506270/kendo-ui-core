<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>kendo.ui.MobileScrollView.Tests</title>
        <script src="../../jquery-loader.js"></script>
        <script src="../../qunit/qunit/qunit.js"></script>
        <script src="../../kendo-test-helpers.js"></script>
        <script src="../../../src/kendo.core.js"></script>
        <script src="../../../src/kendo.fx.js"></script>
        <script src="../../../src/kendo.data.js"></script>
        <script src="../../../src/kendo.binder.js"></script>
        <script src="../../../src/kendo.userevents.js"></script>
        <script src="../../../src/kendo.draganddrop.js"></script>
        <script src="../../../src/kendo.router.js"></script>
        <script src="../../../src/kendo.mobile.scroller.js"></script>
        <script src="../../../src/kendo.mobile.loader.js"></script>
        <script src="../../../src/kendo.mobile.view.js"></script>
        <script src="../../../src/kendo.mobile.pane.js"></script>
        <script src="../../../src/kendo.mobile.application.js"></script>
        <script src="../../../src/kendo.mobile.scrollview.js"></script>
        <link rel="stylesheet" href="../../qunit/qunit/qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">kendo.mobile.ui.VirtualScrollViewContent Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <script id="scrollview-tmp" type="text/x-kendo-template"><div>#:foo#</div></script>
        <script id="scrollview-mvvm-tmp" type="text/x-kendo-template"><div data-bind="text: foo"></div></script>

        <script>
            QUnit.config.reorder = false;

            test("ScrollView binds with MVVM", 2, function() {
                var appContent = '<div data-role="view" data-model="viewModel"> <div id="scrollview" data-role="scrollview" data-bind="source: ds" data-template="scrollview-tmp"></div> </div>';

                $("#qunit-fixture").html(appContent);
                window.viewModel = kendo.observable({
                    ds: [{foo: 1}, {foo: 2}]
                });
                var app = new kendo.mobile.Application($("#qunit-fixture"));

                equal($("#scrollview").data("kendoMobileScrollView").items().eq(1).text(), "1");
                equal($("#scrollview").data("kendoMobileScrollView").items().eq(2).text(), "2");
            });

            test("ScrollView binds contents", 2, function() {
                var appContent = '<div data-role="view" data-model="viewModel"> <div id="scrollview" data-role="scrollview" data-bind="source: ds" data-template="scrollview-mvvm-tmp"></div> </div>';

                $("#qunit-fixture").html(appContent);
                window.viewModel = kendo.observable({
                    ds: [{foo: 1}, {foo: 2}]
                });
                var app = new kendo.mobile.Application($("#qunit-fixture"));

                equal($("#scrollview").data("kendoMobileScrollView").items().eq(1).text(), "1");
                equal($("#scrollview").data("kendoMobileScrollView").items().eq(2).text(), "2");
            });

            test("ScrollView rebinds to a new DataSource", 3, function() {
                var appContent = '<div data-role="view" data-model="viewModel"> <div id="scrollview" data-role="scrollview" data-bind="source: ds" data-template="scrollview-mvvm-tmp"></div> </div>';

                $("#qunit-fixture").html(appContent);
                window.viewModel = kendo.observable({
                    ds: [{foo: 1}, {foo: 2}]
                });
                var app = new kendo.mobile.Application($("#qunit-fixture"));

                var widget = $("#scrollview").data("kendoMobileScrollView");
                var oldDataSource = widget.dataSource;
                oldDataSource.bind("change", function() {
                    console.log("change");
                });

                var newDataSource = new kendo.data.DataSource({
                    data: [ {foo: 3}, {foo: 4} ]
                });
                
                window.viewModel.set("ds", newDataSource);

                equal($("#scrollview").data("kendoMobileScrollView").items().eq(1).text(), "3");
                equal($("#scrollview").data("kendoMobileScrollView").items().eq(2).text(), "4");

                // oldDataSource.data([{foo: 5}, { foo: 6 }]);
                equal($("#scrollview").data("kendoMobileScrollView").items().eq(1).text(), "3");
            });
        </script>
    </body>
</html>
