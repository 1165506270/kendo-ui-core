<!DOCTYPE html>
<html>
    <head>
        <title>kendo.bind tests</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">kendo.bind Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
        <script>
            QUnit.config.testTimeout = 100;

            test("text binding", function() {
                var dom = $('<span data-text="foo"/>');

                kendo.bind(dom, { foo: "foo" });
                equal(dom.text(), "foo");
            });

            test("html binding", function() {
                var dom = $('<span data-html="foo"/>');

                kendo.bind(dom, { foo: "foo" });
                equal(dom.html(), "foo");
            });

            test("value binding", function() {
                var dom = $('<input data-value="foo"/>');

                kendo.bind(dom, { foo: "foo" });
                equal(dom.val(), "foo");
            });

            test("title binding", function() {
                var dom = $('<span data-title="foo"/>');

                kendo.bind(dom, { foo: "foo" });
                equal(dom.attr("title"), "foo");
            });

            test("alt binding", function() {
                var dom = $('<img data-alt="foo"/>');

                kendo.bind(dom, { foo: "foo" });
                equal(dom.attr("alt"), "foo");
            });

            test("src binding", function() {
                var dom = $('<img data-src="foo"/>');

                kendo.bind(dom, { foo: "http://www.example.com" });
                equal(dom.attr("src"), "http://www.example.com");
            });

            test("href binding", function() {
                var dom = $('<a data-href="foo"/>');

                kendo.bind(dom, { foo: "foo" });
                equal(dom.attr("href"), "foo");
            });

            test("binding immediate children", function() {
                var dom = $('<span><img data-alt="foo"/></span>');

                kendo.bind(dom, { foo: "foo" });
                equal(dom.find("img").attr("alt"), "foo");
            });

            test("binding arbitrary children", function() {
                var dom = $('<span><span><img data-alt="foo"/></span></span>');

                kendo.bind(dom, { foo: "foo" });
                equal(dom.find("img").attr("alt"), "foo");
            });

            asyncTest("click binding", function() {
                expect(1);

                var dom = $('<span data-click="foo"/>');

                kendo.bind(dom, {
                    foo: function() {
                        start();
                        ok(true, "click is raised");
                    }
                });

                dom.trigger("click");
            });

            asyncTest("change binding", function() {
                expect(1);

                var dom = $('<span data-change="foo"/>');

                kendo.bind(dom, {
                    foo: function() {
                        start();
                        ok(true, "change is raised");
                    }
                });

                dom.trigger("change");
            });

            asyncTest("the context of the event handler is the viewmodel", function() {
                expect(1);

                var dom = $('<span data-click="foo"/>');
                var viewModel = kendo.observable( {
                    foo: function() {
                        start();
                        strictEqual(this, viewModel);
                    }
                });

                kendo.bind(dom, viewModel);

                dom.trigger("click");
            });

            test("select binding", function() {
                var dom = $('<select data-source="foo"/>');

                kendo.bind(dom, {
                    foo: [1, 2]
                });

                equal(dom.find("option").length, 2);
                equal(dom.find("option").first().text(), "1");
                equal(dom.find("option").last().text(), "2");
            });

            test("select binding with template", function() {
                var dom = $('<select data-source="foo" data-template="select-template" />');

                kendo.bind(dom, {
                    foo: [ {
                        id: 1,
                        name: "foo"
                    }]
                });

                equal(dom.find("option").text(), "foo");
                equal(dom.find("option").val(), "1");
            });
        </script>

        <script id="select-template" type="text/x-kendo-template">
            <option value="${id}">${name}</option>
        </script>
    </head>
</html>
