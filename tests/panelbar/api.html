<!DOCTYPE html>
<html>
    <head>
        <title>kendo.ui.panelbar Tests</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.fx.js"></script>
        <script src="../../src/kendo.panelbar.js"></script>
        <script type="text/javascript" src="../jquery.mockjax.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
        <link type="text/css" href="../../styles/web/kendo.common.css" rel="stylesheet"/>

   <script type="text/javascript">

        QUnit.config.reorder = false;

       var isRaised, isExpandRaised, isCollapseRaised, isSelectRaised, isActivateRaised;

        function getRootItem(index) {
  	return $('#PanelBar1').find('.k-header').parent().eq(index)
        }

        function getPanelBar() {
            return $("#PanelBar1").data("kendoPanelBar");
        }

        //handlers
        function Expand(sender, args) {
            isExpandRaised = true;
        }

       function Activate(sender, args) {
           isActivateRaised = true;
       }

        function Collapse(sender, args) {
            isCollapseRaised = true;
        }

        function Select(sender, args) {
            isSelectRaised = true;
        }

        var onLoadPanelBar;
        function Load(e) {
            isRaised = true;
            onLoadPanelBar = $("#PanelBar1").data("kendoPanelBar");
        }
   </script>

</head>
<body onload="Load()">

<ul class="k-widget k-panelbar k-reset" id="PanelBar1" style="width: 300px; float: left; margin-bottom: 30px; visibility: hidden; position: absolute;">
    <li class="k-item k-state-default"><span class="k-link k-header"><img alt="Mail Icon" class="k-image"
                                                                          src="../../playground/Icons/mail.gif">Mail<span
            class="k-icon k-i-arrow-s k-panelbar-expand"></span></span>
        <ul style="display: none;" class="k-group">
            <li class="k-item k-state-default"><span class="k-link"><img alt="Personal Folders Icon" class="k-image"
                                                                         src="../../playground/Icons/mailPersonalFolders.gif">Personal Folders</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Deleted Items Icon" class="k-image"
                                                                         src="../../playground/Icons/mailDeletedItems.gif">Deleted Items</span>
            </li>
            <li class="k-item k-state-disabled"><span class="k-link"><img alt="Inbox Icon" class="k-image"
                                                                          src="../../playground/Icons/mailInbox.gif">Inbox</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="My Mail Icon" class="k-image"
                                                                         src="../../playground/Icons/mailfolder.gif">My Mail</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Sent Items Icon" class="k-image"
                                                                         src="../../playground/Icons/mailSent.gif">Sent Items</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Outbox Icon" class="k-image"
                                                                         src="../../playground/Icons/mailOutbox.gif">Outbox</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Search Folders Icon" class="k-image"
                                                                         src="../../playground/Icons/mailSearch.gif">Search Folders</span>
            </li>
        </ul>
    </li>
    <li class="k-item k-state-disabled"><span class="k-link k-header"><img alt="Contacts Icon" class="k-image"
                                                                           src="../../playground/Icons/contacts.gif">Contacts<span
            class="k-icon k-i-arrow-s k-panelbar-expand"></span></span>
        <ul class="k-group" style="display: none;">
            <li class="k-item k-state-default"><span class="k-link"><img alt="Contact Icon" class="k-image"
                                                                         src="../../playground/Icons/contactsItems.gif">My Contacts</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Contact Icon" class="k-image"
                                                                         src="../../playground/Icons/contactsItems.gif">Address Cards</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Contact Icon" class="k-image"
                                                                         src="../../playground/Icons/contactsItems.gif">Phone List</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Contact Icon" class="k-image"
                                                                         src="../../playground/Icons/contactsItems.gif">Shared Contacts</span>
            </li>
        </ul>
    </li>
    <li class="k-item k-state-default"><span class="k-link k-header"><img alt="Tasks Icon" class="k-image"
                                                                          src="../../playground/Icons/tasks.gif">Tasks<span
            class="k-icon k-i-arrow-s k-panelbar-expand"></span></span>
        <ul class="k-group" style="display: none;">
            <li class="k-item k-state-default"><span class="k-link"><img alt="Task Icon" class="k-image"
                                                                         src="../../playground/Icons/tasksItems.gif">My Tasks</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Task Icon" class="k-image"
                                                                         src="../../playground/Icons/tasksItems.gif">Shared Tasks</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Task Icon" class="k-image"
                                                                         src="../../playground/Icons/tasksItems.gif">Active Tasks</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Task Icon" class="k-image"
                                                                         src="../../playground/Icons/tasksItems.gif">Completed Tasks</span>
            </li>
        </ul>
    </li>
    <li class="k-item k-state-active"><span class="k-link k-header k-state-selected"><img alt="Notes Icon"
                                                                                          class="k-image"
                                                                                          src="../../playground/Icons/notes.gif">Notes<span
            class="k-icon k-i-arrow-n k-panelbar-collapse"></span></span>
        <ul class="k-group" style="display: block;">
            <li class="k-item k-state-default"><span class="k-link"><img alt="Note Icon" class="k-image"
                                                                         src="../../playground/Icons/notesItems.gif">My Notes</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Note Icon" class="k-image"
                                                                         src="../../playground/Icons/notesItems.gif">Notes List</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Note Icon" class="k-image"
                                                                         src="../../playground/Icons/notesItems.gif">Shared Notes</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Note Icon" class="k-image"
                                                                         src="../../playground/Icons/notesItems.gif">Archive</span>
            </li>
        </ul>
    </li>
    <li class="k-item k-state-default"><span class="k-link k-header"><img alt="Folders List Icon" class="k-image"
                                                                          src="../../playground/Icons/foldersList.gif">Folders List<span
            class="k-icon k-i-arrow-s k-panelbar-expand"></span></span>
        <ul class="k-group" style="display: none;">
            <li class="k-item k-state-default"><span class="k-link"><img alt="Folder List Icon" class="k-image"
                                                                         src="../../playground/Icons/mailfolder.gif">My Client.Net</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Folder List Icon" class="k-image"
                                                                         src="../../playground/Icons/mailfolder.gif">My Profile</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Folder List Icon" class="k-image"
                                                                         src="../../playground/Icons/mailfolder.gif">My Support Tickets</span>
            </li>
            <li class="k-item k-state-default"><span class="k-link"><img alt="Folder List Icon" class="k-image"
                                                                         src="../../playground/Icons/mailfolder.gif">My Licenses</span>
            </li>
        </ul>
    </li>
</ul>
<ul id="panel2"></ul>

    <script type="text/javascript">

        $("#PanelBar1").kendoPanelBar({ animation: false, expand: Expand, collapse: Collapse, select: Select, activate: Activate });

        module("api", {
            teardown: function() {
                $("#panel2").empty();
            }
        });

        test('trigger input select should not bubble', function() {

            isRaised = false;

            var item = getRootItem(6);

            $(item).find('input').first().trigger('select');

            ok(!isRaised);
        });

        test('clicking should raise onSelect event', function() {

            var item = getRootItem(0);

            isSelectRaised = false;

            item.find('> .k-link').trigger('click');

            ok(isSelectRaised);
        });

        test('collapse should raise onCollapse event', function() {

            var panel = getPanelBar();

            isCollapseRaised = false;

            var item = getRootItem(3);

            item.find('> .k-link').trigger('click');

            ok(isCollapseRaised);
        });

        test('expand should raise onExpand event', function() {

            var panel = getPanelBar();

            isExpandRaised = false;

            var item = getRootItem(2);

            item.find('> .k-link').trigger('click');

            ok(isExpandRaised);
        });

        asyncTest('expand should raise onActivate event after duration', function() {

            var panel = getPanelBar();

            isActivateRaised = false;

            var item = getRootItem(4);

            item.find('> .k-link').trigger('click');

            setTimeout(function () {
                ok(isActivateRaised);
                start();
            }, 210);
        });

        test('disable method should disable disabled item', function() {
            var panel = getPanelBar();

            var item = getRootItem(2);

            panel.disable(item);

            ok(item.hasClass('k-state-disabled'));
        });

        test('enable method should enable disabled item', function() {
            var panel = getPanelBar();

            var item = getRootItem(3);

            panel.enable(item);

            ok(item.hasClass('k-state-default'));
        });

        test('collapse method should collapse last item', function() {

            var panel = getPanelBar();

            var item = getRootItem(4);

            panel.collapse(item);

            equal(item.find('> .k-group').css("display"), "none");
        });

        test('client object is available in on load', function() {
            ok(null !== onLoadPanelBar);
            ok(undefined !== onLoadPanelBar);
        });

        test('dataSource should create items with the text specified', function () {
            $("#panel2").kendoPanelBar({ dataSource: [ { text: "Item 1" } ] });

            equal($("#panel2").find(".k-item > .k-link:contains(Item 1)").length, 1);
        });

        test('dataSource should spawn arrows for items with group, content or contentUrl', function () {
            $("#panel2").kendoPanelBar({ dataSource: [ { text: "Item 1", content: "Test" }, { text: "Item 2", items: [] }, { text: "Item 3", contentUrl: "http://www.google.com" } ] });

            var icons = $("#panel2").find(".k-item > .k-link > .k-icon");

            ok(icons.eq(0).is(".k-panelbar-expand.k-i-arrow-s"));
            ok(icons.eq(1).is(".k-panelbar-expand.k-i-arrow-s"));
            ok(icons.eq(2).is(".k-panelbar-expand.k-i-arrow-s"));
        });

        test('dataSource should show collapse arrows for expanded items', function () {
            $("#panel2").kendoPanelBar({ dataSource: [ { text: "Item 1", content: "Test", expanded: true } ] });

            ok($("#panel2").find(".k-item > .k-link > .k-icon").is(".k-panelbar-collapse.k-i-arrow-n"));
        });

        test('setOptions resets the animation', function() {
            var p = new kendo.ui.PanelBar("<div />");

            ok(p.options.animation.expand.effects == "expand:vertical");

            p.setOptions({ animation: false });

            ok("effects" in p.options.animation.expand);
            ok(kendo.size(p.options.animation.expand.effects) == 0);
            p.destroy();
        });

        test('setOptions resets the dataSource object', function() {
            var p = new kendo.ui.PanelBar("<div />", { dataSource: [ { text: "Item 1" } ] });

            ok(p.element.find("li").text() == "Item 1");

            p.setOptions({ dataSource: [ { text: "Changed" } ] });

            ok(p.element.find("li").text() == "Changed");
            p.destroy();
        });

        test("Add dynamic item with cssClass", function () {
            var p = new kendo.ui.PanelBar("<ul></ul>");

            p.append({ text: "test", cssClass: "cssClass" });

            ok(p.element.find(".cssClass")[0]);
            p.destroy();
        });

        test("Adding dynamic content element renders properly on root and inner levels", function () {
            var p = new kendo.ui.PanelBar("<ul></ul>");

            p.append([
                {
                    text: "Item 1",
                    content: "Item 1 Content"
                },
                {
                    text: "Item 2",
                    items: [
                        {
                            text: "Sub Item 1",
                            content: "Sub Item 1 Content"
                        }
                    ]
                }
            ]);

            ok(p.element.children("li:first").children("div.k-content")[0]);
            ok(p.element.find("> li:last > ul > li:first").children("div.k-content")[0]);
            p.destroy();
        });

        test("Adding dynamic contentUrl element renders contents on root and inner levels", function () {
            var p = new kendo.ui.PanelBar("<ul></ul>");

            p.append([
                {
                    text: "Item 1",
                    contentUrl: "AjaxView1.html"
                },
                {
                    text: "Item 2",
                    items: [
                        {
                            text: "Sub Item 1",
                            contentUrl: "AjaxView2.html"
                        }
                    ]
                }
            ]);

            ok(p.element.children("li:first").children("div.k-content")[0]);
            ok(p.element.find("> li:last > ul > li:first").children("div.k-content")[0]);
            p.destroy();
        });

    </script>

    <h1 id="qunit-header">kendo.ui.PanelBar Tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
    <ul id="log"></ul>
</body>
</html>
