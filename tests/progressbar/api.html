<!DOCTYPE html>
<html>
    <head>
        <title>Progressbar tests</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.progressbar.js"></script>
        <script src="helper.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Progressbar API tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <script>
            var pb;

            function createProgressbar(options){
                createPbHtml();

                $("#progressbar").kendoProgressBar(options);
                return $("#progressbar").data("kendoProgressBar");
            }

            function moduleSetup() { 
                //pb = createProgressbar();
            }

            function moduleTeardown() { 
                removePbHtml();
            }

            // -----------------------------------------------------------------------------------
            // -----------------------------------------------------------------------------------
            module("value", {
                setup: function() {
                    moduleSetup();
                },
                teardown: function(){
                    moduleTeardown();
                }
            });

            test("value method returns the actual initial value", function () {
                pb = createProgressbar({
                    value: 50
                });

                equal(pb.value(), 50);
            });

            test("value method sets indeterminate state correctly when false is passed", function () {
                pb = createProgressbar({
                    value: 50
                });

                pb.value(false);

                equal(pb.value(), false);
            });

            test("value method does not set indeterminate state when true is passed", function () {
                pb = createProgressbar({
                    value: 50
                });

                pb.value(true);

                equal(pb.value(), 50);
            });

            test("value method sets value correctly when the value is between min and max", function () {
                pb = createProgressbar({
                    value: 50,
                    min: 20,
                    max: 60
                });

                pb.value(40);

                equal(pb.value(), 40);
            });

            test("value method sets value equal to max value when it is bigger than max", function () {
                pb = createProgressbar({
                    value: 50,
                    min: 20,
                    max: 60
                });

                pb.value(100);

                equal(pb.value(), pb.options.max);
            });

            test("value method sets value equal to min value when it is smaller than min", function () {
                pb = createProgressbar({
                    value: 50,
                    min: 20,
                    max: 60
                });

                pb.value(10);

                equal(pb.value(), pb.options.min);
            });

            test("value method sets the value when it is equal to min", function () {
                pb = createProgressbar({
                    value: 50,
                    min: 20,
                    max: 60
                });

                pb.value(20);

                equal(pb.value(), 20);
            });

            test("value method sets the value when it is equal to max", function () {
                pb = createProgressbar({
                    value: 50,
                    min: 20,
                    max: 60
                });

                pb.value(60);

                equal(pb.value(), 60);
            });

            asyncTest("Start event is fired when value is changed for the first time (type='value')", function() {
                var startFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "value",
                    start: function(){
                        startFired = true;
                    }
                });

                pb.value(30);

                setTimeout(function(){
                    ok(startFired);
                    start();
                }, 100);
            });

            asyncTest("Start event is fired only once (type='value')", function() {
                var startFiredCounter = 0;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "value",
                    start: function(){
                        startFiredCounter++;
                    }
                });

                pb.value(30);
                pb.value(50);

                setTimeout(function(){
                    equal(startFiredCounter, 1);
                    start();
                }, 100);
            });

            asyncTest("Start event is fired when value is changed for the first time (type='percent')", function() {
                var startFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "percent",
                    start: function(){
                        startFired = true;
                    }
                });

                pb.value(30);

                setTimeout(function(){
                    ok(startFired);
                    start();
                }, 100);
            });

            asyncTest("Start event is fired only once (type='percent')", function() {
                var startFiredCounter = 0;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "percent",
                    start: function(){
                        startFiredCounter++;
                    }
                });

                pb.value(30);
                pb.value(50);

                setTimeout(function(){
                    equal(startFiredCounter, 1);
                    start();
                }, 100);
            });

            asyncTest("Start event is fired when value is changed for the first time (type='chunk')", function() {
                var startFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "chunk",
                    start: function(){
                        startFired = true;
                    },
                    animation: false
                });

                pb.value(30);

                setTimeout(function(){
                    ok(startFired);
                    start();
                }, 100);
            });

            asyncTest("Start event is fired only once (type='chunk')", function() {
                var startFiredCounter = 0;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "chunk",
                    start: function(){
                        startFiredCounter++;
                    },
                    animation: false
                });

                pb.value(30);
                pb.value(50);

                setTimeout(function(){
                    equal(startFiredCounter, 1);
                    start();
                }, 100);
            });

            asyncTest("Complete event is not fired before max is reached (type='value')", function(){
                var completeFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "value",
                    complete: function(){
                        completeFired = true;
                    },
                    animation: false
                });

                pb.value(30);
                pb.value(50);
                pb.value(59);

                setTimeout(function(){
                    ok(!completeFired);
                    start();
                }, 100);
            });

            asyncTest("Complete event is fired when max is reached (type='value')", function(){
                var completeFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "value",
                    complete: function(){
                        completeFired = true;
                    },
                    animation: false
                });

                pb.value(50);
                pb.value(59);
                pb.value(60);

                setTimeout(function(){
                    ok(completeFired);
                    start();
                }, 100);
            });

            asyncTest("Complete event is fired only once (type='value')", function(){
                var completeFiredCounter = 0;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "value",
                    complete: function(){
                        completeFiredCounter++;
                    },
                    animation: false
                });

                pb.value(60);
                pb.value(60);
                pb.value(65);

                setTimeout(function(){
                    equal(completeFiredCounter, 1);
                    start();
                }, 100);
            });

            asyncTest("Complete event is not fired before max is reached (type='percent')", function(){
                var completeFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "percent",
                    complete: function(){
                        completeFired = true;
                    },
                    animation: false
                });

                pb.value(30);
                pb.value(50);
                pb.value(59);

                setTimeout(function(){
                    ok(!completeFired);
                    start();
                }, 100);
            });

            asyncTest("Complete event is fired when max is reached (type='percent')", function(){
                var completeFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "percent",
                    complete: function(){
                        completeFired = true;
                    },
                    animation: false
                });

                pb.value(50);
                pb.value(59);
                pb.value(60);

                setTimeout(function(){
                    ok(completeFired);
                    start();
                }, 100);
            });

            asyncTest("Complete event is fired only once (type='percent')", function(){
                var completeFiredCounter = 0;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "percent",
                    complete: function(){
                        completeFiredCounter++;
                    },
                    animation: false
                });

                pb.value(60);
                pb.value(60);
                pb.value(65);

                setTimeout(function(){
                    equal(completeFiredCounter, 1);
                    start();
                }, 100);
            });

            asyncTest("Complete event is not fired before max is reached (type='chunk')", function(){
                var completeFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "chunk",
                    complete: function(){
                        completeFired = true;
                    },
                    animation: false
                });

                pb.value(30);
                pb.value(50);
                pb.value(59);

                setTimeout(function(){
                    ok(!completeFired);
                    start();
                }, 100);
            });

            asyncTest("Complete event is fired when max is reached (type='chunk')", function(){
                var completeFired = false;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "chunk",
                    complete: function(){
                        completeFired = true;
                    },
                    animation: false
                });

                pb.value(50);
                pb.value(59);
                pb.value(60);

                setTimeout(function(){
                    ok(completeFired);
                    start();
                }, 100);
            });

            asyncTest("Complete event is fired only once (type='chunk')", function(){
                var completeFiredCounter = 0;

                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    type: "chunk",
                    complete: function() {
                        completeFiredCounter++;
                    },
                    animation: false
                });

                pb.value(60);
                pb.value(60);
                pb.value(65);

                setTimeout(function() {
                    equal(completeFiredCounter, 1);
                    start();
                }, 100);
            });

            asyncTest("k-progressbar-indeterminate class is set correctly when passed value is false", function(){
                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    animation: false
                });

                pb.value(false);

                setTimeout(function() {
                    ok(pb.wrapper.hasClass("k-progressbar-indeterminate"));
                    start();
                }, 100);
            });

            asyncTest("k-progressbar-indeterminate class is removed when previous value was false", function(){
                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: 20,
                    animation: false
                });

                pb.value(false);
                pb.value(40);

                setTimeout(function() {
                    ok(!pb.wrapper.hasClass("k-progressbar-indeterminate"));
                    start();
                }, 100);
            });

            asyncTest("k-progressbar-indeterminate class is removed when initial value was false", function(){
                pb = createProgressbar({
                    min: 20,
                    max: 60,
                    value: false,
                    animation: false
                });

                pb.value(40);

                setTimeout(function() {
                    ok(!pb.wrapper.hasClass("k-progressbar-indeterminate"));
                    start();
                }, 100);
            });


            // -----------------------------------------------------------------------------------
            // -----------------------------------------------------------------------------------
            module("enable", {
                setup: function() {
                    moduleSetup();
                },
                teardown: function() {
                    moduleTeardown();
                }
            });

            test("enable method renders k-state-disabled class when false is passed", function () {
                pb = createProgressbar();

                pb.enable(false);

                ok(pb.wrapper.hasClass("k-state-disabled"));
            });

            test("enable method removes k-state-disabled class when no parameter is passed", function () {
                pb = createProgressbar();

                pb.enable(false);
                pb.enable();

                ok(!pb.wrapper.hasClass("k-state-disabled"));
            });

            test("enable method removes k-state-disabled class when true is passed", function () {
                pb = createProgressbar();

                pb.enable(false);
                pb.enable(true);

                ok(!pb.wrapper.hasClass("k-state-disabled"));
            });

            test("enable method does not adds k-state-disabled class if not needed", function () {
                pb = createProgressbar();

                pb.enable();
                pb.enable(true);

                ok(!pb.wrapper.hasClass("k-state-disabled"));
            });

            test("enable method does not removes k-state-disabled class if not needed", function () {
                pb = createProgressbar();

                pb.enable(false);
                pb.enable(false);

                ok(pb.wrapper.hasClass("k-state-disabled"));
            });

            test("enable does not disable progressbar", function(){
                pb = createProgressbar();
                pb.enable();

                ok(!pb.wrapper.hasClass("k-state-disabled"));
            });

            test("initially disabled state is applied", function() {
                pb = createProgressbar({
                    enable: false
                });

                ok(pb.wrapper.hasClass("k-state-disabled"));
            });
        </script>
    </body>
</html>