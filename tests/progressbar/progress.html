<!DOCTYPE html>
<html>
    <head>
        <title>Progressbar tests</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.progressbar.js"></script>
        <script src="helper.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Progressbar API tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
        <script>
            var pb;

            function createProgressbar(options){
                createPbHtml();

                $("#progressbar").kendoProgressBar(options);
                return $("#progressbar").data("kendoProgressBar");
            }

            function moduleSetup() { 
                //pb = createProgressbar();
            }

            function moduleTeardown() { 
                removePbHtml();
            }

            // -----------------------------------------------------------------------------------
            // -----------------------------------------------------------------------------------
            module("Rendering", {
                setup: function() {
                    moduleSetup();
                },
                teardown: function(){
                    moduleTeardown();
                }
            });

            asyncTest("k-complete is added when the progress width is more than 98%", function() {
                var progressCompleted = false;

                pb = createProgressbar({
                    animation: {
                        duration: 50
                    },
                    complete: function(e){
                        progressCompleted = true;
                    }
                });

                pb.value(99);

                setTimeout(function(){
                    equal(pb.wrapper.find(".k-complete").length, 1);
                    start();
                }, 100);
            });

            asyncTest("k-complete is removed when the progress width becomes less than 98%", function() {
                var progressCompleted = false;

                pb = createProgressbar({
                    animation: {
                        duration: 50
                    },
                    complete: function(e){
                        progressCompleted = true;
                    }
                });

                pb.value(99);
                pb.value(90);

                setTimeout(function(){
                    equal(pb.wrapper.find(".k-complete").length, 0);
                    start();
                }, 100);
            });

            asyncTest("k-complete is not added when the progress width is less than or equal to 98%", function() {
                var progressCompleted = false;

                pb = createProgressbar({
                    animation: {
                        duration: 50
                    },
                    complete: function(e){
                        progressCompleted = true;
                    }
                });

                pb.value(98);

                setTimeout(function(){
                    equal(pb.wrapper.find(".k-complete").length, 0);
                    start();
                }, 100);
            });

            asyncTest("Complete event has correct value parameter (type='value')", function() {
                var value;

                pb = createProgressbar({
                    min: -50,
                    max: 165,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "value",
                    complete: function(e){
                        value = e.value;
                    }
                });

                pb.value(165);

                setTimeout(function() {
                    equal(value, pb.options.max);
                    start();
                }, 100);
            });

            asyncTest("Complete event has correct value parameter (type='percentage')", function() {
                var value;

                pb = createProgressbar({
                    min: -50,
                    max: 165,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "percentage",
                    complete: function(e){
                        value = e.value;
                    }
                });

                pb.value(165);

                setTimeout(function() {
                    equal(value, pb.options.max);
                    start();
                }, 100);
            });

            asyncTest("Complete event has correct value parameter (type='chunk')", function() {
                var value;

                pb = createProgressbar({
                    min: -50,
                    max: 165,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "chunk",
                    complete: function(e){
                        value = e.value;
                    }
                });

                pb.value(165);

                setTimeout(function() {
                    equal(value, pb.options.max);
                    start();
                }, 100);
            });

            asyncTest("Context is correctly set in complete event (type='value')", function() {
                var context;

                pb = createProgressbar({
                    min: -50,
                    max: 165,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "value",
                    complete: function(e){
                        context = this;
                    }
                });

                pb.value(165);

                setTimeout(function() {
                    equal(context, pb);
                    start();
                }, 100);
            });

            asyncTest("Context is correctly set in complete event (type='percentage')", function() {
                var context;

                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "percentage",
                    complete: function(e){
                        context = this;
                    }
                });

                pb.value(130);

                setTimeout(function() {
                    equal(context, pb);
                    start();
                }, 80);
            });

            asyncTest("Context is correctly set in complete event (type='chunk')", function() {
                var context;

                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "chunk",
                    complete: function(e){
                        context = this;
                    }
                });

                pb.value(130);

                setTimeout(function() {
                    equal(context, pb);
                    start();
                }, 80);
            });


            // -----------------------------------------------------------------------------------
            // -----------------------------------------------------------------------------------
            module("Rendering / Chunk progressbar", {
                setup: function() {
                    moduleSetup();
                },
                teardown: function(){
                    moduleTeardown();
                }
            });

            test("k-progressbar-reverse class is added to progressbar (type='chunk')", function() {
                pb = createProgressbar({
                    type: "chunk",
                    reverse: true
                });

                ok(pb.wrapper.hasClass("k-progressbar-reverse"));
            });

            test("Correct chunks are updated when progressbar is orientation:horizontal and reverse: false", function() {
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "horizontal",
                    reverse: false,
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5
                });

                pb.value(2);

                equal(pb.wrapper.find("li:lt(2)").filter(".k-state-selected").length, 2);
            });

            test("Correct chunks are updated when progressbar is orientation:horizontal and reverse: true", function() {
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "horizontal",
                    reverse: true,
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5
                });

                pb.value(2);

                equal(pb.wrapper.find("li:gt(2)").filter(".k-state-selected").length, 2);
            });

            test("Correct chunks are updated when progressbar is orientation:vertical and reverse: false", function() {
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "vertical",
                    reverse: false,
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5
                });

                pb.value(2);

                equal(pb.wrapper.find("li:gt(2)").filter(".k-state-selected").length, 2);
            });

            test("Correct chunks are updated when progressbar is orientation:vertical and reverse: true", function() {
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "vertical",
                    reverse: true,
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5
                });

                pb.value(2);

                equal(pb.wrapper.find("li:lt(2)").filter(".k-state-selected").length, 2);
            });

            test("Correct chunks are updated when progressbar is orientation:horizontal and reverse: false and value was decreased", 2, function() {
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "horizontal",
                    reverse: false,
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5
                });

                pb.value(4);
                pb.value(2);

                equal(pb.wrapper.find("li:lt(2)").filter(".k-state-selected").length, 2);
                equal(pb.wrapper.find(".k-state-default").length, 3);
            });

            test("Correct chunks are updated when progressbar is orientation:horizontal and reverse: true and value was decreased", 2, function() {
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "horizontal",
                    reverse: true,
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5
                });

                pb.value(4);
                pb.value(2);

                equal(pb.wrapper.find("li:gt(2)").filter(".k-state-selected").length, 2);
                equal(pb.wrapper.find(".k-state-default").length, 3);
            });

            test("Correct chunks are updated when progressbar is orientation:vertical and reverse: false and value was decreased", 2, function() {
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "vertical",
                    reverse: false,
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5
                });

                pb.value(4);
                pb.value(2);

                equal(pb.wrapper.find("li:gt(2)").filter(".k-state-selected").length, 2);
                equal(pb.wrapper.find(".k-state-default").length, 3);
            });

            test("Correct chunks are updated when progressbar is orientation:vertical and reverse: true and value was decreased", 2, function() {
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "vertical",
                    reverse: true,
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5
                });

                pb.value(4);
                pb.value(2);

                equal(pb.wrapper.find("li:lt(2)").filter(".k-state-selected").length, 2);
                equal(pb.wrapper.find(".k-state-default").length, 3);
            });

            test("k-state-selected class is added to the chunk list when the progress is completed for first time", function(){
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "horizontal",
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5,
                });

                pb.value(5);

                ok(pb.wrapper.find("ul.k-reset").hasClass("k-state-selected"));
            });

            test("k-state-selected class is removed from the chunk list when the progress is completed and then reversed", function(){
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "horizontal",
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5,
                });

                pb.value(5);
                pb.value(2);

                ok(!pb.wrapper.find("ul.k-reset").hasClass("k-state-selected"));
            });

            test("k-state-selected class is added again to the chunk list when the progress is completed again", function(){
                pb = createProgressbar({
                    type: "chunk",
                    orientation: "horizontal",
                    min: 0,
                    max: 5,
                    value: 0,
                    chunkCount: 5,
                });

                pb.value(5);
                pb.value(2);
                pb.value(5);

                ok(pb.wrapper.find("ul.k-reset").hasClass("k-state-selected"));
            });


            // -----------------------------------------------------------------------------------
            // -----------------------------------------------------------------------------------
            module("Rendering / Regular progressbar", {
                setup: function() {
                    moduleSetup();
                },
                teardown: function(){
                    moduleTeardown();
                }
            });

            asyncTest("Progress status wrapper is hidden when value is set to min and showStatus is true (type: 'value')", function() {
                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: 100,
                    animation: {
                        duration: 50
                    },
                    type: "value",
                    showStatus: true
                });

                pb.value(-50);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:hidden").length, 1);
                    start();
                }, 80);
            });

            asyncTest("Progress status wrapper is hidden when value is set to min and showStatus is true (type: 'percentage')", function() {
                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: 100,
                    animation: {
                        duration: 50
                    },
                    type: "percentage",
                    showStatus: true
                });

                pb.value(-50);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:hidden").length, 1);
                    start();
                }, 80);
            });

            asyncTest("Progress status wrapper is hidden when value is set to min and showStatus is false (type: 'value')", function() {
                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: 100,
                    animation: {
                        duration: 50
                    },
                    type: "value",
                    showStatus: false
                });

                pb.value(-50);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:hidden").length, 1);
                    start();
                }, 80);
            });

            asyncTest("Progress status wrapper is hidden when value is set to min and showStatus is false (type: 'percentage')", function() {
                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: 100,
                    animation: {
                        duration: 50
                    },
                    type: "percentage",
                    showStatus: false
                });

                pb.value(-50);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:hidden").length, 1);
                    start();
                }, 80);
            });

            asyncTest("Progress status wrapper is appended when initial value is set to min and then changed, showStatus is true (type: 'value')", function() {
                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "value",
                    showStatus: true
                });

                pb.value(-20);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:visible").length, 1);
                    start();
                }, 80);
            });

            asyncTest("Progress status wrapper is appended when initial value is set to min and then changed, showStatus is true (type: 'percentage')", function() {
                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "percentage",
                    showStatus: true
                });

                pb.value(-20);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:visible").length, 1);
                    start();
                }, 80);
            });

            asyncTest("Progress status wrapper is appended when initial value is set to min and then changed, showStatus is false (type: 'value')", function() {
                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "value",
                    showStatus: false
                });

                pb.value(-20);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:visible").length, 1);
                    start();
                }, 80);
            });

            asyncTest("Progress status wrapper is appended when initial value is set to min and then changed, showStatus is false (type: 'percentage')", function() {
                pb = createProgressbar({
                    min: -50,
                    max: 130,
                    value: -50,
                    animation: {
                        duration: 50
                    },
                    type: "percentage",
                    showStatus: false
                });

                pb.value(-20);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:visible").length, 1);
                    start();
                }, 80);
            });

            asyncTest("Progress status wrapper is shown again when hidden once, showStatus is true (type: 'value')", function() {
                pb = createProgressbar({
                    min: 0,
                    max: 130,
                    value: 0,
                    animation: {
                        duration: 10
                    },
                    type: "value",
                    showStatus: true
                });

                pb.value(20);
                pb.value(0);
                pb.value(50);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:visible").length, 1);
                    start();
                }, 100);
            });

            asyncTest("Progress status wrapper is shown again when hidden once, showStatus is true (type: 'percentage')", function() {
                pb = createProgressbar({
                    min: 0,
                    max: 130,
                    value: 0,
                    animation: {
                        duration: 10
                    },
                    type: "percentage",
                    showStatus: true
                });

                pb.value(20);
                pb.value(0);
                pb.value(50);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:visible").length, 1);
                    start();
                }, 100);
            });

            asyncTest("Progress status wrapper is shown again when hidden once, showStatus is false (type: 'value')", function() {
                pb = createProgressbar({
                    min: 0,
                    max: 130,
                    value: 0,
                    animation: {
                        duration: 10
                    },
                    type: "value",
                    showStatus: false
                });

                pb.value(20);
                pb.value(0);
                pb.value(50);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:visible").length, 1);
                    start();
                }, 100);
            });

            asyncTest("Progress status wrapper is shown again when hidden once, showStatus is false (type: 'percentage')", function() {
                pb = createProgressbar({
                    min: 0,
                    max: 130,
                    value: 0,
                    animation: {
                        duration: 10
                    },
                    type: "percentage",
                    showStatus: false
                });

                pb.value(20);
                pb.value(0);
                pb.value(50);

                setTimeout(function() {
                    equal(pb.wrapper.find(".k-state-selected:visible").length, 1);
                    start();
                }, 100);
            });
        </script>
    </body>
</html>