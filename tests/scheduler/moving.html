<!DOCTYPE html>
<html>
    <head>
        <title>Scheduler Moving</title>
        <link href="../../styles/web/kendo.common.min.css" rel="stylesheet" />
        <link href="../../styles/web/kendo.default.min.css" rel="stylesheet" />
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit/addons/close-enough/qunit-close-enough.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.draganddrop.js"></script>
        <script src="../../src/kendo.validator.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <script src="../../src/kendo.editable.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.tooltip.js"></script>
        <script src="../../src/kendo.list.js"></script>
        <script src="../../src/kendo.dropdownlist.js"></script>
        <script src="../../src/kendo.multiselect.js"></script>
        <script src="../../src/kendo.calendar.js"></script>
        <script src="../../src/kendo.window.js"></script>
        <script src="../../src/kendo.scheduler.view.js"></script>
        <script src="../../src/kendo.scheduler.dayview.js"></script>
        <script src="../../src/kendo.scheduler.agendaview.js"></script>
        <script src="../../src/kendo.scheduler.monthview.js"></script>
        <script src="../../src/kendo.scheduler.recurrence.js"></script>
        <script src="../../src/kendo.scheduler.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Scheduler Moving</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var div = $("<div>").width(500).height(1000);

            function equalWithRound(value, expected) {
                QUnit.close(value, expected, 3);
            }

            module("moving", {
                setup: function() {
                    div.appendTo(document.body);
                },
                teardown: function() {
                    div.kendoScheduler("destroy").empty().remove();
                    $("[data-role=window]").kendoWindow("destroy").remove();
                }
            });

            test("hint shows start and end time when moving event in week view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle, handle.offset());
                drag(scheduler, handle, slots.eq(1).offset());

                equal($(".k-event-drag-hint dt").text(), "10:30 AM - 11:30 AM");
            });

            test("hint shows north icon when start time is before the start of the view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle, slots.eq(1).offset());

                drag(scheduler, handle, slots.eq(0).offset());

                equal($(".k-event-drag-hint .k-i-arrow-n").length, 1);
            });

            test("hint shows west icon when start time is before the start of the view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/3 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragstart(scheduler, handle, slots.eq(1).offset());

                drag(scheduler, handle, slots.eq(0).offset());

                equal($(".k-event-drag-hint .k-i-arrow-w").length, 1);
            });

            test("hint shows east icon when end time is after the end of the view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/7 10:00"), end: new Date("2013/6/8 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragstart(scheduler, handle, slots.eq(5).offset());

                drag(scheduler, handle, slots.eq(6).offset());

                equal($(".k-event-drag-hint .k-i-arrow-e").length, 1);
            });

            test("hint shows south icon when end time is after the end of the view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    endTime: new Date("2013/6/6 11:30"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle, handle.offset());

                drag(scheduler, handle, slots.last().offset());

                equal($(".k-event-drag-hint .k-i-arrow-s").length, 1);
            });

            test("hint shows east icon when the start time is before the start of the month view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/5/26 10:00"), end: new Date("2013/5/27 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle, slots.eq(1).offset());

                drag(scheduler, handle, slots.first().offset());

                equal($(".k-event-drag-hint .k-i-arrow-e").length, 1);
            });

            test("moving the occurrence changes the start of the series if the edit series button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/5/26 11:00"), end: new Date("2013/5/26 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-event:last");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                $(".k-window .k-button:last").click();

                equal(scheduler.dataSource.at(0).start.getHours(), 11);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 28);
                equal(scheduler.dataSource.at(0).start.getMonth(), 4);
            });

            test("moving the occurrence changes the start of the exception if the edit occurence button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 11:00"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/5/26 11:00"), end: new Date("2013/5/26 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-event:last");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                $(".k-window .k-button:first").click();

                equal(scheduler.dataSource.at(1).start.getHours(), 11);
                equal(scheduler.dataSource.at(1).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(1).start.getDate(), 28);
                equal(scheduler.dataSource.at(1).start.getMonth(), 4);
            });

            test("moving the recurrence head changes the start of the series if the edit series button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/5/26 11:00"), end: new Date("2013/5/26 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-event:first");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(1));

                $(".k-window .k-button:last").click();

                equal(scheduler.dataSource.at(0).start.getHours(), 11);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 27);
                equal(scheduler.dataSource.at(0).start.getMonth(), 4);
            });

            test("moving the recurrence head changes the start of the exception if the edit occurence button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 11:00"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/5/26 11:00"), end: new Date("2013/5/26 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-event:first");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                $(".k-window .k-button:first").click();

                equal(scheduler.dataSource.at(1).start.getHours(), 11);
                equal(scheduler.dataSource.at(1).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(1).start.getDate(), 28);
                equal(scheduler.dataSource.at(1).start.getMonth(), 4);
            });

            test("hint shows west icon when the end time is after the end of the month view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/7/5 10:00"), end: new Date("2013/7/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle, slots.last().prev().offset());

                drag(scheduler, handle, slots.last().offset());

                equal($(".k-event-drag-hint .k-i-arrow-w").length, 1);
            });

            test("moving event in day view changes its start time", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 30);
                equal(scheduler.dataSource.at(0).start.getDate(), 6);
            });

            test("moving event pass the end of the view when the view ends at 12:00 AM", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 17:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 11:00 PM"), end: new Date("2013/6/7 12:00 AM"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.last());

                equal(scheduler.dataSource.at(0).start.getHours(), 23);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 30);
                equal(scheduler.dataSource.at(0).start.getDate(), 6);
                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 30);
                equal(scheduler.dataSource.at(0).end.getDate(), 7);
            });

            test("moving event in day view changes its end time", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:10"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).end.getHours(), 10);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 40);
                equal(scheduler.dataSource.at(0).end.getDate(), 6);
            });

            test("moving event in week before the start of the view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                var offset = handle.offset();

                offset.top += slots.first().outerHeight();

                dragdrop(scheduler, handle, offset, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 9);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 30);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
                equal(scheduler.dataSource.at(0).end.getHours(), 10);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 30);
                equal(scheduler.dataSource.at(0).end.getDate(), 3);
            });

            test("moving all day event in week view before the start of the view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/3 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-header-all-day td");

                var offset = handle.offset();

                offset.left += slots.first().outerWidth();

                dragdrop(scheduler, handle, offset, slots.first());

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 1);
                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).end.getDate(), 2);
            });

            test("moving all day event in week view after the end of the view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/7 10:00"), end: new Date("2013/6/8 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragdrop(scheduler, handle, slots.last());

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 8);
                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).end.getDate(), 9);
            });

            test("moving event in week after the end of the view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    endTime: new Date("2013/6/6 11:30"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td:nth-child(1)");

                var offset = handle.offset();

                dragdrop(scheduler, handle, offset, slots.last());

                equal(scheduler.dataSource.at(0).start.getHours(), 11);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 2);
                equal(scheduler.dataSource.at(0).end.getHours(), 12);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).end.getDate(), 2);
            });

            test("moving all day event in week view changes its start and end time", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 8:00"),
                    views: ["week"],
                    dataSource: [
                        { isAllDay: true, start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 10:10"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
                equal(scheduler.dataSource.at(0).end.getHours(), 10);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 10);
                equal(scheduler.dataSource.at(0).end.getDate(), 3);
            });

            test("moving all day event in week view changes its start and end time relative to the current slot", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { isAllDay: true, start: new Date("2013/6/2 10:00"), end: new Date("2013/6/4 10:10"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-header-all-day td");

                var offset = handle.offset();

                offset.top += slots.first().outerWidth();

                dragdrop(scheduler, handle, offset, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
                equal(scheduler.dataSource.at(0).end.getHours(), 10);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 10);
                equal(scheduler.dataSource.at(0).end.getDate(), 5);
            });

            test("moving event in month view changes its start and end time", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 10:10"), title: "" }
                    ]
                });

                var slots = div.find(".k-scheduler-content td:nth-child(2)");
                var handle = div.find(".k-event");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
                equal(scheduler.dataSource.at(0).end.getHours(), 10);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 10);
                equal(scheduler.dataSource.at(0).end.getDate(), 3);
            });


            test("moving event in month view changes its start and end time relatively to the current slot", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/4 10:10"), title: "" }
                    ]
                });

                var slots = div.find(".k-scheduler-content td:nth-child(3)");
                var handle = div.find(".k-event");

                var offset = handle.offset();

                offset.left += slots.first().outerWidth() + 10;

                dragdrop(scheduler, handle, offset, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
                equal(scheduler.dataSource.at(0).end.getHours(), 10);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 10);
                equal(scheduler.dataSource.at(0).end.getDate(), 5);
            });

            test("moving event in month view before the view start", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/5/26 10:00"), end: new Date("2013/5/27 10:10"), title: "" }
                    ]
                });

                var slots = div.find(".k-scheduler-content td:nth-child(1)");
                var handle = div.find(".k-event");

                var offset = handle.offset();

                offset.left += slots.first().outerWidth() + 10;

                dragdrop(scheduler, handle, offset, slots.eq(0));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 25);
                equal(scheduler.dataSource.at(0).start.getMonth(), 4);
                equal(scheduler.dataSource.at(0).end.getHours(), 10);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 10);
                equal(scheduler.dataSource.at(0).end.getDate(), 26);
                equal(scheduler.dataSource.at(0).end.getMonth(), 4);
            });

            test("moving event which starts before the start of the month view by its last slot", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/5/24 9:00 PM"), end: new Date("2013/5/26 12:00 AM"), title: "" }
                    ]
                });

                var slots = div.find(".k-scheduler-content td:nth-child(2)");
                var handle = div.find(".k-event");

                dragdrop(scheduler, handle, slots.eq(0));

                equal(scheduler.dataSource.at(0).start.getHours(), 21);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 25);
                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 27);
            });

            test("moving event which ends after the end of the month view by its first slot", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/7/5 9:00 PM"), end: new Date("2013/7/7 12:00 AM"), title: "" }
                    ]
                });

                var slots = div.find(".k-scheduler-content td:nth-child(7)");
                var handle = div.find(".k-event");

                dragdrop(scheduler, handle, slots.last());

                equal(scheduler.dataSource.at(0).start.getHours(), 21);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 6);
                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 8);
            });

            test("moving event which starts before the start of the month view by its middle slot", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/5/25 9:00 PM"), end: new Date("2013/5/27 12:00 AM"), title: "" }
                    ]
                });

                var slots = div.find(".k-scheduler-content td:nth-child(2)");
                var handle = div.find(".k-event");

                dragdrop(scheduler, handle, slots.eq(0));

                equal(scheduler.dataSource.at(0).start.getHours(), 21);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 26);
                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 28);
            });

            test("moving event in month view after the view start", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/7/5 10:00"), end: new Date("2013/7/6 10:10"), title: "" }
                    ]
                });

                var slots = div.find(".k-scheduler-content td:nth-child(7)");
                var handle = div.find(".k-event");

                dragdrop(scheduler, handle, slots.eq(5));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 6);
                equal(scheduler.dataSource.at(0).start.getMonth(), 6);
                equal(scheduler.dataSource.at(0).end.getHours(), 10);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 10);
                equal(scheduler.dataSource.at(0).end.getDate(), 7);
                equal(scheduler.dataSource.at(0).end.getMonth(), 6);
            });

            test("moving event which ends after the end of the month view by its first slot", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/7/4 9:00 PM"), end: new Date("2013/7/7 12:00 AM"), title: "" }
                    ]
                });

                var slots = div.find(".k-scheduler-content td:nth-child(6)");
                var handle = div.find(".k-event");

                dragdrop(scheduler, handle, slots.last());

                equal(scheduler.dataSource.at(0).start.getHours(), 21);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 5);
                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 8);
            });

            test("moving event in week view changes its start and end time relatively to the current slot", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 11:10"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                var offset = handle.offset();

                offset.top += slots.first().outerHeight();

                dragdrop(scheduler, handle, offset, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 00);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 10);
                equal(scheduler.dataSource.at(0).end.getDate(), 3);
            });

            test("dragging and dropping doesn't change the event time if editable is set to false", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    editable: false,
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
            });

            test("dragging and dropping doesn't change the event time if editable.move is set to false", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    editable: { move: false },
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
            });

            test("the move hint is in the right resource group", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    startTime: new Date("2013/6/6 10:00"),
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 10:30"), ownerId: 2, title: "" }
                    ],
                    group: {
                        resources: ["Owner"]
                    },
                    resources: [
                        {
                            field: "ownerId",
                            name: "Owner",
                            dataSource: [
                                { text: "Alex", value: 1, color: "red" },
                                { text: "Bob", value: 2, color: "green" }
                            ],
                            title: "Owner"
                        }
                   ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-content td:nth-child(8)");

                dragstart(scheduler, handle, handle.offset());

                drag(scheduler, handle, slots.eq(1).offset());

                equalWithRound(div.find(".k-event-drag-hint").offset().left, slots.eq(1).offset().left);
                equalWithRound(div.find(".k-event-drag-hint").offset().top, slots.eq(1).offset().top);
            });

            test("the move hint is in the right resource group when moving all day event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    startTime: new Date("2013/6/6 10:00"),
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 10:30"), isAllDay: true, ownerId: 2, title: "" }
                    ],
                    group: {
                        resources: ["Owner"]
                    },
                    resources: [
                        {
                            field: "ownerId",
                            name: "Owner",
                            dataSource: [
                                { text: "Alex", value: 1, color: "red" },
                                { text: "Bob", value: 2, color: "green" }
                            ],
                            title: "Owner"
                        }
                   ]
                });

                var handle = div.find(".k-event");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragstart(scheduler, handle, handle.offset());

                drag(scheduler, handle, slots.eq(8).offset());

                equalWithRound(div.find(".k-event-drag-hint").offset().left, slots.eq(8).offset().left);
                equalWithRound(div.find(".k-event-drag-hint").offset().top, slots.eq(8).offset().top);
            });

            test("the move hint is in the right vertical resource group when moving all day event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    startTime: new Date("2013/6/6 10:00"),
                    endTime: new Date("2013/6/6 11:00"),
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 10:30"), isAllDay: true, ownerId: 1, title: "" },
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 10:30"), isAllDay: true, ownerId: 2, title: "" }
                    ],
                    group: {
                        resources: ["Owner"],
                        direction: "vertical"
                    },
                    resources: [
                        {
                            field: "ownerId",
                            name: "Owner",
                            dataSource: [
                                { text: "Alex", value: 1, color: "red" },
                                { text: "Bob", value: 2, color: "green" }
                            ],
                            title: "Owner"
                        }
                   ]
                });

                var handle = div.find(".k-event:last");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragstart(scheduler, handle, handle.offset());

                drag(scheduler, handle, slots.eq(3).offset());

                equalWithRound(div.find(".k-event-drag-hint").offset().left, slots.eq(3).offset().left);
                equalWithRound(div.find(".k-event-drag-hint").offset().top, slots.eq(3).offset().top);
            });

            test("the move hint is in the right vertical resource group when moving events", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    startTime: new Date("2013/6/6 10:00"),
                    endTime: new Date("2013/6/6 11:00"),
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 10:00"), end: new Date("2013/6/2 10:30"), ownerId: 2, title: "" }
                    ],
                    group: {
                        resources: ["Owner"],
                        direction: "vertical"
                    },
                    resources: [
                        {
                            field: "ownerId",
                            name: "Owner",
                            dataSource: [
                                { text: "Alex", value: 1, color: "red" },
                                { text: "Bob", value: 2, color: "green" }
                            ],
                            title: "Owner"
                        }
                   ]
                });

                var handle = div.find(".k-event:last");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragstart(scheduler, handle, handle.offset());

                drag(scheduler, handle, slots.eq(4).offset());

                equalWithRound(div.find(".k-event-drag-hint").offset().left, slots.eq(4).offset().left);
                equalWithRound(div.find(".k-event-drag-hint").offset().top, slots.eq(4).offset().top);
            });

            test("moving event between groups changes its resource", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    startTime: new Date("2013/6/6 10:00"),
                    endTime: new Date("2013/6/6 11:00"),
                    date: new Date("2013/6/6"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:30"), ownerId: 2, title: "" }
                    ],
                    group: {
                        resources: ["Owner"]
                    },
                    resources: [
                        {
                            field: "ownerId",
                            name: "Owner",
                            dataSource: [
                                { text: "Alex", value: 1, color: "red" },
                                { text: "Bob", value: 2, color: "green" }
                            ],
                            title: "Owner"
                        }
                   ]
                });

                var handle = div.find(".k-event:last");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(0).prev());

                equal(scheduler.dataSource.at(0).ownerId, 1);
            });

            test("moving event between vertical groups changes its resource", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    startTime: new Date("2013/6/6 10:00"),
                    endTime: new Date("2013/6/6 11:00"),
                    date: new Date("2013/6/6"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:30"), ownerId: 2, title: "" }
                    ],
                    group: {
                        resources: ["Owner"],
                        direction: "vertical"
                    },
                    resources: [
                        {
                            field: "ownerId",
                            name: "Owner",
                            dataSource: [
                                { text: "Alex", value: 1, color: "red" },
                                { text: "Bob", value: 2, color: "green" }
                            ],
                            title: "Owner"
                        }
                   ]
                });

                var handle = div.find(".k-event:last");

                var slots = div.find(".k-scheduler-content td:nth-child(1)");

                dragdrop(scheduler, handle, slots.eq(2));

                equal(scheduler.dataSource.at(0).ownerId, 1);
            });

            function dragdrop(scheduler, target, offset, to) {
                if (!to) {
                    to = offset;
                    offset = target.offset();
                }

                dragstart(scheduler, target, offset);
                drag(scheduler, target, to.offset());
                dragend(scheduler, target, to.offset());
            }

            function dragstart(scheduler, target, offset) {
                var draggable = scheduler._moveDraggable;

                if (!draggable) {
                    return;
                }

                draggable.trigger("dragstart", {
                    currentTarget: target,
                    x: { location: offset.left },
                    y: { location: offset.top }
                });
            }

            function drag(scheduler, target, offset) {
                var draggable = scheduler._moveDraggable;

                if (!draggable) {
                    return;
                }

                draggable.trigger("drag", {
                    currentTarget: target,
                    x: { location: offset.left },
                    y: { location: offset.top }
                });
            }

            function dragend(scheduler, target, offset) {
                var draggable = scheduler._moveDraggable;

                if (!draggable) {
                    return;
                }

                draggable.trigger("dragend", {
                    currentTarget: target,
                    x: { location: offset.left },
                    y: { location: offset.top }
                });
            }
        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
