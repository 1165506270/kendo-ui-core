<!DOCTYPE html>
<html>
    <head>
        <title>Recurrence dates</title>
        <script src="../jquery-loader.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.scheduler.recurrence.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Scheduler initialization</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var occurrences = kendo.recurrence.expand;

            module("Cloning scheduler event");
            test("Occurrence clones original event", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY"
                }

                var event = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 11, 17) } )[1];

                equal(event.uid, ""); //???
                equal(event.title, schedulerEvent.title);
                equal(event.rule, schedulerEvent.rule);
                equal(event.recurrenceID, schedulerEvent.uid);
                equal(event.start.getTime(), +new Date(2000, 10, 11, 16, 30));
                equal(event.end.getTime(), +new Date(2000, 10, 11, 17, 0));
            });

            module("HOURLY Occurrences");
            test("HOURLY occurrences method repeat event in one hour", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 0),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=HOURLY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 10, 18) } );

                equal(events.length, 3);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 0));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));

                equal(events[1].start.getTime(), +new Date(2000, 10, 10, 17, 0));
                equal(events[1].end.getTime(), +new Date(2000, 10, 10, 18, 0));

                equal(events[2].start.getTime(), +new Date(2000, 10, 10, 18, 0));
                equal(events[2].end.getTime(), +new Date(2000, 10, 10, 19, 0));
            });

            test("HOURLY occurrences method repeat event every 3 hours", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 0),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=HOURLY;INTERVAL=3"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 10, 20) } );

                equal(events.length, 2);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 0));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));

                equal(events[1].start.getTime(), +new Date(2000, 10, 10, 19, 0));
                equal(events[1].end.getTime(), +new Date(2000, 10, 10, 20, 0));
            });

            test("HOURLY method limits BYHOUR", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 0),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=HOURLY;BYHOUR=10,19"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 10, 20) } );

                equal(events.length, 1);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 19, 0));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 20, 0));
            });

            test("HOURLY method limits BYHOUR and expands BYMINUTE", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 10, 0),
                    end: new Date(2000, 10, 10, 11, 0),
                    rule: "FREQ=HOURLY;BYHOUR=10;BYMINUTE=20,40"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 10, 20) } );

                equal(events.length, 2);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 10, 20));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 11, 20));

                equal(events[1].start.getTime(), +new Date(2000, 10, 10, 10, 40));
                equal(events[1].end.getTime(), +new Date(2000, 10, 10, 11, 40));
            });

            test("HOURLY method limits BYHOUR and expands BYSECOND", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 10, 0),
                    end: new Date(2000, 10, 10, 11, 0),
                    rule: "FREQ=HOURLY;BYHOUR=10;BYMINUTE=20,40;BYSECOND=30"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 10, 20) } );

                equal(events.length, 2);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 10, 20, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 11, 20, 30));

                equal(events[1].start.getTime(), +new Date(2000, 10, 10, 10, 40, 30));
                equal(events[1].end.getTime(), +new Date(2000, 10, 10, 11, 40, 30));
            });

            module("DAILY Occurrences");
            test("DAILY occurrences method returns one occurrence (FREQ: DAILY)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 11, 17) } );

                equal(events.length, 2);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 10, 11, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 10, 11, 17, 0));
            });
            test("DAILY occurrences method returns multiple occurrences (FREQ: DAILY)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 16, 17) } );

                equal(events.length, 7);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));

                equal(events[6].recurrenceID, schedulerEvent.uid);
                equal(events[6].start.getTime(), +new Date(2000, 10, 16, 16, 30));
                equal(events[6].end.getTime(), +new Date(2000, 10, 16, 17, 0));
            });

            test("DAILY occurrences method honours interval rule (FREQ: DAILY)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY;INTERVAL=2"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 16, 17) } );

                equal(events.length, 4);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 10, 12, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 10, 12, 17, 0));

                equal(events[3].recurrenceID, schedulerEvent.uid);
                equal(events[3].start.getTime(), +new Date(2000, 10, 16, 16, 30));
                equal(events[3].end.getTime(), +new Date(2000, 10, 16, 17, 0));
            });

            test("DAILY occurrences method honours COUNT", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY;COUNT=2"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 16) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 10, 11, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 10, 11, 17, 0));
            });

            test("DAILY occurrences method honours UNTIL", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY;UNTIL=20001111T090000"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 16) } );

                equal(events.length, 1);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));
            });

            test("DAILY occurrences method returns empty array if not valid rule", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "UNTIL=20001111T090000"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 16) } );

                equal(events.length, 0);
            });

            test("DAILY occurrences method returns empty array if range is before the event", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY;UNTIL=20001111T090000"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 9, 12), end: new Date(2000, 9, 16) } );

                equal(events.length, 0);
            });

            test("DAILY occurrences method limits BYMONTH", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY;BYMONTH=11"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 30), end: new Date(2000, 11, 1, 17) } );

                equal(events.length, 1);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 30, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 30, 17, 0));
            });

            test("DAILY occurrences method limits BYMONTHDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY;BYMONTHDAY=10,13,15"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 16) } );

                equal(events.length, 3);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 10, 13, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 10, 13, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2000, 10, 15, 16, 30));
                equal(events[2].end.getTime(), +new Date(2000, 10, 15, 17, 0));
            });

            test("DAILY occurrences method limits BYMONTHDAY (-3, 10)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 4, 10, 16, 30),
                    end: new Date(2013, 4, 10, 17, 0),
                    rule: "FREQ=DAILY;BYMONTHDAY=-3,10"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 4, 1), end: new Date(2013, 4, 30) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 4, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 4, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 4, 27, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 4, 27, 17, 0));
            });

            test("DAILY occurrences method limits BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY;BYDAY=SU, MO"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 13, 17) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 12, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 12, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 10, 13, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 10, 13, 17, 0));
            });

            test("DAILY occurrences method limits BYDAY (2FR)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY;BYDAY=3FR"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 13) } );

                equal(events.length, 0);
            });

            test("DAILY occurrences method limits BYDAY (-3FR)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 4, 10, 16, 30),
                    end: new Date(2013, 4, 10, 17, 0),
                    rule: "FREQ=DAILY;BYDAY=-3FR"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 4, 10), end: new Date(2013, 4, 24) } );

                equal(events.length, 1);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 4, 17, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 4, 17, 17, 0));
            });

            test("DAILY occurrences method returns empty array if no such day", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 4, 10, 16, 30),
                    end: new Date(2013, 4, 10, 17, 0),
                    rule: "FREQ=DAILY;BYDAY=5FR"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 4, 10), end: new Date(2013, 4, 24) } );

                equal(events.length, 0);
            });

            test("DAILY occurrences method honours INTERVAL=2", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 4, 10, 16, 30),
                    end: new Date(2013, 4, 10, 17, 0),
                    rule: "FREQ=DAILY;INTERVAL=2"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 4, 10), end: new Date(2013, 4, 17) } );
                equal(events.length, 4);
            });

            test("DAILY occurrences method honours BYDAY and INTERVAL", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 4, 17, 16, 30),
                    end: new Date(2013, 4, 17, 17, 0),
                    rule: "FREQ=DAILY;BYDAY=TU,TH;INTERVAL=2;"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 4, 17), end: new Date(2013, 5, 8) } );
                equal(events.length, 4);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 4, 21, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 4, 21, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 4, 23, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 4, 23, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2013, 5, 4, 16, 30));
                equal(events[2].end.getTime(), +new Date(2013, 5, 4, 17, 0));

                equal(events[3].recurrenceID, schedulerEvent.uid);
                equal(events[3].start.getTime(), +new Date(2013, 5, 6, 16, 30));
                equal(events[3].end.getTime(), +new Date(2013, 5, 6, 17, 0));
            });

            test("DAILY limit by BYMONTH and BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYMONTH=6;BYDAY=TU,TH"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 24), end: new Date(2013, 6, 10, 17) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 25, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 5, 25, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 27, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 5, 27, 17, 0));
            });

            test("DAILY expands BYHOUR", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYHOUR=8,18"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 11, 17) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 18, 30));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 19, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 11, 8, 30));
                equal(events[1].end.getTime(), +new Date(2013, 5, 11, 9, 0));
            });

            test("DAILY expands BYHOUR and BYMINUTE", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYHOUR=8;BYMINUTE=15,45"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 11, 17) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 11, 8, 15));
                equal(events[0].end.getTime(), +new Date(2013, 5, 11, 8, 45));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 11, 8, 45));
                equal(events[1].end.getTime(), +new Date(2013, 5, 11, 9, 15));
            });

            test("DAILY expands BYHOUR and BYMINUTE (honours start hours and minutes)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYHOUR=16;BYMINUTE=15,45"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 10, 17) } );

                equal(events.length, 1);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 16, 45));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 17, 15));
            });

            test("DAILY expands BYHOUR and BYMINUTE (BYHOUR === current hour and minute < current minute)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYHOUR=16;BYMINUTE=15"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 11, 17) } );

                equal(events.length, 1);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 11, 16, 15));
                equal(events[0].end.getTime(), +new Date(2013, 5, 11, 16, 45));
            });

            test("DAILY expands BYMINUTE", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYMINUTE=15"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 10, 19) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 17, 15));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 17, 45));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 10, 18, 15));
                equal(events[1].end.getTime(), +new Date(2013, 5, 10, 18, 45));
            });

            test("DAILY expands BYHOUR and BYMINUTE (two minute rules)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYHOUR=17;BYMINUTE=20,40"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 10, 17, 50) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 17, 20));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 17, 50));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 10, 17, 40));
                equal(events[1].end.getTime(), +new Date(2013, 5, 10, 18, 10));
            });

            test("DAILY expands BYSECONDS", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYSECOND=20,40"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 10, 16, 31) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 16, 30, 20));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 17, 0, 20));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 10, 16, 30, 40));
                equal(events[1].end.getTime(), +new Date(2013, 5, 10, 17, 0, 40));
            });

            test("DAILY expands BYMINUTE and BYSECOND", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30, 40),
                    end: new Date(2000, 5, 10, 17, 0, 40),
                    rule: "FREQ=DAILY;BYMINUTE=40;BYSECOND=40"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 10, 16, 50) } );

                equal(events.length, 1);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 16, 40, 40));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 17, 10, 40));
            });

            test("DAILY expands BYMINUTE and BYSECOND (two second rules)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30, 40),
                    end: new Date(2000, 5, 10, 17, 0, 40),
                    rule: "FREQ=DAILY;BYMINUTE=40;BYSECOND=20,40"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 10, 16, 50) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 16, 40, 20));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 17, 10, 20));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 10, 16, 40, 40));
                equal(events[1].end.getTime(), +new Date(2013, 5, 10, 17, 10, 40));
            });

            test("DAILY expands BYDAY and BYHOUR", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=DAILY;BYDAY=TU;BYHOUR=10, 12"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 11, 16, 50) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 11, 10, 30));
                equal(events[0].end.getTime(), +new Date(2013, 5, 11, 11));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 11, 12, 30));
                equal(events[1].end.getTime(), +new Date(2013, 5, 11, 13));
            });

            test("DAILY honours BYSETPOS", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 10, 30),
                    end: new Date(2000, 5, 10, 11, 0),
                    rule: "FREQ=DAILY;BYHOUR=10,12,16,18,20;BYSETPOS=1,3,5"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 5, 10, 23) } );

                equal(events.length, 3);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 10, 30));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 11));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 10, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 5, 10, 17));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2013, 5, 10, 20, 30));
                equal(events[2].end.getTime(), +new Date(2013, 5, 10, 21));
            });

            module("WEEKLY Occurrences");
            test("WEEKLY occurrences method returns one event for each new week", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 11, 10) } );

                equal(events.length, 5);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 10, 17, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 10, 17, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2000, 10, 24, 16, 30));
                equal(events[2].end.getTime(), +new Date(2000, 10, 24, 17, 0));

                equal(events[3].recurrenceID, schedulerEvent.uid);
                equal(events[3].start.getTime(), +new Date(2000, 11, 1, 16, 30));
                equal(events[3].end.getTime(), +new Date(2000, 11, 1, 17, 0));

                equal(events[4].recurrenceID, schedulerEvent.uid);
                equal(events[4].start.getTime(), +new Date(2000, 11, 8, 16, 30));
                equal(events[4].end.getTime(), +new Date(2000, 11, 8, 17, 0));
            });

            test("WEEKLY occurrences method honours BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=SU,MO"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 25) } );

                equal(events.length, 4);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 12, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 12, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 10, 13, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 10, 13, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2000, 10, 19, 16, 30));
                equal(events[2].end.getTime(), +new Date(2000, 10, 19, 17, 0));

                equal(events[3].recurrenceID, schedulerEvent.uid);
                equal(events[3].start.getTime(), +new Date(2000, 10, 20, 16, 30));
                equal(events[3].end.getTime(), +new Date(2000, 10, 20, 17, 0));
            });

            test("WEEKLY occurrences method honours INTERVAL", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=TU,FR;INTERVAL=2"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 10, 27) } );

                equal(events.length, 3);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 12, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 10, 12, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 10, 15, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 10, 15, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2013, 10, 26, 16, 30));
                equal(events[2].end.getTime(), +new Date(2013, 10, 26, 17, 0));
            });

            test("WEEKLY occurrences method honours INTERVAL=3", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=TU,FR;INTERVAL=3"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 10, 27) } );
                equal(events.length, 2);
            });

            test("WEEKLY occurrences method honours COUNT=1", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=TU,FR;INTERVAL=2;COUNT=1"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 10, 27) } );

                equal(events.length, 1);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 12, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 10, 12, 17, 0));
            });

            test("WEEKLY occurrences method honours COUNT=5", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=TU,FR;INTERVAL=2;COUNT=5"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2014, 10, 27) } );

                equal(events.length, 5);
            });

            test("WEEKLY occurrences method honours UNTIL", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=TU,FR;INTERVAL=2;UNTIL=20131126T000000"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 10, 27) } );

                equal(events.length, 2);
            });

            test("WEEKLY occurrences method returns empty array if no events", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=TU,FR;INTERVAL=2"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2010, 10, 10), end: new Date(2010, 10, 27) } );

                equal(events.length, 0);
            });

            test("WEEKLY occurrences method starts from second day of BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 25, 16, 30),
                    end: new Date(2013, 10, 25, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=TU,FR"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 27), end: new Date(2013, 10, 30) } );

                equal(events.length, 1);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 29, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 10, 29, 17, 0));
            });

            test("WEEKLY occurrences method limits by BYMONTH=12 and INTERVAL=2", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 25, 16, 30),
                    end: new Date(2013, 10, 25, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=TU,FR;BYMONTH=12;INTERVAL=2"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 27), end: new Date(2014, 0, 1) } );

                equal(events.length, 5);
            });

            test("WEEKLY occurrences method limits by BYMONTH=11,12", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 25, 16, 30),
                    end: new Date(2013, 10, 25, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=FR;BYMONTH=11, 12"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 27), end: new Date(2014, 0, 1) } );

                equal(events.length, 5);
            });

            test("WEEKLY occurrences method honours BYDAY=5FR,-3TU", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=5FR,-3TU"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 11, 1) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 12, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 10, 12, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 10, 29, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 10, 29, 17, 0));
            });

            test("WEEKLY occurrences expand BYHOUR", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=FR;BYHOUR=12,14"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 10, 16) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 15, 12, 30));
                equal(events[0].end.getTime(), +new Date(2013, 10, 15, 13, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 10, 15, 14, 30));
                equal(events[1].end.getTime(), +new Date(2013, 10, 15, 15, 0));
            });

            test("WEEKLY occurrences expand BYHOUR and BYMINUTE", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=FR;BYHOUR=12,14;BYMINUTE=20"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 10, 16) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 15, 12, 20));
                equal(events[0].end.getTime(), +new Date(2013, 10, 15, 12, 50));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 10, 15, 14, 20));
                equal(events[1].end.getTime(), +new Date(2013, 10, 15, 14, 50));
            });

            test("WEEKLY occurrences expand BYHOUR and BYMINUTE and BYSECOND", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=FR;BYHOUR=12,14;BYMINUTE=20;BYSECOND=30"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 10, 16) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 15, 12, 20, 30));
                equal(events[0].end.getTime(), +new Date(2013, 10, 15, 12, 50, 30));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 10, 15, 14, 20, 30));
                equal(events[1].end.getTime(), +new Date(2013, 10, 15, 14, 50, 30));
            });

            //TODO: Add test for BYSETPOS
            /*test("WEEKLY occurrences method returns only nth occurrence", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=WEEKLY;BYDAY=MO,TU,WE;BYSETPOS=1"
                }

                debugger;
                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 11, 1) } );

                equal(events.length, 3);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 11, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 10, 11, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 10, 18, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 10, 18, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 10, 25, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 10, 25, 17, 0));
            });*/

            module("MONTHLY Occurrences");
            test("MONTHLY method returns one event for each new month", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=MONTHLY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 5, 10), end: new Date(2000, 9, 10, 17) } );

                equal(events.length, 5);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 5, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 5, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 6, 10, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 6, 10, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2000, 7, 10, 16, 30));
                equal(events[2].end.getTime(), +new Date(2000, 7, 10, 17, 0));

                equal(events[3].recurrenceID, schedulerEvent.uid);
                equal(events[3].start.getTime(), +new Date(2000, 8, 10, 16, 30));
                equal(events[3].end.getTime(), +new Date(2000, 8, 10, 17, 0));

                equal(events[4].recurrenceID, schedulerEvent.uid);
                equal(events[4].start.getTime(), +new Date(2000, 9, 10, 16, 30));
                equal(events[4].end.getTime(), +new Date(2000, 9, 10, 17, 0));
            });

            test("MONTHLY occurrence sets date to event.start if NO BYMONTHDAYS and BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 0, 31, 16, 30),
                    end: new Date(2000, 0, 31, 17, 0),
                    rule: "FREQ=MONTHLY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 0, 10), end: new Date(2000, 5, 10, 17) } );

                equal(events.length, 3);
                equal(events[0].start.getDate(), 31);
                equal(events[1].start.getDate(), 31);
                equal(events[2].start.getDate(), 31);
            });

            test("MONTHLY method returns only if date is available in current month", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 0, 31, 16, 30),
                    end: new Date(2000, 0, 31, 17, 0),
                    rule: "FREQ=MONTHLY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 0, 10), end: new Date(2000, 5, 10, 17) } );

                equal(events.length, 3);
                equal(events[0].start.getMonth(), 0);
                equal(events[1].start.getMonth(), 2);
                equal(events[2].start.getMonth(), 4);
            });

            test("MONTHLY method limits by month", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=MONTHLY;BYMONTH=6,8,10"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 5, 10), end: new Date(2000, 9, 10, 17) } );

                equal(events.length, 3);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 5, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 5, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 7, 10, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 7, 10, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2000, 9, 10, 16, 30));
                equal(events[2].end.getTime(), +new Date(2000, 9, 10, 17, 0));
            });

            test("MONTHLY method limits by month and return empty array", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=MONTHLY;BYMONTH=12"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 5, 10), end: new Date(2000, 9, 10, 17) } );
                equal(events.length, 0);
            });

            test("MONTHLY method expands by BYMONTHDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=MONTHLY;BYMONTHDAY=6,10"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 5, 10), end: new Date(2000, 6, 10, 17) } );

                equal(events.length, 3);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 5, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 5, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2000, 6, 6, 16, 30));
                equal(events[1].end.getTime(), +new Date(2000, 6, 6, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2000, 6, 10, 16, 30));
                equal(events[2].end.getTime(), +new Date(2000, 6, 10, 17, 0));
            });

            test("MONTHLY method expands by BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=MONTHLY;BYDAY=MO,WE"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 6, 10, 17) } );

                equal(events.length, 10);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 5, 10, 17, 0));

                equal(events[4].recurrenceID, schedulerEvent.uid);
                equal(events[4].start.getTime(), +new Date(2013, 5, 24, 16, 30));
                equal(events[4].end.getTime(), +new Date(2013, 5, 24, 17, 0));

                equal(events[9].recurrenceID, schedulerEvent.uid);
                equal(events[9].start.getTime(), +new Date(2013, 6, 10, 16, 30));
                equal(events[9].end.getTime(), +new Date(2013, 6, 10, 17, 0));
            });

            test("MONTHLY expand by BYMONTHDAY and limit by BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=MONTHLY;BYMONTHDAY=13,23,25;BYDAY=TU,TH"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 10), end: new Date(2013, 6, 10, 17) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 13, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 5, 13, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 25, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 5, 25, 17, 0));
            });

            test("MONTHLY expand by BYMONTH and limit by BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=MONTHLY;BYMONTH=6;BYDAY=TU,TH"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 5, 24), end: new Date(2013, 6, 10, 17) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 5, 25, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 5, 25, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 5, 27, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 5, 27, 17, 0));
            });

            test("MONTHLY occurrences expand BYHOUR and BYMINUTE and BYSECOND", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 10, 10, 16, 30),
                    end: new Date(2013, 10, 10, 17, 0),
                    rule: "FREQ=MONTHLY;BYDAY=FR;BYHOUR=12,14;BYMINUTE=20;BYSECOND=30"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 10, 10), end: new Date(2013, 10, 16) } );

                equal(events.length, 2);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 10, 15, 12, 20, 30));
                equal(events[0].end.getTime(), +new Date(2013, 10, 15, 12, 50, 30));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 10, 15, 14, 20, 30));
                equal(events[1].end.getTime(), +new Date(2013, 10, 15, 14, 50, 30));
            });

            //TODO: Add test for BYSETPOS

            module("YEARLY Occurrences");
            test("YEARLY method returns one event for each new year", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=YEARLY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 5, 10), end: new Date(2002, 9, 10, 17) } );

                equal(events.length, 3);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 5, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 5, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2001, 5, 10, 16, 30));
                equal(events[1].end.getTime(), +new Date(2001, 5, 10, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2002, 5, 10, 16, 30));
                equal(events[2].end.getTime(), +new Date(2002, 5, 10, 17, 0));
            });

            test("YEARLY method expands BYMONTH", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 5, 10, 16, 30),
                    end: new Date(2000, 5, 10, 17, 0),
                    rule: "FREQ=YEARLY;BYMONTH=12"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 5, 10), end: new Date(2002, 11, 10, 17) } );

                equal(events.length, 3);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 11, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 11, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2001, 11, 10, 16, 30));
                equal(events[1].end.getTime(), +new Date(2001, 11, 10, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2002, 11, 10, 16, 30));
                equal(events[2].end.getTime(), +new Date(2002, 11, 10, 17, 0));
            });

            test("YEARLY method expands BYWEEKNO", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 0, 10, 16, 30),
                    end: new Date(2013, 0, 10, 17, 0),
                    rule: "FREQ=YEARLY;BYWEEKNO=10;WKST=MO"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 0, 10), end: new Date(2013, 11, 10, 17) } );
                equal(events.length, 7); //04 - 10 March

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 2, 4, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 2, 4, 17, 0));

                equal(events[6].recurrenceID, schedulerEvent.uid);
                equal(events[6].start.getTime(), +new Date(2013, 2, 10, 16, 30));
                equal(events[6].end.getTime(), +new Date(2013, 2, 10, 17, 0));
            });

            test("YEARLY method expands BYYEARDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 0, 1, 16, 30),
                    end: new Date(2013, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYYEARDAY=10,100,200"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 0, 1), end: new Date(2013, 11, 31, 17) } );
                equal(events.length, 3);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 0, 10, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 0, 10, 17, 0));

                equal(events[1].recurrenceID, schedulerEvent.uid);
                equal(events[1].start.getTime(), +new Date(2013, 3, 10, 16, 30));
                equal(events[1].end.getTime(), +new Date(2013, 3, 10, 17, 0));

                equal(events[2].recurrenceID, schedulerEvent.uid);
                equal(events[2].start.getTime(), +new Date(2013, 6, 19, 16, 30));
                equal(events[2].end.getTime(), +new Date(2013, 6, 19, 17, 0));
            });

            test("YEARLY method expands BYMONTHDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 0, 1, 16, 30),
                    end: new Date(2013, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYMONTHDAY=31"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 0, 1), end: new Date(2013, 11, 31, 17) } );
                equal(events.length, 7);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 0, 31, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 0, 31, 17, 0));

                equal(events[6].recurrenceID, schedulerEvent.uid);
                equal(events[6].start.getTime(), +new Date(2013, 11, 31, 16, 30));
                equal(events[6].end.getTime(), +new Date(2013, 11, 31, 17, 0));
            });

            test("YEARLY method expands BYDAY", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 0, 1, 16, 30),
                    end: new Date(2013, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYDAY=TH"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 4, 1), end: new Date(2013, 4, 31, 17) } );
                equal(events.length, 5);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 4, 2, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 4, 2, 17, 0));

                equal(events[4].recurrenceID, schedulerEvent.uid);
                equal(events[4].start.getTime(), +new Date(2013, 4, 30, 16, 30));
                equal(events[4].end.getTime(), +new Date(2013, 4, 30, 17, 0));
            });

            test("YEARLY method expands BYMONTH and limit by BYWEEKNO", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 0, 1, 16, 30),
                    end: new Date(2013, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYMONTH=3;BYWEEKNO=10;WKST=MO"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 0, 1), end: new Date(2013, 4, 31, 17) } );
                equal(events.length, 7); //04 - 10 March

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 2, 4, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 2, 4, 17, 0));

                equal(events[6].recurrenceID, schedulerEvent.uid);
                equal(events[6].start.getTime(), +new Date(2013, 2, 10, 16, 30));
                equal(events[6].end.getTime(), +new Date(2013, 2, 10, 17, 0));
            });

            test("YEARLY method expands BYMONTH and limit by BYYEARDAY (returns 0)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 0, 1, 16, 30),
                    end: new Date(2013, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYMONTH=3;BYYEARDAY=200"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 0, 1), end: new Date(2013, 4, 31, 17) } );
                equal(events.length, 0);
            });

            test("YEARLY method expands BYMONTH and limit by BYYEARDAY (returns 1)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2012, 0, 1, 16, 30),
                    end: new Date(2012, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYMONTH=2;BYYEARDAY=60"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2012, 0, 1), end: new Date(2012, 4, 31, 17) } );
                equal(events.length, 1);

                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2012, 1, 29, 16, 30));
                equal(events[0].end.getTime(), +new Date(2012, 1, 29, 17, 0));
            });

            test("YEARLY method expands BYMONTH and limit by BYMONTHDAY (returns 1)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2012, 0, 1, 16, 30),
                    end: new Date(2012, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYMONTH=2;BYMONTHDAY=1,29"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 0, 1), end: new Date(2013, 4, 31, 17) } );

                equal(events.length, 1);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 1, 1, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 1, 1, 17, 0));
            });

            test("YEARLY method expands BYMONTH and limit by BYDAY (returns 4)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2013, 0, 1, 16, 30),
                    end: new Date(2013, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYMONTH=2;BYDAY=WE"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 0, 1), end: new Date(2013, 4, 31, 17) } );

                equal(events.length, 4);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 1, 6, 16, 30));
                equal(events[0].end.getTime(), +new Date(2013, 1, 6, 17, 0));

                equal(events[3].recurrenceID, schedulerEvent.uid);
                equal(events[3].start.getTime(), +new Date(2013, 1, 27, 16, 30));
                equal(events[3].end.getTime(), +new Date(2013, 1, 27, 17, 0));
            });

            test("YEARLY method expands BYMONTH, BYHOUR, BYMINUTE and limit by BYMONTHDAY (returns 2)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2012, 0, 1, 16, 30),
                    end: new Date(2012, 0, 1, 17, 0),
                    rule: "FREQ=YEARLY;BYMONTH=2;BYMONTHDAY=1,29;BYHOUR=17,18;BYMINUTE=40"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2013, 0, 1), end: new Date(2013, 4, 31, 17) } );

                equal(events.length, 2);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2013, 1, 1, 17, 40));
                equal(events[0].end.getTime(), +new Date(2013, 1, 1, 18, 10));

                equal(events[1].start.getTime(), +new Date(2013, 1, 1, 18, 40));
                equal(events[1].end.getTime(), +new Date(2013, 1, 1, 19, 10));
            });
        </script>
    </body>
</html>
