<!DOCTYPE html>
<html>
    <head>
        <title>Recurrence dates</title>
        <script src="../jquery-loader.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.scheduler.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Scheduler initialization</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var recurrence = kendo.recurrence,
                occurrences = recurrence.occurrences;

            module("Recurring helper methods");

            test("expandEvent method expand original method with rrule object", function() {
                var schedulerEvent = {
                    title: "Title",
                    start: new Date(),
                    rule: "FREQ:DAILY"
                }

                recurrence.expandEvent(schedulerEvent);

                ok(schedulerEvent.ruleInstance);
            });

            test("DAILY frequency next method gets next day (interval:1)", function() {
                var next = recurrence.frequency.DAILY.next(new Date(2000, 10, 10, 18, 18, 18), new Date(2000, 10, 12, 18, 18, 18), 1);
                equal(+next, +new Date(2000, 10, 11, 18, 18, 18))
            });

            test("DAILY frequency next method gets the day after tomorrow (interval:2)", function() {
                var next = recurrence.frequency.DAILY.next(new Date(2000, 10, 10, 18, 18, 18), new Date(2000, 10, 12, 18, 18, 18), 2);
                equal(+next, +new Date(2000, 10, 12, 18, 18, 18));
            });


            module("Recurring events");

            test("Occurrences method returns one occurrence (Day view)", function() {
                var schedulerEvent = {
                    uid: "id",
                    title: "Title",
                    start: new Date(2000, 10, 10, 16, 30),
                    end: new Date(2000, 10, 10, 17, 0),
                    rule: "FREQ=DAILY"
                }

                var events = occurrences(schedulerEvent, { start: new Date(2000, 10, 10), end: new Date(2000, 10, 11) } );

                equal(events.length, 1);
                equal(events[0].recurrenceID, schedulerEvent.uid);
                equal(events[0].start.getTime(), +new Date(2000, 10, 11, 16, 30));
                equal(events[0].end.getTime(), +new Date(2000, 10, 11, 17, 0));
            });

        </script>
    </body>
</html>
