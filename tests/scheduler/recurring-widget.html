<!DOCTYPE html>
<html>
    <head>
        <title>Recurring widget</title>
        <script src="../jquery-loader.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.list.js"></script>
        <script src="../../src/kendo.dropdownlist.js"></script>
        <script src="../../src/kendo.calendar.js"></script>
        <script src="../../src/kendo.datepicker.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.numerictextbox.js"></script>
        <script src="../../src/kendo.scheduler.recurrence.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Recurring widget</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var RecurrenceEditor = kendo.ui.RecurrenceEditor,
                div;

            module("kendo.ui.RecurrenceEditor initialization", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    //div.data("kendoRecurrenceEditor").destroy();
                    div.remove();
                }
            });

            test("kendoRecurrenceEditor attaches a reccurrenceEditor object to target", function() {
                div.kendoRecurrenceEditor();

               ok(div.data("kendoRecurrenceEditor") instanceof RecurrenceEditor);
            });

            test("renders dropdownlist for frequencies", function() {
                div.kendoRecurrenceEditor();

                var ddl = div.find("[data-role=dropdownlist]").data("kendoDropDownList");

                ok(ddl);
                ok(ddl.ul.children());
                equal(ddl.value(), "");
                equal(ddl.select(), 0);
            });

            test("changing frequency changes value of the widget", function() {
                var editor = new RecurrenceEditor(div);
                var ddl = div.find("[data-role=dropdownlist]").data("kendoDropDownList");

                ddl.select(1);
                ddl.trigger("change");

                equal(editor.value(), "FREQ=DAILY");
            });

            test("changing frequency to never clears view and value", function() {
                var editor = new RecurrenceEditor(div);
                var ddl = div.find("[data-role=dropdownlist]").data("kendoDropDownList");

                ddl.select(1);
                ddl.trigger("change");

                ddl.select(0);
                ddl.trigger("change");

                equal(editor.value(), "");
                equal(editor.container.html(), "");
            });

            test("renders frequency view container", function() {
                div.kendoRecurrenceEditor();

                var container = div.find(".k-recur-view");

                ok(container[0]);
            });

            module("kendo.ui.RecurrenceEditor Daily view", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    //div.data("kendoRecurrenceEditor").destroy();
                    div.remove();
                }
            });

            test("Render interval input with default value", function() {
                var editor = new RecurrenceEditor(div);
                editor.setView("daily");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                ok(interval);
                equal(interval.value(), 1);
            });

            test("Change interval updates widget value", function() {
                var editor = new RecurrenceEditor(div);
                editor.setView("daily");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(3);
                interval.trigger("change");

                equal(editor.value(), "FREQ=DAILY;INTERVAL=3");
            });

            test("Clears value of the interval is equal to 1", function() {
                var editor = new RecurrenceEditor(div);
                editor.setView("daily");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(null);
                interval.trigger("change");

                equal(editor.value(), "FREQ=DAILY"); //default value of INTERVAL is 1
            });

            test("All end inputs are disabled if never radio is checked", function() {
                var editor = new RecurrenceEditor(div);
                editor.setView("daily");

                var radio = div.find(".k-recur-end-never,.k-recur-end-until,.k-recur-end-count").filter(":checked"),
                    until = div.find(".k-recur-until:input"),
                    count = div.find(".k-recur-count:input");

                equal(radio.length, 1);
                equal(radio.val(), "never");
                equal(until.prop("disabled"), true);
                equal(count.prop("disabled"), true);
            });

            test("Select count radio sets count value", function() {
                var editor = new RecurrenceEditor(div);
                editor.setView("daily");

                editor.radioButtonCount.click();

                equal(editor.value(), "FREQ=DAILY;COUNT=1"); //default value of INTERVAL is 1
            });

            test("Select until radio sets until value", function() {
                var editor = new RecurrenceEditor(div);
                editor.setView("daily");

                editor.radioButtonUntil.click();

                equal(editor.value(), "FREQ=DAILY;UNTIL=20130613T000000Z"); //default value of INTERVAL is 1
            });

            module("kendo.ui.RecurrenceEditor API", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    //div.data("kendoRecurrenceEditor").destroy();
                    div.remove();
                }
            });

            test("value method sets frequency ddl value", function() {
                var editor = new RecurrenceEditor(div);
                editor.value("FREQ=DAILY");

                equal(editor.ddlFrequency.value(), "daily");
            });

            test("value method sets interval if valid frequency", function() {
                var editor = new RecurrenceEditor(div);
                editor.value("FREQ=DAILY;INTERVAL=2");

                equal(div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox").value(), 2);
            });

            test("value method sets end rule to never", function() {
                var editor = new RecurrenceEditor(div);
                editor.value("FREQ=DAILY");

                ok(editor.radioButtonNever.prop("checked"));
            });

            test("value method sets end rule to count", function() {
                var editor = new RecurrenceEditor(div);
                editor.value("FREQ=DAILY;COUNT=10");

                ok(editor.radioButtonCount.prop("checked"));
                equal(editor.countNumericTextBox.value(), 10);
            });

            test("value method sets end rule to until", function() {
                var editor = new RecurrenceEditor(div),
                    until = new Date(2013, 5, 15);

                editor.value("FREQ=DAILY;UNTIL=20130615T000000Z");

                ok(editor.radioButtonUntil.prop("checked"));
                equal(editor.untilDatePicker.value().getTime(), until.getTime());
            });

        </script>
    </body>
</html>
