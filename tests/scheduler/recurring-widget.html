<!DOCTYPE html>
<html>
    <head>
        <title>Recurring widget</title>
        <script src="../jquery-loader.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.list.js"></script>
        <script src="../../src/kendo.dropdownlist.js"></script>
        <script src="../../src/kendo.calendar.js"></script>
        <script src="../../src/kendo.datepicker.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.numerictextbox.js"></script>
        <script src="../../src/kendo.scheduler.recurrence.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Recurring widget</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var RecurrenceEditor = kendo.ui.RecurrenceEditor,
                div;

            module("kendo.ui.RecurrenceEditor initialization", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    //div.data("kendoRecurrenceEditor").destroy();
                    div.remove();
                }
            });

            test("kendoRecurrenceEditor attaches a reccurrenceEditor object to target", function() {
                div.kendoRecurrenceEditor();

               ok(div.data("kendoRecurrenceEditor") instanceof RecurrenceEditor);
            });

            test("renders dropdownlist for frequencies", function() {
                div.kendoRecurrenceEditor();

                var ddl = div.find("[data-role=dropdownlist]").data("kendoDropDownList");

                ok(ddl);
                ok(ddl.ul.children());
                equal(ddl.value(), "");
                equal(ddl.select(), 0);
            });

            test("changing frequency changes value of the widget", function() {
                var editor = new RecurrenceEditor(div);
                var ddl = div.find("[data-role=dropdownlist]").data("kendoDropDownList");

                ddl.select(1);
                ddl.trigger("change");

                equal(editor.value(), "FREQ=DAILY");
            });

            test("changing frequency to never clears view and value", function() {
                var editor = new RecurrenceEditor(div);
                var ddl = div.find("[data-role=dropdownlist]").data("kendoDropDownList");

                ddl.select(1);
                ddl.trigger("change");

                ddl.select(0);
                ddl.trigger("change");

                equal(editor.value(), "");
                equal(editor._container.html(), "");
            });

            test("changing frequency resets widget value", function() {
                var editor = new RecurrenceEditor(div, {
                    value: "FREQ=WEEKLY;BYDAY=MO,TU,WE"
                });
                var ddl = div.find("[data-role=dropdownlist]").data("kendoDropDownList");

                ddl.select(1);
                ddl.trigger("change");

                equal(editor.value(), "FREQ=DAILY");
            });

            test("renders frequency view container", function() {
                div.kendoRecurrenceEditor();

                var container = div.find(".k-recur-view");

                ok(container[0]);
            });

            test("renders frequency in 'k-edit-field' container", function() {
                div.wrap("<div class='k-edit-field' />");

                var parentDiv = div.parent();

                div.kendoRecurrenceEditor();

                var container = parentDiv.next(".k-recur-view");

                ok(container[0]);
            });

            module("kendo.ui.RecurrenceEditor Daily view", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    //div.data("kendoRecurrenceEditor").destroy();
                    div.remove();
                }
            });

            test("Render interval input with default value", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("daily");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                ok(interval);
                equal(interval.value(), 1);
            });

            test("Change interval updates widget value", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("daily");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(3);
                interval.trigger("change");

                equal(editor.value(), "FREQ=DAILY;INTERVAL=3");
            });

            test("Clears value of the interval is equal to 1", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("daily");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(null);
                interval.trigger("change");

                equal(editor.value(), "FREQ=DAILY"); //default value of INTERVAL is 1
            });

            test("All end inputs are disabled if never radio is checked", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("daily");

                var radio = div.find(".k-recur-end-never,.k-recur-end-until,.k-recur-end-count").filter(":checked"),
                    until = div.find(".k-recur-until:input"),
                    count = div.find(".k-recur-count:input");

                equal(radio.length, 1);
                equal(radio.val(), "never");
                equal(until.prop("disabled"), true);
                equal(count.prop("disabled"), true);
            });

            test("Select count radio sets count value", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("daily");

                editor.radioButtonCount.click();

                equal(editor.value(), "FREQ=DAILY;COUNT=1"); //default value of INTERVAL is 1
            });

            test("Select until radio sets until value (no timezone)", function() {
                var editor = new RecurrenceEditor(div),
                    date = kendo.date.today();


                editor._initView("daily");

                editor.radioButtonUntil.click();

                date = kendo.timezone.apply(date, 0);
                equal(editor.value(), "FREQ=DAILY;UNTIL=" + kendo.toString(date, "yyyyMMddTHHmmssZ"));
            });

            test("Until datepicker uses start value as min", function() {
                var date = kendo.date.today();
                var editor = new RecurrenceEditor(div, { start: date });

                editor._initView("daily");

                equal(editor._until.min().getTime(), date.getTime());
            });

            test("Select until radio sets until value (Etc/UTC zone)", function() {
                var editor = new RecurrenceEditor(div, {
                        timezone: "Etc/UTC"
                    }),
                    date = kendo.date.today();


                editor._initView("daily");

                editor.radioButtonUntil.click();

                equal(editor.value(), "FREQ=DAILY;UNTIL=" + kendo.toString(date, "yyyyMMddTHHmmssZ"));
            });

            module("kendo.ui.RecurrenceEditor Weekly view", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    //div.data("kendoRecurrenceEditor").destroy();
                    div.remove();
                }
            });

            test("Render interval input with default value", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("weekly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                ok(interval);
                equal(interval.value(), 1);
            });

            test("Change interval updates widget value", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("weekly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(3);
                interval.trigger("change");

                equal(editor.value(), "FREQ=WEEKLY;INTERVAL=3;BYDAY=FR");
            });

            test("Clears value of the interval is equal to 1", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("weekly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(null);
                interval.trigger("change");

                equal(editor.value(), "FREQ=WEEKLY;BYDAY=FR"); //default value of INTERVAL is 1
            });

            test("All end inputs are disabled if never radio is checked", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("weekly");

                var radio = div.find(".k-recur-end-never,.k-recur-end-until,.k-recur-end-count").filter(":checked"),
                    until = div.find(".k-recur-until:input"),
                    count = div.find(".k-recur-count:input");

                equal(radio.length, 1);
                equal(radio.val(), "never");
                equal(until.prop("disabled"), true);
                equal(count.prop("disabled"), true);
            });

            test("Select count radio sets count value", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("weekly");

                editor.radioButtonCount.click();

                equal(editor.value(), "FREQ=WEEKLY;COUNT=1;BYDAY=FR"); //default value of INTERVAL is 1
            });

            test("Select until radio sets until value (no timezone)", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("weekly");

                editor.radioButtonUntil.click();

                date = kendo.timezone.apply(date, 0);
                equal(editor.value(), "FREQ=WEEKLY;UNTIL=" + kendo.toString(date, "yyyyMMddTHHmmssZ") + ";BYDAY=FR");
            });

            test("Render weekdays", function() {
                var editor = new RecurrenceEditor(div),
                    date = kendo.date.today();

                editor._initView("weekly");

                var checkboxes = editor._container.find("input[type=checkbox]");

                equal(checkboxes.length, 7);
            });

            test("Take into account firstWeekDay option", function() {
                var editor = new RecurrenceEditor(div, { firstWeekDay: 6 }),
                    date = kendo.date.today();

                editor._initView("weekly");

                var checkboxes = editor._container.find("input[type=checkbox]");

                equal(checkboxes.eq(0).val(), "6");
            });

            test("Take into account firstWeekDay option when check the input", function() {
                var editor = new RecurrenceEditor(div, {
                    firstWeekDay: 1,
                    start: new Date(2013, 7, 27)
                }),
                date = kendo.date.today();

                editor._initView("weekly");

                var checkboxes = editor._container.find("input[type=checkbox]:checked");

                equal(checkboxes.eq(0).val(), "2");
            });

            test("Use day of event start date to check correct checkbox", function() {
                var date = kendo.date.today(),
                    editor = new RecurrenceEditor(div, {
                        start: date
                    });

                editor._initView("weekly");

                var checkboxes = editor._container.find("input[type=checkbox]:checked");

                equal(checkboxes.eq(0).val(), date.getDay());
            });

            module("kendo.ui.RecurrenceEditor Monthly view", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    div.remove();
                }
            });

            test("Render interval input with default value", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("monthly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                ok(interval);
                equal(interval.value(), 1);
            });

            test("Change interval updates widget value", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("monthly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(3);
                interval.trigger("change");

                equal(editor.value(), "FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=14");
            });

            test("Clears value of the interval is equal to 1", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("monthly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(null);
                interval.trigger("change");

                equal(editor.value(), "FREQ=MONTHLY;BYMONTHDAY=14"); //default value of INTERVAL is 1
            });

            test("All end inputs are disabled if never radio is checked", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("monthly");

                var radio = div.find(".k-recur-end-never,.k-recur-end-until,.k-recur-end-count").filter(":checked"),
                    until = div.find(".k-recur-until:input"),
                    count = div.find(".k-recur-count:input");

                equal(radio.length, 1);
                equal(radio.val(), "never");
                equal(until.prop("disabled"), true);
                equal(count.prop("disabled"), true);
            });

            test("Select count radio sets count value", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("monthly");

                editor.radioButtonCount.click();

                equal(editor.value(), "FREQ=MONTHLY;COUNT=1;BYMONTHDAY=14"); //default value of INTERVAL is 1
            });

            test("Select until radio sets until value (no timezone)", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("monthly");
                editor.radioButtonUntil.click();

                date = kendo.timezone.apply(date, 0);
                equal(editor.value(), "FREQ=MONTHLY;UNTIL=" + kendo.toString(date, "yyyyMMddTHHmmssZ") + ";BYMONTHDAY=14");
            });

            test("Render inputs to handle bymonthday and byday options", function() {
                var editor = new RecurrenceEditor(div),
                    container = editor._container;

                editor._initView("monthly");

                var radioButton = container.find("[type=radio].k-recur-month-radio");
                var numericMonthDay = container.find(".k-recur-monthday");
                var ddlOffset = container.find(".k-recur-weekday-offset");
                var ddlWeekDay = container.find(".k-recur-weekday");

                equal(radioButton.length, 2);
                ok(numericMonthDay[0]);
                ok(ddlOffset[0]);
                ok(ddlWeekDay[0]);
            });

            test("Initialize monthday numeric", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("monthly");

                var numericMonthDay = container.find("[data-role=numerictextbox].k-recur-monthday"),
                    numeric = numericMonthDay.data("kendoNumericTextBox");

                ok(numeric);
                equal(numeric.min(), 1);
                equal(numeric.max(), 31);
                equal(numeric.value(), today.getDate());
            });

            test("Update monthdays rule on monthday numeric change", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("monthly");

                var numericMonthDay = container.find("[data-role=numerictextbox].k-recur-monthday"),
                    numeric = numericMonthDay.data("kendoNumericTextBox");

                numeric.value(20);
                numeric.trigger("change");

                equal(editor.value(), "FREQ=MONTHLY;BYMONTHDAY=20");
            });

            test("Initialize week day widgets", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._value.weekDays = [
                    { offset: 3, day: 6 }
                ];

                editor._initView("monthly");

                var offset = container.find("[data-role=dropdownlist].k-recur-weekday-offset").data("kendoDropDownList")
                    weekday = container.find("[data-role=dropdownlist].k-recur-weekday").data("kendoDropDownList");

                ok(offset);
                ok(weekday);

                equal(offset.value(), "3");
                equal(weekday.value(), "6");
            });

            test("Update week day rule", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("monthly");
                container.find(".k-recur-month-radio:last").click();

                var offset = container.find("[data-role=dropdownlist].k-recur-weekday-offset").data("kendoDropDownList")
                    weekday = container.find("[data-role=dropdownlist].k-recur-weekday").data("kendoDropDownList");

                offset.value("-1");
                offset.trigger("change");

                equal(editor.value(), "FREQ=MONTHLY;BYDAY=-1SU");

                weekday.value("3");
                weekday.trigger("change");

                equal(editor.value(), "FREQ=MONTHLY;BYDAY=-1WE");
            });

            test("On initial render enable monthday and disable weekday", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("monthly");

                var numeric = container.find("[data-role=numerictextbox].k-recur-monthday"),
                    offset = container.find("[data-role=dropdownlist].k-recur-weekday-offset"),
                    weekday = container.find("[data-role=dropdownlist].k-recur-weekday");

                equal(numeric.prop("disabled"), false);
                equal(offset.prop("disabled"), true);
                equal(weekday.prop("disabled"), true);

                equal(editor.value(), "FREQ=MONTHLY;BYMONTHDAY=" + today.getDate());
            });

            test("Select weekday disables monthday", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("monthly");

                container.find(".k-recur-month-radio:last").click();

                var numeric = container.find("[data-role=numerictextbox].k-recur-monthday"),
                    offset = container.find("[data-role=dropdownlist].k-recur-weekday-offset"),
                    weekday = container.find("[data-role=dropdownlist].k-recur-weekday");

                equal(numeric.prop("disabled"), true);
                equal(offset.prop("disabled"), false);
                equal(weekday.prop("disabled"), false);
                equal(editor.value(), "FREQ=MONTHLY;BYDAY=1SU");
            });

            module("kendo.ui.RecurrenceEditor Yearly view", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    div.remove();
                }
            });

            test("Render interval input with default value", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("yearly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                ok(interval);
                equal(interval.value(), 1);
            });

            test("Change interval updates widget value", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("yearly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(3);
                interval.trigger("change");

                equal(editor.value(), "FREQ=YEARLY;INTERVAL=3;BYMONTH=" + (date.getMonth() + 1) + ";BYMONTHDAY=14");
            });

            test("Clears value of the interval is equal to 1", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("yearly");

                var interval = div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox");

                interval.value(null);
                interval.trigger("change");

                equal(editor.value(), "FREQ=YEARLY;BYMONTH=" + (date.getMonth() + 1) + ";BYMONTHDAY=14"); //default value of INTERVAL is 1
            });

            test("All end inputs are disabled if never radio is checked", function() {
                var editor = new RecurrenceEditor(div);
                editor._initView("yearly");

                var radio = div.find(".k-recur-end-never,.k-recur-end-until,.k-recur-end-count").filter(":checked"),
                    until = div.find(".k-recur-until:input"),
                    count = div.find(".k-recur-count:input");

                equal(radio.length, 1);
                equal(radio.val(), "never");
                equal(until.prop("disabled"), true);
                equal(count.prop("disabled"), true);
            });

            test("Select count radio sets count value", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("yearly");

                editor.radioButtonCount.click();

                equal(editor.value(), "FREQ=YEARLY;COUNT=1;BYMONTH=" + (date.getMonth() + 1) + ";BYMONTHDAY=14");
            });

            test("Select until radio sets until value (no timezone)", function() {
                var date = new Date(2013, 5, 14),
                    editor = new RecurrenceEditor(div, { start: date });

                editor._initView("yearly");
                editor.radioButtonUntil.click();

                date = kendo.timezone.apply(date, 0);
                equal(editor.value(), "FREQ=YEARLY;UNTIL=" + kendo.toString(date, "yyyyMMddTHHmmssZ") + ";BYMONTH=" + (date.getMonth() + 1) + ";BYMONTHDAY=14");
            });

            test("Render inputs to handle bymonthday and byday options", function() {
                var editor = new RecurrenceEditor(div),
                    container = editor._container;

                editor._initView("yearly");

                var radioButton = container.find("[type=radio].k-recur-year-radio");
                var numericMonthDay = container.find(".k-recur-monthday");
                var ddlOffset = container.find(".k-recur-weekday-offset");
                var ddlWeekDay = container.find(".k-recur-weekday");

                equal(radioButton.length, 2);
                ok(numericMonthDay[0]);
                ok(ddlOffset[0]);
                ok(ddlWeekDay[0]);
            });

            test("Initialize monthday numeric", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("yearly");

                var numericMonthDay = container.find("[data-role=numerictextbox].k-recur-monthday"),
                    numeric = numericMonthDay.data("kendoNumericTextBox");

                ok(numeric);
                equal(numeric.min(), 1);
                equal(numeric.max(), 31);
                equal(numeric.value(), today.getDate());
            });

            test("Update monthdays rule on monthday numeric change", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("yearly");

                var numericMonthDay = container.find("[data-role=numerictextbox].k-recur-monthday"),
                    numeric = numericMonthDay.data("kendoNumericTextBox");

                numeric.value(20);
                numeric.trigger("change");

                equal(editor.value(), "FREQ=YEARLY;BYMONTH=" + (today.getMonth() + 1) + ";BYMONTHDAY=20");
            });

            test("Initialize week day widgets", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._value.weekDays = [
                    { offset: 3, day: 6 }
                ];

                editor._initView("yearly");

                var offset = container.find("[data-role=dropdownlist].k-recur-weekday-offset").data("kendoDropDownList")
                    weekday = container.find("[data-role=dropdownlist].k-recur-weekday").data("kendoDropDownList");

                ok(offset);
                ok(weekday);

                equal(offset.value(), "3");
                equal(weekday.value(), "6");
            });

            test("Update week day rule", function() {
                var today = kendo.date.today(),
                    month = today.getMonth() + 1,
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("yearly");
                container.find(".k-recur-year-radio:last").click();

                var offset = container.find("[data-role=dropdownlist].k-recur-weekday-offset").data("kendoDropDownList")
                    weekday = container.find("[data-role=dropdownlist].k-recur-weekday").data("kendoDropDownList");

                offset.value("-1");
                offset.trigger("change");

                equal(editor.value(), "FREQ=YEARLY;BYMONTH=" + month + ";BYDAY=-1SU");

                weekday.value("3");
                weekday.trigger("change");

                equal(editor.value(), "FREQ=YEARLY;BYMONTH=" + month + ";BYDAY=-1WE");
            });

            test("On initial render enable monthday and disable weekday", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("yearly");

                var numeric = container.find("[data-role=numerictextbox].k-recur-monthday"),
                    offset = container.find("[data-role=dropdownlist].k-recur-weekday-offset"),
                    weekday = container.find("[data-role=dropdownlist].k-recur-weekday"),
                    monthFirst = container.find("[data-role=dropdownlist].k-recur-month:first"),
                    monthLast = container.find("[data-role=dropdownlist].k-recur-month:last");

                equal(monthFirst.prop("disabled"), false);
                equal(numeric.prop("disabled"), false);
                equal(offset.prop("disabled"), true);
                equal(weekday.prop("disabled"), true);
                equal(monthLast.prop("disabled"), true);

                equal(editor.value(), "FREQ=YEARLY;BYMONTH=" + (today.getMonth() + 1) + ";BYMONTHDAY=" + today.getDate());
            });

            test("Select weekday disables monthday", function() {
                var today = kendo.date.today(),
                    editor = new RecurrenceEditor(div, { start: today }),
                    container = editor._container;

                editor._initView("yearly");

                container.find(".k-recur-year-radio:last").click();

                var numeric = container.find("[data-role=numerictextbox].k-recur-monthday"),
                    offset = container.find("[data-role=dropdownlist].k-recur-weekday-offset"),
                    weekday = container.find("[data-role=dropdownlist].k-recur-weekday"),
                    monthFirst = container.find("[data-role=dropdownlist].k-recur-month:first"),
                    monthLast = container.find("[data-role=dropdownlist].k-recur-month:last");


                equal(monthFirst.prop("disabled"), true);
                equal(numeric.prop("disabled"), true);
                equal(offset.prop("disabled"), false);
                equal(weekday.prop("disabled"), false);
                equal(monthLast.prop("disabled"), false);

                equal(editor.value(), "FREQ=YEARLY;BYMONTH=" + (today.getMonth() + 1) + ";BYDAY=1SU");
            });

            module("kendo.ui.RecurrenceEditor API", {
                setup: function() {
                    div = $("<div />").appendTo(document.body);
                },
                teardown: function() {
                    //div.data("kendoRecurrenceEditor").destroy();
                    div.remove();
                }
            });

            test("value method sets frequency ddl value", function() {
                var editor = new RecurrenceEditor(div);
                editor.value("FREQ=DAILY");

                equal(editor._frequency.value(), "daily");
            });

            test("value method sets interval if valid frequency", function() {
                var editor = new RecurrenceEditor(div);
                editor.value("FREQ=DAILY;INTERVAL=2");

                equal(div.find("[data-role=numerictextbox].k-recur-interval").data("kendoNumericTextBox").value(), 2);
            });

            test("value method sets end rule to never", function() {
                var editor = new RecurrenceEditor(div);
                editor.value("FREQ=DAILY");

                ok(editor.radioButtonNever.prop("checked"));
            });

            test("value method sets end rule to count", function() {
                var editor = new RecurrenceEditor(div);
                editor.value("FREQ=DAILY;COUNT=10");

                ok(editor.radioButtonCount.prop("checked"));
                equal(div.find("[data-role=numerictextbox].k-recur-count").data("kendoNumericTextBox").value(), 10);
            });

            test("value method sets end rule to until (no timezone)", function() {
                var editor = new RecurrenceEditor(div),
                    until = kendo.parseDate("20130615T000000Z", "yyyyMMddTHHmmsszz");

                editor.value("FREQ=DAILY;UNTIL=20130615T000000Z");

                ok(editor.radioButtonUntil.prop("checked"));
                deepEqual(div.find("[data-role=datepicker].k-recur-until").data("kendoDatePicker").value(), until);
            });

        </script>
    </body>
</html>
