<!DOCTYPE html>
<html>
    <head>
        <title>Scheduler Resizing</title>
        <link href="../../styles/web/kendo.common.min.css" rel="stylesheet" />
        <link href="../../styles/web/kendo.default.min.css" rel="stylesheet" />
        <script src="../jquery-loader.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit/addons/close-enough/qunit-close-enough.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.draganddrop.js"></script>
        <script src="../../src/kendo.validator.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.binder.js"></script>
        <script src="../../src/kendo.editable.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.tooltip.js"></script>
        <script src="../../src/kendo.list.js"></script>
        <script src="../../src/kendo.dropdownlist.js"></script>
        <script src="../../src/kendo.multiselect.js"></script>
        <script src="../../src/kendo.calendar.js"></script>
        <script src="../../src/kendo.window.js"></script>
        <script src="../../src/kendo.scheduler.view.js"></script>
        <script src="../../src/kendo.scheduler.dayview.js"></script>
        <script src="../../src/kendo.scheduler.agendaview.js"></script>
        <script src="../../src/kendo.scheduler.monthview.js"></script>
        <script src="../../src/kendo.scheduler.recurrence.js"></script>
        <script src="../../src/kendo.scheduler.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Scheduler Resizing</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>

            var div = $("<div>").width(500).height(1000);

            function equalWithRound(value, expected) {
                QUnit.close(value, expected, 2);
            }

            module("resizing", {
                setup: function() {
                    div.appendTo(document.body);
                },
                teardown: function() {
                    div.kendoScheduler("destroy").empty().remove();
                    $("[data-role=window]").kendoWindow("destroy").remove();
                }
            });

            test("day view renders south resize handle for events which end in the current day", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-s").length, 1);
            });

            test("week view renders east resize handle for all day events", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/7 11:00"), isAllDay: true, title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-e").length, 1);
            });

            test("day view renders north resize handle for events which start in the current day", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-n").length, 1);
            });

            test("day view does not render east resize handle", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), isAllDay: true, title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-e").length, 0);
            });

            test("week view does not render resize handles when editable is set to false", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    editable: false,
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), isAllDay: true, title: "" },
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                equal(div.find(".k-resize-e,.k-resize-w,.k-resize-s,.k-resize-n").length, 0);
            });

            test("month view does not render resize handles when editable is set to false", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    editable: false,
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                equal(div.find(".k-resize-e,.k-resize-w").length, 0);
            });

            test("week view does not render resize handles when editable.resize is set to false", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    editable: { resize: false },
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), isAllDay: true, title: "" },
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                equal(div.find(".k-resize-e,.k-resize-w,.k-resize-s,.k-resize-n").length, 0);
            });

            test("month view does not render resize handles when editable.resize is set to false", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    editable: { resize: false },
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                equal(div.find(".k-resize-e,.k-resize-w").length, 0);
            });

            test("day view does not render west resize handle", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), isAllDay: true, title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-w").length, 0);
            });

            test("week view renders west resize handle for all day events", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/7 11:00"), isAllDay: true, title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-w").length, 1);
            });

            test("day view does not render south resize handle for events which don't end in the current day", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/7 11:00"), title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-s").length, 0);
            });

            test("week view does not render east resize handle for all day events which dont end in the current week", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/10 11:00"), isAllDay: true, title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-e").length, 0);
            });

            test("week view does not render west resize handle for all day events which dont start in the current week", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/1 10:00"), end: new Date("2013/6/6 11:00"), isAllDay: true, title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-w").length, 0);
            });

            test("day view does not render north resize handle for events which don't start in the current day", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    dataSource: [
                        { start: new Date("2013/6/5 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                equal(div.find(".k-event > .k-resize-n").length, 0);
            });

            test("dragging and dropping the south resize handle changes the end time of the event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 30);
            });

            test("resize event till the end of the day", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 17:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:30 PM"), end: new Date("2013/6/6 11:00 PM"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.last());

                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
            });

            test("resize event till the last but one slot", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 17:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:30 PM"), end: new Date("2013/6/6 11:00 PM"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(slots.length - 2));

                equal(scheduler.dataSource.at(0).end.getHours(), 23);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 30);
            });

            test("dragging and dropping doesn't change the event time if editable is set to false", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    editable: false,
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
            });

            test("dragging and dropping doesn't change the event time if editable.resize is set to false", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    editable: { resize: false },
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
            });

            test("the south/north resize hint starts from the beginning of the slot that contains the event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:30"), title: "" },
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s").last();

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle);

                drag(scheduler, handle, slots.eq(1).offset());

                equal(div.find(".k-marquee").offset().left, slots.eq(1).offset().left);
            });

            test("the south/north resize hint is as wide as the slot that contains the event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:30"), title: "" },
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s").last();

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle);

                drag(scheduler, handle, slots.eq(1).offset());

                equal(div.find(".k-marquee").outerWidth(), slots.eq(1).outerWidth());
            });

            test("dragging and dropping the south resize handle over the next day changes the end time of the event but stays on the same date", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/3 10:00"), end: new Date("2013/6/3 10:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(1).next());

                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 3);
            });

            test("dragging and dropping the north resize handle changes the start of the event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-n");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 30);
            });

            test("dragging and dropping the north resize handle over the previous day changes the start time of the event but stays on the same date", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/3 10:00"), end: new Date("2013/6/3 11:00"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-n");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(1).prev());

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 30);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
            });

            test("a scheduler event can't be less than half an hour long after resizing via the south resize handle", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 30);
            });

            test("a scheduler event can't be less than half an hour long in week view when the cursor is over the next day", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/3 10:00"), end: new Date("2013/6/3 10:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-n");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(1).prev());

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
            });

            test("a scheduler event can't be less than half an hour long in week view when the cursor is over the previous day", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/2 10:00"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 11:00"), end: new Date("2013/6/2 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td:nth-child(1)");

                dragdrop(scheduler, handle, slots.eq(1).next());

                equal(scheduler.dataSource.at(0).end.getHours(), 11);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 30);
            });

            test("a scheduler event can't be less than half an hour long after resizing via the north resize handle", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-n");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
            });

            test("dragging the south handle is restricted", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 10:00"), end: new Date("2013/6/6 10:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-s");

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle);

                var offset = slots.last().offset();
                drag(scheduler, handle, offset);

                offset.top += slots.last().outerHeight() + 10;

                drag(scheduler, handle, offset);
                dragend(scheduler, handle, offset);

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
            });

            test("dragging the north handle is restricted", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 10:00"),
                    dataSource: [
                        { start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-n");

                var slots = div.find(".k-scheduler-content td");

                dragstart(scheduler, handle);

                var offset = slots.first().offset();
                drag(scheduler, handle, offset);

                offset.top -= 10;

                drag(scheduler, handle, offset);
                dragend(scheduler, handle, offset);

                equal(scheduler.dataSource.at(0).start.getHours(), 10);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
            });

            test("dragging and dropping the east resize handle changes the end time of the event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 11:00"), end: new Date("2013/6/2 11:30"), isAllDay: true, title: "" }
                    ]
                });

                var handle = div.find(".k-resize-e");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 3);
            });

            test("reducing the event length via the east resize handle changes the end time of the event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 11:00"), end: new Date("2013/6/3 11:30"), isAllDay: true, title: "" }
                    ]
                });

                var handle = div.find(".k-resize-e");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragdrop(scheduler, handle, slots.eq(0));

                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 3);
            });

            test("dragging and dropping the west resize handle changes the start of the event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/3 11:00"), end: new Date("2013/6/3 11:30"), isAllDay: true, title: "" }
                    ]
                });

                var handle = div.find(".k-resize-w");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragdrop(scheduler, handle, slots.eq(0));

                equal(scheduler.dataSource.at(0).start.getHours(), 0);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 2);
            });

            test("reducing the event length via the west resize handle changes the end time of the event", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 11:00"), end: new Date("2013/6/3 11:30"), isAllDay: true, title: "" }
                    ]
                });

                var handle = div.find(".k-resize-w");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 0);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
            });

            test("dragging the east resize handle is restricted", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/2 11:00"), end: new Date("2013/6/2 11:30"), isAllDay: true, title: "" }
                    ]
                });

                var handle = div.find(".k-resize-e");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragstart(scheduler, handle);

                var offset = slots.last().offset();
                drag(scheduler, handle, offset);

                offset.left += 100;

                drag(scheduler, handle, offset);

                dragend(scheduler, handle, offset);

                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 8);
            });

            test("dragging the west resize handle is restricted", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/3 11:00"), end: new Date("2013/6/3 11:30"), isAllDay: true, title: "" }
                    ]
                });

                var handle = div.find(".k-resize-w");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragstart(scheduler, handle);

                var offset = slots.first().offset();

                drag(scheduler, handle, offset);

                offset.left -= 100;

                drag(scheduler, handle, offset);

                dragend(scheduler, handle, offset);

                equal(scheduler.dataSource.at(0).start.getHours(), 0);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 2);
            });

            test("a scheduler all day event can't be less than a day long when dragging the east handle", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/3 11:00"), end: new Date("2013/6/3 11:30"), isAllDay: true, title: "" }
                    ]
                });

                var handle = div.find(".k-resize-e");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragdrop(scheduler, handle, slots.eq(0));

                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 4);
            });

            test("a scheduler all day event can't be less than a day long when dragging the west handle", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/3 11:00"), end: new Date("2013/6/3 11:30"), isAllDay: true, title: "" }
                    ]
                });

                var handle = div.find(".k-resize-w");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragdrop(scheduler, handle, slots.eq(3));

                equal(scheduler.dataSource.at(0).start.getHours(), 0);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 3);
            });

            test("dragging the east handle moves the end of the event in month view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/5/26 11:00"), end: new Date("2013/5/27 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-e");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(2));

                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 28);
            });

            test("dragging the east handle moves the end of the event in month view and updates its month", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/5/26 11:00"), end: new Date("2013/5/27 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-e");

                var slots = div.find(".k-scheduler-content td.k-other-month");

                dragdrop(scheduler, handle, slots.last());

                equal(scheduler.dataSource.at(0).end.getHours(), 0);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 6);
                equal(scheduler.dataSource.at(0).end.getMonth(), 6);
            });

            test("dragging the west handle moves the start of the event in month view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/5/26 11:00"), end: new Date("2013/5/27 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-w");

                var slots = div.find(".k-scheduler-content td");

                dragdrop(scheduler, handle, slots.eq(1));

                equal(scheduler.dataSource.at(0).start.getHours(), 0);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 27);
            });

            test("the hint starts from the current slot and ends at event end while dragging the west handle in week view", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["week"],
                    dataSource: [
                        { start: new Date("2013/6/3 11:00"), end: new Date("2013/6/4 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-w");

                var slots = div.find(".k-scheduler-header-all-day td");

                dragstart(scheduler, handle, handle.offset());

                drag(scheduler, handle, slots.eq(0).offset());


                equal(div.find(".k-marquee").offset().left, slots.eq(0).offset().left);

                equalWithRound(div.find(".k-marquee").offset().left + div.find(".k-marquee").outerWidth(), slots.eq(3).offset().left);
            });

            test("dragging the west handle moves the start of the event in month view and updates its month", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/6/6 11:00"), end: new Date("2013/6/7 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-w");

                var slots = div.find(".k-scheduler-content td.k-other-month");

                dragdrop(scheduler, handle, slots.first());

                equal(scheduler.dataSource.at(0).start.getHours(), 0);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 26);
                equal(scheduler.dataSource.at(0).start.getMonth(), 4);
            });

            test("month view doesn't render east resize handle for events which end in the next week", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/6/6 11:00"), end: new Date("2013/6/9 11:30"), title: "" }
                    ]
                });

                equal(div.find(".k-event:first .k-resize-e").length, 0);
            });

            test("month view doesn't render west resize handle for events which start in the previous week", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { start: new Date("2013/6/6 11:00"), end: new Date("2013/6/9 11:30"), title: "" }
                    ]
                });

                equal(div.find(".k-event:last .k-resize-w").length, 0);
            });

            test("dragging the west handle of the ocurrence moves the start of the series if the edit series button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-w:last");

                var slots = div.find(".k-scheduler-content td.k-other-month");

                dragdrop(scheduler, handle, slots.first());

                $(".k-window .k-button:last").click();

                equal(scheduler.dataSource.at(0).start.getHours(), 0);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 26);
                equal(scheduler.dataSource.at(0).start.getMonth(), 4);
            });

            test("dragging the west handle of the ocurrence head shows the edit recurrence dialog", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-w:first");

                var slots = div.find(".k-scheduler-content td.k-other-month");

                dragdrop(scheduler, handle, slots.first());

                equal($(".k-window").length, 1);
            });

            test("dragging the west handle of the ocurrence head moves the start of the series if the edit series button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-w:first");

                var slots = div.find(".k-scheduler-content td.k-other-month");

                dragdrop(scheduler, handle, slots.first());

                $(".k-window .k-button:last").click();

                equal(scheduler.dataSource.at(0).start.getHours(), 0);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 26);
                equal(scheduler.dataSource.at(0).start.getMonth(), 4);
            });

            test("dragging the west handle of the ocurrence head moves the start of the exception if the edit ocurrence button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-w:first");

                var slots = div.find(".k-scheduler-content td.k-other-month");

                dragdrop(scheduler, handle, slots.first());

                $(".k-window .k-button:first").click();

                equal(scheduler.dataSource.at(1).start.getHours(), 0);
                equal(scheduler.dataSource.at(1).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(1).start.getDate(), 26);
                equal(scheduler.dataSource.at(1).start.getMonth(), 4);
            });

            test("dragging the south handle of the ocurrence moves the end time of the series if the edit series button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 11:00"),
                    views: ["week"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/2 11:00"), end: new Date("2013/6/2 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-s:last");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(1));

                $(".k-window .k-button:last").click();


                equal(scheduler.dataSource.at(0).end.getHours(), 12);
                equal(scheduler.dataSource.at(0).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).end.getDate(), 2);
                equal(scheduler.dataSource.at(0).end.getMonth(), 5);
            });

            test("dragging the south handle of the ocurrence moves the end time of the exception if the edit ocurrence button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 11:00"),
                    views: ["week"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/2 11:00"), end: new Date("2013/6/2 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-s:last");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(1));

                $(".k-window .k-button:first").click();


                equal(scheduler.dataSource.at(1).end.getHours(), 12);
                equal(scheduler.dataSource.at(1).end.getMinutes(), 0);
                equal(scheduler.dataSource.at(1).end.getDate(), 3);
                equal(scheduler.dataSource.at(1).end.getMonth(), 5);
            });

            test("dragging the north handle of the ocurrence moves the start time of the series if the edit series button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 11:00"),
                    views: ["week"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/2 11:30"), end: new Date("2013/6/2 12:00"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-n:last");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(0));

                $(".k-window .k-button:last").click();


                equal(scheduler.dataSource.at(0).start.getHours(), 11);
                equal(scheduler.dataSource.at(0).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(0).start.getDate(), 2);
                equal(scheduler.dataSource.at(0).start.getMonth(), 5);
            });

            test("dragging the north handle of the ocurrence moves the start time of the exception if the edit ocurrence button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 11:00"),
                    views: ["week"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/2 11:30"), end: new Date("2013/6/2 12:00"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-n:last");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(0));

                $(".k-window .k-button:first").click();


                equal(scheduler.dataSource.at(1).start.getHours(), 11);
                equal(scheduler.dataSource.at(1).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(1).start.getDate(), 3);
                equal(scheduler.dataSource.at(1).start.getMonth(), 5);
            });

            test("dragging the north handle of the ocurrence updates the recurrenceException field if the edit ocurrence button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    startTime: new Date("2013/6/6 11:00"),
                    views: ["week"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/2 11:30"), end: new Date("2013/6/2 12:00"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-n:last");

                var slots = div.find(".k-scheduler-content td:nth-child(2)");

                dragdrop(scheduler, handle, slots.eq(0));

                $(".k-window .k-button:first").click();

                equal(scheduler.dataSource.at(1).start.getHours(), 11);
                equal(scheduler.dataSource.at(1).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(1).start.getDate(), 3);
                equal(scheduler.dataSource.at(1).start.getMonth(), 5);
                equal(scheduler.dataSource.at(0).recurrenceException, kendo.toString(kendo.timezone.apply(new Date("2013/6/3 11:30"), 0), "yyyyMMddTHHmmssZ") + ";");
            });

            test("dragging the west handle of the ocurrence creates an exception if the edit ocurrence button is clicked", function() {
                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2" }
                    ]
                });

                var handle = div.find(".k-resize-w:last");

                var slots = div.find(".k-scheduler-content td.k-other-month");

                dragdrop(scheduler, handle, slots.first());

                $(".k-window .k-button:first").click();

                equal(scheduler.dataSource.at(1).start.getHours(), 0);
                equal(scheduler.dataSource.at(1).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(1).start.getDate(), 26);
                equal(scheduler.dataSource.at(1).start.getMonth(), 4);
            });

            test("dragging the west handle of the exception changes the start of the exception", function() {
                var recurrenceException = kendo.toString(kendo.timezone.apply(new Date("2013/6/7 11:00"), 0), "yyyyMMddTHHmmssZ") + ";";

                var scheduler = new kendo.ui.Scheduler(div, {
                    date: new Date("2013/6/6"),
                    views: ["month"],
                    dataSource: [
                        { id: 1, start: new Date("2013/6/6 11:00"), end: new Date("2013/6/6 11:30"), title: "", recurrenceRule: "FREQ=DAILY;COUNT=2", recurrenceException: recurrenceException },
                        { id: 2, recurrenceId: 1, start: new Date("2013/6/7 11:00"), end: new Date("2013/6/7 11:30"), title: "" }
                    ]
                });

                var handle = div.find(".k-resize-w:last");

                var slots = div.find(".k-scheduler-content td.k-other-month");

                dragdrop(scheduler, handle, slots.first());

                equal(scheduler.dataSource.at(1).start.getHours(), 0);
                equal(scheduler.dataSource.at(1).start.getMinutes(), 0);
                equal(scheduler.dataSource.at(1).start.getDate(), 26);
                equal(scheduler.dataSource.at(1).start.getMonth(), 4);

                equal(scheduler.dataSource.at(0).recurrenceException, kendo.toString(kendo.timezone.apply(new Date("2013/5/26 00:00"), 0), "yyyyMMddTHHmmssZ") + ";");
            });

            function dragdrop(scheduler, target, to) {
                var offset = to.offset();

                dragstart(scheduler, target);
                drag(scheduler, target, offset);
                dragend(scheduler, target, offset);
            }

            function dragstart(scheduler, target) {
                var draggable = scheduler._resizeDraggable;

                if (!draggable) {
                    return;
                }

                var offset = target.offset();

                draggable.trigger("dragstart", {
                    currentTarget: target,
                    x: { location: offset.left },
                    y: { location: offset.top }
                });
            }

            function drag(scheduler, target, offset) {
                var draggable = scheduler._resizeDraggable;

                if (!draggable) {
                    return;
                }

                draggable.trigger("drag", {
                    currentTarget: target,
                    x: { location: offset.left },
                    y: { location: offset.top }
                });
            }

            function dragend(scheduler, target, offset) {
                var draggable = scheduler._resizeDraggable;

                if (!draggable) {
                    return;
                }

                draggable.trigger("dragend", {
                    currentTarget: target,
                    x: { location: offset.left },
                    y: { location: offset.top }
                });
            }
        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
