<!DOCTYPE html>
<html>
    <head>
        <title>Scheduler Views rendering</title>
        <script src="../jquery-loader.js"></script>
        <script type="text/javascript" src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.scheduler.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">Scheduler Views rendering</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var MultiDayView = kendo.ui.MultiDayView,
                container;

            var MyDayView = MultiDayView.extend({
                init: function(element, options) {
                    var that = this;

                    MultiDayView.fn.init.call(that, element, options);
                },
                render: function() {
                    this._render(this.options.dates);
                }
            });

            function setup(options) {
                return new MyDayView(container, $.extend({ minorTick: 60, majorTick: 120 }, options));
            }

            module("Multi Day View rendering", {
                setup: function() {
                    container = document.createElement("div");
                    document.body.appendChild(container);
                    container = $(container);
                },
                teardown: function() {
                    $(container).remove();
                }
            });

            test("renders times header slots", function() {
                var view = setup();
                view.render();

                ok(container.find(".k-scheduler-times").length);
                equal(view.timesHeader[0], container.find(".k-scheduler-times")[0]);
            });

            test("renders headers for selected dates", function() {
                var view = setup({ dates: [new Date("1/2/2013"), new Date("2/1/2013")], allDaySlot: false });
                view.render();

                ok(view.datesHeader.hasClass("k-scheduler-header"));
                equal(view.datesHeader.find("col").length, 2);
                equal(view.datesHeader.find("th").length, 2);
            });

            test("k-today is render if date is today", function() {
                var view = setup({ dates: [new Date()] });

                view.render();

                equal(view.datesHeader.find("th.k-today").length, 1);
            });

            test("k-today is not render if date is not today", function() {
                var view = setup({ dates: [new Date("1/2/2013")] });

                view.render();

                ok(!view.datesHeader.find("th.k-today").length);
            });

            test("dates are formatted", function() {
                var view = setup({ dates: [new Date("1/26/2013")] });

                view.render();

                equal(view.datesHeader.find("th").text(), "Sat 1/26");
            });

            test("dates are formatted with custom format", function() {
                var view = setup({ headerDateFormat: "d", dates: [new Date("1/26/2013")] });

                view.render();

                equal(view.datesHeader.find("th").text(), "1/26/2013");
            });

            test("title is read from the options", function() {
                var view = setup({ title: "the title" });

                equal(view.title, "the title");
            });

            test("render time slots", function() {
                var view = setup({
                    majorTick: 120,
                    minorTick: 60
                });

                view.render();

                equal(view.times.find("th").length, 25);
                equal(view.times.find("th:first").text(), "00:00");
                equal(view.times.find("th:last").text(), "00:00");
            });

            test("time is show in major time slots", function() {
                var view = setup({
                        startTime: new Date(2000, 0, 1, 10, 0, 0),
                        endTime: new Date(2000, 0, 1, 11, 0, 0),
                        minorTick: 15,
                        majorTick: 30
                    });

                view.render();
                var cells = view.times.find("th");

                equal(cells.first().text(), "10:00");
                equal(cells.eq(1).html(), "&nbsp;");
                equal(cells.eq(2).text(), "10:30");
                equal(cells.eq(3).html(), "&nbsp;");
                equal(cells.eq(4).text(), "11:00");
            });

            test("time slots does not overflow endTime", function() {
                var view = setup({
                        startTime: new Date(2000, 0, 1, 0, 0, 0),
                        endTime: new Date(2000, 0, 1, 23, 59, 0),
                        minorTick: 15
                    });

                view.render();

                equal(view.times.find("tr:not(.k-last) em:not(:empty):last").text(), "22:00");
                equal(view.times.find("tr.k-last").text(), "23:59");
                equal(view.times.find("th").length, 97);
            });

            test("start time is later than end time", function() {
                var view = setup({
                        startTime: new Date(2000, 0, 1, 13, 0, 0),
                        endTime: new Date(2000, 0, 1, 10, 0, 0),
                    });

                view.render();

                equal(view.times.find("tr:not(.k-last) em:not(:empty):last").text(), "08:00");
                equal(view.times.find("tr.k-last").text(), "10:00");
                equal(view.times.find("th").length, 22);
            });

            test("last time slot has k-last class applied", function() {
                 var view = setup({ });

                view.render();

                ok(view.times.find("tr:last").hasClass("k-last"));
            });

            test("render day slots", function() {
                var view = setup({
                    dates: [
                        new Date("1/26/2013"),
                        new Date("1/27/2013")
                    ]
                });

                view.render();

                equal(view.content.find("tr").length, 24);
                equal(view.content.find("col").length, 2);
                equal(view.content.find("td").length, 48);
            });

            test("apply css to day slot", function() {
                var view = setup({
                    dates: [
                        new Date("1/26/2013")
                    ]
                });

                view.render();

                equal(view.content.find("tr.k-middle-row").length, 12);
                equal(view.content.find("tr:not(.k-middle-row)").length, 12);
            });

            test("content is update on multiple render calls", function() {
                var view = setup({
                    dates: [
                        new Date("1/26/2013")
                    ]
                });

                view.render();
                view.render();
                equal(container.find(".k-scheduler-content").length, 1);
                equal(container.find(".k-scheduler-content > table").length, 1);
            });

            test("datesHeader is update on multiple render calls", function() {
                var view = setup({
                    dates: [
                        new Date("1/26/2013")
                    ],
                    allDaySlot: false
                });

                view.render();
                view.render();

                equal(container.find(".k-scheduler-header").length, 1);
                equal(container.find(".k-scheduler-header-wrap > table").length, 1);
            });

            test("destroy clears views html", function() {
                var view = setup({
                    dates: [
                        new Date("1/26/2013")
                    ]
                });

                view.render();
                view.destroy();

                ok(!view.content);
                ok(!view.times);
                ok(!view.timesHeader);
                ok(!view.datesHeader);
            });
/*
            test("view content height is set", function() {
                 container.css("height", 500);

                 var view = setup({
                    dates: [
                        new Date("1/26/2013")
                    ]
                });

                view.render();

                equal(view.content.height(), 500 - (view.datesHeader.height() - view.footer.height()));
            });
*/
            test("content and times heights are equal", function() {
                container.css("height", 500);

                 var view = setup({
                    dates: [
                        new Date("1/26/2013")
                    ]
                });

                view.render();

                equal(view.content.height(), view.times.height());
            });

            test("all day slot is rendered", function() {
                var view = setup({
                    dates: [
                        new Date("1/26/2013")
                    ]
                });

                view.render();

                equal(view.datesHeader.find(".k-scheduler-table").length, 2);
                equal(view.allDayHeader[0], view.datesHeader.find(".k-scheduler-table:last")[0]);
                equal(view.allDayHeader.find("td").length, 1);
            });

            test("all day slot is not rendered if disabled", function() {
                var view = setup({
                    allDaySlot: false,
                    dates: [
                        new Date("1/26/2013")
                    ]
                });

                view.render();

                equal(view.datesHeader.find(".k-scheduler-table").length, 1);
                ok(!view.allDayHeader);
            });

            test("render footer toolbar", function() {
                var view = setup();

                view.render();

                ok(view.footer);
                ok(view.footer.hasClass("k-scheduler-footer"));
            });
/*
            test("toolbat commands", function() {
                var view = setup({
                    commands: ["toggleWorkDay"]
                });

                view.render();
                view.footer.find(".k-scheduler-toggle-day").length);
            });
            */
        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
