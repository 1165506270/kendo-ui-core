<!DOCTYPE html>
<html>
    <head>
        <title>kendo.ui.Slider Tests</title>
        <script src="../../src/jquery.min.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.draganddrop.js"></script>
        <script src="../../src/kendo.slider.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
        <link type="text/css" href="../../styles/kendo.common.css" rel="stylesheet"/>
        <link type="text/css" href="../../styles/kendo.blueopal.css" rel="stylesheet"/>
    </head>
    <body>

        <script type="text/javascript">
            var Slider = kendo.ui.Slider,
                input = {},
                isDefaultPrevent;

            module("Slider/Slider", {
                setup: function () {
                    input = $("<input value='1' />");
                    isDefaultPrevent = false;
                },
                teardown: function() {
                    $(".k-slider").remove();
                }
            });

            function newSlider(options, newInput) {
                return new Slider((newInput || input).appendTo(document.body)[0], options);
            }

            test('slider should decrease value with a small step when down and left arrow keyboard is clicked', function () {
                var downArrow = "40", // down arrow
                    leftArrow = "37", // left arrow
                    slider = newSlider({ value: 5, smallStep: 2 }),
                    dragHandle = slider.wrapper.find(".k-draghandle");

                dragHandle.trigger({ type: "keydown",
                    keyCode: downArrow,
                    preventDefault: function () {
                        isDefaultPrevent = true;
                    }
                });

                ok(isDefaultPrevent);
                equal(3, slider.value());

                slider.value(5);

                dragHandle.trigger({ type: "keydown",
                    keyCode: leftArrow,
                    preventDefault: function () {
                        isDefaultPrevent = true;
                    }
                });

                ok(isDefaultPrevent);
                equal(3, slider.value());

                slider.value(5);
            });

            test('slider should increase value with a small step when down and left arrow keyboard is clicked', function () {
                var upArrow = "38"; // up arrow
                    rightArrow = "39", // right arrow
                    slider = newSlider({ value: 5, smallStep: 2 }),
                    dragHandle = slider.wrapper.find(".k-draghandle");

                dragHandle.trigger({ type: "keydown",
                    keyCode: upArrow,
                    preventDefault: function () {
                        isDefaultPrevent = true;
                    }
                });

                ok(isDefaultPrevent);
                equal(7, slider.value());

                slider.value(5);

                dragHandle.trigger({ type: "keydown",
                    keyCode: rightArrow,
                    preventDefault: function () {
                        isDefaultPrevent = true;
                    }
                });

                ok(isDefaultPrevent);
                equal(7, slider.value());

                slider.value(5);
            });

            test('slider should increase value with a large step when page up keyboard is clicked', function () {
                var end = "33", // page up
                    slider = newSlider({ value: 5, largeStep: 3 }),
                    dragHandle = slider.wrapper.find(".k-draghandle");

                dragHandle.trigger({ type: "keydown",
                    keyCode: end,
                    preventDefault: function () {
                        isDefaultPrevent = true;
                    }
                });

                ok(isDefaultPrevent);
                equal(8, slider.value());

                slider.value(5);
            });

            test('slider should decrease value with a large step when page down keyboard is clicked', function () {
                var home = "34", // page down
                    slider = newSlider({ value: 5, largeStep: 3 }),
                    dragHandle = slider.wrapper.find(".k-draghandle");

                dragHandle.trigger({ type: "keydown",
                    keyCode: home,
                    preventDefault: function () {
                        isDefaultPrevent = true;
                    }
                });

                ok(isDefaultPrevent);
                equal(2, slider.value());

                slider.value(5);
            });

            test('slider should increase value to maximum value when end keyboard is clicked', function () {
                var end = "35", // end
                    slider = newSlider({ value: 5 }),
                    dragHandle = slider.wrapper.find(".k-draghandle");

                dragHandle.trigger({ type: "keydown",
                    keyCode: end,
                    preventDefault: function () {
                        isDefaultPrevent = true;
                    }
                });

                ok(isDefaultPrevent);
                equal(10, slider.value());

                slider.value(5);
            });

            test('slider should increase value to minimum value when home keyboard is clicked', function () {
                var home = "36", // home
                    slider = newSlider({ value: 5 }),
                    dragHandle = slider.wrapper.find(".k-draghandle");

                dragHandle.trigger({ type: "keydown",
                    keyCode: home,
                    preventDefault: function () {
                        isDefaultPrevent = true;
                    }
                });

                ok(isDefaultPrevent);
                equal(0, slider.value());

                slider.value(5);
            });

            test('getValueFromPosition with small step 3 and mouse position 100 should return max value', function () {
                var slider = newSlider({ value: 0, smallStep: 3, style: "width: 156px;" }),
                    mousePosition = 100,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 10);
            });

            test('getValueFromPosition with small step 2 and mouse position 79 should return 8', function () {
                var slider = newSlider({ value: 0, smallStep: 2, style: "width: 156px;" }),
                    mousePosition = 79,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 8);
            });

            test('getValueFromPosition with small step 3 and mouse position 80 should return 9', function () {
                var slider = newSlider({ value: 0, smallStep: 3, style: "width: 156px;" }),
                    mousePosition = 80,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 9);
            });

            test('getValueFromPosition with small step 2 and mouse position 60 should return 3', function () {
                var slider = newSlider({ value: 0, smallStep: 2, style: "width: 156px;" }),
                    mousePosition = 60,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 6);
            });

            test('getValueFromPosition with small step 2 and mouse position 95 should return 10', function () {
                var slider = newSlider({ value: 0, smallStep: 2, style: "width: 156px;" }),
                    mousePosition = 95,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 10);
            });

            test('getValueFromPosition with small step 2 and mouse position 9 should return 0', function () {
                var slider = newSlider({ value: 0, smallStep: 2, style: "width: 156px;" }),
                    mousePosition = 9,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 0);
            });

            test('getValueFromPosition with small step 0.1 mouse position 40 should return 0.4', function () {
                var slider = newSlider({ value: 0, smallStep: 0.1, max: 1, style: "width: 156px;" }),
                    mousePosition = 40,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 0.4);
            });

            test('getValueFromPosition with small step 0.1 mouse position 30 should return 0.3', function () {
                var slider = newSlider({ value: 0, smallStep: 0.1, max: 1, style: "width: 156px;" }),
                    mousePosition = 30,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 0.3);
            });

            test('getValueFromPosition with small step 0.1 mouse position 49 should return 0.5', function () {
                var slider = newSlider({ value: 0, smallStep: 0.1, max: 1, style: "width: 156px;" }),
                    mousePosition = 49,
                    dragableArea = { startPoint: 0, endPoint: slider._maxSelection },
                    value = slider._getValueFromPosition(mousePosition, dragableArea);

                equal(value, 0.5);
            });

            test("slider should get value from the input", function () {
                var slider = newSlider();

                equal(slider.value(), 1);
            });

            test("slider should get step from the input", function () {
                var slider = newSlider({}, $("<input step='2' />"));

                equal(slider.options.smallStep, 2);
            });

            test("slider should get min from the input", function () {
                var slider = newSlider({}, $("<input min='4' />"));

                equal(slider.options.min, 4);
            });

            test("slider should get max from the input", function () {
                var slider = newSlider({}, $("<input max='5' />"));

                equal(slider.options.max, 5);
            });

            test("slider should have default input value", function () {
                var slider = newSlider({}, $("<input />"));

                equal(slider.element.val(), 0);
            });

        </script>

        <h1 id="qunit-header">kendo.ui.Slider Tests</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
