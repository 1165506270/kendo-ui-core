<!DOCTYPE html>
<html>
    <head>
        <title>UI5.Chart Tests</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <link href="../qunit/qunit/qunit.css" type="text/css" rel="stylesheet"/>
        <link href="../../styles/dataviz/kendo.dataviz.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.data.js"></script>
        <script src="../../src/kendo.dataviz.core.js"></script>
        <script src="../../src/kendo.dataviz.chart.js"></script>
        <script src="../../src/kendo.dataviz.sparkline.js"></script>
        <script src="../../src/kendo.dataviz.themes.js"></script>
        <script src="../../src/kendo.dataviz.svg.js"></script>
        <script src="../../src/kendo.dataviz.vml.js"></script>
        <script type="text/javascript">

            var dataviz = kendo.dataviz,
                deepExtend = kendo.deepExtend,
                Sparkline = dataviz.ui.Sparkline;

            (function() {
                var sparkline,
                    plotArea,
                    liveSeries;

                function createSparkline(options) {
                    $("#sparkline").kendoSparkline(options);
                    sparkline = $("#sparkline").data("kendoSparkline");
                    liveSeries = sparkline._plotArea.charts[0].options.series
                }

                function destroySparkline() {
                    var element = $("#sparkline");
                    kendo.destroy(element);
                    element.unbind().empty();
                }

                // ------------------------------------------------------------
                module("Data Binding / Array", {
                    setup: function() {
                        createSparkline([1, 2]);
                    },
                    teardown: destroySparkline
                });

                test("array is used to initialize series data", function() {
                    equal(sparkline.options.seriesDefaults.data.length, 2);
                });

                test("observable array is used to initialize series data", function() {
                    createSparkline(new kendo.data.ObservableArray([1, 2]));
                    equal(sparkline.options.seriesDefaults.data.length, 2);
                });

                test("default series are created", function() {
                    equal(sparkline.options.series.length, 1);
                });

                test("default series are bound to array items", function() {
                    equal(liveSeries[0].data.length, 2);
                });

                test("number is encapsulated in array", function() {
                    createSparkline(1);
                    equal(liveSeries[0].data[0], 1);
                });

                // ------------------------------------------------------------
                module("Data Binding / Data", {
                    setup: function() {
                        createSparkline({
                            data: [1, 2]
                        });
                    },
                    teardown: destroySparkline
                });

                test("default series are created", function() {
                    equal(sparkline.options.series.length, 1);
                });

                test("default series are bound to array items", function() {
                    equal(liveSeries[0].data.length, 2);
                });

                test("default series inherit seriesDefaults options", function() {
                    createSparkline({
                        seriesDefaults: {
                            field: "value"
                        }
                    });

                    equal(sparkline.options.series[0].field, "value");
                });

                test("number is encapsulated in array", function() {
                    createSparkline({
                        data: 1
                    });
                    equal(liveSeries[0].data[0], 1);
                });

                // ------------------------------------------------------------
                module("Data Binding / Data Source / Implicit series", {
                    setup: function() {
                        createSparkline({
                            seriesDefaults: {
                                field: "value"
                            },
                            dataSource: new kendo.data.DataSource({
                                data: [{ value: 1 }, { value: 2 }]
                            })
                        });
                    },
                    teardown: destroySparkline
                });

                test("default series are created", function() {
                    equal(sparkline.options.series.length, 1);
                });

                test("default series are bound to existing data source", function() {
                    equal(sparkline.options.series[0].data.length, 2);
                });

                // ------------------------------------------------------------
                module("Data Binding / Data Source / Explicit series", {
                    setup: function() {
                        createSparkline({
                            dataSource: [{ value: 1 }, { value: 2 }],
                            series: [{
                                field: "value"
                            }]
                        });
                    },
                    teardown: destroySparkline
                });

                test("default series are not created", function() {
                    equal(sparkline.options.series.length, 1);
                });

                test("series are data bound", function() {
                    equal(sparkline.options.series[0].data.length, 2);
                });

                test("series are bound to existing data source", function() {
                    createSparkline({
                        dataSource: new kendo.data.DataSource({
                            data: [{ value: 1 }, { value: 2 }],
                        }),
                        series: [{
                            field: "value"
                        }]
                    });

                    equal(sparkline.options.series[0].data.length, 2);
                });

            })();
        </script>

        <h1 id="qunit-header">kendo.sparkline</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>

        <span id="sparkline"></span>
    </body>
</html>
