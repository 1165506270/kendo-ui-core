<!DOCTYPE html>
<html>
    <head>
        <title>Splitter client API</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.draganddrop.js"></script>
        <script src="../../src/kendo.resizable.js"></script>
        <script src="../../src/kendo.splitter.js"></script>
        <script src="helper.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">Splitter client API</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>

            module("Splitter / ClientSideApi", {
                teardown: function() {
                    if (splitterObject.destroy) {
                        splitterObject.destroy();
                    }
                    
                    splitterObject = null;
                    splitter = null;

                    $('.k-splitter').remove();
                }
            });

            test("toggle(false) toggles pane state", function() {
                createSplitter({
                    panes: [ { collapsible: true }, {} ]
                });

                var pane = splitter.find(".k-pane:first");

                splitterObject.toggle(pane, false);

                ok(pane.data("pane").collapsed);

                createSplitter({
                    panes: [ {}, { collapsible: true } ]
                });

                pane = splitter.find(".k-pane:last")

                splitterObject.toggle(pane, false);

                ok(pane.data("pane").collapsed);
            });

            test("toggle(false) triggers resize", function() {
                var triggered = false;

                createSplitter({
                    panes: [ { collapsible: true }, {} ],
                    resize: function() {
                        triggered = true;
                    }
                });

                splitterObject.toggle(".k-pane:last", false);

                ok(triggered);
            });

            test("toggle(false) converts associated arrow to expand arrow", function() {
                createSplitter({
                    panes: [ { collapsible: true }, {} ]
                });

                splitterObject.toggle(".k-pane:first", false);

                var previousArrow = splitter.find(".k-expand-prev");

                ok(previousArrow.is(".k-expand-prev"));
                ok(previousArrow.is(":not(.k-collapse-prev)"));
            });

            test("toggle(false) disables splitbar resize", function() {
                createSplitter({
                    panes: [ { collapsible: true }, {} ]
                });

                splitterObject.toggle(".k-pane:first", false);

                ok(!splitter.find(".k-splitbar").hasClass("k-splitbar-draggable-horizontal"));
            });

            test("toggle(true) removes splibar hover style", function() {
                createSplitter({
                    panes: [ { collapsible: true, collapsed: true }, {} ]
                });

                splitter.find(".k-splitbar").addClass("k-splitbar-horizontal-hover");

                splitterObject.toggle(".k-pane:first", false);

                ok(!splitter.find(".k-splitbar").hasClass("k-splitbar-horizontal-hover"));
            });

            test("toggle(true) toggles pane state", function() {
                createSplitter({
                    panes: [ { collapsible: true, collapsed: true }, {} ]
                });

                var pane = splitter.find(".k-pane:first");

                splitterObject.toggle(pane, true);

                ok(!pane.data("pane").collapsed);

                createSplitter({
                    panes: [ {}, { collapsible: true, collapsed: true } ]
                });

                pane = splitter.find(".k-pane:last")

                splitterObject.toggle(pane, true);

                ok(!pane.data("pane").collapsed);
            });

            test("toggle(true) triggers resize", function() {
                var triggered = false;

                createSplitter({
                    panes: [ { collapsible: true, collapsed: true }, {} ],
                    resize: function() {
                        triggered = true;
                    }
                });

                splitterObject.toggle(".k-pane:first", true);

                ok(triggered);
            });

            test("toggle(true) converts associated arrow to collapse arrow", function() {
                createSplitter({
                    panes: [ { collapsible: true, collapsed: true }, {} ]
                });

                splitterObject.toggle(".k-pane:first", true);

                var previousArrow = splitter.find(".k-collapse-prev");

                ok(previousArrow.is(".k-collapse-prev"));
                ok(previousArrow.is(":not(.k-expand-prev)"));
            });

            test("toggle(true) enables splitbar resize", function() {
                createSplitter({
                    panes: [ { collapsible: true, collapsed: true }, {} ]
                });

                splitterObject.toggle(".k-pane:first", true);

                ok(splitter.find(".k-splitbar").hasClass("k-splitbar-draggable-horizontal"));
            });

            test("toggle(true) does not add splibar hover style", function() {
                createSplitter({
                    panes: [ { collapsible: true, collapsed: true }, {} ]
                });

                splitterObject.toggle(".k-pane:first", true);

                ok(!splitter.find(".k-splitbar").hasClass("k-splitbar-horizontal-hover"));
            });

            test("toggle() without arguments toggles pane collapsed state", function() {
                createSplitter({
                    panes: [ { collapsible: true, collapsed: true }, {} ]
                });

                splitterObject.toggle(".k-pane:first");
                ok(!splitter.find(".k-pane:first").data("pane").collapsed);

                splitterObject.toggle(".k-pane:first");
                ok(splitter.find(".k-pane:first").data("pane").collapsed);

                splitter.remove();
                createSplitter({
                    panes: [ { collapsible: true }, {} ]
                });

                splitterObject.toggle(".k-pane:first");
                ok(splitter.find(".k-pane:first").data("pane").collapsed);

                splitterObject.toggle(".k-pane:first");
                ok(!splitter.find(".k-pane:first").data("pane").collapsed);
            });

            test("toggle() applies selector context", function() {
                createSplitter({
                    panes: [{ collapsible: true }, {}]
                });

                createSplitter({
                    panes: [{ collapsible: true }, {}]
                });

                splitterObject.toggle(".k-pane:first", false);

                ok(splitter.find(".k-pane:first").data("pane").collapsed);
            });

            test("collapse() calls toggle(false)", function() {
                var args;

                createSplitter({
                    panes: [ { collapsible: true }, {} ]
                });

                splitterObject.toggle = function() {
                    args = arguments;
                };

                splitterObject.collapse(".k-pane:last");

                ok(args);
                equal(args.length, 2);
                equal(args[0], ".k-pane:last");
                equal(args[1], false);
            });

            test("expand() calls toggle(true)", function() {
                var args;

                createSplitter({
                    panes: [ { collapsible: true }, {} ]
                });

                splitterObject.toggle = function() {
                    args = arguments;
                };

                splitterObject.expand(".k-pane:last");

                ok(args);
                equal(args.length, 2);
                equal(args[0], ".k-pane:last");
                equal(args[1], true);
            });

            test("size() gets/sets pane size", function() {
                createSplitter({
                    panes: [ { size: "110px" }, {} ]
                });

                var firstPane = splitter.find(".k-pane:first");

                equal(splitterObject.size(firstPane), "110px");

                splitterObject.size(firstPane, "120px");

                equal(splitterObject.size(firstPane), "120px");
            });

            test("size() applies selector context", function() {
                createSplitter({
                    panes: [ { size: "125px" }, {} ]
                });

                createSplitter({
                    panes: [ { size: "110px" }, {} ]
                });

                equal(splitterObject.size(".k-pane:first"), "110px");
            });

            test("min() gets/sets pane min", function() {
                createSplitter({
                    panes: [ { min: "110px", size: "200px" }, {} ]
                });

                var firstPane = splitter.find(".k-pane:first");

                equal(splitterObject.min(firstPane), "110px");

                splitterObject.min(firstPane, "120px");

                equal(splitterObject.min(firstPane), "120px");
            });

            test("max() gets/sets pane max", function() {
                createSplitter({
                    panes: [ { max: "200px", size: "110px" }, {} ]
                });

                var firstPane = splitter.find(".k-pane:first");

                equal(splitterObject.max(firstPane), "200px");

                splitterObject.max(firstPane, "120px");

                equal(splitterObject.max(firstPane), "120px");
            });

            test("size(value) triggers resize", function() {
                var triggered = false;

                createSplitter({
                    panes: [ { size: "110px" }, {} ]
                });

                splitterObject.bind("resize", function() {
                    triggered = true;
                });

                splitterObject.size(".k-pane:first", "120px");

                ok(triggered);
            });

            test("ajaxRequest() with remote URL", function() {
                createSplitter({
                    panes: [ {}, {} ]
                });

                var url = "http://google.com";

                splitterObject.ajaxRequest(".k-pane:first", url);

                var pane = splitter.find(".k-pane:first"),
                    iframe = pane.find("> iframe");

                equal(iframe.length, 1);
                equal(iframe.attr("src"), url);
                ok(!pane.hasClass("k-scrollable"));
            });

            test("collapsing uncollapsible panes is not permitted", function() {
                createSplitter({
                    panes: [ { collapsible: false }, { collapsible: false }]
                });

                splitterObject.toggle(splitter.find(".k-scrollable:first"), false);

                equal(splitter.find(".k-pane:first").data("pane").collapsed, undefined);
            });

            test("ajaxRequest() applies selector context", function() {
                createSplitter({
                    panes: [ {}, {} ]
                });

                splitterObject.ajaxRequest(".k-pane:first", "http://google.com");

                equal(splitter.find("iframe").length, 1);
            });

            test("append() appends a pane element", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                splitterObject.append();

                equal(splitter.children(".k-pane").length, 3);
            });

            test("append() returns the pane element", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var result = splitterObject.append() || $();

                ok(result.is(splitter.children(".k-pane").last()));
            });

            test("append() appends a pane configuration", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var config = { foo: "bar" };

                splitterObject.append(config);

                var panes = splitterObject.options.panes;

                equal(panes[panes.length - 1], config);
            });

            test("insertBefore() inserts a pane element", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var referencePane = splitter.children(".k-pane").addClass("existing-pane").first();

                splitterObject.insertBefore({}, referencePane);

                equal(splitter.children(".k-pane").length, 3);
                ok(!splitter.children(".k-pane").first().hasClass("existing-pane"));
            });

            test("insertBefore() returns the pane element", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var referencePane = splitter.children(".k-pane").addClass("existing-pane").first();

                var result = splitterObject.insertBefore({}, referencePane) || $();

                ok(result.is(splitter.children(".k-pane").first()));
            });

            test("insertBefore() inserts a pane configuration", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var referencePane = splitter.children(".k-pane").addClass("existing-pane").first(),
                    config = { foo: "bar" };

                splitterObject.insertBefore(config, referencePane);

                equal(splitterObject.options.panes[0], config);
            });

            test("insertAfter() inserts a pane element", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var referencePane = splitter.children(".k-pane").addClass("existing-pane").first();

                splitterObject.insertAfter({}, referencePane);

                equal(splitter.children(".k-pane").length, 3);
                ok(!splitter.children(".k-pane").eq(1).hasClass("existing-pane"));
            });

            test("insertAfter() returns the pane element", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var referencePane = splitter.children(".k-pane").addClass("existing-pane").first();

                var result = splitterObject.insertAfter({}, referencePane) || $();

                ok(result.is(splitter.children(".k-pane").eq(1)));
            });

            test("insertAfter() inserts a pane configuration", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var referencePane = splitter.children(".k-pane").addClass("existing-pane").first(),
                    config = { foo: "bar" };

                splitterObject.insertAfter(config, referencePane);

                equal(splitterObject.options.panes[1], config);
            });

            test("remove() removes a pane element", function() {
                createSplitter({
                    panes: [{}, {}, {}]
                }, 3);

                splitter.children(".k-pane").eq(1).addClass("remaining-pane");

                splitterObject.remove(splitter.children(".k-pane").not(".remaining-pane"));

                equal(splitter.children(".k-pane").length, 1);
                ok(splitter.children(".k-pane").first().hasClass("remaining-pane"));
            });

            test("remove() removes a pane configuration", function() {
                var config = { foo: "bar" };
                
                createSplitter({
                    panes: [{}, config, {}]
                }, 3);

                splitter.children(".k-pane").eq(1).addClass("remaining-pane");

                splitterObject.remove(splitter.children(".k-pane").not(".remaining-pane"));

                var panes = splitterObject.options.panes;
                
                ok(panes[0] && typeof panes[0].foo != "undefined");
            });

            test("remove() returns the splitter object", function() {
                createSplitter({
                    panes: [{}, {}]
                });

                var result = splitterObject.remove(splitter.children(".k-pane").first());

                ok(result && result.options && result.options.name && result.options.name == "Splitter");
            });


        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>