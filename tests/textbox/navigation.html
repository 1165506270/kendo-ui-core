<!DOCTYPE html>
<html>
    <head>
        <title>NumericTextBox Navigation</title>
        <script src="../jquery-loader.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../kendo-test-helpers.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.userevents.js"></script>
        <script src="../../src/kendo.numerictextbox.js"></script>
        <script src="../../src/cultures/kendo.culture.bg-BG.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">NumericTextBox Navigation</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>

            var NumericTextBox = kendo.ui.NumericTextBox,
                keys = kendo.keys,
                input;

            QUnit.config.reorder = false;

            $.fn.pressKey = function(key, eventName, options) {
                if (typeof key === "string") {
                    key = key.charCodeAt(0);
                }

                if ($.isPlainObject(eventName)) {
                    options = eventName;
                    eventName = "keypress";
                }

                return this.trigger($.extend({ type: eventName, keyCode: key, which: key }, options) );
            }

            QUnit.config.testTimeout = 1000;

            module("kendo.ui.NumericTextBox Navigation", {
                setup: function() {
                    input = $("<input />").appendTo(document.body);
                },
                teardown: function() {
                    input.parents(".k-widget").andSelf().remove();
                }
            });

            test("pressing DOWN arrow calls _step()", function() {
                var textbox = new NumericTextBox(input);

                stub(textbox, "_step");
                input.pressKey(kendo.keys.DOWN, "keydown");

                equal(textbox.calls("_step"), 1);
                equal(textbox.args("_step")[0], -1);
            });

            test("pressing UP arrow calls _step()", function() {
                var textbox = new NumericTextBox(input);

                stub(textbox, "_step");
                input.pressKey(kendo.keys.UP, "keydown");

                equal(textbox.calls("_step"), 1);
                equal(textbox.args("_step")[0], 1);
            });

            test("typing digit is allowed", 0, function() {
                var textbox = new NumericTextBox(input);

                input.pressKey("4", {
                    preventDefault: function() {
                        ok(false);
                    }
                });
            });

            test("typing letter is not allowed", 1, function() {
                var textbox = new NumericTextBox(input);

                input.pressKey("a", {
                    preventDefault: function() {
                        ok(true);
                    }
                });
            });

            test("'-' is allowed", 0, function() {
                var textbox = new NumericTextBox(input);

                input.pressKey("-", {
                    preventDefault: function() {
                        ok(false);
                    }
                });
            });

            test("Do not allow '-' if min is bigger than 0", 1, function() {
                var textbox = new NumericTextBox(input, {
                    min: 0
                });

                input.pressKey("-", {
                    preventDefault: function() {
                        ok(true);
                    }
                });
            });

            test("Spacebar is not allowed", 1, function() {
                var textbox = new NumericTextBox(input);

                input.pressKey(" ", {
                    preventDefault: function() {
                        ok(true);
                    }
                });
            });

            test("Non-visual keys are allowed", 0, function() {
                var textbox = new NumericTextBox(input);

                input.val(1).pressKey(0, {
                    preventDefault: function() {
                        ok(false);
                    }
                });
            });

            test("Backspace in Firefox is allowed", 0, function() {
                var textbox = new NumericTextBox(input);

                input.pressKey(kendo.keys.BACKSPACE, {
                    preventDefault: function() {
                        ok(false);
                    }
                });
            });

            test("Allow decimal separator '.'", 0, function() {
                var textbox = new NumericTextBox(input);

                input.pressKey(".", {
                    preventDefault: function() {
                        ok(false);
                    }
                });
            });

            test("Do not allow decimal separator ','", 1, function() {
                var textbox = new NumericTextBox(input);

                input.pressKey(",", {
                    preventDefault: function() {
                        ok(true);
                    }
                });
            });

            test("Allow decimal separator ',' in bg-BG culture", 0, function() {
                var textbox = new NumericTextBox(input);

                kendo.culture("bg-BG");

                input.pressKey(",", {
                    preventDefault: function() {
                        ok(false);
                    }
                });

                kendo.culture("en-US");
            });

            test("Do not allow decimal separator '.' in bg-BG culture", 1, function() {
                var textbox = new NumericTextBox(input);

                kendo.culture("bg-BG");

                input.pressKey(".", {
                    preventDefault: function() {
                        ok(true);
                    }
                });

                kendo.culture("en-US");
            });

            test("Prevent decimal separator if decimals: 0", 1, function() {
                var textbox = new NumericTextBox(input, {
                    decimals: 0
                });

                input.pressKey(".", {
                    preventDefault: function() {
                        ok(true);
                    }
                });
            });

            asyncTest("Avoid exception when group separator is empty string", function() {
                kendo.culture().numberFormat[","] = "";

                var textbox = new NumericTextBox(input);
                textbox._text.focus();

                setTimeout(function() {
                    kendo.culture().numberFormat[","] = ",";
                    start();
                    ok(true);
                });
            });

        </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
