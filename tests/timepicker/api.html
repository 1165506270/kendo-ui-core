<!DOCTYPE html>
<html>
    <head>
        <title>TimePicker API</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit/qunit/qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.popup.js"></script>
        <script src="../../src/kendo.timepicker.js"></script>
        <link rel="stylesheet" href="../qunit/qunit/qunit.css" type="text/css" />
    </head>
    <body>
        <h1 id="qunit-header">TimePicker API</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>

            var TimeView = kendo.TimeView,
                MIDNIGHT = new Date(0, 0, 0, 0, 0, 0),
                div, input;

            module("kendo.ui.TimePicker API", {
                setup: function() {
                    input = $("<input />").appendTo(document.body);
                },
                teardown: function() {
                    input.parents(".k-widget").andSelf().remove();
                }
            });

            test("open TimeView", function() {
                var tv = new TimeView({
                    anchor: input,
                    min: MIDNIGHT,
                    max: MIDNIGHT,
                    interval: 30
                });

                tv.open();

                ok(tv.popup.element.is(":visible"));
            });

            test("close TimeView", function() {
                var tv = new TimeView({
                    anchor: input,
                    min: MIDNIGHT,
                    max: MIDNIGHT,
                    interval: 30
                });

                tv.open();
                tv.close();

                ok(!tv.popup.element.is(":visible"));
            });

            test("select() method should select li", function() {
                var tv = new TimeView({
                    format: "hh:mm tt",
                    min: MIDNIGHT,
                    max: MIDNIGHT,
                    interval: 30
                });

                tv.refresh();

                tv.select("10:00 AM");

                equal(tv.ul.find("li.k-state-selected").length, 1);
                equal(tv.ul.find("li.k-state-selected").html(), "10:00 AM");
            });

            test("click() select li and set date", function() {
                tv = new TimeView({
                    min: MIDNIGHT,
                    max: MIDNIGHT,
                    interval: 30,
                    change: $.noop
                });

                tv.refresh();

                var li = tv.ul.find("li")
                           .filter(function() {
                               return $(this).text() == "2:00 PM";
                           });

                tv.click({currentTarget: li[0]});

                equal(tv.ul.find("li.k-state-selected")[0], li[0]);
            });

            test("current() should persist current selected LI", function() {
                var tv = new TimeView({
                    min: MIDNIGHT,
                    max: MIDNIGHT,
                    interval: 30
                });

                tv.refresh();

                equal(tv.current(), undefined);

                tv.current(tv.ul.find("li:first"));

                equal(tv.ul.find("li.k-state-selected").length, 1);
                equal(tv.current().index(), tv.ul.find("li.k-state-selected").index());
            });

            test("toggle should toggel popup", function() {
                var tv = new TimeView({
                    min: MIDNIGHT,
                    max: MIDNIGHT,
                    interval: 30,
                    format: "hh:mm tt"
                });

                tv.toggle();

                ok(tv.popup.visible());
                ok(tv.ul.children()[0]);
            });

            //timepicker
            test("enable(false) should disable widget", function() {
                var timepicker = input.kendoTimePicker().data("kendoTimePicker");

                timepicker.enable(false);

                ok(input.attr("disabled"), "disabled");
                ok(timepicker._inputWrapper.hasClass("k-state-disabled"));
                ok(!timepicker._inputWrapper.hasClass("k-state-default"));
            });

            test("enable(false) should unbind icon click", function() {
                var timepicker = input.kendoTimePicker().data("kendoTimePicker");

                timepicker.enable(false);

                timepicker.wrapper.find(".k-select").click();

                ok(!timepicker.timeView.popup.visible());
            });

            test("enable(true) should enable widget", function() {
                var timepicker = input.kendoTimePicker().data("kendoTimePicker");

                timepicker.enable(false);
                timepicker.enable();

                ok(!input.attr("disabled"));
                ok(timepicker._inputWrapper.hasClass("k-state-default"));
                ok(!timepicker._inputWrapper.hasClass("k-state-disabled"));
            });

            test("enable(true) should bind icon click", function() {
                var timepicker = input.kendoTimePicker().data("kendoTimePicker");

                timepicker.enable(true);

                timepicker._arrow.click();

                ok(timepicker.timeView.popup.visible());
            });

            test("open() should open timeview", function() {
                var timepicker = input.kendoTimePicker().data("kendoTimePicker");
                timepicker.open();

                ok(timepicker.timeView.popup.visible());
            });

            test("close() should close timeview", function() {
                var timepicker = input.kendoTimePicker().data("kendoTimePicker");
                timepicker.open();
                timepicker.close();

                ok(!timepicker.timeView.popup.visible());
            });

       </script>
        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
