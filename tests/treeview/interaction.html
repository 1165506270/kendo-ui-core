<!DOCTYPE html>
<html>
    <head>
        <title>TreeView interaction</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.treeview.js"></script>
        <link rel="stylesheet" href="../qunit.css" />
        <link rel="stylesheet" href="../../styles/kendo.common.css" />
        <link rel="stylesheet" href="../../styles/kendo.vista.css" />
    </head>
    <body>
        <h1 id="qunit-header">TreeView interaction</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>

        <script>
            var TreeView = kendo.ui.TreeView;

            function createTreeView(data) {
                var rendering = new kendo.ui.TreeView.TreeViewRendering();

                return $("<div class='t-widget t-treeview t-reset'>" + rendering.renderGroup({
                    group: {
                        isFirstLevel: true,
                        isExpanded: true
                    },
                    items: data
                }) + "</div>").appendTo(document.body).kendoTreeView();
            }

            function removeTreeViews() {
                $(".t-treeview").remove();
            }

            module("expand / collapse", {
                teardown: removeTreeViews
            });

            test("trying to expand disabled items does not expand them", function() {
                treeview = createTreeView([
                    { text: "foo", enabled: false, items: [ { text: "bar" } ] }
                ]);

                var item = $(".t-item:first", treeview);

                item.find(".t-plus")
                    .toggleClass("t-plus-disabled", true)
                    .trigger("click");

                equal(item.find(".t-group").css("display"), "none");
            });

            test("clicking plus icon should toggle minus icon and show subgroup", function() {
                treeview = createTreeView([
                    { text: "foo", items: [ { text: "bar" } ] }
                ]);

                var item = $(".t-item:first", treeview);

                item.find(".t-plus")
                    .trigger("click");

                ok(item.find(".t-icon").hasClass("t-minus"));
                equal(item.find(".t-group").css("display"), "block");
            });

            test("clicking minus icon should toggle plus icon and collaspe subgroup", function() {
                treeview = createTreeView([
                    { text: "foo", expanded: true, items: [ { text: "bar" } ] }
                ]);

                var item = $(".t-item:first", treeview);

                item.find(".t-minus")
                    .trigger("click");

                ok(item.find(".t-icon").hasClass("t-plus"));
                equal(item.find(".t-group").css("display"), "none");
            });

            test("double clicking disabled items does not expand them", function() {
                treeview = createTreeView([
                    { text: "foo", disabled: true, items: [ { text: "bar" } ] }
                ]);

                var item = $(".t-item:first", treeview);

                item.find(".t-in.t-state-disabled")
                    .trigger("dblclick");
                
                equal(item.find(".t-group").css("display"), "none");
            });

            module("selection", {
                teardown: removeTreeViews
            });

            test("clicking nodes selects them", function() {
                treeview = createTreeView([
                    { text: "foo" }
                ]);

                var item = $(".t-item:first", treeview).find(".t-in");

                item.trigger("click");

                ok(item.hasClass("t-state-selected"));
            });

            test("clicking disabled nodes does not select them", function() {
                treeview = createTreeView([
                    { text: "foo", enabled: false }
                ]);

                var item = $(".t-item:first", treeview).find(".t-in");

                item.trigger("click");

                ok(!item.hasClass("t-state-selected"));
            });
        </script>

        <div id="qunit-fixture"> </div>
        <ul id="log"></ul>
    </body>
</html>
