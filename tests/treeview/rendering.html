<!DOCTYPE html>
<html>
    <head>
        <title>TreeView Rendering</title>
        <script src="../../src/jquery.js"></script>
        <script src="../qunit.js"></script>
        <script src="../qunit-runner.js"></script>
        <script src="../../src/kendo.core.js"></script>
        <script src="../../src/kendo.treeview.js"></script>
        <link rel="stylesheet" href="../qunit.css" />
    </head>
    <body>
        <h1 id="qunit-header">TreeView Rendering</h1>
        <h2 id="qunit-banner"></h2>
        <div id="qunit-testrunner-toolbar"></div>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests"></ol>
        <script>
            var TreeView = kendo.ui.TreeView;

            module("rendering", {
                teardown: function() {
                    $(".k-treeview").remove();
                }
            });

            function treeviewFromHtml(html) {
                return $(html).appendTo(document.body).kendoTreeView().parent();
            }

            test("basic classes", function() {
                var element = treeviewFromHtml("<ul><li>item</li></ul>");

                ok(element.is("div"));
                ok(element.is(".k-widget.k-treeview"));
                ok(element.find("ul").is(".k-group"));
                ok(element.find("li").is(".k-item"));
            });

            test("first level group sets lines", function() {
                var element = treeviewFromHtml("<ul><li>item<ul><li>subitem</li></ul></li></ul>");

                ok(element.find("ul:first").is(".k-treeview-lines"));
                ok(element.find("ul:last").is(":not(.k-treeview-lines)"));
                ok(element.find("ul:last").is(".k-group"));
            });

            test("collapsed groups", function() {
                var element = treeviewFromHtml("<ul><li data-expanded='false'>item<ul><li>subitem</li></ul></li></ul>");

                equals(element.find("ul:last").css("display"), "none");
            });

            test("node wrappers", function() {
                var element = treeviewFromHtml("<ul><li>item</li></ul>"),
                    outerWrapper = element.find("li"),
                    wrapper = element.find("div:first");

                equals(wrapper.length, 1);
                ok(outerWrapper.hasClass("k-first"));
                ok(outerWrapper.hasClass("k-last"));
                ok(wrapper.hasClass("k-top"));
                equals(wrapper.find("span.k-in").length, 1);
                equals(wrapper.find("span.k-in").text(), "item");
            });

            test("moves arbitrary content in the text wrapper", function() {
                var element = treeviewFromHtml("<ul><li>item<span class='status'></span></li></ul>"),
                    wrapper = element.find("div:first");

                equals(wrapper.find("span.k-in").text(), "item");
                equals(wrapper.find("span.status").length, 1);
                ok(wrapper.find("span.status").parent().hasClass("k-in"));
            });

            test("does not nest wrapper elements", function() {
                var element = treeviewFromHtml("<ul><li><div class='k-bot'><span class='k-in'>text</span></div></li></ul>"),
                    wrapper = element.find("div:first");

                equals(element.find("div.k-bot").length, 1);
                equals(element.find("span.k-in").length, 1);
            });

            test("creates toggle buttons", function() {
                var element = treeviewFromHtml("<ul><li data-expanded='true'>foo<ul><li>bar</li></ul></li></ul>"),
                    wrapper = element.find("div:first");

                equals(wrapper.find("span.k-icon.k-minus").length, 1);
                equals(element.find(".k-group:not(.k-treeview-lines)").length, 1);
            });

            module("group");

            test("renders empty group when there are no items", function() {
                var html = TreeView.renderGroup({
                    items: [],
                    group: {
                        expanded: true
                    }
                });

                equal(html, "<ul class='k-group'></ul>");
            });

            test("renders lines class for first level", function() {
                var html = TreeView.renderGroup({ 
                    items: [],
                    group: {
                        firstLevel: true,
                        expanded: true
                    }
                });

                equal(html, "<ul class='k-group k-treeview-lines'></ul>");
            });

            test("renders hidden group if it is not expanded", function() {
                var html = TreeView.renderGroup({
                    items: [],
                    group: {
                        expanded: false
                    }
                });

                equal(html, "<ul class='k-group' style='display:none'></ul>");
            });

            test("renders items, if any", function() {
                var html = TreeView.renderGroup({ 
                    items: [
                        { text: "foo" }
                    ],
                    group: {
                        firstLevel: true,
                        expanded: true
                    }
                });

                equal($(html).find(".k-item").length, 1);
            });

            module("item");

            test("renders list items with k-item class", function() {
                var $item = $(TreeView.renderItem({
                    item: {}
                }));

                ok($item.is("li.k-item"));
            });

            test("renders list items with k-first class for first item in first-level groups", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        index: 0
                    },
                    group: {
                        firstLevel: true
                    }
                }));

                ok($item.is(".k-first"));
            });

            test("renders list items with k-last class for last item", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        index: 0
                    },
                    group: {
                        length: 1,
                        firstLevel: true
                    }
                }));

                ok($item.is(".k-last"));
            });

            test("renders div elements with k-top class for first item in group", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        index: 0
                    },
                    group: {
                        length: 2
                    }
                }));

                equals($item.find("div.k-top").length, 1);
            });

            test("renders div elements with k-bot class for last item in group", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        index: 1
                    },
                    group: {
                        length: 3
                    }
                }));

                equals($item.find("div.k-mid").length, 1);
            });

            test("renders div elements with k-mid class for items in middle of group", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        index: 1
                    },
                    group: {
                        length: 2
                    }
                }));

                equals($item.find("div.k-bot").length, 1);
            });

            test("does not render k-top class for last items in group", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        index: 0
                    },
                    group: {
                        length: 1
                    }
                }));

                equals($item.find("div.k-top").length, 0);
            });

            test("does not render k-top class for single items in root group", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        index: 0
                    },
                    group: {
                        firstLevel: true,
                        length: 1
                    }
                }));

                equals($item.find("div.k-top").length, 1);
            });

            test("renders of links for items with NavigateUrl", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "text",
                        url: "http://kendoui.com/"
                    }
                }));

                equal($item.find("a[href='http://kendoui.com/']").length, 1);
            });

            test("renders disabled state on disabled items", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "text",
                        enabled: false
                    }
                }));

                equal($item.find(".k-in.k-state-disabled").length, 1);
            });

            test("renders selected state on selected items", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "text",
                        selected: true
                    }
                }));

                equal($item.find(".k-in.k-state-selected").length, 1);
            });

            test("renders collapsed subgroups by default", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "Collapsed",
                        items: [
                            { text: "Should not be visible" }
                        ]
                    }
                }));
                
                equal($item.find(".k-group").css("display"), "none");
            });


            test("renders spriteCssClass", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "text",
                        spriteCssClass: "cssClass1"
                    }
                }));

                equal($item.find('.k-sprite').length, 1);
                ok($item.find('.k-sprite').hasClass('cssClass1'));
            });

            test("renders images", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "text",
                        imageUrl: "foo"
                    }
                }));

                var image = $item.find(".k-image");

                equal(image.length, 1);
                equal(image.attr("src").lastIndexOf("foo"), image.attr("src").length - 3);
            });

            test("renders text", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "foo"
                    }
                }));

                equal($item.text(), "foo");
            });

            test("renders text encoded", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "foo>>"
                    }
                }));

                equal($item.text(), "foo>>");
            });

            test("renders encoded text as html", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "<span class='foo'></span>",
                        encoded: false
                    }
                }));

                equal($item.find(".foo").length, 1);
            });

            test("renders plus icon if item contains items", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "foo",
                        items: [
                            { text: "bar" }
                        ]
                    }
                }));

                equal($item.find(".k-icon.k-plus").length, 1);
            });

            test("renders minus icon if item is expanded", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "foo",
                        expanded: true,
                        items: [
                            { text: "bar" }
                        ]
                    }
                }));

                equal($item.find(".k-icon.k-minus").length, 1);
            });

            test("renders disabled plus icon if item is disabled", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "foo",
                        enabled: false,
                        items: [
                            { text: "bar" }
                        ]
                    }
                }));

                equal($item.find(".k-icon.k-plus-disabled").length, 1);
                equal($item.find(".k-icon.k-plus").length, 0);
            });

            test("renders disabled minus icon if item is disabled and expanded", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "foo",
                        enabled: false,
                        expanded: true,
                        items: [
                            { text: "bar" }
                        ]
                    }
                }));

                equal($item.find(".k-icon.k-minus-disabled").length, 1);
                equal($item.find(".k-icon.k-minus").length, 0);
            });

            test("does not render group, if there are no sub-items", function() {
                var $item = $(TreeView.renderItem({
                    item: {
                        text: "foo"
                    },
                    treeview: {}
                }));

                equal($item.find(".k-group").length, 0);
            });
        </script>

        <div id="qunit-fixture">test markup, will be hidden</div>
        <ul id="log"></ul>
    </body>
</html>
